2025-11-24 15:07:01,391 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:07:01,394 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:01,395 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:01,396 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:01,397 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:01,398 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:01,399 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:01,401 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:07:01,401 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:07:01,401 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:01,404 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:07:01,404 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:07:01,405 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 16.9ms
2025-11-24 15:07:03,873 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/area/1/tree/
2025-11-24 15:07:03,873 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/area/1/tree/ 200 0.6ms
2025-11-24 15:07:03,875 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:07:03,875 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:03,876 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:03,876 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:03,876 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:03,876 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:03,877 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:03,877 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:03,877 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:07:03,878 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:03,879 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:03,880 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:03,881 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:03,882 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:03,883 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:03,883 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:07:03,883 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:07:03,884 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:03,884 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:07:03,885 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 9.8ms
2025-11-24 15:07:07,372 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:07:07,373 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:07,373 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:07,373 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:07,373 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:07,373 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:07,375 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:07,375 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:07,375 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:07:07,376 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:07,377 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:07,377 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:07,378 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:07,379 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:07,380 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:07,381 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:07:07,381 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:07:07,381 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:07,383 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:07:07,383 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:07:07,383 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 11.1ms
2025-11-24 15:07:17,719 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:07:17,719 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:17,719 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:17,720 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:17,720 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:17,720 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:17,721 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:17,721 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:17,721 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:07:17,722 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,724 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,726 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,727 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,729 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,730 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,731 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:17,731 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:17,732 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:07:17,732 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,734 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:07:17,734 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,738 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:07:17,738 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:17,739 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:17,739 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:17,739 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:07:17,739 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:07:17,740 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 21.2ms
2025-11-24 15:07:17,743 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:07:17,743 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:17,743 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:17,744 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:17,744 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:17,744 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:17,745 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:17,746 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:17,746 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:07:17,746 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,748 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,748 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,749 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,750 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,751 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,752 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:17,752 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:17,752 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:07:17,752 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,754 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:07:17,754 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:17,756 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:07:17,756 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:17,756 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:17,756 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:17,756 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:07:17,756 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:07:17,757 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.7ms
2025-11-24 15:07:19,124 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:07:19,124 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:19,124 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:19,125 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:19,125 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:19,125 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:19,126 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:19,127 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:19,127 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:07:19,128 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,129 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,131 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,132 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,133 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,134 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,134 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:19,135 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:19,135 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,136 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,143 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:07:19,144 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:07:19,145 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:07:19,145 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 21.5ms
2025-11-24 15:07:19,145 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:19,145 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:19,146 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:19,146 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:19,146 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:19,147 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:19,147 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:19,147 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:07:19,148 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,149 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,149 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,150 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,151 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,151 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,152 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:07:19,152 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,153 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:07:19,153 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:07:19,154 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.9ms
2025-11-24 15:07:19,156 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:07:19,156 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:19,156 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:19,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:19,157 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:19,157 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:19,158 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:19,158 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:19,158 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:07:19,159 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,160 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,161 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,162 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,163 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,164 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,165 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:19,165 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:19,165 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,166 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,169 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:07:19,169 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:07:19,170 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:07:19,170 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:19,170 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:19,170 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:19,170 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:19,170 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:19,171 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:19,171 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:19,171 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:07:19,172 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.0ms
2025-11-24 15:07:19,172 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,173 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,174 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,174 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,175 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,177 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,178 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:07:19,178 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:19,178 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:07:19,179 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:07:19,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.1ms
2025-11-24 15:07:20,491 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:07:20,492 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:20,492 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:20,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:20,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:20,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:20,493 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:20,493 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:20,494 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:07:20,494 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,495 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,496 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,498 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,499 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,500 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,501 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:20,501 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:20,502 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:07:20,502 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,504 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:07:20,504 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,506 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:07:20,506 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:20,506 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:20,506 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:20,506 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:07:20,507 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:07:20,507 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 16.2ms
2025-11-24 15:07:20,509 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:07:20,510 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:20,510 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:20,511 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:20,511 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:20,511 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:20,512 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:20,513 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:20,513 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:07:20,514 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,515 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,515 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,516 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,517 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,517 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,518 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:20,518 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:20,518 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:07:20,518 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,520 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:07:20,520 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:20,522 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:07:20,522 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:20,522 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:20,522 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:20,522 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:07:20,522 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:07:20,523 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.0ms
2025-11-24 15:07:21,286 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:07:21,287 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:21,287 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:21,287 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:21,287 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:21,287 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:21,289 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:21,289 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:21,289 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:07:21,290 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,291 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,292 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,294 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,295 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,296 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,297 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:21,298 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:21,298 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,300 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,302 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:07:21,302 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:07:21,303 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:07:21,303 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:21,304 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:21,304 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:21,304 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:21,304 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:21,305 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:21,305 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:21,305 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:07:21,306 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,307 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,308 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,308 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,309 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,310 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,311 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:07:21,312 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,313 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:07:21,313 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:07:21,313 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 27.3ms
2025-11-24 15:07:21,314 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.3ms
2025-11-24 15:07:21,316 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:07:21,316 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:21,316 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:21,317 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:21,317 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:21,317 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:21,318 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:21,318 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:21,318 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:07:21,319 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:07:21,319 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,320 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,321 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,322 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,323 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,324 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,324 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:21,325 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:21,325 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,327 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,330 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:07:21,330 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:07:21,331 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:21,332 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:21,332 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:21,332 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:21,332 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:21,333 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:21,333 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:21,334 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:07:21,334 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,335 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,337 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,337 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,339 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,340 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:07:21,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:21,341 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:07:21,341 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:07:21,342 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 26.1ms
2025-11-24 15:07:21,342 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 23.9ms
2025-11-24 15:07:22,842 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:07:22,842 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:22,843 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:22,843 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:22,843 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:22,843 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:22,844 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:22,844 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:22,844 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:07:22,845 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,846 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,848 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,849 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,850 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,852 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,852 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:22,853 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:22,853 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:07:22,853 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,855 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:07:22,855 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,857 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:07:22,857 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:22,857 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:22,857 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:22,857 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:07:22,858 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:07:22,858 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 16.7ms
2025-11-24 15:07:22,860 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:07:22,861 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:22,861 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:22,861 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:22,861 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:22,861 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:22,863 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:22,863 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:22,863 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:07:22,864 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,865 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,866 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,867 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,868 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,868 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,869 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:22,869 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:22,869 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:07:22,869 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,871 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:07:22,871 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:22,872 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:07:22,872 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:22,872 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:22,873 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:22,873 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:07:22,873 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:07:22,873 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.3ms
2025-11-24 15:07:23,230 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:07:23,230 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:23,230 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:23,231 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:23,231 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:23,231 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:23,232 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:23,232 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:23,232 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:07:23,233 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,234 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,236 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,237 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,238 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,239 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,240 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:23,240 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:23,240 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,242 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,244 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:07:23,245 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:07:23,245 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:07:23,246 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:23,246 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:23,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:23,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:23,247 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:23,248 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:23,248 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:23,249 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:07:23,249 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 19.3ms
2025-11-24 15:07:23,250 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,251 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,251 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,252 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,253 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,254 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,254 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:07:23,254 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,255 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:07:23,255 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:07:23,256 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.8ms
2025-11-24 15:07:23,257 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:07:23,258 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:23,258 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:23,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:23,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:23,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:23,260 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:23,260 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:23,260 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:07:23,260 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:07:23,261 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,262 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,263 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,264 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,265 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,266 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,267 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:23,267 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:23,267 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,268 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,271 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:07:23,271 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:07:23,271 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:23,272 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:23,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:23,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:23,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:23,273 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:23,273 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:23,273 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:07:23,273 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,274 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,275 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,275 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,276 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,277 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,278 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:07:23,278 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,279 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:07:23,279 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:07:23,280 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 22.2ms
2025-11-24 15:07:23,280 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 20.0ms
2025-11-24 15:07:23,752 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:07:23,752 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:23,753 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:23,753 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:23,753 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:23,753 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:23,754 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:23,754 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:23,755 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:07:23,755 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,757 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,759 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,760 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,762 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,763 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,764 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:23,765 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:23,765 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:07:23,765 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,768 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:07:23,768 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,770 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:07:23,770 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:23,770 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:23,771 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:23,771 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:07:23,771 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:07:23,772 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 19.5ms
2025-11-24 15:07:23,773 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:07:23,774 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:23,774 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:23,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:23,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:23,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:23,775 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:23,776 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:23,776 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:07:23,776 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,777 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,778 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,779 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,780 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,782 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,783 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:23,783 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:23,783 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:07:23,783 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,785 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:07:23,785 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:23,787 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:07:23,787 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:23,787 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:23,787 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:07:23,788 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:07:23,788 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:07:23,788 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.2ms
2025-11-24 15:07:24,268 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:07:24,268 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:24,268 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:24,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:24,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:24,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:24,270 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:24,270 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:24,270 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:07:24,271 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,272 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,274 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,275 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,276 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,277 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,278 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:24,279 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:24,279 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,282 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,285 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:07:24,285 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:07:24,286 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:07:24,286 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:24,286 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:24,286 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:24,287 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:24,287 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:24,288 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:24,288 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:24,288 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:07:24,288 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 20.8ms
2025-11-24 15:07:24,289 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,290 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,291 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,292 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,292 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,293 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,294 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:07:24,294 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,295 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:07:24,295 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:07:24,296 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.6ms
2025-11-24 15:07:24,298 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:07:24,299 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:24,299 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:24,299 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:24,299 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:24,300 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:24,301 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:24,301 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:24,301 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:07:24,302 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,303 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,304 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,304 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,305 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,306 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,307 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:07:24,307 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:07:24,307 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,309 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,311 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:07:24,311 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:07:24,311 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:07:24,312 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:24,312 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:24,312 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:24,312 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:24,313 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:24,314 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:24,314 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:07:24,314 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:07:24,315 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,316 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,317 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,318 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,319 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,320 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,320 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:07:24,320 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:07:24,321 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:07:24,321 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:07:24,322 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 23.9ms
2025-11-24 15:07:24,323 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.4ms
2025-11-24 15:08:18,292 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'admin', 'assets', 'cdn', 'static', 'backend', 'api', 'www'}
2025-11-24 15:08:29,050 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 15:08:29,050 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-24 15:08:29,053 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 15:08:29,053 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:29,054 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:29,054 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:29,054 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:29,054 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:29,097 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:29,101 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 15:08:29,102 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:29,102 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 15:08:29,106 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,130 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 2, Usuario 1, Tipo: web
2025-11-24 15:08:29,130 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,132 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: 2, Level: 4, Type: tenant_admin)
2025-11-24 15:08:29,133 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,137 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 15:08:29,138 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,139 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,141 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 15:08:29,142 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 8, Rotación: True
2025-11-24 15:08:29,142 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,146 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 15:08:29,146 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 15:08:29,146 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 15:08:29,146 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 8
2025-11-24 15:08:29,147 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-11-24 15:08:29,147 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 94.3ms
2025-11-24 15:08:29,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 15:08:29,151 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.3ms
2025-11-24 15:08:29,153 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 15:08:29,153 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:29,154 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:29,154 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:29,154 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:29,154 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:29,155 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:29,155 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:29,155 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/me/
2025-11-24 15:08:29,156 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,158 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-11-24 15:08:29,158 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-24 15:08:29,158 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 2
2025-11-24 15:08:29,158 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,165 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,170 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,174 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 15:08:29,174 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-24 15:08:29,175 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 21.7ms
2025-11-24 15:08:29,202 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 15:08:29,203 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.6ms
2025-11-24 15:08:29,204 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:08:29,204 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 15:08:29,205 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:29,205 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:29,205 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:29,205 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:29,205 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:29,206 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:29,207 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:29,207 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:08:29,208 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,210 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,212 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,213 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,214 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,215 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,216 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:08:29,216 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:08:29,217 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,218 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,225 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:08:29,225 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:08:29,225 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 21.4ms
2025-11-24 15:08:29,226 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:08:29,227 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:29,227 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:29,227 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:29,227 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:29,228 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:29,229 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:29,229 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:29,229 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:08:29,230 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,231 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,231 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,232 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,233 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,233 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,234 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:08:29,234 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,235 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:08:29,235 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:08:29,236 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 15:08:29,236 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 32.4ms
2025-11-24 15:08:29,236 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:29,237 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:29,237 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:29,237 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:29,237 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:29,238 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:29,238 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:29,238 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 15:08:29,239 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,239 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,240 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,241 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,242 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 15:08:29,242 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 15:08:29,242 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,308 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 15:08:29,308 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 15:08:29,309 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 83.7ms
2025-11-24 15:08:29,311 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 74.8ms
2025-11-24 15:08:29,312 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:08:29,313 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:29,313 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:29,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:29,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:29,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:29,315 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:29,315 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:29,315 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:08:29,316 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:08:29,316 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,317 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,318 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,319 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,320 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,321 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,322 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:08:29,322 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:08:29,322 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,324 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,328 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:08:29,328 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:08:29,328 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 15:08:29,329 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:29,329 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:29,329 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:29,329 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:29,330 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:29,330 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:29,331 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:29,331 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:08:29,332 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:29,332 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:29,332 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:29,332 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:29,332 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:29,333 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:29,333 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:29,334 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 15:08:29,334 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,336 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,337 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,339 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,339 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,340 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:08:29,341 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,342 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:08:29,342 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:08:29,343 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,344 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,345 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,346 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,347 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 15:08:29,347 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 15:08:29,347 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:29,348 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 15:08:29,348 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 15:08:29,349 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 37.0ms
2025-11-24 15:08:29,350 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 34.0ms
2025-11-24 15:08:29,350 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 22.0ms
2025-11-24 15:08:35,832 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:08:35,833 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:35,833 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:35,834 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:35,834 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:35,834 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:35,835 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:35,836 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:35,836 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:08:35,837 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,838 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,839 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,841 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,842 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,844 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,845 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:08:35,845 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:08:35,845 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:08:35,845 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,849 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:08:35,849 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,854 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:08:35,854 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:08:35,854 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:08:35,854 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:08:35,855 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:08:35,855 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:08:35,855 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 23.1ms
2025-11-24 15:08:35,857 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:08:35,858 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:35,858 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:35,858 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:35,858 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:35,859 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:35,860 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:35,860 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:35,861 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:08:35,862 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,863 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,864 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,866 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,868 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,869 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,870 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:08:35,870 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:08:35,871 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:08:35,871 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,873 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:08:35,873 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:35,875 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:08:35,876 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:08:35,876 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:08:35,876 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:08:35,876 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:08:35,876 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:08:35,877 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 19.4ms
2025-11-24 15:08:36,985 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:08:36,986 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:36,986 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:36,987 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:36,987 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:36,987 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:36,988 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:36,989 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:36,989 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:08:36,990 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:36,991 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:36,992 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:36,993 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:36,995 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:36,996 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:36,997 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:08:36,997 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:08:36,997 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:36,999 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,003 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:08:37,003 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:08:37,004 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:08:37,004 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:37,005 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:37,005 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:37,005 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:37,005 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:37,006 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:37,006 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:37,006 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:08:37,006 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 21.1ms
2025-11-24 15:08:37,007 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,008 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,009 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,010 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,010 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,011 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,012 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:08:37,012 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,013 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:08:37,013 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:08:37,014 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.3ms
2025-11-24 15:08:37,016 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:08:37,016 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:37,017 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:37,017 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:37,017 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:37,017 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:37,019 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:37,019 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:37,019 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:08:37,020 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,021 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,022 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,023 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,024 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,024 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,025 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:08:37,025 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:08:37,026 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,027 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,029 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:08:37,029 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:08:37,030 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:08:37,030 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:37,031 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:37,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:37,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:37,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:37,032 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:37,032 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:37,032 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:08:37,033 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,035 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,036 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,036 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,037 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,038 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,039 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:08:37,039 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:37,040 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:08:37,040 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:08:37,041 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 25.0ms
2025-11-24 15:08:37,042 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.7ms
2025-11-24 15:08:38,107 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:08:38,108 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:38,108 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:38,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:38,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:38,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:38,109 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:38,110 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:38,110 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:08:38,110 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,112 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,114 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,115 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,117 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,119 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,120 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:08:38,120 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:08:38,121 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:08:38,121 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,123 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:08:38,123 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,125 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:08:38,125 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:08:38,125 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:08:38,126 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:08:38,126 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:08:38,126 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:08:38,127 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 19.8ms
2025-11-24 15:08:38,129 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:08:38,129 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:38,129 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:38,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:38,130 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:38,130 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:38,131 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:38,131 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:38,131 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:08:38,132 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,133 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,135 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,136 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,137 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,137 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,138 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:08:38,138 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:08:38,139 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:08:38,139 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,140 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:08:38,140 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,142 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:08:38,142 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:08:38,142 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:08:38,142 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:08:38,142 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:08:38,142 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:08:38,143 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.4ms
2025-11-24 15:08:38,906 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:08:38,906 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:38,907 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:38,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:38,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:38,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:38,908 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:38,909 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:38,909 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:08:38,910 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,911 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,912 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,913 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,914 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,915 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,916 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:08:38,916 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:08:38,917 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,919 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,923 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:08:38,923 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:08:38,923 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 17.4ms
2025-11-24 15:08:38,925 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:08:38,926 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:38,926 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:38,926 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:38,926 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:38,926 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:38,927 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:38,927 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:38,927 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:08:38,928 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,929 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,930 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,931 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,932 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,932 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,933 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:08:38,933 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:08:38,933 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,935 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:38,937 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:08:38,938 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:08:38,938 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.2ms
2025-11-24 15:08:39,504 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:08:39,505 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:39,505 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:39,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:39,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:39,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:39,506 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:39,507 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:39,507 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:08:39,507 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,509 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,511 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,513 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,515 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,516 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,517 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:08:39,518 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:08:39,518 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,521 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:08:39,521 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:08:39,522 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 18.0ms
2025-11-24 15:08:39,524 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:08:39,524 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:39,525 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:39,525 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:39,525 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:39,525 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:39,526 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:39,526 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:39,526 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:08:39,527 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,528 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,529 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,530 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,531 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,531 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,532 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:08:39,532 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:08:39,532 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:39,533 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:08:39,533 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:08:39,534 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 10.2ms
2025-11-24 15:08:41,428 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:08:41,429 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:41,429 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:41,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:41,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:41,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:41,430 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:41,431 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:41,431 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:08:41,431 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:41,432 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:41,433 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:41,434 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:41,435 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:41,436 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:41,437 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:08:41,437 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:08:41,438 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:41,441 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:08:41,441 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:08:41,442 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 13.8ms
2025-11-24 15:08:43,436 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:08:43,437 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:43,437 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:43,437 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:43,437 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:43,437 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:43,439 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:43,439 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:43,439 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:08:43,440 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:43,441 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:43,442 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:43,443 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:43,443 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:43,444 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:43,445 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:08:43,445 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:08:43,445 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:43,446 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:08:43,446 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 10.5ms
2025-11-24 15:08:56,104 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:08:56,105 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:08:56,105 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:08:56,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:08:56,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:08:56,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:08:56,108 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:08:56,108 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:08:56,109 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:08:56,109 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:56,110 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:56,112 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:56,113 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:56,114 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:56,115 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:56,116 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:08:56,116 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:08:56,116 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:08:56,121 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:08:56,121 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:08:56,122 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 17.5ms
2025-11-24 15:09:00,938 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:09:00,938 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:09:00,938 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:09:00,938 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:09:00,939 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:09:00,939 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:09:00,940 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:09:00,940 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:09:00,941 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:09:00,941 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:09:00,942 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:09:00,943 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:09:00,944 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:09:00,945 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:09:00,945 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:09:00,946 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:09:00,947 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:09:00,947 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:09:00,947 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:09:00,948 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 10.3ms
2025-11-24 15:10:34,827 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/area/2/tree/
2025-11-24 15:10:34,827 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/area/2/tree/ 200 0.5ms
2025-11-24 15:10:34,830 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:10:34,830 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:10:34,830 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:10:34,830 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:10:34,830 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:10:34,831 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:10:34,842 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:10:34,842 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:10:34,842 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:10:34,843 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:34,851 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:34,853 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:34,853 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:34,854 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:34,855 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:34,856 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:10:34,856 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:10:34,856 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:34,859 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:10:34,859 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:10:34,860 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 30.4ms
2025-11-24 15:10:37,037 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:10:37,038 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:10:37,038 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:10:37,038 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:10:37,039 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:10:37,039 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:10:37,040 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:10:37,040 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:10:37,040 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:10:37,041 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:37,042 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:37,043 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:37,043 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:37,044 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:37,045 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:37,046 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:10:37,047 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:10:37,047 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:10:37,048 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:10:37,049 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 11.2ms
2025-11-24 15:11:12,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:11:12,152 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:11:12,152 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:11:12,152 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:11:12,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:11:12,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:11:12,156 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:11:12,157 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:11:12,157 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:11:12,158 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:12,159 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:12,161 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:12,162 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:12,163 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:12,165 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:12,166 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:11:12,166 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:11:12,166 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:12,170 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:11:12,170 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:11:12,170 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 19.0ms
2025-11-24 15:11:20,573 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:11:20,573 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:11:20,573 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:11:20,574 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:11:20,574 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:11:20,574 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:11:20,575 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:11:20,575 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:11:20,575 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:11:20,576 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:20,577 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:20,578 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:20,579 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:20,580 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:20,580 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:20,581 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:11:20,581 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:11:20,582 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:11:20,583 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:11:20,583 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 10.8ms
2025-11-24 15:12:43,220 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:12:43,220 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:43,220 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:43,220 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:43,221 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:43,221 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:43,233 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:43,234 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:43,234 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:12:43,235 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:43,241 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:43,243 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:43,244 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:43,244 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:43,245 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:43,246 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:12:43,246 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:12:43,246 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:43,249 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:12:43,249 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:12:43,250 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 30.3ms
2025-11-24 15:12:45,186 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:12:45,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:45,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:45,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:45,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:45,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:45,188 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:45,188 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:45,188 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:12:45,189 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:45,190 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:45,190 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:45,191 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:45,192 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:45,193 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:45,194 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:12:45,194 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:12:45,194 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:45,195 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:12:45,195 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 9.8ms
2025-11-24 15:12:47,774 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 15:12:47,775 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.6ms
2025-11-24 15:12:47,777 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:12:47,777 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:47,778 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:47,778 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:47,778 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:47,778 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:47,779 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:47,780 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:47,780 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:12:47,781 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,783 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,785 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,786 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,788 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,790 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,792 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:12:47,792 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:12:47,792 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,794 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,798 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:12:47,798 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:12:47,799 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 21.9ms
2025-11-24 15:12:47,801 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:12:47,801 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:47,802 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:47,802 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:47,802 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:47,802 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:47,804 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:47,804 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:47,804 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:12:47,806 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,807 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,808 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,809 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,810 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,811 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,812 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:12:47,812 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:12:47,813 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,814 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:47,816 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:12:47,816 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:12:47,817 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.1ms
2025-11-24 15:12:48,387 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:12:48,387 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.7ms
2025-11-24 15:12:48,389 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:12:48,389 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.7ms
2025-11-24 15:12:48,390 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:12:48,390 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:48,390 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:48,391 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:48,391 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:48,391 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:48,392 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:48,392 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:48,393 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:12:48,394 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,395 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,396 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,398 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,399 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,400 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,401 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:12:48,401 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:12:48,401 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:12:48,401 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,404 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:12:48,404 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,408 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:12:48,409 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:12:48,409 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:12:48,409 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:12:48,409 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:12:48,409 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:12:48,410 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 20.7ms
2025-11-24 15:12:48,412 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:12:48,412 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:48,412 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:48,413 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:48,413 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:48,413 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:48,414 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:48,414 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:48,414 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:12:48,415 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,416 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,417 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,417 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,418 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,419 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,420 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:12:48,420 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:12:48,420 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:12:48,420 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,422 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:12:48,423 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,425 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:12:48,425 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:12:48,425 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:12:48,425 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:12:48,425 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:12:48,425 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:12:48,426 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.2ms
2025-11-24 15:12:48,879 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:12:48,880 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:12:48,880 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.4ms
2025-11-24 15:12:48,882 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.9ms
2025-11-24 15:12:48,882 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:12:48,883 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:12:48,884 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.9ms
2025-11-24 15:12:48,884 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.8ms
2025-11-24 15:12:48,885 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:12:48,886 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:48,887 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:48,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:48,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:48,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:48,889 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:48,890 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:48,890 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:12:48,891 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,892 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,893 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,894 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,894 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,895 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,896 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:12:48,896 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:12:48,896 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,898 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,904 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:12:48,904 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:12:48,906 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:12:48,906 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:48,906 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:48,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:48,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:48,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:48,908 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:48,908 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:48,908 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:12:48,908 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 23.6ms
2025-11-24 15:12:48,909 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,910 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,911 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,911 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,912 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,912 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,913 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:12:48,913 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,914 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:12:48,914 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:12:48,915 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.8ms
2025-11-24 15:12:48,917 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:12:48,917 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:48,917 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:48,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:48,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:48,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:48,919 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:48,919 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:48,919 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:12:48,920 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,921 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,923 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,924 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,925 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,926 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,927 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:12:48,927 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:12:48,927 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,929 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,931 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:12:48,931 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:12:48,932 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:12:48,933 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:48,933 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:48,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:48,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:48,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:48,934 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:48,934 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:48,934 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:12:48,935 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 17.8ms
2025-11-24 15:12:48,935 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,936 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,937 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,938 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,939 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,940 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,941 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:12:48,941 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:48,942 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:12:48,942 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:12:48,943 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.7ms
2025-11-24 15:12:50,377 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 15:12:50,378 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.8ms
2025-11-24 15:12:50,378 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 15:12:50,379 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.9ms
2025-11-24 15:12:50,380 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:12:50,381 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:50,381 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:50,381 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:50,381 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:50,381 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:50,383 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:50,383 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:50,383 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:12:50,385 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,386 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,388 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,389 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,391 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,392 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,393 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:12:50,393 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:12:50,393 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,398 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:12:50,398 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:12:50,399 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 18.4ms
2025-11-24 15:12:50,400 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:12:50,401 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:50,401 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:50,401 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:50,401 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:50,402 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:50,402 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:50,403 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:50,403 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:12:50,403 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,404 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,405 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,406 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,407 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,408 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,409 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:12:50,410 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:12:50,410 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:50,411 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:12:50,411 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:12:50,411 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 10.7ms
2025-11-24 15:12:53,390 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:12:53,391 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:53,391 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:53,391 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:53,391 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:53,391 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:53,393 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:53,393 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:53,393 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:12:53,394 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:53,395 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:53,396 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:53,396 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:53,397 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:53,398 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:53,399 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:12:53,399 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:12:53,399 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:53,400 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:12:53,400 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:12:53,401 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 10.9ms
2025-11-24 15:12:55,889 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:12:55,890 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:12:55,890 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:12:55,890 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:12:55,890 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:12:55,891 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:12:55,892 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:12:55,892 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:12:55,892 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:12:55,893 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:55,894 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:55,895 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:55,896 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:55,897 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:55,898 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:55,901 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:12:55,901 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:12:55,902 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:12:55,903 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:12:55,903 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 14.0ms
2025-11-24 15:13:33,857 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 15:13:33,858 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 0.6ms
2025-11-24 15:13:33,862 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 15:13:33,862 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:13:33,863 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:13:33,863 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:13:33,863 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:13:33,864 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:13:33,869 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:13:33,871 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 15:13:33,872 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:13:33,872 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/sessions/admin/
2025-11-24 15:13:33,873 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,875 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,877 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,878 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,880 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,882 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,884 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,888 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-24 15:13:33,888 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,893 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 2 sesiones activas recuperadas - Cliente 2
2025-11-24 15:13:33,893 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 2 sesiones activas totales.
2025-11-24 15:13:33,894 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 32.4ms
2025-11-24 15:13:33,897 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 15:13:33,897 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:13:33,899 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:13:33,899 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:13:33,899 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:13:33,899 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:13:33,901 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:13:33,901 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:13:33,902 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/sessions/admin/
2025-11-24 15:13:33,902 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,904 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,905 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,907 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,908 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,909 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,910 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,911 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-24 15:13:33,911 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:33,913 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 2 sesiones activas recuperadas - Cliente 2
2025-11-24 15:13:33,913 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 2 sesiones activas totales.
2025-11-24 15:13:33,914 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 17.4ms
2025-11-24 15:13:34,559 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:13:34,559 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:13:34,559 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:13:34,559 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:13:34,560 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:13:34,560 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:13:34,561 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:13:34,561 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:13:34,561 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:13:34,562 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,563 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,566 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,568 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,569 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,570 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,571 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:13:34,572 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:13:34,572 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,574 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,578 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:13:34,578 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:13:34,579 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 20.7ms
2025-11-24 15:13:34,582 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:13:34,583 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:13:34,583 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:13:34,584 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:13:34,584 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:13:34,584 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:13:34,586 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:13:34,586 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:13:34,586 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:13:34,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,588 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,589 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,591 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:13:34,591 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:13:34,591 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,593 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:34,594 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:13:34,594 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:13:34,595 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.2ms
2025-11-24 15:13:35,169 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:13:35,170 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:13:35,170 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:13:35,170 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:13:35,171 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:13:35,171 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:13:35,172 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:13:35,172 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:13:35,172 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:13:35,173 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,175 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,176 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,177 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,179 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,180 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,181 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:13:35,181 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:13:35,181 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,184 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:13:35,185 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:13:35,185 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 16.0ms
2025-11-24 15:13:35,187 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:13:35,188 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:13:35,188 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:13:35,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:13:35,189 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:13:35,189 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:13:35,190 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:13:35,190 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:13:35,190 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:13:35,191 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,192 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,193 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,193 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,194 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,195 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,196 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:13:35,196 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:13:35,196 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:35,197 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:13:35,197 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:13:35,198 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 10.3ms
2025-11-24 15:13:37,593 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:13:37,593 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:13:37,594 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:13:37,594 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:13:37,594 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:13:37,594 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:13:37,595 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:13:37,595 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:13:37,596 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:13:37,596 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:37,597 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:37,598 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:37,599 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:37,600 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:37,601 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:37,601 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:13:37,602 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:13:37,602 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:37,607 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:13:37,607 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:13:37,608 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 14.8ms
2025-11-24 15:13:40,843 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:13:40,844 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:13:40,844 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:13:40,844 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:13:40,844 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:13:40,844 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:13:40,846 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:13:40,846 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:13:40,846 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:13:40,847 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:40,847 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:40,848 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:40,849 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:40,850 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:40,851 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:40,851 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:13:40,852 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:13:40,852 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:13:40,852 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:13:40,853 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 10.0ms
2025-11-24 15:14:35,119 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 15:14:35,119 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:14:35,120 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:14:35,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:14:35,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:14:35,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:14:35,124 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:14:35,125 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:14:35,125 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 15:14:35,128 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,132 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 2, Usuario 1, Tipo: web
2025-11-24 15:14:35,133 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,136 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: 2, Level: 4, Type: tenant_admin)
2025-11-24 15:14:35,136 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,143 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 15:14:35,143 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,144 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,147 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 15:14:35,148 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 9, Rotación: True
2025-11-24 15:14:35,148 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,151 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 15:14:35,151 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 15:14:35,151 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 15:14:35,152 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 9
2025-11-24 15:14:35,152 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-11-24 15:14:35,152 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 33.4ms
2025-11-24 15:14:35,158 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 15:14:35,158 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:14:35,158 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:14:35,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:14:35,159 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:14:35,159 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:14:35,160 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:14:35,160 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:14:35,160 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/me/
2025-11-24 15:14:35,161 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,163 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-11-24 15:14:35,163 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-24 15:14:35,163 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 2
2025-11-24 15:14:35,163 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,167 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,170 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,175 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 15:14:35,175 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-24 15:14:35,176 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 18.1ms
2025-11-24 15:14:35,190 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 15:14:35,191 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:14:35,191 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:14:35,192 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:14:35,192 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:14:35,192 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:14:35,193 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:14:35,193 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:14:35,194 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 15:14:35,195 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,196 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,197 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,198 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,199 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 15:14:35,199 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 15:14:35,199 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,267 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 15:14:35,267 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 15:14:35,268 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:14:35,269 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:14:35,269 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:14:35,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:14:35,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:14:35,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:14:35,270 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:14:35,271 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:14:35,271 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:14:35,272 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,273 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,274 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,275 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,276 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,277 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,278 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:14:35,278 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:14:35,278 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,279 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:14:35,280 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:14:35,280 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 89.7ms
2025-11-24 15:14:35,281 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 12.6ms
2025-11-24 15:14:35,282 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 15:14:35,283 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:14:35,283 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:14:35,283 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:14:35,284 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:14:35,284 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:14:35,285 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:14:35,285 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:14:35,285 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 15:14:35,286 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,287 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,289 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,290 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,292 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 15:14:35,292 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 15:14:35,292 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,294 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 15:14:35,294 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 15:14:35,295 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:14:35,296 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:14:35,296 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:14:35,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:14:35,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:14:35,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:14:35,297 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:14:35,298 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:14:35,298 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:14:35,298 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.8ms
2025-11-24 15:14:35,299 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,300 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,301 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,301 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,302 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,303 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,304 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:14:35,304 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:14:35,304 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:35,305 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:14:35,305 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:14:35,307 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 11.9ms
2025-11-24 15:14:38,452 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:14:38,452 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:14:38,453 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:14:38,453 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:14:38,453 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:14:38,453 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:14:38,454 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:14:38,454 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:14:38,454 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:14:38,455 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:38,456 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:38,457 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:38,458 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:38,459 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:38,460 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:38,461 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:14:38,461 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:14:38,461 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:38,464 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:14:38,464 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:14:38,465 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 13.3ms
2025-11-24 15:14:40,257 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:14:40,258 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:14:40,258 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:14:40,258 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:14:40,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:14:40,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:14:40,260 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:14:40,260 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:14:40,260 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:14:40,261 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:40,262 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:40,263 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:40,263 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:40,264 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:40,265 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:40,266 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:14:40,266 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:14:40,266 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:14:40,267 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:14:40,267 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 9.9ms
2025-11-24 15:16:16,441 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/1/
2025-11-24 15:16:16,442 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:16:16,442 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 15:16:16,442 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 15:16:16,442 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:16:16,442 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 15:16:16,443 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 15:16:16,443 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:16:16,443 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/1/
2025-11-24 15:16:16,444 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 15:16:16,444 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/1/ 401 2.9ms
2025-11-24 15:19:32,672 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:19:32,672 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:19:32,673 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 15:19:32,673 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 15:19:32,673 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:19:32,673 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 15:19:32,673 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 15:19:32,673 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:19:32,674 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/area/2/tree/
2025-11-24 15:19:32,674 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 15:19:32,675 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 401 3.1ms
2025-11-24 15:19:46,177 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 15:19:46,177 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:19:46,178 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 15:19:46,178 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 15:19:46,178 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:19:46,178 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 15:19:46,178 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 15:19:46,178 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:19:46,179 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 15:19:46,193 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 15:19:46,193 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 15:19:46,193 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 15:19:46,435 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 15:19:46,435 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-24 15:19:46,435 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-24 15:19:46,436 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 15:19:46,439 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 15:19:46,439 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11345, Rotación: False
2025-11-24 15:19:46,439 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11345
2025-11-24 15:19:46,439 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-24 15:19:46,440 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 263.2ms
2025-11-24 15:19:51,823 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:19:51,824 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:19:51,824 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 15:19:51,824 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 15:19:51,824 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:19:51,825 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 15:19:51,825 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 15:19:51,825 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:19:51,825 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/area/2/tree/
2025-11-24 15:19:51,877 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 1.
2025-11-24 15:19:51,878 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 1, area_id: 2
2025-11-24 15:19:51,882 - app.services.menu_service - INFO - No se encontraron menús para el cliente 1, área ID: 2.
2025-11-24 15:19:51,882 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 58.9ms
2025-11-24 15:20:03,614 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:20:03,614 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:20:03,614 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 15:20:03,615 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 15:20:03,615 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:20:03,615 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 15:20:03,615 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 15:20:03,615 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:20:03,615 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/area/1/tree/
2025-11-24 15:20:03,640 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 1.
2025-11-24 15:20:03,640 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 1, area_id: 1
2025-11-24 15:20:03,643 - app.services.menu_service - INFO - No se encontraron menús para el cliente 1, área ID: 1.
2025-11-24 15:20:03,644 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 30.2ms
2025-11-24 15:20:17,966 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:20:17,966 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:20:17,966 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 15:20:17,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 15:20:17,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:20:17,967 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 15:20:17,967 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 15:20:17,967 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:20:17,967 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/area/2/tree/
2025-11-24 15:20:17,982 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 1.
2025-11-24 15:20:17,982 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 1, area_id: 2
2025-11-24 15:20:17,984 - app.services.menu_service - INFO - No se encontraron menús para el cliente 1, área ID: 2.
2025-11-24 15:20:17,985 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 19.1ms
2025-11-24 15:20:27,065 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:20:27,065 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:20:27,065 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:20:27,065 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:20:27,066 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:20:27,066 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:20:27,068 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:20:27,070 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 15:20:27,070 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:20:27,070 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:20:27,071 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:27,078 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:27,080 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:27,081 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:27,082 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:27,082 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:27,083 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:20:27,083 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:20:27,083 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:27,086 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:20:27,086 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:20:27,087 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 22.3ms
2025-11-24 15:20:53,829 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/area/1/tree/
2025-11-24 15:20:53,830 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/area/1/tree/ 200 0.4ms
2025-11-24 15:20:53,832 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:20:53,832 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:20:53,833 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:20:53,833 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:20:53,833 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:20:53,833 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:20:53,834 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:20:53,834 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:20:53,834 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:20:53,835 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:53,836 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:53,837 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:53,838 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:53,838 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:53,839 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:53,840 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:20:53,840 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:20:53,840 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:53,841 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:20:53,841 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 9.6ms
2025-11-24 15:20:56,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/area/2/tree/
2025-11-24 15:20:56,421 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/area/2/tree/ 200 0.5ms
2025-11-24 15:20:56,423 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:20:56,423 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:20:56,423 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:20:56,423 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:20:56,424 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:20:56,424 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:20:56,427 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:20:56,428 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:20:56,428 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:20:56,429 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:56,430 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:56,431 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:56,432 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:56,433 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:56,434 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:56,436 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:20:56,436 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:20:56,436 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:20:56,440 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:20:56,440 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:20:56,441 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 18.2ms
2025-11-24 15:21:34,936 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:21:34,937 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:21:34,937 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:21:34,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:21:34,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:21:34,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:21:34,941 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:21:34,941 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:21:34,942 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:21:34,942 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:21:34,943 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:21:34,945 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:21:34,946 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:21:34,947 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:21:34,948 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:21:34,949 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:21:34,949 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:21:34,949 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:21:34,952 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:21:34,953 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 17.1ms
2025-11-24 15:22:05,770 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:22:05,770 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:22:05,770 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:22:05,770 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:22:05,771 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:22:05,771 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:22:05,773 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:22:05,774 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:22:05,774 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:22:05,774 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:05,775 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:05,777 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:05,778 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:05,779 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:05,779 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:05,780 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:22:05,780 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:22:05,780 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:05,785 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:22:05,785 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:22:05,786 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 16.0ms
2025-11-24 15:22:16,225 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:22:16,226 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:22:16,226 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:22:16,226 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:22:16,226 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:22:16,227 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:22:16,228 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:22:16,228 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:22:16,228 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:22:16,229 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:16,229 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:16,230 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:16,231 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:16,232 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:16,232 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:16,233 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:22:16,233 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:22:16,234 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:22:16,234 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:22:16,235 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 9.9ms
2025-11-24 15:23:53,664 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'admin', 'cdn', 'static', 'backend', 'www', 'assets'}
2025-11-24 15:23:54,260 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:23:54,261 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:23:54,261 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:23:54,261 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:23:54,261 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:23:54,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:23:54,303 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:23:54,307 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 15:23:54,307 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:23:54,307 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:23:54,312 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:54,332 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:54,335 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:54,336 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:54,337 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:54,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:54,340 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:23:54,340 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:23:54,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:54,344 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:23:54,345 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:23:54,345 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 85.2ms
2025-11-24 15:23:55,936 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:23:55,936 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:23:55,936 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:23:55,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:23:55,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:23:55,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:23:55,938 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:23:55,939 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:23:55,939 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:23:55,939 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:55,940 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:55,941 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:55,942 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:55,943 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:55,944 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:55,944 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:23:55,945 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:23:55,945 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:23:55,946 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:23:55,946 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 10.3ms
2025-11-24 15:24:04,210 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 15:24:04,211 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-24 15:24:04,213 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 15:24:04,214 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:24:04,214 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:24:04,214 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:24:04,215 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:24:04,215 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:24:04,216 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:24:04,217 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:24:04,217 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 15:24:04,220 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,223 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 2, Usuario 1, Tipo: web
2025-11-24 15:24:04,223 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,226 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: 2, Level: 4, Type: tenant_admin)
2025-11-24 15:24:04,226 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,232 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 15:24:04,233 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,234 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,237 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 15:24:04,237 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 10, Rotación: True
2025-11-24 15:24:04,237 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,240 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 15:24:04,240 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 15:24:04,241 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 15:24:04,241 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 10
2025-11-24 15:24:04,241 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-11-24 15:24:04,242 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 28.3ms
2025-11-24 15:24:04,248 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 15:24:04,248 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-24 15:24:04,250 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 15:24:04,251 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:24:04,251 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:24:04,251 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:24:04,251 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:24:04,251 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:24:04,253 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:24:04,253 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:24:04,253 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/me/
2025-11-24 15:24:04,254 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,256 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-11-24 15:24:04,256 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-24 15:24:04,256 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 2
2025-11-24 15:24:04,256 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,263 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,267 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,271 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 15:24:04,271 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-24 15:24:04,272 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 21.5ms
2025-11-24 15:24:04,291 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 15:24:04,292 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-24 15:24:04,293 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 15:24:04,294 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 15:24:04,294 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 15:24:04,295 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.7ms
2025-11-24 15:24:04,295 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.7ms
2025-11-24 15:24:04,296 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.7ms
2025-11-24 15:24:04,296 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 15:24:04,298 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:24:04,299 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:24:04,299 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:24:04,299 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:24:04,299 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:24:04,300 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:24:04,300 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:24:04,300 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 15:24:04,301 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,302 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,303 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,304 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,305 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 15:24:04,305 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 15:24:04,305 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,375 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 15:24:04,375 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 15:24:04,377 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:24:04,377 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 80.8ms
2025-11-24 15:24:04,377 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:24:04,378 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:24:04,378 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:24:04,378 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:24:04,378 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:24:04,380 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:24:04,380 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:24:04,380 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:24:04,381 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,382 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,383 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,384 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,384 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,385 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,386 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:24:04,386 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:24:04,386 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,387 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:24:04,387 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:24:04,389 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 12.1ms
2025-11-24 15:24:04,389 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 15:24:04,390 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:24:04,390 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:24:04,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:24:04,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:24:04,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:24:04,391 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:24:04,391 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:24:04,391 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 15:24:04,392 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,393 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,394 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,395 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,396 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 15:24:04,397 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 15:24:04,397 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,398 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 15:24:04,398 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 15:24:04,399 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:24:04,400 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:24:04,400 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:24:04,400 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:24:04,400 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:24:04,400 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:24:04,401 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:24:04,401 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:24:04,401 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:24:04,402 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,403 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,404 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,405 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,406 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,406 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,407 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:24:04,407 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:24:04,407 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:04,408 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:24:04,408 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:24:04,408 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.6ms
2025-11-24 15:24:04,409 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 10.1ms
2025-11-24 15:24:07,956 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:24:07,957 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:24:07,957 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:24:07,957 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:24:07,958 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:24:07,958 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:24:07,959 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:24:07,959 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:24:07,959 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:24:07,960 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:07,961 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:07,961 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:07,962 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:07,963 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:07,964 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:07,965 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:24:07,966 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:24:07,966 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:07,967 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:24:07,967 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:24:07,968 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 11.2ms
2025-11-24 15:24:11,282 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:24:11,283 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:24:11,283 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:24:11,283 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:24:11,283 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:24:11,283 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:24:11,285 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:24:11,285 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:24:11,285 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:24:11,286 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:11,287 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:11,288 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:11,289 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:11,289 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:11,290 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:11,291 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:24:11,291 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:24:11,292 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:24:11,292 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:24:11,293 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 10.7ms
2025-11-24 15:25:34,478 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'www', 'cdn', 'static', 'assets', 'api', 'backend', 'admin'}
2025-11-24 15:25:35,778 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 15:25:35,779 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 15:25:35,783 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 4.5ms
2025-11-24 15:25:35,783 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 4.0ms
2025-11-24 15:25:35,786 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:25:35,786 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:25:35,787 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:25:35,787 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:25:35,787 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:25:35,787 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:25:35,833 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:25:35,837 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 15:25:35,837 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:25:35,837 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:25:35,840 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,862 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,865 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,866 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,868 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,869 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,870 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:25:35,870 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:25:35,870 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,872 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,877 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:25:35,877 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:25:35,878 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 92.0ms
2025-11-24 15:25:35,880 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:25:35,880 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:25:35,880 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:25:35,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:25:35,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:25:35,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:25:35,883 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:25:35,883 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:25:35,883 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:25:35,884 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,885 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,886 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,887 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,888 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,889 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,890 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:25:35,891 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:25:35,891 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,892 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:35,894 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:25:35,894 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:25:35,895 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.4ms
2025-11-24 15:25:36,865 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:25:36,866 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:25:36,866 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:25:36,866 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:25:36,866 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:25:36,867 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:25:36,868 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:25:36,868 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:25:36,868 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:25:36,869 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,870 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,871 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,872 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,874 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,875 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,876 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:25:36,876 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:25:36,877 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,878 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:25:36,878 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:25:36,878 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 13.4ms
2025-11-24 15:25:36,880 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:25:36,881 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:25:36,881 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:25:36,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:25:36,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:25:36,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:25:36,883 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:25:36,883 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:25:36,883 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:25:36,884 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,885 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,886 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,887 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,888 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,889 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,890 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:25:36,890 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:25:36,890 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:36,891 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:25:36,891 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:25:36,891 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 11.3ms
2025-11-24 15:25:38,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:25:38,281 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:25:38,281 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:25:38,281 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:25:38,281 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:25:38,281 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:25:38,282 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:25:38,282 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:25:38,283 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:25:38,283 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:38,284 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:38,286 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:38,287 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:38,288 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:38,289 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:38,290 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:25:38,290 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:25:38,290 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:38,292 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:25:38,292 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:25:38,292 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 12.5ms
2025-11-24 15:25:39,476 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:25:39,477 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:25:39,477 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:25:39,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:25:39,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:25:39,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:25:39,478 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:25:39,479 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:25:39,479 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:25:39,479 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:39,480 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:39,481 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:39,482 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:39,483 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:39,484 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:39,485 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:25:39,485 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:25:39,486 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:25:39,487 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 15:25:39,487 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 11.0ms
2025-11-24 15:26:29,379 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:26:29,380 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:29,380 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:29,380 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:29,380 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:29,381 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:29,384 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:29,384 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:29,384 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:26:29,385 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:29,386 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:29,388 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:29,389 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:29,390 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:29,391 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:29,392 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:26:29,392 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:26:29,392 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:29,393 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:26:29,393 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:26:29,394 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 14.7ms
2025-11-24 15:26:30,941 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'admin', 'cdn', 'static', 'assets', 'www', 'backend', 'api'}
2025-11-24 15:26:30,976 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:26:30,977 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:30,977 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:30,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:30,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:30,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:31,011 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:31,014 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 15:26:31,014 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:31,014 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:26:31,018 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:31,037 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:31,039 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:31,040 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:31,041 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:31,042 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:31,043 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:26:31,043 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:26:31,043 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:31,044 - app.utils.menu_helper - INFO - Árbol de menú construido con 3 items raíz.
2025-11-24 15:26:31,044 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 1 construido con 3 items raíz.
2025-11-24 15:26:31,045 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 68.8ms
2025-11-24 15:26:34,458 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:26:34,459 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:34,459 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:34,459 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:34,460 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:34,460 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:34,461 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:34,461 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:34,461 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:26:34,462 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:34,463 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:34,464 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:34,465 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:34,466 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:34,467 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:34,468 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:26:34,468 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:26:34,468 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:34,469 - app.utils.menu_helper - INFO - Árbol de menú construido con 2 items raíz.
2025-11-24 15:26:34,469 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 2 items raíz.
2025-11-24 15:26:34,470 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 11.8ms
2025-11-24 15:26:35,976 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 15:26:35,976 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:35,976 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:35,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:35,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:35,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:35,978 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:35,978 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:35,978 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 15:26:35,979 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:35,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:35,981 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:35,981 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:35,982 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:35,983 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:35,984 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:26:35,984 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 15:26:35,984 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:35,985 - app.utils.menu_helper - INFO - Árbol de menú construido con 3 items raíz.
2025-11-24 15:26:35,986 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 1 construido con 3 items raíz.
2025-11-24 15:26:35,986 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 10.5ms
2025-11-24 15:26:38,114 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:26:38,114 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:38,114 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:38,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:38,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:38,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:38,117 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:38,117 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:38,117 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:26:38,118 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,119 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,121 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,122 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,124 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,125 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,127 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:26:38,127 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:26:38,127 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,129 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,134 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:26:38,134 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:26:38,135 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 20.8ms
2025-11-24 15:26:38,136 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:26:38,137 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:38,137 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:38,137 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:38,137 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:38,137 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:38,138 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:38,138 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:38,139 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:26:38,139 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,143 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,144 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,145 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,146 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,147 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,148 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:26:38,148 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:26:38,148 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,150 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,151 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:26:38,152 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:26:38,152 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.8ms
2025-11-24 15:26:38,811 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:26:38,812 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:26:38,812 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.0ms
2025-11-24 15:26:38,813 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.2ms
2025-11-24 15:26:38,814 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:26:38,815 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:38,815 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:38,815 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:38,815 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:38,815 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:38,817 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:38,817 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:38,817 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:26:38,818 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,820 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,821 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,822 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,823 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,824 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,825 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:26:38,826 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:26:38,826 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:26:38,826 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,828 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:26:38,828 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,832 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:26:38,832 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:38,832 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:38,832 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:38,832 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:26:38,832 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:26:38,833 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.8ms
2025-11-24 15:26:38,834 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:26:38,835 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:38,835 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:38,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:38,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:38,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:38,836 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:38,836 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:38,837 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:26:38,837 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,838 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,839 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,839 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,840 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,841 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,843 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:26:38,843 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:26:38,843 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:26:38,843 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,845 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:26:38,845 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:38,846 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:26:38,846 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:38,846 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:38,847 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:38,847 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:26:38,847 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:26:38,847 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.0ms
2025-11-24 15:26:39,360 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:26:39,361 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:26:39,361 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.4ms
2025-11-24 15:26:39,362 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.3ms
2025-11-24 15:26:39,364 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:26:39,364 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:26:39,365 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.8ms
2025-11-24 15:26:39,366 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.5ms
2025-11-24 15:26:39,366 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:26:39,368 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:39,368 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:39,369 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:39,369 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:39,369 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:39,370 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:39,370 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:39,371 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:26:39,371 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:26:39,372 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,373 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,374 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,375 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,376 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,377 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,378 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:26:39,378 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:26:39,378 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,381 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,386 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:26:39,387 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:26:39,387 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:39,387 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:39,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:39,388 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:39,388 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:39,389 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:39,389 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:39,389 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:26:39,390 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,391 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,392 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,393 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,394 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,395 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,396 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:26:39,396 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,397 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:26:39,397 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:26:39,398 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 31.3ms
2025-11-24 15:26:39,398 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 27.5ms
2025-11-24 15:26:39,400 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:26:39,401 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:26:39,401 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:39,401 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:39,401 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:39,402 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:39,402 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:39,403 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:39,403 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:39,403 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:26:39,404 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,405 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,406 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,406 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,407 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,408 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,409 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:26:39,409 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:26:39,410 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,411 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,413 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:26:39,413 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:26:39,414 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:39,414 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:39,414 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:39,414 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:39,414 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:39,415 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:39,416 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:39,416 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:26:39,416 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,417 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,418 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,418 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,419 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,420 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,421 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:26:39,421 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:39,422 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:26:39,422 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:26:39,423 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 22.5ms
2025-11-24 15:26:39,423 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 22.2ms
2025-11-24 15:26:40,719 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:26:40,720 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:40,720 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:40,720 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:40,720 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:40,720 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:40,721 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:40,722 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:40,722 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:26:40,723 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,724 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,725 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,726 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,728 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,729 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,730 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:26:40,731 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:26:40,731 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:26:40,731 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,733 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:26:40,733 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,735 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:26:40,735 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:40,735 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:40,735 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:40,736 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:26:40,736 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:26:40,737 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.4ms
2025-11-24 15:26:40,738 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:26:40,739 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:40,739 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:40,739 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:40,739 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:40,739 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:40,740 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:40,741 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:40,741 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:26:40,741 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,743 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,744 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,745 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,747 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,747 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,748 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:26:40,748 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:26:40,748 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:26:40,749 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,750 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:26:40,750 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:40,752 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:26:40,752 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:40,752 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:40,752 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:40,752 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:26:40,752 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:26:40,753 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.6ms
2025-11-24 15:26:41,698 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:26:41,699 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:41,700 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:41,700 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:41,700 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:41,700 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:41,701 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:41,702 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:41,702 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:26:41,703 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,704 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,705 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,706 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,708 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,709 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,710 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:26:41,710 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:26:41,710 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,713 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,715 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:26:41,715 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:26:41,716 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 17.1ms
2025-11-24 15:26:41,717 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:26:41,718 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:41,718 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:41,718 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:41,718 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:41,718 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:41,719 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:41,720 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:41,720 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:26:41,720 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,721 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,722 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,723 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,724 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,724 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,725 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:26:41,726 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:26:41,726 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,728 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:41,730 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:26:41,730 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:26:41,731 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.4ms
2025-11-24 15:26:42,285 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:26:42,285 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:42,285 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:42,285 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:42,286 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:42,286 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:42,287 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:42,287 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:42,287 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:26:42,287 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,289 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,290 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,291 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,292 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,294 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,295 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:26:42,296 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:26:42,296 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:26:42,296 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,298 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:26:42,298 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,300 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:26:42,300 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:42,301 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:42,301 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:42,301 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:26:42,301 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:26:42,302 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.1ms
2025-11-24 15:26:42,304 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:26:42,304 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:42,304 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:42,304 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:42,305 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:42,305 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:42,306 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:42,306 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:42,306 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:26:42,307 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,308 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,309 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,309 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,310 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,311 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,312 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:26:42,313 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:26:42,313 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:26:42,313 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,315 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:26:42,315 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:42,317 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:26:42,317 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:42,317 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:42,317 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:26:42,317 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:26:42,317 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:26:42,318 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.6ms
2025-11-24 15:26:43,545 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:26:43,546 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:43,546 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:43,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:43,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:43,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:43,548 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:43,548 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:43,548 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:26:43,549 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,551 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,552 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,553 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,554 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,555 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,557 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:26:43,557 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:26:43,557 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,559 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,561 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:26:43,561 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:26:43,562 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:26:43,562 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:43,563 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:43,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:43,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:43,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:43,564 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:43,565 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:43,565 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:26:43,566 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,567 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,568 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,568 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,569 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,570 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,571 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:26:43,571 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,572 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:26:43,572 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:26:43,572 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 27.0ms
2025-11-24 15:26:43,573 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.3ms
2025-11-24 15:26:43,574 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:26:43,575 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:43,576 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:43,576 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:43,576 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:43,576 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:43,577 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:43,577 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:43,577 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:26:43,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:26:43,578 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,580 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,582 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,583 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,583 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,584 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:26:43,584 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:26:43,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,588 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:26:43,588 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:26:43,589 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:26:43,589 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:26:43,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:26:43,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:26:43,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:26:43,590 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:26:43,590 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:26:43,591 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:26:43,591 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,592 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,593 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,594 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,594 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,595 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,597 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:26:43,597 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:26:43,598 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:26:43,598 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:26:43,599 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.0ms
2025-11-24 15:26:43,599 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 21.8ms
2025-11-24 15:27:00,181 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 15:27:00,182 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 0.8ms
2025-11-24 15:27:00,183 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 15:27:00,184 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 0.6ms
2025-11-24 15:27:00,185 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 15:27:00,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:00,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:00,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:00,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:00,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:00,188 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:00,188 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:00,189 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/sessions/admin/
2025-11-24 15:27:00,190 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,191 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,192 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,194 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,195 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,197 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,198 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,200 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-24 15:27:00,200 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,204 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 2 sesiones activas recuperadas - Cliente 2
2025-11-24 15:27:00,205 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 2 sesiones activas totales.
2025-11-24 15:27:00,205 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 19.7ms
2025-11-24 15:27:00,208 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 15:27:00,208 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:00,209 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:00,209 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:00,209 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:00,209 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:00,210 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:00,210 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:00,211 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/sessions/admin/
2025-11-24 15:27:00,211 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,212 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,214 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,215 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,216 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,217 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,218 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,219 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-24 15:27:00,219 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,221 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 2 sesiones activas recuperadas - Cliente 2
2025-11-24 15:27:00,221 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 2 sesiones activas totales.
2025-11-24 15:27:00,221 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 13.8ms
2025-11-24 15:27:00,853 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:27:00,854 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:00,854 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:00,854 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:00,855 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:00,855 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:00,856 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:00,856 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:00,856 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:27:00,857 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,859 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,860 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,862 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,863 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,864 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,866 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:27:00,866 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:27:00,866 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,867 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:27:00,867 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:27:00,868 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 14.7ms
2025-11-24 15:27:00,870 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:27:00,870 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:00,871 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:00,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:00,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:00,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:00,872 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:00,872 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:00,873 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:27:00,873 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,874 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,875 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,876 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,877 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,878 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,879 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:27:00,879 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:27:00,879 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:00,880 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:27:00,881 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:27:00,881 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 11.4ms
2025-11-24 15:27:01,859 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:27:01,859 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:01,860 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:01,860 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:01,860 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:01,860 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:01,861 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:01,861 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:01,862 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:27:01,862 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,864 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,865 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,867 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,868 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,869 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,871 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:27:01,871 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:27:01,871 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,873 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,875 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:27:01,876 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:27:01,876 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 17.8ms
2025-11-24 15:27:01,878 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:27:01,879 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:01,879 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:01,879 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:01,879 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:01,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:01,881 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:01,881 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:01,882 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:27:01,883 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,884 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,885 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,886 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,888 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,888 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,890 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:27:01,890 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:27:01,890 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,892 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:01,894 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:27:01,894 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:27:01,895 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 17.1ms
2025-11-24 15:27:03,338 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:27:03,339 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:03,339 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:03,339 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:03,339 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:03,339 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:03,341 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:03,341 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:03,341 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:27:03,342 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,344 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,345 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,346 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,349 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,350 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,352 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:27:03,352 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:27:03,352 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:27:03,352 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,354 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:27:03,354 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,356 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:27:03,357 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:27:03,357 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:27:03,357 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:27:03,357 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:27:03,357 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:27:03,358 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 19.5ms
2025-11-24 15:27:03,359 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:27:03,360 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:03,360 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:03,360 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:03,360 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:03,361 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:03,362 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:03,362 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:03,362 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:27:03,363 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,364 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,366 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,367 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,368 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,369 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,370 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:27:03,370 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:27:03,370 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:27:03,370 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,372 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:27:03,372 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:03,374 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:27:03,374 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:27:03,374 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:27:03,375 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:27:03,375 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:27:03,375 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:27:03,375 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.9ms
2025-11-24 15:27:06,451 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:27:06,452 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:06,452 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:06,452 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:06,453 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:06,453 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:06,454 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:06,454 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:06,454 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:27:06,455 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,456 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,457 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,458 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,459 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,460 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,462 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:27:06,462 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:27:06,463 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,465 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,468 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:27:06,469 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:27:06,470 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:27:06,471 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 19.3ms
2025-11-24 15:27:06,471 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:06,471 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:06,471 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:06,472 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:06,472 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:06,473 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:06,473 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:06,473 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:27:06,474 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,476 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,477 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,477 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,478 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,479 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,480 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:27:06,480 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,481 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:27:06,481 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:27:06,483 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.7ms
2025-11-24 15:27:06,483 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:27:06,484 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:06,484 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:06,484 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:06,485 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:06,485 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:06,486 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:06,486 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:06,486 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:27:06,488 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,489 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,490 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,491 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,492 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,492 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,493 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:27:06,493 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:27:06,494 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,495 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,497 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:27:06,498 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:27:06,498 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:27:06,499 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:06,499 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:06,499 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:06,499 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:06,500 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:06,501 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:06,501 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:06,501 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:27:06,502 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,503 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,504 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,505 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,506 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,507 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,507 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:27:06,507 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:06,508 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:27:06,508 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:27:06,509 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 25.8ms
2025-11-24 15:27:06,510 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.6ms
2025-11-24 15:27:40,772 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:27:40,772 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:40,773 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:40,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:40,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:40,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:40,776 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:40,777 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:40,777 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:27:40,778 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,780 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,782 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,784 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,786 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,787 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,788 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:27:40,788 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:27:40,788 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:27:40,789 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,791 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:27:40,791 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,796 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:27:40,796 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:27:40,796 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:27:40,797 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:27:40,797 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:27:40,797 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:27:40,798 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 26.0ms
2025-11-24 15:27:40,800 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:27:40,801 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:40,801 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:40,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:40,802 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:40,802 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:40,803 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:40,803 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:40,803 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:27:40,804 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,806 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,808 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,809 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,810 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,811 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,812 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:27:40,812 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:27:40,812 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:27:40,812 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,814 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:27:40,815 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:40,818 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:27:40,818 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:27:40,818 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:27:40,818 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:27:40,818 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:27:40,819 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:27:40,820 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 19.4ms
2025-11-24 15:27:43,209 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:27:43,210 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:43,210 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:43,210 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:43,210 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:43,210 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:43,212 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:43,212 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:43,212 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:27:43,213 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,213 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,215 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,216 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,218 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,220 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,222 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:27:43,222 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:27:43,222 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,225 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,231 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:27:43,232 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:27:43,233 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:27:43,233 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 23.7ms
2025-11-24 15:27:43,233 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:43,234 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:43,234 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:43,234 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:43,234 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:43,236 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:43,236 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:43,236 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:27:43,238 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,239 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,240 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,241 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,241 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,242 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,243 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:27:43,243 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,244 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:27:43,244 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:27:43,246 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.7ms
2025-11-24 15:27:43,246 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:27:43,247 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:43,247 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:43,247 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:43,247 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:43,247 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:43,248 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:43,248 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:43,248 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:27:43,249 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,250 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,251 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,252 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,254 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,255 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,256 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:27:43,256 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:27:43,256 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,258 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,260 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:27:43,260 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:27:43,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:27:43,261 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:27:43,262 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:27:43,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:27:43,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:27:43,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:27:43,263 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:27:43,263 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:27:43,263 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:27:43,264 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,265 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,266 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,266 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,267 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,268 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,269 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:27:43,269 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:27:43,271 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:27:43,271 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:27:43,271 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 25.5ms
2025-11-24 15:27:43,273 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.9ms
2025-11-24 15:28:59,643 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'admin', 'assets', 'www', 'static', 'backend', 'cdn'}
2025-11-24 15:29:02,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:29:02,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:29:02,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:29:02,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:29:02,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:29:02,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:29:02,616 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:29:02,619 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 15:29:02,620 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:29:02,620 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:29:02,624 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,644 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,647 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,648 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,649 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,650 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,651 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:29:02,651 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:29:02,651 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:29:02,652 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,654 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:29:02,654 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,659 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:29:02,659 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:29:02,659 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:29:02,659 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:29:02,659 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:29:02,660 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:29:02,661 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 83.1ms
2025-11-24 15:29:02,663 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:29:02,664 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:29:02,664 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:29:02,664 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:29:02,665 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:29:02,665 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:29:02,666 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:29:02,666 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:29:02,666 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:29:02,667 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,668 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,669 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,669 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,670 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,671 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,672 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:29:02,672 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:29:02,672 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:29:02,672 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,674 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:29:02,674 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:02,676 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:29:02,676 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:29:02,676 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:29:02,676 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:29:02,676 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:29:02,676 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:29:02,677 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.8ms
2025-11-24 15:29:05,972 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'assets', 'www', 'admin', 'cdn', 'backend', 'static'}
2025-11-24 15:29:08,913 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:29:08,914 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:29:08,914 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:29:08,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:29:08,915 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:29:08,915 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:29:08,940 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:29:08,943 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 15:29:08,943 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:29:08,943 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:29:08,948 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,956 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,958 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,959 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,960 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,960 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,961 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:29:08,962 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:29:08,962 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,964 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,972 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:29:08,973 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:29:08,974 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:29:08,974 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:29:08,974 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:29:08,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:29:08,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:29:08,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:29:08,976 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:29:08,976 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:29:08,976 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:29:08,977 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,977 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,978 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,979 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,981 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,981 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:29:08,981 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,982 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:29:08,982 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:29:08,983 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 70.2ms
2025-11-24 15:29:08,985 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.3ms
2025-11-24 15:29:08,987 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:29:08,987 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:29:08,988 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:29:08,988 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:29:08,988 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:29:08,988 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:29:08,989 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:29:08,989 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:29:08,990 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:29:08,990 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,991 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,992 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,993 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,994 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,994 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,995 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:29:08,995 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:29:08,996 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:08,997 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:09,000 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:29:09,000 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:29:09,002 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:29:09,003 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:29:09,003 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:29:09,003 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:29:09,003 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:29:09,003 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:29:09,004 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:29:09,005 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:29:09,005 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:29:09,006 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:09,006 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:09,007 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:09,008 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:09,009 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:09,010 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:09,010 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:29:09,011 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:29:09,011 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:29:09,012 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:29:09,012 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 25.3ms
2025-11-24 15:29:09,013 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.3ms
2025-11-24 15:30:51,870 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:30:51,871 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:30:51,871 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:30:51,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:30:51,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:30:51,872 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:30:51,886 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:30:51,886 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:30:51,886 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:30:51,887 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,894 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,896 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,897 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,898 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,899 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,900 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:30:51,900 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:30:51,901 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:30:51,901 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,903 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:30:51,903 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,906 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:30:51,906 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:30:51,906 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:30:51,907 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:30:51,907 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:30:51,907 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:30:51,907 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 37.2ms
2025-11-24 15:30:51,909 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:30:51,910 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:30:51,910 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:30:51,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:30:51,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:30:51,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:30:51,911 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:30:51,911 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:30:51,911 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:30:51,912 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,913 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,914 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,915 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,916 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,918 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,919 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:30:51,919 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:30:51,919 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:30:51,919 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,921 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:30:51,921 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:51,922 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:30:51,922 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:30:51,922 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:30:51,922 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:30:51,923 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:30:51,923 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:30:51,923 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.2ms
2025-11-24 15:30:52,622 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:30:52,623 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:30:52,623 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:30:52,623 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:30:52,624 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:30:52,624 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:30:52,625 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:30:52,625 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:30:52,626 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:30:52,626 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:30:52,627 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,628 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,630 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,631 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,632 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,633 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,635 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:30:52,635 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:30:52,635 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,638 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,644 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:30:52,644 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:30:52,645 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:30:52,645 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:30:52,645 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:30:52,645 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:30:52,646 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:30:52,646 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:30:52,646 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:30:52,647 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:30:52,647 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,648 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,649 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,650 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,651 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,652 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,653 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:30:52,653 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,654 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:30:52,654 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:30:52,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 32.6ms
2025-11-24 15:30:52,656 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 29.5ms
2025-11-24 15:30:52,657 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:30:52,658 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:30:52,658 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:30:52,658 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:30:52,658 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:30:52,658 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:30:52,659 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:30:52,659 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:30:52,660 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:30:52,660 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:30:52,661 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,662 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,662 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,663 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,664 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,665 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,666 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:30:52,666 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:30:52,666 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,668 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,671 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:30:52,671 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:30:52,672 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:30:52,672 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:30:52,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:30:52,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:30:52,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:30:52,673 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:30:52,673 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:30:52,673 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:30:52,674 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,675 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,676 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,677 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,678 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,678 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,679 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:30:52,679 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:30:52,680 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:30:52,680 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:30:52,681 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 23.3ms
2025-11-24 15:30:52,681 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 21.5ms
2025-11-24 15:31:07,696 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:31:07,698 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.3ms
2025-11-24 15:31:07,699 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:31:07,700 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.8ms
2025-11-24 15:31:07,702 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:31:07,702 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:31:07,703 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:31:07,703 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:31:07,703 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:31:07,703 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:31:07,705 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:31:07,705 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:31:07,705 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:31:07,706 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,708 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,709 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,709 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,710 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,711 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,712 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:31:07,713 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:31:07,713 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:31:07,713 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,716 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:31:07,716 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,719 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:31:07,719 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:31:07,719 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:31:07,719 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:31:07,719 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:31:07,719 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:31:07,720 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:31:07,721 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:31:07,721 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:31:07,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:31:07,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:31:07,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:31:07,722 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:31:07,722 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:31:07,723 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:31:07,723 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 21.5ms
2025-11-24 15:31:07,724 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,725 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,727 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,728 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,735 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,737 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,738 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:31:07,738 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:31:07,738 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:31:07,739 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,741 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:31:07,741 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:07,743 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:31:07,744 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:31:07,744 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:31:07,744 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:31:07,744 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:31:07,744 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:31:07,746 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 25.9ms
2025-11-24 15:31:12,057 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:31:12,057 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.6ms
2025-11-24 15:31:12,059 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:31:12,060 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.3ms
2025-11-24 15:31:12,060 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:31:12,061 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:31:12,062 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:31:12,063 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:31:12,063 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:31:12,063 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:31:12,063 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:31:12,067 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:31:12,068 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:31:12,071 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:31:12,072 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 11.3ms
2025-11-24 15:31:12,073 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,075 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,077 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,079 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,080 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,081 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,082 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:31:12,082 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:31:12,083 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,085 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,089 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:31:12,089 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:31:12,090 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:31:12,092 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:31:12,093 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 3.0ms
2025-11-24 15:31:12,094 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:31:12,094 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:31:12,094 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:31:12,094 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:31:12,094 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:31:12,095 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:31:12,096 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:31:12,096 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:31:12,097 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,098 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,099 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,100 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,101 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,102 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,104 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:31:12,104 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,105 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:31:12,105 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:31:12,106 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 45.0ms
2025-11-24 15:31:12,107 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:31:12,108 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 15.2ms
2025-11-24 15:31:12,108 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:31:12,108 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:31:12,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:31:12,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:31:12,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:31:12,110 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:31:12,110 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:31:12,110 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:31:12,111 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,112 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,113 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,114 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,115 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,116 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,117 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:31:12,117 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:31:12,117 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,119 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,122 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:31:12,122 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:31:12,123 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:31:12,124 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:31:12,124 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:31:12,124 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:31:12,125 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:31:12,125 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:31:12,126 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:31:12,126 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:31:12,126 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:31:12,127 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 19.4ms
2025-11-24 15:31:12,127 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,128 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,129 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,130 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,131 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,131 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,132 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:31:12,132 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:12,133 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:31:12,133 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:31:12,135 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.7ms
2025-11-24 15:31:17,820 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:31:17,821 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.1ms
2025-11-24 15:31:17,822 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:31:17,823 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.8ms
2025-11-24 15:31:17,827 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:31:17,828 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:31:17,828 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:31:17,828 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:31:17,828 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:31:17,828 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:31:17,830 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:31:17,830 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:31:17,830 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:31:17,831 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,832 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,833 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,834 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,835 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,836 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,837 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:31:17,837 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:31:17,838 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:31:17,838 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,840 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:31:17,841 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,843 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:31:17,844 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:31:17,844 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:31:17,844 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:31:17,844 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:31:17,844 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:31:17,845 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:31:17,845 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:31:17,846 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:31:17,846 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:31:17,846 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:31:17,846 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:31:17,847 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:31:17,847 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:31:17,847 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:31:17,848 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,849 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,850 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,851 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,852 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,853 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,853 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:31:17,854 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:31:17,854 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:31:17,854 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,856 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:31:17,856 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:17,858 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:31:17,859 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:31:17,859 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:31:17,859 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:31:17,859 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:31:17,860 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:31:17,860 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 33.5ms
2025-11-24 15:31:17,861 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 16.2ms
2025-11-24 15:31:23,562 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:31:23,563 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.8ms
2025-11-24 15:31:23,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:31:23,566 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.0ms
2025-11-24 15:31:23,566 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:31:23,567 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:31:23,568 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.5ms
2025-11-24 15:31:23,568 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.4ms
2025-11-24 15:31:23,570 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:31:23,571 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:31:23,572 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:31:23,572 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:31:23,572 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:31:23,572 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:31:23,574 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:31:23,574 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:31:23,575 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:31:23,576 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,577 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,579 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,582 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,583 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,585 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:31:23,585 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:31:23,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,589 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:31:23,590 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:31:23,591 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:31:23,591 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:31:23,592 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:31:23,592 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:31:23,592 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:31:23,592 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:31:23,592 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:31:23,593 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:31:23,594 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:31:23,594 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:31:23,594 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:31:23,594 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:31:23,595 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:31:23,595 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:31:23,595 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:31:23,596 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:31:23,597 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:31:23,597 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:31:23,598 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,599 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,600 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,601 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,602 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,603 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,604 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:31:23,604 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,604 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:31:23,605 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:31:23,605 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,606 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,607 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,607 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,608 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,609 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,609 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:31:23,609 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,610 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:31:23,611 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:31:23,611 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:31:23,611 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 41.0ms
2025-11-24 15:31:23,612 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:31:23,612 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:31:23,612 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:31:23,612 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:31:23,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:31:23,614 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:31:23,614 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:31:23,614 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:31:23,615 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,616 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,617 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,618 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,619 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,620 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,620 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:31:23,620 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:31:23,621 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,622 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:31:23,625 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:31:23,625 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:31:23,626 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 34.7ms
2025-11-24 15:31:23,626 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 34.8ms
2025-11-24 15:31:23,628 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.7ms
2025-11-24 15:32:05,524 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:32:05,525 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.6ms
2025-11-24 15:32:05,528 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:32:05,529 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.8ms
2025-11-24 15:32:05,531 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:32:05,531 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:32:05,532 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:32:05,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:32:05,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:32:05,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:32:05,538 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:32:05,539 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:32:05,539 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:32:05,540 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,541 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,544 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,546 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,547 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,549 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,550 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:32:05,551 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:32:05,551 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:32:05,552 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,557 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:32:05,558 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,563 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:32:05,563 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:32:05,563 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:32:05,563 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:32:05,563 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:32:05,564 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:32:05,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:32:05,565 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 34.6ms
2025-11-24 15:32:05,566 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:32:05,566 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:32:05,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:32:05,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:32:05,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:32:05,569 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:32:05,569 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:32:05,570 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:32:05,571 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,573 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,574 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,575 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,577 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,578 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,578 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:32:05,579 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:32:05,579 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:32:05,579 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,581 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:32:05,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:05,582 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:32:05,583 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:32:05,583 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:32:05,583 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:32:05,583 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:32:05,583 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:32:05,585 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 20.0ms
2025-11-24 15:32:13,208 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:32:13,208 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.6ms
2025-11-24 15:32:13,211 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:32:13,211 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:32:13,212 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.4ms
2025-11-24 15:32:13,213 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:32:13,213 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.7ms
2025-11-24 15:32:13,215 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.3ms
2025-11-24 15:32:13,215 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:32:13,217 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:32:13,217 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:32:13,217 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:32:13,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:32:13,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:32:13,219 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:32:13,220 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:32:13,220 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:32:13,222 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,223 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,225 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,226 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,227 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,229 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,230 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:32:13,230 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:32:13,230 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,233 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,240 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:32:13,241 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:32:13,243 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:32:13,243 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:32:13,244 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:32:13,245 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 29.7ms
2025-11-24 15:32:13,246 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:32:13,246 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:32:13,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:32:13,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:32:13,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:32:13,247 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:32:13,248 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:32:13,248 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:32:13,248 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:32:13,248 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:32:13,248 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:32:13,249 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:32:13,249 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:32:13,250 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:32:13,250 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:32:13,250 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:32:13,250 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:32:13,250 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:32:13,251 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:32:13,251 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:32:13,251 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:32:13,252 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:32:13,252 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:32:13,252 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:32:13,254 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,255 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,256 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,257 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,258 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,259 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,260 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:32:13,261 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,262 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:32:13,262 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:32:13,264 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,265 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,265 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,266 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,267 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,268 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,269 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:32:13,269 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:32:13,269 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,271 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,273 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:32:13,273 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:32:13,274 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,275 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,276 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,277 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,278 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,279 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,280 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:32:13,280 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:32:13,280 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:32:13,281 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:32:13,282 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 39.4ms
2025-11-24 15:32:13,282 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 38.8ms
2025-11-24 15:32:13,283 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 38.5ms
2025-11-24 15:34:31,527 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:34:31,528 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:34:31,528 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 15:34:31,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-24 15:34:31,529 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:34:31,529 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-24 15:34:31,529 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 15:34:31,529 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:34:31,529 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-24 15:34:31,530 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 401 2.8ms
2025-11-24 15:34:31,585 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-24 15:34:31,585 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:34:31,585 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 15:34:31,585 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-24 15:34:31,586 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:34:31,586 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-24 15:34:31,586 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 15:34:31,586 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:34:31,586 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/favicon.ico
2025-11-24 15:34:31,587 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico 404 2.8ms
2025-11-24 15:39:32,625 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'admin', 'backend', 'www', 'cdn', 'assets', 'static'}
2025-11-24 15:41:11,254 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:41:11,255 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:41:11,258 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 3.7ms
2025-11-24 15:41:11,258 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.8ms
2025-11-24 15:41:11,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:41:11,262 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:11,262 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:11,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:11,263 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:11,263 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:11,313 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:11,315 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 15:41:11,316 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:11,316 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:41:11,316 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:41:11,319 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 15:41:11,319 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:11,320 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:11,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:11,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:11,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:11,321 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:11,321 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:11,321 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:41:11,322 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 15:41:11,322 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 401 61.1ms
2025-11-24 15:41:11,323 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 401 6.9ms
2025-11-24 15:41:11,327 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 15:41:11,327 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-24 15:41:11,329 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 15:41:11,329 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:11,329 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:11,330 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:11,330 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:11,330 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:11,331 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:11,331 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:11,331 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 15:41:11,333 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:11,355 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 2, Usuario 1, Tipo: web
2025-11-24 15:41:11,356 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:11,358 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: 2, Level: 4, Type: tenant_admin)
2025-11-24 15:41:11,358 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:11,363 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 15:41:11,363 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:11,364 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:11,367 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 15:41:11,368 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 11, Rotación: True
2025-11-24 15:41:11,368 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:11,373 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 15:41:11,373 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 15:41:11,374 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 15:41:11,374 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11
2025-11-24 15:41:11,374 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-11-24 15:41:11,375 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 45.9ms
2025-11-24 15:41:12,834 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'cdn', 'www', 'assets', 'api', 'static', 'admin', 'backend'}
2025-11-24 15:41:12,875 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:41:12,875 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:41:12,877 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.4ms
2025-11-24 15:41:12,877 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.2ms
2025-11-24 15:41:12,880 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:41:12,880 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:12,880 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:12,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:12,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:12,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:12,909 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:12,913 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 15:41:12,913 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:12,913 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:41:12,916 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,925 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,926 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,927 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,928 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,928 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,930 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:41:12,930 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:41:12,930 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:41:12,930 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,932 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:41:12,932 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,935 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:41:12,935 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:12,936 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:12,936 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:12,936 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:41:12,936 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:41:12,937 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:41:12,937 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:12,937 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:12,938 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:12,938 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:12,938 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:12,939 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:12,939 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:12,939 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:41:12,940 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,941 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,942 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,942 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,943 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,944 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,944 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:41:12,945 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:41:12,945 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:41:12,945 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,946 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:41:12,946 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:12,948 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:41:12,948 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:12,948 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:12,948 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:12,948 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:41:12,948 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:41:12,949 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 69.1ms
2025-11-24 15:41:12,950 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 12.8ms
2025-11-24 15:41:13,567 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:41:13,568 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.7ms
2025-11-24 15:41:13,570 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:41:13,572 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.5ms
2025-11-24 15:41:13,572 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:41:13,573 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:41:13,574 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:41:13,574 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.4ms
2025-11-24 15:41:13,575 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:13,575 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:13,575 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:13,575 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:13,575 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:13,577 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:13,577 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:13,577 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:41:13,578 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,580 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,583 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,584 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,586 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:41:13,586 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:41:13,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,589 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,598 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:13,598 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:13,598 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:13,598 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:41:13,599 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:41:13,599 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:41:13,600 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 25.9ms
2025-11-24 15:41:13,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:41:13,602 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:13,602 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:13,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:13,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:13,603 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:13,604 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:13,604 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:13,605 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:41:13,606 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,607 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,608 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,609 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,610 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,611 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,612 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:41:13,612 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,613 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:41:13,613 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:41:13,614 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 41.0ms
2025-11-24 15:41:13,615 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:41:13,615 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:41:13,616 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 15.5ms
2025-11-24 15:41:13,616 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:13,616 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:13,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:13,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:13,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:13,618 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:13,618 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:13,618 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:41:13,619 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:13,619 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:13,619 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:13,619 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:13,619 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:13,620 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:13,621 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:13,621 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:41:13,622 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,623 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,624 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,625 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,627 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,628 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,629 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:41:13,629 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,629 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:41:13,630 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:41:13,630 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,631 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,632 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,633 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,634 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,635 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,635 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:41:13,636 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:41:13,636 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,638 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:13,642 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:13,642 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:13,642 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:13,642 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:41:13,642 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:41:13,642 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:41:13,644 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 29.0ms
2025-11-24 15:41:13,644 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 29.0ms
2025-11-24 15:41:18,735 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:41:18,736 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:18,736 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:18,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:18,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:18,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:18,738 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:18,738 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:18,739 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:41:18,739 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,740 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,741 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,742 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,744 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,745 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,746 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:41:18,747 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:41:18,747 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:41:18,747 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,749 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:41:18,749 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,751 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:41:18,751 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:18,751 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:18,752 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:18,752 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:41:18,752 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:41:18,752 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.0ms
2025-11-24 15:41:18,754 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:41:18,754 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:18,755 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:18,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:18,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:18,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:18,756 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:18,757 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:18,757 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:41:18,758 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,759 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,760 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,761 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,762 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,763 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,764 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:41:18,764 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:41:18,764 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:41:18,765 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,766 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:41:18,766 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:18,768 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:41:18,768 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:18,768 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:18,768 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:18,768 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:41:18,769 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:41:18,769 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.0ms
2025-11-24 15:41:19,764 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:41:19,764 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:19,765 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:19,765 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:19,765 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:19,765 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:19,766 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:19,766 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:19,766 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:41:19,767 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,768 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,769 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,770 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,771 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,772 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,774 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:41:19,774 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:41:19,774 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,776 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,779 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:19,780 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:19,780 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:19,780 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:41:19,780 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:41:19,781 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:41:19,782 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:41:19,782 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 18.5ms
2025-11-24 15:41:19,783 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:19,783 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:19,783 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:19,783 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:19,783 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:19,784 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:19,784 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:19,784 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:41:19,785 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,787 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,787 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,788 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,789 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,790 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,790 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:41:19,790 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,791 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:41:19,791 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:41:19,793 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.0ms
2025-11-24 15:41:19,793 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:41:19,794 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:19,795 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:19,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:19,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:19,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:19,796 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:19,797 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:19,797 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:41:19,797 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,798 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,799 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,800 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,800 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,801 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,802 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:41:19,802 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:41:19,802 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,804 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,806 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:19,806 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:19,806 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:19,806 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:41:19,806 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:41:19,807 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:41:19,808 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:41:19,808 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:19,808 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:19,809 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:19,809 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:19,809 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:19,810 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:19,811 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:19,811 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:41:19,812 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,813 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,814 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,814 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,815 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,816 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,817 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:41:19,817 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:19,817 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:41:19,818 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:41:19,818 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.7ms
2025-11-24 15:41:19,819 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.3ms
2025-11-24 15:41:25,339 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:41:25,339 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:25,340 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:25,340 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:25,340 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:25,340 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:25,341 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:25,342 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:25,342 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:41:25,343 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,344 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,345 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,347 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,348 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,350 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,351 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:41:25,352 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:41:25,352 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:41:25,352 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,354 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:41:25,354 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,356 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:41:25,356 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:25,356 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:25,356 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:25,357 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:41:25,357 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:41:25,358 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.8ms
2025-11-24 15:41:25,360 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:41:25,360 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:25,360 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:25,360 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:25,360 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:25,361 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:25,362 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:25,362 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:25,362 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:41:25,363 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,364 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,366 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,367 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,368 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,369 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,370 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:41:25,370 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:41:25,371 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:41:25,371 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,372 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:41:25,372 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,374 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:41:25,374 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:25,374 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:25,374 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:41:25,375 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:41:25,375 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:41:25,375 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.8ms
2025-11-24 15:41:25,949 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 15:41:25,950 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.7ms
2025-11-24 15:41:25,951 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 15:41:25,952 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.5ms
2025-11-24 15:41:25,953 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:41:25,953 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:25,953 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:25,954 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:25,954 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:25,954 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:25,955 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:25,955 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:25,956 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:41:25,957 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,958 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,960 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,961 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,962 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,963 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,965 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:41:25,965 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:41:25,965 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,969 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,974 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:41:25,974 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:41:25,975 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 21.9ms
2025-11-24 15:41:25,977 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:41:25,977 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:25,977 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:25,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:25,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:25,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:25,979 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:25,979 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:25,979 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:41:25,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,981 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,982 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,983 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,984 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,985 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,986 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:41:25,987 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:41:25,987 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,989 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:25,991 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:41:25,991 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:41:25,991 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 14.7ms
2025-11-24 15:41:26,902 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 15:41:26,902 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.6ms
2025-11-24 15:41:26,904 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:41:26,905 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:26,905 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:26,905 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:26,905 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:26,905 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:26,907 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:26,907 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:26,907 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:41:26,908 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,910 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,911 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,912 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,913 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,915 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,916 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:41:26,916 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:41:26,917 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,918 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:41:26,919 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:41:26,919 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 15.0ms
2025-11-24 15:41:26,921 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:41:26,922 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:26,922 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:26,922 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:26,922 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:26,922 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:26,923 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:26,924 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:26,924 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:41:26,925 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,925 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,926 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,927 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,928 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,928 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,929 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:41:26,929 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:41:26,930 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:26,930 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:41:26,930 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:41:26,931 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 9.7ms
2025-11-24 15:41:27,455 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 15:41:27,456 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 0.8ms
2025-11-24 15:41:27,456 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 15:41:27,458 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 1.4ms
2025-11-24 15:41:27,459 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 15:41:27,459 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:27,460 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:27,460 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:27,460 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:27,460 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:27,461 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:27,462 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:27,462 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/sessions/admin/
2025-11-24 15:41:27,463 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,464 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,466 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,467 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,468 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,469 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,471 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,472 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-24 15:41:27,473 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,476 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 2 sesiones activas recuperadas - Cliente 2
2025-11-24 15:41:27,476 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 2 sesiones activas totales.
2025-11-24 15:41:27,477 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 18.2ms
2025-11-24 15:41:27,479 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 15:41:27,479 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:41:27,479 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:41:27,480 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:41:27,480 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:41:27,480 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:41:27,481 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:41:27,481 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:41:27,481 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/sessions/admin/
2025-11-24 15:41:27,482 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,483 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,484 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,485 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,486 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,487 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,488 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,489 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-24 15:41:27,490 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:41:27,491 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 2 sesiones activas recuperadas - Cliente 2
2025-11-24 15:41:27,492 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 2 sesiones activas totales.
2025-11-24 15:41:27,492 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 13.4ms
2025-11-24 15:42:41,450 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:42:41,450 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:41,450 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:41,451 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:41,451 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:41,451 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:41,468 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:41,468 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:41,469 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:42:41,470 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,480 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,482 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,483 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,484 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,485 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,487 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:42:41,487 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:42:41,488 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,491 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,496 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:42:41,496 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:42:41,497 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 47.1ms
2025-11-24 15:42:41,499 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:42:41,499 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:41,499 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:41,500 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:41,500 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:41,500 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:41,501 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:41,502 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:41,502 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:42:41,503 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,504 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,506 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,507 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,508 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,509 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,510 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:42:41,511 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:42:41,511 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,512 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:41,514 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:42:41,514 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:42:41,515 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.3ms
2025-11-24 15:42:44,168 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:44,168 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:44,168 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:44,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:44,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:44,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:44,170 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:44,170 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:44,170 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:44,171 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,172 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,174 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,175 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,177 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,178 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,179 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:44,179 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:44,179 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,182 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,190 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:44,190 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:44,191 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:44,191 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:44,191 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:44,192 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:44,193 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:44,193 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 25.4ms
2025-11-24 15:42:44,194 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:44,194 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:44,194 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:44,194 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:44,194 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:44,195 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:44,195 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:44,195 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:44,197 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,198 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,198 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,199 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,200 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,201 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,201 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:44,201 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,202 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:44,202 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:44,204 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.9ms
2025-11-24 15:42:44,204 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:44,205 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:44,205 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:44,205 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:44,205 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:44,206 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:44,207 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:44,207 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:44,207 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:44,208 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,209 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,210 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,211 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,212 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,213 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,214 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:44,214 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:44,214 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,216 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,218 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:44,218 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:44,218 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:44,218 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:44,219 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:44,219 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:44,220 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:44,220 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:44,220 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:44,221 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:44,221 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:44,221 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:44,222 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:44,222 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:44,222 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:44,223 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,225 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,226 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,227 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,228 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,229 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,230 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:44,230 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:44,230 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:44,231 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:44,231 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 27.2ms
2025-11-24 15:42:44,232 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.5ms
2025-11-24 15:42:46,216 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:46,216 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:46,217 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:46,217 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:46,217 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:46,217 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:46,219 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:46,219 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:46,219 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:46,220 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,221 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,222 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,223 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,225 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,226 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,227 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:46,227 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:46,227 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:46,228 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,230 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:46,230 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,233 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:46,234 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:46,234 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:46,234 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:46,234 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:46,234 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:46,235 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 19.2ms
2025-11-24 15:42:46,237 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:46,237 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:46,237 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:46,238 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:46,238 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:46,238 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:46,239 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:46,239 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:46,239 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:46,240 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,241 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,242 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,243 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,244 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,245 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,246 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:46,246 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:46,246 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:46,246 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,248 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:46,248 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:46,249 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:46,249 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:46,250 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:46,250 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:46,250 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:46,250 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:46,251 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.9ms
2025-11-24 15:42:50,941 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:50,942 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:50,942 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:50,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:50,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:50,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:50,943 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:50,943 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:50,944 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:50,944 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,945 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,947 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,949 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,950 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,951 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,952 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:50,952 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:50,952 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,954 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,957 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:50,957 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:50,957 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:50,958 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:50,958 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:50,958 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:50,959 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:50,960 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 18.7ms
2025-11-24 15:42:50,960 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:50,960 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:50,960 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:50,960 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:50,960 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:50,962 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:50,962 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:50,962 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:50,963 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,964 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,966 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,967 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,967 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,968 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,969 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:50,969 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,970 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:50,970 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:50,971 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.2ms
2025-11-24 15:42:50,972 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:50,973 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:50,973 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:50,973 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:50,974 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:50,974 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:50,975 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:50,975 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:50,975 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:50,976 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,977 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,978 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,979 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,981 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,982 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:50,982 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:50,982 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,984 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,987 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:50,987 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:50,987 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:50,987 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:50,988 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:50,988 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:50,989 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:50,989 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:50,989 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:50,989 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:50,989 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:50,989 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:50,990 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:50,990 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:50,991 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:50,991 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,992 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,993 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,994 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,995 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,995 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,996 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:50,997 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:50,998 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:50,998 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:50,999 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 26.2ms
2025-11-24 15:42:50,999 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.9ms
2025-11-24 15:42:53,305 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:53,306 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:53,306 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:53,306 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:53,306 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:53,307 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:53,310 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:53,310 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:53,311 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:53,312 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,313 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,316 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,317 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,318 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,319 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,320 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:53,320 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:53,321 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:53,321 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,322 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:53,323 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,327 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:53,327 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:53,327 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:53,327 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:53,327 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:53,327 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:53,328 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 22.9ms
2025-11-24 15:42:53,330 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:53,330 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:53,331 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:53,331 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:53,331 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:53,331 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:53,333 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:53,333 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:53,334 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:53,335 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,341 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,342 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,343 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,344 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:53,344 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:53,344 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:53,344 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,346 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:53,346 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,351 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:53,351 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:53,351 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:53,351 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:53,352 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:53,352 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:53,352 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 22.7ms
2025-11-24 15:42:53,912 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:53,912 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:53,913 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:53,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:53,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:53,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:53,917 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:53,917 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:53,917 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:53,918 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,920 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,922 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,924 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,926 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,927 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,928 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:53,928 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:53,929 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,933 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,943 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:53,944 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:53,944 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:53,944 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:53,944 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:53,945 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:53,945 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:53,946 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:53,946 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:53,946 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:53,946 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:53,947 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:53,950 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:53,951 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:53,951 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:53,952 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,953 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,955 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,955 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,957 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,958 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,959 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:53,959 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,960 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:53,960 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:53,961 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 49.4ms
2025-11-24 15:42:53,962 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 16.4ms
2025-11-24 15:42:53,963 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:53,964 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:53,965 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:53,965 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:53,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:53,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:53,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:53,969 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:53,969 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:53,969 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:53,970 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,972 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,973 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,975 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,976 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,977 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,978 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:53,978 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:53,978 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,981 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:53,992 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:53,992 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:53,992 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:53,993 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:53,993 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:53,993 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:53,994 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:53,994 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:53,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:53,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:53,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:53,997 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:53,998 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:53,998 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:53,999 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,000 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,002 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,003 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,004 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,005 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,006 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:54,007 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,008 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:54,008 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:54,009 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 45.1ms
2025-11-24 15:42:54,009 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 45.0ms
2025-11-24 15:42:54,519 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:54,520 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:54,522 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:54,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:54,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:54,524 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:54,528 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:54,528 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:54,528 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:54,529 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,531 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,534 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,536 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,537 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,538 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,539 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:54,539 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:54,539 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:54,539 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,541 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:54,541 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,545 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:54,545 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:54,545 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:54,545 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:54,545 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:54,545 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:54,546 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 26.9ms
2025-11-24 15:42:54,548 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:54,548 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:54,548 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:54,548 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:54,549 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:54,549 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:54,550 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:54,550 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:54,551 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:54,551 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,552 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,553 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,554 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,555 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,556 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,557 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:54,557 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:54,557 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:54,557 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,559 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:54,559 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,560 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:54,560 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:54,561 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:54,561 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:54,561 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:54,561 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:54,562 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.0ms
2025-11-24 15:42:54,921 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:54,921 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:54,921 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:54,922 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:54,922 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:54,922 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:54,925 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:54,925 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:54,926 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:54,927 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,928 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,930 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,931 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,933 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,935 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,936 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:54,936 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:54,936 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,939 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,946 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:54,946 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:54,947 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:54,947 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:54,947 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:54,947 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:54,948 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:54,948 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:54,948 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:54,948 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:54,948 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:54,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:54,950 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:54,950 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:54,950 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:54,951 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,952 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,953 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,954 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,955 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,956 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,956 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:54,957 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,957 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:54,958 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:54,958 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 37.5ms
2025-11-24 15:42:54,959 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.4ms
2025-11-24 15:42:54,960 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:54,961 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:54,961 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:54,961 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:54,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:54,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:54,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:54,963 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:54,963 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:54,963 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:54,964 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,965 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,966 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,968 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,969 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,970 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,970 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:54,971 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:54,971 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,973 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,975 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:54,975 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:54,975 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:54,975 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:54,976 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:54,976 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:54,976 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:54,976 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:54,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:54,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:54,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:54,978 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:54,978 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:54,978 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:54,979 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,979 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,981 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,982 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,983 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,984 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:54,984 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:54,985 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:54,985 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:54,986 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 25.6ms
2025-11-24 15:42:54,986 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 25.5ms
2025-11-24 15:42:55,554 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:55,555 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:55,555 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:55,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:55,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:55,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:55,559 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:55,559 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:55,559 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:55,560 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,561 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,563 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,564 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,565 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,566 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,568 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:55,568 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:55,568 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:55,568 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,571 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:55,571 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,574 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:55,574 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:55,575 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:55,575 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:55,575 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:55,575 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:55,576 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 21.6ms
2025-11-24 15:42:55,577 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:55,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:55,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:55,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:55,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:55,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:55,579 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:55,580 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:55,580 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:55,580 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,582 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,583 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,587 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:55,587 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:55,588 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:55,588 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,590 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:55,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,594 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:55,594 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:55,594 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:55,595 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:55,595 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:55,595 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:55,596 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.2ms
2025-11-24 15:42:55,929 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:55,930 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:55,930 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:55,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:55,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:55,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:55,934 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:55,934 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:55,935 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:55,936 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,937 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,940 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,941 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,942 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,943 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,944 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:55,944 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:55,944 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,947 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,955 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:55,956 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:55,956 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:55,956 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:55,956 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:55,957 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:55,957 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:55,958 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:55,958 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:55,958 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:55,958 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:55,958 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:55,959 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:55,959 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:55,959 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:55,960 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,961 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,962 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,962 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,963 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,964 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,964 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:55,965 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,965 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:55,966 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:55,966 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 36.9ms
2025-11-24 15:42:55,967 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.9ms
2025-11-24 15:42:55,969 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:55,970 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:55,970 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:55,970 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:55,970 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:55,970 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:55,971 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:55,972 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:55,972 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:55,973 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,973 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,974 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,975 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,976 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,976 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,977 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:55,977 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:55,978 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,979 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,981 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:55,981 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:55,982 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:55,982 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:55,982 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:55,982 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:55,983 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:55,983 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:55,984 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:55,984 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:55,984 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:55,984 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:55,985 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:55,985 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:55,986 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:55,986 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,988 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,988 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,989 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,990 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,991 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,991 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:55,992 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:55,992 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:55,992 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:55,993 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.3ms
2025-11-24 15:42:55,994 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.9ms
2025-11-24 15:42:57,189 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:57,190 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:57,190 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:57,190 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:57,190 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:57,191 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:57,194 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:57,195 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:57,195 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:57,196 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,197 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,200 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,201 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,204 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,205 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,207 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:57,207 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:57,207 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:57,207 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,210 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:57,210 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,214 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:57,214 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:57,214 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:57,215 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:57,215 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:57,215 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:57,216 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 26.4ms
2025-11-24 15:42:57,218 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:57,218 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:57,219 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:57,219 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:57,219 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:57,219 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:57,223 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:57,223 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:57,224 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:57,224 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,225 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,227 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,228 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,229 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,230 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,232 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:57,232 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:57,232 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:57,232 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,234 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:57,234 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,240 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:57,240 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:57,240 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:57,241 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:57,241 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:57,241 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:57,242 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 23.9ms
2025-11-24 15:42:57,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:57,601 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:57,601 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:57,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:57,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:57,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:57,605 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:57,608 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:57,611 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:57,612 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,614 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,617 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,619 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,621 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,622 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,623 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:57,624 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:57,624 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,626 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,633 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:57,633 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:57,634 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:57,634 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:57,634 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:57,634 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:57,635 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:57,636 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:57,636 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:57,636 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:57,636 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:57,636 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:57,638 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:57,638 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:57,638 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:57,639 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,640 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,641 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,642 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,642 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,643 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,644 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:57,644 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,645 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:57,645 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:57,646 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 45.8ms
2025-11-24 15:42:57,646 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.4ms
2025-11-24 15:42:57,648 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:57,648 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:57,649 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:57,649 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:57,649 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:57,649 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:57,650 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:57,650 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:57,650 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:57,651 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,652 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,654 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,655 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,656 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,656 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,657 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:57,658 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:57,658 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,660 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,662 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:57,662 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:57,663 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:57,663 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:57,663 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:57,663 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:57,664 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:57,664 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:57,665 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:57,665 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:57,665 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:57,665 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:57,666 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:57,666 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:57,666 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:57,667 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,668 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,669 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,670 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,671 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,672 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,673 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:57,673 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:57,674 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:57,674 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:57,674 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 26.6ms
2025-11-24 15:42:57,675 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.3ms
2025-11-24 15:42:58,206 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:58,207 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:58,207 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:58,207 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:58,208 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:58,208 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:58,209 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:58,209 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:58,209 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:58,210 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,212 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,213 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,214 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,215 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,216 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,217 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:58,218 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:58,218 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:58,218 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,222 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:58,222 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,226 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:58,226 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:58,226 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:58,226 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:58,227 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:58,227 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:58,228 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 21.1ms
2025-11-24 15:42:58,229 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:58,230 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:58,230 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:58,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:58,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:58,231 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:58,232 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:58,232 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:58,232 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:58,233 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,234 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,235 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,236 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,237 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,239 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,240 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:58,240 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:58,240 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:58,240 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,242 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:58,242 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,243 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:58,244 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:58,244 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:58,244 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:58,244 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:58,244 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:58,245 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.6ms
2025-11-24 15:42:58,586 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:58,587 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:58,587 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:58,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:58,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:58,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:58,588 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:58,589 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:58,589 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:58,589 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,592 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,593 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,594 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,595 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,596 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:58,597 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:58,597 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,599 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,602 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:58,602 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:58,603 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:58,603 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:58,603 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:58,603 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:58,604 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:58,605 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:58,605 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:58,605 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:58,605 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:58,606 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:58,607 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:58,607 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:58,607 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:58,608 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,609 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,610 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,610 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,611 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,612 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,612 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:58,613 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,613 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:58,613 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:58,614 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 28.0ms
2025-11-24 15:42:58,615 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.3ms
2025-11-24 15:42:58,616 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:58,617 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:58,617 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:58,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:58,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:58,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:58,618 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:58,618 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:58,618 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:58,619 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:58,620 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,621 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,622 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,623 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,624 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,625 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,626 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:58,626 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:58,626 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,628 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,630 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:58,630 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:58,630 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:58,630 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:58,630 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:58,631 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:58,631 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:58,631 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:58,631 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:58,632 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:58,632 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:58,632 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:58,633 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:58,633 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:58,633 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,634 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,635 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,636 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,637 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,638 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,639 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:58,639 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:58,640 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:58,640 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:58,641 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.9ms
2025-11-24 15:42:58,642 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 22.7ms
2025-11-24 15:42:59,029 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:59,030 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:59,030 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:59,030 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:59,030 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:59,030 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:59,031 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:59,032 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:59,032 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:59,033 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,034 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,035 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,037 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,038 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,039 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,041 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:59,041 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:59,041 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:59,041 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,043 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:59,043 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,045 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:59,045 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:59,045 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:59,045 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:59,045 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:59,046 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:59,046 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.0ms
2025-11-24 15:42:59,048 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:42:59,048 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:59,048 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:59,048 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:59,048 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:59,049 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:59,049 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:59,050 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:59,050 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:42:59,051 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,052 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,053 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,054 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,054 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,055 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,056 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:59,057 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:59,057 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:42:59,057 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,058 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:42:59,059 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,060 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:42:59,060 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:59,060 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:59,061 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:59,061 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:42:59,061 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:42:59,061 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.5ms
2025-11-24 15:42:59,469 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:59,470 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:59,471 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:59,471 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:59,471 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:59,471 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:59,473 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:59,473 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:59,473 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:59,474 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,476 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,478 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,480 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,481 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,482 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,483 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:59,484 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:59,484 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,486 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,490 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:59,491 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:59,491 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:59,491 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:59,492 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:59,492 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:59,493 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:59,493 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:59,493 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:59,494 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:59,494 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:59,494 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:59,495 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:59,495 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:59,496 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:59,497 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,498 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,499 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,500 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,501 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,502 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,503 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:59,503 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,504 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:59,505 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:59,505 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 36.1ms
2025-11-24 15:42:59,506 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 13.5ms
2025-11-24 15:42:59,508 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:42:59,508 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:59,509 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:59,509 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:59,509 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:59,509 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:59,511 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:59,511 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:59,511 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 15:42:59,512 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,513 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,514 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,515 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,516 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,517 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,518 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:42:59,518 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:42:59,519 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,521 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,525 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:59,525 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:59,526 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:42:59,526 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 15:42:59,526 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:42:59,526 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 15:42:59,527 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:42:59,528 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:42:59,528 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:42:59,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:42:59,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:42:59,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:42:59,529 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:42:59,530 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:42:59,530 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 15:42:59,531 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,532 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,533 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,534 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,535 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,536 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,537 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:42:59,537 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:42:59,538 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 15:42:59,538 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 15:42:59,539 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 31.3ms
2025-11-24 15:42:59,541 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 13.5ms
2025-11-24 15:43:13,217 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:43:13,217 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:13,218 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:43:13,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:43:13,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:13,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:43:13,220 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:43:13,220 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:43:13,220 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:43:13,221 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,223 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,225 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,226 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,228 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,230 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,232 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:43:13,232 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:43:13,232 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:43:13,232 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,237 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:43:13,237 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,240 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:43:13,241 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:43:13,241 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:43:13,241 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:43:13,241 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:43:13,241 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:43:13,242 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 25.5ms
2025-11-24 15:43:13,244 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:43:13,245 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:13,245 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:43:13,245 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:43:13,245 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:13,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:43:13,247 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:43:13,247 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:43:13,248 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:43:13,249 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,250 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,252 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,253 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,254 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,255 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,256 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:43:13,256 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:43:13,256 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:43:13,257 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,259 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:43:13,259 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,261 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:43:13,261 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:43:13,261 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:43:13,261 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:43:13,261 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:43:13,261 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:43:13,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.6ms
2025-11-24 15:43:13,773 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:43:13,773 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:13,773 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:43:13,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:43:13,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:13,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:43:13,775 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:43:13,775 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:43:13,775 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:43:13,776 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,777 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,778 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,780 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,781 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,782 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,783 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:43:13,784 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:43:13,784 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,786 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,791 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:43:13,791 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:43:13,792 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 19.0ms
2025-11-24 15:43:13,794 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:43:13,794 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:13,794 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:43:13,794 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:43:13,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:13,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:43:13,796 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:43:13,796 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:43:13,796 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:43:13,797 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,798 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,799 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,800 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,800 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,801 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,802 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:43:13,803 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:43:13,803 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,804 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:13,806 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:43:13,807 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:43:13,807 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.5ms
2025-11-24 15:43:14,357 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:43:14,357 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:14,358 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:43:14,358 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:43:14,358 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:14,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:43:14,362 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:43:14,363 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:43:14,363 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:43:14,364 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,365 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,367 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,369 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,370 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,372 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,372 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:43:14,373 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:43:14,373 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:43:14,373 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,375 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:43:14,375 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,376 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:43:14,377 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:43:14,377 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:43:14,377 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:43:14,377 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:43:14,377 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:43:14,378 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 21.1ms
2025-11-24 15:43:14,380 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:43:14,380 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:14,380 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:43:14,380 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:43:14,380 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:14,380 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:43:14,381 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:43:14,382 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:43:14,382 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 15:43:14,382 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,383 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,384 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,385 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,387 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,388 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,389 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:43:14,389 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 15:43:14,389 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 15:43:14,389 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,391 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 15:43:14,391 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:43:14,392 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 15:43:14,392 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:43:14,392 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:43:14,393 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 15:43:14,393 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 15:43:14,393 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 15:43:14,393 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.0ms
2025-11-24 15:43:15,717 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 15:43:15,717 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-24 15:43:15,720 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 15:43:15,721 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:15,721 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:15,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:15,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:15,722 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:15,725 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:15,727 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_sistema
2025-11-24 15:43:15,728 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:15,728 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 15:43:15,735 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-24 15:43:15,736 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: admin_acme
2025-11-24 15:43:15,736 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 16.6ms
2025-11-24 15:43:25,257 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 15:43:25,258 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-24 15:43:25,260 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 15:43:25,260 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:25,260 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:25,261 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:25,261 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:25,261 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:25,262 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:25,262 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:25,262 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/login/
2025-11-24 15:43:25,267 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-24 15:43:25,267 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-24 15:43:25,267 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-24 15:43:25,509 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-24 15:43:25,509 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 15:43:25,514 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-24 15:43:25,517 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 15:43:25,518 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 11346, Rotación: False
2025-11-24 15:43:25,518 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11346
2025-11-24 15:43:25,518 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-24 15:43:25,519 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 258.8ms
2025-11-24 15:43:25,542 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 15:43:25,543 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.0ms
2025-11-24 15:43:25,545 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 15:43:25,545 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:43:25,545 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:43:25,548 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.9ms
2025-11-24 15:43:25,548 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.8ms
2025-11-24 15:43:25,548 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.9ms
2025-11-24 15:43:25,549 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 15:43:25,549 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 15:43:25,550 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 15:43:25,551 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:25,551 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:25,552 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:25,552 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:25,552 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:25,553 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:25,553 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:25,554 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/menus/getmenu/
2025-11-24 15:43:25,577 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-24 15:43:25,578 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-24 15:43:25,625 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-24 15:43:25,626 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 76.7ms
2025-11-24 15:43:25,626 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 76.6ms
2025-11-24 15:43:25,628 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:43:25,629 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:43:25,629 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 80.6ms
2025-11-24 15:43:25,630 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:25,630 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:25,630 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:25,630 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:25,630 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:25,631 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:25,632 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:25,632 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 15:43:25,632 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:25,632 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:25,632 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:25,633 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:25,633 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:25,633 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:25,634 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:25,634 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 15:43:25,641 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:43:25,641 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 15:43:25,652 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 2 usuarios únicos de 2 filas crudas
2025-11-24 15:43:25,652 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:43:25,652 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 15:43:25,656 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 15:43:25,658 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 15:43:25,659 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 15:43:25,660 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 31.5ms
2025-11-24 15:43:25,660 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 31.4ms
2025-11-24 15:43:25,660 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 15:43:25,661 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:25,662 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:25,662 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:25,662 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:25,662 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:25,664 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:25,664 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:25,664 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/menus/getmenu/
2025-11-24 15:43:25,668 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-24 15:43:25,668 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-24 15:43:25,669 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-24 15:43:25,670 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:43:25,671 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:25,671 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:25,671 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:25,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:25,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:25,673 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:25,673 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:25,673 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 15:43:25,677 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:43:25,677 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 15:43:25,682 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 2 usuarios únicos de 2 filas crudas
2025-11-24 15:43:25,683 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:43:25,683 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 15:43:25,683 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:43:25,684 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 23.5ms
2025-11-24 15:43:25,684 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:25,684 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:25,685 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:25,685 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:25,685 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:25,686 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:25,686 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:25,686 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 15:43:25,690 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 15:43:25,691 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 15:43:25,691 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 15:43:25,692 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 21.6ms
2025-11-24 15:43:25,693 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.6ms
2025-11-24 15:43:28,214 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:43:28,215 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 15:43:28,215 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.7ms
2025-11-24 15:43:28,216 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.3ms
2025-11-24 15:43:28,219 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:43:28,219 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:28,219 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:28,220 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:28,220 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:28,220 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:28,221 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:28,222 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:28,222 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 15:43:28,227 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:43:28,227 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 15:43:28,228 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 15:43:28,233 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 15:43:28,237 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 15:43:28,237 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 15:43:28,237 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 15:43:28,238 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 19.4ms
2025-11-24 15:43:28,240 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 15:43:28,240 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:28,240 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:28,241 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:28,241 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:28,241 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:28,242 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:28,242 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:28,242 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 15:43:28,246 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:43:28,246 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 15:43:28,246 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 15:43:28,248 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 15:43:28,251 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 15:43:28,251 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 15:43:28,251 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 15:43:28,252 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 11.9ms
2025-11-24 15:43:32,789 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 15:43:32,789 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.7ms
2025-11-24 15:43:32,792 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:43:32,792 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:32,793 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:32,793 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:32,793 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:32,793 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:32,794 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:32,795 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:32,795 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 15:43:32,801 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:43:32,802 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 15:43:32,806 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 15:43:32,807 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 15:43:32,807 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.6ms
2025-11-24 15:43:32,809 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:43:32,810 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:32,810 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:32,810 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:32,811 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:32,811 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:32,812 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:32,812 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:32,812 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 15:43:32,818 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:43:32,818 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 15:43:32,820 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 15:43:32,821 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 15:43:32,821 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.0ms
2025-11-24 15:43:33,472 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 15:43:33,472 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.5ms
2025-11-24 15:43:33,474 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:43:33,474 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:33,475 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:33,475 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:33,475 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:33,475 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:33,477 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:33,477 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:33,477 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/list/
2025-11-24 15:43:33,483 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 15:43:33,483 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 4
2025-11-24 15:43:33,486 - app.services.area_service - INFO - No se encontraron áreas activas para el cliente 4 en la lista simple
2025-11-24 15:43:33,487 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 4 - Total: 0 áreas activas
2025-11-24 15:43:33,487 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 13.5ms
2025-11-24 15:43:33,489 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:43:33,490 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:33,490 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:33,490 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:33,490 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:33,491 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:33,492 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:33,492 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:33,492 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/list/
2025-11-24 15:43:33,497 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 15:43:33,497 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 4
2025-11-24 15:43:33,498 - app.services.area_service - INFO - No se encontraron áreas activas para el cliente 4 en la lista simple
2025-11-24 15:43:33,498 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 4 - Total: 0 áreas activas
2025-11-24 15:43:33,498 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 8.9ms
2025-11-24 15:43:34,458 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 15:43:34,459 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 0.6ms
2025-11-24 15:43:34,461 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 15:43:34,461 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 15:43:34,462 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 1.1ms
2025-11-24 15:43:34,462 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:34,462 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:34,463 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:34,463 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:34,463 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:34,464 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:34,465 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:34,465 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/sessions/admin/
2025-11-24 15:43:34,476 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_tech
2025-11-24 15:43:34,483 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 30 sesiones activas recuperadas - Cliente 4
2025-11-24 15:43:34,483 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 30 sesiones activas totales.
2025-11-24 15:43:34,484 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 22.8ms
2025-11-24 15:43:34,486 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 15:43:34,487 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:34,487 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:34,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:34,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:34,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:34,490 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:34,490 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:34,490 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/sessions/admin/
2025-11-24 15:43:34,496 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_tech
2025-11-24 15:43:34,498 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 30 sesiones activas recuperadas - Cliente 4
2025-11-24 15:43:34,498 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 30 sesiones activas totales.
2025-11-24 15:43:34,499 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 12.5ms
2025-11-24 15:43:35,475 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:43:35,475 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:35,475 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:35,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:35,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:35,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:35,477 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:35,477 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:35,478 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/list/
2025-11-24 15:43:35,484 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 15:43:35,484 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 4
2025-11-24 15:43:35,485 - app.services.area_service - INFO - No se encontraron áreas activas para el cliente 4 en la lista simple
2025-11-24 15:43:35,485 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 4 - Total: 0 áreas activas
2025-11-24 15:43:35,485 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 10.9ms
2025-11-24 15:43:35,487 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:43:35,488 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:35,488 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:35,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:35,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:35,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:35,490 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:35,490 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:35,490 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/list/
2025-11-24 15:43:35,495 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 15:43:35,495 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 4
2025-11-24 15:43:35,496 - app.services.area_service - INFO - No se encontraron áreas activas para el cliente 4 en la lista simple
2025-11-24 15:43:35,496 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 4 - Total: 0 áreas activas
2025-11-24 15:43:35,496 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 9.2ms
2025-11-24 15:43:36,712 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 15:43:36,713 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:36,713 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:36,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:36,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:36,714 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:36,715 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:36,715 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:36,715 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/sessions/admin/
2025-11-24 15:43:36,722 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_tech
2025-11-24 15:43:36,724 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 30 sesiones activas recuperadas - Cliente 4
2025-11-24 15:43:36,725 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 30 sesiones activas totales.
2025-11-24 15:43:36,726 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 13.6ms
2025-11-24 15:43:36,728 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 15:43:36,728 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:36,728 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:36,729 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:36,729 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:36,729 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:36,730 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:36,730 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:36,730 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/sessions/admin/
2025-11-24 15:43:36,741 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_tech
2025-11-24 15:43:36,743 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 30 sesiones activas recuperadas - Cliente 4
2025-11-24 15:43:36,743 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 30 sesiones activas totales.
2025-11-24 15:43:36,744 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 15.7ms
2025-11-24 15:43:38,610 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:43:38,610 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:38,611 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:38,611 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:38,611 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:38,611 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:38,612 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:38,613 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:38,613 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 15:43:38,619 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:43:38,619 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 15:43:38,624 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 2 usuarios únicos de 2 filas crudas
2025-11-24 15:43:38,624 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:43:38,625 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 15:43:38,626 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:43:38,627 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.6ms
2025-11-24 15:43:38,627 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:38,627 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:38,627 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:38,627 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:38,628 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:38,629 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:38,629 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:38,629 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 15:43:38,634 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 15:43:38,634 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 15:43:38,634 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 15:43:38,635 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.6ms
2025-11-24 15:43:38,637 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 15:43:38,637 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:38,637 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:38,638 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:38,638 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:38,638 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:38,639 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:38,639 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:38,639 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 15:43:38,645 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 15:43:38,645 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 15:43:38,649 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 2 usuarios únicos de 2 filas crudas
2025-11-24 15:43:38,650 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 15:43:38,650 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 15:43:38,651 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 15:43:38,651 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:38,651 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 15:43:38,651 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 15:43:38,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:38,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 15:43:38,652 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 15:43:38,653 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 15:43:38,653 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 15:43:38,653 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.4ms
2025-11-24 15:43:38,657 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 15:43:38,658 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 15:43:38,659 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 15:43:38,660 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.0ms
2025-11-24 15:43:42,326 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 15:43:42,326 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-24 15:43:42,329 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 15:43:42,329 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:42,330 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:42,330 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:42,330 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:42,330 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:42,330 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:42,331 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:42,331 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 15:43:42,334 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 1
2025-11-24 15:43:42,334 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: admin_tech
2025-11-24 15:43:42,335 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.9ms
2025-11-24 15:43:49,826 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 15:43:49,827 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.4ms
2025-11-24 15:43:49,828 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 15:43:49,829 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:49,829 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:49,829 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:49,829 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:49,830 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:49,830 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:49,830 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:49,830 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 15:43:49,832 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 15:43:49,833 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 15:43:49,833 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 15:43:50,053 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 15:43:50,053 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-24 15:43:50,053 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-24 15:43:50,054 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 15:43:50,055 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 15:43:50,055 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11347, Rotación: False
2025-11-24 15:43:50,056 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11347
2025-11-24 15:43:50,056 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-24 15:43:50,056 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 228.0ms
2025-11-24 15:43:50,082 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 15:43:50,083 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.7ms
2025-11-24 15:43:50,084 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 15:43:50,086 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.8ms
2025-11-24 15:43:50,087 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 15:43:50,088 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:50,089 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:50,089 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:50,089 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:50,089 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:50,090 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:50,090 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:50,090 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 15:43:50,094 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 15:43:50,094 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 15:43:50,096 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 15:43:50,096 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.9ms
2025-11-24 15:43:50,098 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 15:43:50,099 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:50,099 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:50,099 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:50,099 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:50,099 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:50,099 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:50,100 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:50,100 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 15:43:50,105 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 15:43:50,105 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 15:43:50,106 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 15:43:50,107 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.6ms
2025-11-24 15:43:52,719 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 15:43:52,719 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 15:43:52,720 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.2ms
2025-11-24 15:43:52,720 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.8ms
2025-11-24 15:43:52,723 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 15:43:52,724 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:52,724 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:52,724 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:52,724 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:52,725 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:52,725 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:52,725 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:52,725 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 15:43:52,730 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 15:43:52,730 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 15:43:52,735 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 15:43:52,736 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.1ms
2025-11-24 15:43:52,739 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 15:43:52,739 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:52,740 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:52,740 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:52,740 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:52,740 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:52,740 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:52,741 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:52,741 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 15:43:52,744 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 15:43:52,744 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 15:43:52,746 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 15:43:52,747 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.5ms
2025-11-24 15:43:54,486 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 15:43:54,487 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:54,487 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:54,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:54,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:54,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:54,488 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:54,488 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:54,489 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 15:43:54,491 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 15:43:54,495 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 15:43:54,496 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 15:43:54,499 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 15:43:54,499 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11348, Rotación: True
2025-11-24 15:43:54,504 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 15:43:54,506 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 15:43:54,506 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 15:43:54,506 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11348
2025-11-24 15:43:54,506 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 15:43:54,507 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 20.9ms
2025-11-24 15:43:54,512 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 15:43:54,512 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.6ms
2025-11-24 15:43:54,514 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 15:43:54,515 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:54,515 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:54,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:54,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:54,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:54,515 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:54,515 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:54,516 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-24 15:43:54,517 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-24 15:43:54,517 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-24 15:43:54,517 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-24 15:43:54,531 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 15:43:54,531 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-24 15:43:54,532 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 17.4ms
2025-11-24 15:43:54,549 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 15:43:54,550 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:54,550 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:54,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:54,551 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:54,551 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:54,551 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:54,551 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:54,551 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 15:43:54,552 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 15:43:54,555 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 15:43:54,555 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 15:43:54,557 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 15:43:54,558 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:54,558 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:54,558 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:54,558 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:54,558 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:54,559 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:54,559 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:54,559 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 15:43:54,563 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 15:43:54,563 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 15:43:54,565 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 15:43:54,566 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 16.4ms
2025-11-24 15:43:54,566 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.9ms
2025-11-24 15:43:54,568 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 15:43:54,569 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 15:43:54,569 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:54,570 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:54,570 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:54,570 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:54,570 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:54,570 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:54,571 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:54,571 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 15:43:54,576 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 15:43:54,577 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 15:43:54,578 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 15:43:54,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:54,579 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:54,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:54,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:54,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:54,579 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:54,580 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:54,580 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 15:43:54,584 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 15:43:54,584 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 15:43:54,586 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 15:43:54,587 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.2ms
2025-11-24 15:43:54,587 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 17.8ms
2025-11-24 15:43:58,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 15:43:58,579 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:58,579 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:58,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:58,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:58,580 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:58,580 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:58,580 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:58,580 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 15:43:58,585 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 15:43:58,585 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 15:43:58,587 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 15:43:58,588 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.2ms
2025-11-24 15:43:58,590 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 15:43:58,591 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:43:58,591 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 15:43:58,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 15:43:58,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:43:58,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 15:43:58,591 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 15:43:58,592 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 15:43:58,592 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 15:43:58,596 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 15:43:58,597 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 15:43:58,599 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 15:43:58,599 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.4ms
2025-11-24 17:15:30,422 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-24 17:15:30,426 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 17:15:30,427 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 17:15:30,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 17:15:30,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 17:15:30,428 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 17:15:30,428 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 17:15:30,428 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 17:15:30,429 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-24 17:15:30,435 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 13.6ms
2025-11-24 17:15:32,548 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'cdn', 'assets', 'admin', 'backend', 'api', 'static', 'www'}
2025-11-24 17:15:32,620 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-24 17:15:32,622 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 17:15:32,622 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 17:15:32,623 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 17:15:32,623 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 17:15:32,623 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 17:15:32,623 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 17:15:32,623 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 17:15:32,623 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-24 17:15:32,795 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 174.5ms
2025-11-24 17:16:05,821 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 17:16:05,821 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 17:16:05,821 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 17:16:05,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 17:16:05,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 17:16:05,822 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 17:16:05,822 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 17:16:05,822 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 17:16:05,822 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 17:16:05,823 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 401 2.4ms
2025-11-24 17:38:33,041 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-24 17:38:33,042 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 17:38:33,042 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 17:38:33,042 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 17:38:33,042 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 17:38:33,042 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 17:38:33,043 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 17:38:33,043 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 17:38:33,043 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-24 17:38:33,044 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.5ms
2025-11-24 17:38:33,149 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-24 17:38:33,149 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 17:38:33,149 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 17:38:33,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 17:38:33,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 17:38:33,150 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 17:38:33,150 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 17:38:33,150 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 17:38:33,151 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-24 17:38:33,155 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 6.0ms
2025-11-24 17:38:41,429 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 17:38:41,430 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 17:38:41,430 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 17:38:41,430 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 17:38:41,430 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 17:38:41,430 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 17:38:41,431 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 17:38:41,431 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 17:38:41,431 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 17:38:41,527 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 17:38:41,527 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 17:38:41,528 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 17:38:41,787 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 17:38:41,787 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-24 17:38:41,787 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-24 17:38:41,788 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 17:38:41,804 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 17:38:41,804 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11349, Rotación: False
2025-11-24 17:38:41,805 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11349
2025-11-24 17:38:41,805 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-24 17:38:41,806 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 376.2ms
2025-11-24 17:38:45,921 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 17:38:45,921 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 17:38:45,922 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 17:38:45,922 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 17:38:45,922 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 17:38:45,922 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 17:38:45,922 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 17:38:45,922 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 17:38:45,923 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 17:38:45,949 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 17:38:45,949 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 17:38:45,952 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 17:38:45,953 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 32.1ms
2025-11-24 17:43:43,164 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'cdn', 'www', 'static', 'admin', 'assets', 'api', 'backend'}
2025-11-24 18:39:06,278 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'admin', 'assets', 'static', 'www', 'backend', 'cdn'}
2025-11-24 18:39:31,509 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 18:39:31,510 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.0ms
2025-11-24 18:39:31,513 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:39:31,514 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:31,514 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:39:31,514 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:39:31,514 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:31,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:39:31,515 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:39:31,515 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:39:31,515 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 18:39:31,630 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 18:39:31,635 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 18:39:31,647 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 18:39:31,657 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 18:39:31,658 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11350, Rotación: True
2025-11-24 18:39:31,668 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 18:39:31,671 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 18:39:31,671 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 18:39:31,672 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11350
2025-11-24 18:39:31,672 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 18:39:31,673 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 159.7ms
2025-11-24 18:39:31,678 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 18:39:31,678 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-24 18:39:31,681 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 18:39:31,681 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:31,681 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:39:31,681 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:39:31,682 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:31,682 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:39:31,682 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:39:31,682 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:39:31,682 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-24 18:39:31,686 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-24 18:39:31,687 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-24 18:39:31,687 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-24 18:39:31,705 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 18:39:31,705 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-24 18:39:31,706 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 25.1ms
2025-11-24 18:39:31,763 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 18:39:31,764 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-11-24 18:39:31,766 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 18:39:31,766 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 18:39:31,767 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 18:39:31,767 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.8ms
2025-11-24 18:39:31,768 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.7ms
2025-11-24 18:39:31,768 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:39:31,768 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.5ms
2025-11-24 18:39:31,770 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:31,770 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:39:31,770 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:39:31,771 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:31,771 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:39:31,771 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:39:31,772 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:39:31,772 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:39:31,795 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:39:31,795 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:39:31,864 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:39:31,866 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 98.2ms
2025-11-24 18:39:31,866 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:39:31,867 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:31,868 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:39:31,868 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:39:31,868 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:31,869 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:39:31,869 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:39:31,870 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:39:31,870 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:39:31,874 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:39:31,875 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:39:31,884 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:39:31,886 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:39:31,887 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 20.5ms
2025-11-24 18:39:31,887 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:31,888 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:39:31,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:39:31,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:31,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:39:31,888 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:39:31,889 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:39:31,889 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:39:31,894 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:39:31,894 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:39:31,895 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:39:31,896 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:39:31,897 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:31,897 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:39:31,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:39:31,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:31,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:39:31,897 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:39:31,898 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:39:31,898 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:39:31,898 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 12.1ms
2025-11-24 18:39:31,904 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:39:31,904 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:39:31,907 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:39:31,909 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 12.7ms
2025-11-24 18:39:41,553 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:39:41,554 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:41,554 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:39:41,554 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:39:41,554 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:41,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:39:41,555 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:39:41,555 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:39:41,555 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:39:41,560 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:39:41,561 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:39:41,568 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:39:41,570 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 16.3ms
2025-11-24 18:39:41,572 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:39:41,573 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:41,573 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:39:41,573 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:39:41,574 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:41,574 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:39:41,574 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:39:41,574 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:39:41,574 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:39:41,583 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:39:41,583 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:39:41,585 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:39:41,586 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.0ms
2025-11-24 18:39:42,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-24 18:39:42,567 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 2.1ms
2025-11-24 18:39:42,568 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-24 18:39:42,569 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.0ms
2025-11-24 18:39:42,571 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-24 18:39:42,572 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:42,572 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:39:42,572 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:39:42,572 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:42,572 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:39:42,573 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:39:42,573 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:39:42,573 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-24 18:39:42,579 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-24 18:39:42,579 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-24 18:39:42,586 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-24 18:39:42,589 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-24 18:39:42,589 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 18.6ms
2025-11-24 18:39:42,591 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-24 18:39:42,592 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:42,592 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:39:42,593 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:39:42,593 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:42,593 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:39:42,593 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:39:42,593 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:39:42,593 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-24 18:39:42,599 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-24 18:39:42,599 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-24 18:39:42,600 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-24 18:39:42,601 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-24 18:39:42,602 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.4ms
2025-11-24 18:39:54,661 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:39:54,662 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:54,662 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:39:54,662 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:39:54,662 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:54,662 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:39:54,663 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:39:54,663 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:39:54,663 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:39:54,702 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:39:54,702 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:39:54,709 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:39:54,710 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 49.0ms
2025-11-24 18:39:54,712 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:39:54,713 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:54,713 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:39:54,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:39:54,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:54,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:39:54,714 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:39:54,714 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:39:54,714 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:39:54,718 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:39:54,718 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:39:54,720 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:39:54,721 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.0ms
2025-11-24 18:39:57,013 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 18:39:57,014 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-24 18:39:57,017 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:39:57,018 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:39:57,018 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:39:57,018 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:39:57,018 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:39:57,018 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:39:57,025 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:39:57,034 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 18:39:57,034 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:39:57,034 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 18:39:57,037 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:39:57,121 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 2
2025-11-24 18:39:57,122 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 18:39:57,122 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 105.5ms
2025-11-24 18:40:05,477 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 18:40:05,478 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.7ms
2025-11-24 18:40:05,480 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 18:40:05,481 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:05,481 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:40:05,481 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:40:05,481 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:05,481 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:40:05,482 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:40:05,483 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:40:05,483 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 18:40:05,491 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 18:40:05,491 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 18:40:05,492 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 18:40:05,492 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,755 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,759 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,767 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 18:40:05,768 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 18:40:05,768 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,772 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,774 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 18:40:05,774 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,778 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 18:40:05,779 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 12, Rotación: False
2025-11-24 18:40:05,779 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 12
2025-11-24 18:40:05,779 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 18:40:05,780 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 299.4ms
2025-11-24 18:40:05,810 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 18:40:05,811 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.0ms
2025-11-24 18:40:05,812 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 18:40:05,813 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.3ms
2025-11-24 18:40:05,816 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 18:40:05,817 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 18:40:05,818 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.1ms
2025-11-24 18:40:05,818 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:40:05,820 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.9ms
2025-11-24 18:40:05,820 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:05,820 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:40:05,821 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:40:05,821 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:05,821 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:40:05,822 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:40:05,823 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:40:05,823 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 18:40:05,824 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,826 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,828 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,829 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,831 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 18:40:05,831 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:40:05,831 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,922 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 18:40:05,922 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 18:40:05,923 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:40:05,924 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:05,924 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:40:05,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:40:05,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:05,925 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:40:05,926 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:40:05,926 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:40:05,926 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:40:05,927 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,928 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,929 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,930 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,931 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,942 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,943 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:40:05,943 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:40:05,944 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:40:05,944 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,950 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:40:05,950 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,955 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:40:05,955 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:40:05,956 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:40:05,956 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:40:05,956 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:40:05,956 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:40:05,957 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 138.7ms
2025-11-24 18:40:05,958 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 35.0ms
2025-11-24 18:40:05,959 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:40:05,960 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:05,961 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:40:05,961 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:40:05,961 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:05,961 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:40:05,962 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:40:05,963 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:40:05,963 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 18:40:05,964 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,965 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,967 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,968 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,969 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 18:40:05,969 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:40:05,970 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,972 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 18:40:05,972 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 18:40:05,972 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:40:05,973 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:05,973 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:40:05,973 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:40:05,974 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:05,974 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:40:05,975 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:40:05,976 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:40:05,976 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:40:05,977 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,978 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,981 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,982 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,983 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,984 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:40:05,984 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:40:05,984 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:40:05,984 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,987 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:40:05,987 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:40:05,990 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:40:05,990 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:40:05,990 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:40:05,990 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:40:05,990 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:40:05,991 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:40:05,992 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 32.3ms
2025-11-24 18:40:05,993 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 20.3ms
2025-11-24 18:40:36,569 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/
2025-11-24 18:40:36,569 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/ 200 0.9ms
2025-11-24 18:40:36,572 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/estadisticas/
2025-11-24 18:40:36,573 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/
2025-11-24 18:40:36,574 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/estadisticas/
2025-11-24 18:40:36,574 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/estadisticas/ 200 2.5ms
2025-11-24 18:40:36,575 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/ 200 2.0ms
2025-11-24 18:40:36,576 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/estadisticas/ 200 2.3ms
2025-11-24 18:40:36,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/
2025-11-24 18:40:36,580 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:36,580 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:40:36,580 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:40:36,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:36,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:40:36,581 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:40:36,581 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:40:36,582 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/
2025-11-24 18:40:36,588 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/2 recibida por usuario: superadmin
2025-11-24 18:40:36,590 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/estadisticas/
2025-11-24 18:40:36,591 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:36,591 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:40:36,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:40:36,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:36,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:40:36,592 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:40:36,592 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:40:36,592 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/estadisticas/
2025-11-24 18:40:36,592 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/ 200 14.6ms
2025-11-24 18:40:36,598 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/2/estadisticas recibida por usuario: superadmin
2025-11-24 18:40:36,598 - app.services.cliente_service - INFO - Obteniendo estadísticas para cliente ID: 2
2025-11-24 18:40:36,617 - app.services.cliente_service - INFO - Estadísticas obtenidas para cliente 2
2025-11-24 18:40:36,618 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/estadisticas/ 200 28.5ms
2025-11-24 18:40:36,620 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/
2025-11-24 18:40:36,621 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:36,621 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:40:36,621 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:40:36,621 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:36,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:40:36,622 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:40:36,622 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:40:36,622 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/
2025-11-24 18:40:36,626 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/2 recibida por usuario: superadmin
2025-11-24 18:40:36,628 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/estadisticas/
2025-11-24 18:40:36,629 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:36,629 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:40:36,629 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:40:36,629 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:36,630 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:40:36,630 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:40:36,630 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:40:36,630 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/estadisticas/
2025-11-24 18:40:36,631 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/ 200 10.7ms
2025-11-24 18:40:36,635 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/2/estadisticas recibida por usuario: superadmin
2025-11-24 18:40:36,636 - app.services.cliente_service - INFO - Obteniendo estadísticas para cliente ID: 2
2025-11-24 18:40:36,639 - app.services.cliente_service - INFO - Estadísticas obtenidas para cliente 2
2025-11-24 18:40:36,640 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/estadisticas/ 200 12.1ms
2025-11-24 18:40:39,542 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/clientes/2/modulos/
2025-11-24 18:40:39,543 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/clientes/2/modulos/
2025-11-24 18:40:39,544 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/clientes/2/modulos/ 200 1.1ms
2025-11-24 18:40:39,544 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/clientes/2/modulos/ 200 0.9ms
2025-11-24 18:40:39,546 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/clientes/2/modulos/
2025-11-24 18:40:39,547 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:39,547 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:40:39,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:40:39,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:39,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:40:39,548 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:40:39,548 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:40:39,548 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/clientes/2/modulos/
2025-11-24 18:40:39,553 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /clientes/2/modulos/ recibida
2025-11-24 18:40:39,553 - app.services.modulo_service - INFO - Obteniendo módulos para cliente ID: 2
2025-11-24 18:40:39,558 - app.api.v1.endpoints.modulos - INFO - Módulos para cliente 2 recuperados: 5 módulos
2025-11-24 18:40:39,559 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/clientes/2/modulos/ 200 12.9ms
2025-11-24 18:40:39,561 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/clientes/2/modulos/
2025-11-24 18:40:39,562 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:39,562 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:40:39,562 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:40:39,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:39,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:40:39,563 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:40:39,563 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:40:39,563 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/clientes/2/modulos/
2025-11-24 18:40:39,568 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /clientes/2/modulos/ recibida
2025-11-24 18:40:39,568 - app.services.modulo_service - INFO - Obteniendo módulos para cliente ID: 2
2025-11-24 18:40:39,570 - app.api.v1.endpoints.modulos - INFO - Módulos para cliente 2 recuperados: 5 módulos
2025-11-24 18:40:39,571 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/clientes/2/modulos/ 200 9.2ms
2025-11-24 18:40:43,471 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:40:43,472 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:43,472 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:40:43,472 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:40:43,472 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:43,472 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:40:43,473 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:40:43,473 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:40:43,473 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:40:43,478 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:40:43,478 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:40:43,481 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:40:43,482 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 11.1ms
2025-11-24 18:40:43,486 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:40:43,487 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:40:43,487 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:40:43,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:40:43,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:40:43,489 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:40:43,489 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:40:43,489 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:40:43,489 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:40:43,495 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:40:43,496 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:40:43,500 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:40:43,501 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 15.0ms
2025-11-24 18:43:27,224 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:43:27,225 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:43:27,226 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:43:27,226 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:43:27,226 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:43:27,227 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:43:27,227 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:43:27,227 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:43:27,228 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 18:43:27,268 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 1
2025-11-24 18:43:27,269 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: admin_acme
2025-11-24 18:43:27,269 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 45.2ms
2025-11-24 18:43:33,509 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:43:33,510 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:43:33,510 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:43:33,510 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:43:33,510 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:43:33,510 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:43:33,517 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:43:33,518 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:43:33,518 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 18:43:33,521 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,537 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 2, Usuario 1, Tipo: web
2025-11-24 18:43:33,537 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,542 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: 2, Level: 4, Type: tenant_admin)
2025-11-24 18:43:33,542 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,559 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 18:43:33,560 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,561 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,567 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 18:43:33,568 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 13, Rotación: True
2025-11-24 18:43:33,568 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,577 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 18:43:33,577 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 18:43:33,577 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 18:43:33,577 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 13
2025-11-24 18:43:33,578 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-11-24 18:43:33,578 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 69.5ms
2025-11-24 18:43:33,585 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 18:43:33,586 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-24 18:43:33,588 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 18:43:33,588 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:43:33,589 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:43:33,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:43:33,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:43:33,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:43:33,590 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:43:33,591 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:43:33,591 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/me/
2025-11-24 18:43:33,591 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,594 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-11-24 18:43:33,594 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-24 18:43:33,594 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 2
2025-11-24 18:43:33,594 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,602 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,606 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,611 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 18:43:33,611 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-24 18:43:33,612 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 24.0ms
2025-11-24 18:43:33,632 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:43:33,633 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:43:33,634 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:43:33,634 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:43:33,634 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:43:33,635 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:43:33,636 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:43:33,636 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:43:33,637 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 18:43:33,637 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:43:33,638 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,639 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,641 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,642 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,643 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 18:43:33,643 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:43:33,643 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,749 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 18:43:33,749 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 18:43:33,750 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:43:33,750 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:43:33,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:43:33,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:43:33,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:43:33,752 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:43:33,752 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:43:33,753 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:43:33,753 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,755 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,756 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,757 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,758 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,760 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,761 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:43:33,761 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:43:33,761 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:43:33,762 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,779 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:43:33,779 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,785 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:43:33,786 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:43:33,786 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:43:33,786 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:43:33,786 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:43:33,786 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:43:33,787 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 155.3ms
2025-11-24 18:43:33,788 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 151.0ms
2025-11-24 18:43:33,790 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:43:33,791 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:43:33,791 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:43:33,791 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:43:33,791 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:43:33,792 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:43:33,793 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:43:33,793 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:43:33,793 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 18:43:33,794 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:43:33,795 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,796 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,797 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,799 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,801 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 18:43:33,801 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:43:33,802 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,822 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 18:43:33,830 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 18:43:33,838 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:43:33,838 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:43:33,839 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:43:33,839 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:43:33,839 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:43:33,842 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:43:33,842 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:43:33,843 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:43:33,844 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,846 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,847 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,853 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,854 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,856 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,858 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:43:33,859 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:43:33,859 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:43:33,860 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,862 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:43:33,862 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:33,870 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:43:33,870 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:43:33,871 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:43:33,871 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:43:33,872 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:43:33,872 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:43:33,873 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 83.0ms
2025-11-24 18:43:33,874 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 79.9ms
2025-11-24 18:43:37,854 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 18:43:37,856 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.3ms
2025-11-24 18:43:37,857 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 18:43:37,858 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.8ms
2025-11-24 18:43:37,860 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 18:43:37,860 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:43:37,860 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:43:37,861 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:43:37,861 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:43:37,861 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:43:37,862 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:43:37,862 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:43:37,863 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 18:43:37,864 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,866 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,867 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,869 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,870 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,872 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,873 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 18:43:37,874 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 18:43:37,874 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,877 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,881 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 18:43:37,882 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 18:43:37,883 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 22.8ms
2025-11-24 18:43:37,885 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 18:43:37,886 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:43:37,886 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:43:37,886 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:43:37,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:43:37,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:43:37,889 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:43:37,889 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:43:37,889 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 18:43:37,890 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,892 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,893 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,894 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,895 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,895 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,896 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 18:43:37,896 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 18:43:37,897 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,898 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:37,900 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 18:43:37,901 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 18:43:37,901 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.8ms
2025-11-24 18:43:39,229 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 18:43:39,230 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.1ms
2025-11-24 18:43:39,230 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 18:43:39,232 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.1ms
2025-11-24 18:43:39,234 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 18:43:39,234 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:43:39,235 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:43:39,235 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:43:39,235 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:43:39,235 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:43:39,238 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:43:39,238 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:43:39,238 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 18:43:39,239 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,241 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,243 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,244 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,245 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,247 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,248 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:43:39,248 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 18:43:39,248 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,250 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 18:43:39,250 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 18:43:39,251 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 17.0ms
2025-11-24 18:43:39,253 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 18:43:39,254 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:43:39,254 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:43:39,254 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:43:39,257 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:43:39,258 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:43:39,259 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:43:39,259 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:43:39,260 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 18:43:39,261 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,262 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,263 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,264 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,265 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,266 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,267 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:43:39,267 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 18:43:39,268 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:43:39,269 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 18:43:39,269 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 18:43:39,270 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 16.8ms
2025-11-24 18:48:52,687 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:48:52,688 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:48:52,688 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:48:52,688 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:48:52,688 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:48:52,689 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:48:52,709 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:48:52,718 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 18:48:52,719 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:48:52,719 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 18:48:52,721 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,734 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 2, Usuario 1, Tipo: web
2025-11-24 18:48:52,735 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,740 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: 2, Level: 4, Type: tenant_admin)
2025-11-24 18:48:52,740 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,748 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 18:48:52,749 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,750 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,755 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 18:48:52,755 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 14, Rotación: True
2025-11-24 18:48:52,756 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,760 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 18:48:52,761 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 18:48:52,761 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 18:48:52,761 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14
2025-11-24 18:48:52,761 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-11-24 18:48:52,762 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 74.8ms
2025-11-24 18:48:52,768 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 18:48:52,768 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:48:52,769 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:48:52,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:48:52,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:48:52,770 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:48:52,771 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:48:52,771 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:48:52,772 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/me/
2025-11-24 18:48:52,772 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,775 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-11-24 18:48:52,775 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-24 18:48:52,775 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 2
2025-11-24 18:48:52,775 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,782 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,789 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,793 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 18:48:52,794 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-24 18:48:52,794 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 26.9ms
2025-11-24 18:48:52,825 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:48:52,826 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:48:52,827 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:48:52,827 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:48:52,827 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:48:52,827 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:48:52,829 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:48:52,829 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:48:52,829 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 18:48:52,830 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 18:48:52,831 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,833 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,838 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,839 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,840 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 18:48:52,841 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:48:52,841 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,935 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 18:48:52,936 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 18:48:52,936 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:48:52,937 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:48:52,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:48:52,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:48:52,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:48:52,938 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:48:52,938 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:48:52,939 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 18:48:52,939 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,941 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,942 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,943 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,944 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,945 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,946 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:48:52,946 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 18:48:52,947 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,948 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 18:48:52,948 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 18:48:52,949 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 123.6ms
2025-11-24 18:48:52,950 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 119.9ms
2025-11-24 18:48:52,953 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:48:52,956 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:48:52,956 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:48:52,956 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:48:52,956 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:48:52,957 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:48:52,958 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:48:52,958 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:48:52,958 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 18:48:52,959 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,961 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,962 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,963 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,964 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 18:48:52,965 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:48:52,965 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,968 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 18:48:52,969 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 18:48:52,970 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 18:48:52,970 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:48:52,971 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:48:52,971 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:48:52,971 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:48:52,971 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:48:52,973 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:48:52,973 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:48:52,973 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 18:48:52,974 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,975 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,977 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,978 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,979 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,981 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:48:52,982 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 18:48:52,982 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:52,983 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 18:48:52,983 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 18:48:52,984 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.9ms
2025-11-24 18:48:52,986 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 16.3ms
2025-11-24 18:48:53,998 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 18:48:54,000 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.8ms
2025-11-24 18:48:54,005 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 18:48:54,006 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 18:48:54,008 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 18:48:54,009 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 4.1ms
2025-11-24 18:48:54,009 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 3.4ms
2025-11-24 18:48:54,010 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.0ms
2025-11-24 18:48:54,010 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 18:48:54,012 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:48:54,012 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:48:54,012 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:48:54,013 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:48:54,013 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:48:54,014 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:48:54,014 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:48:54,015 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 18:48:54,016 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,017 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,020 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,021 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,023 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,025 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,026 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:48:54,026 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:48:54,026 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,030 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,040 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:48:54,040 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:48:54,040 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:48:54,040 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 18:48:54,041 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 18:48:54,041 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 18:48:54,042 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 18:48:54,043 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:48:54,043 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:48:54,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:48:54,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:48:54,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:48:54,044 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:48:54,045 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:48:54,045 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 18:48:54,046 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,047 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,048 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,049 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,050 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,051 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,053 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:48:54,053 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,055 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 18:48:54,055 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 18:48:54,056 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 45.9ms
2025-11-24 18:48:54,057 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 14.7ms
2025-11-24 18:48:54,058 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 18:48:54,059 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:48:54,059 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:48:54,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:48:54,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:48:54,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:48:54,061 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:48:54,061 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:48:54,061 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 18:48:54,062 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,064 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,065 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,066 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,067 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,070 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,071 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:48:54,072 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:48:54,072 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,075 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,078 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:48:54,078 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:48:54,078 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:48:54,079 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 18:48:54,079 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 18:48:54,079 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 18:48:54,080 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 18:48:54,081 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:48:54,081 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:48:54,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:48:54,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:48:54,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:48:54,083 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:48:54,083 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:48:54,083 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 18:48:54,083 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.9ms
2025-11-24 18:48:54,084 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,086 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,088 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,089 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,090 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,091 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,092 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:48:54,092 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:54,093 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 18:48:54,093 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 18:48:54,095 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 14.6ms
2025-11-24 18:48:56,302 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:48:56,302 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:48:56,302 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:48:56,302 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:48:56,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:48:56,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:48:56,304 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:48:56,305 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:48:56,305 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:48:56,306 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,308 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,309 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,311 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,314 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,317 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,319 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:48:56,319 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:48:56,319 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:48:56,319 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,324 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:48:56,324 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,329 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:48:56,330 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:48:56,330 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:48:56,330 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:48:56,330 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:48:56,331 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:48:56,331 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 29.9ms
2025-11-24 18:48:56,333 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:48:56,334 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:48:56,334 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:48:56,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:48:56,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:48:56,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:48:56,336 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:48:56,336 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:48:56,337 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:48:56,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,339 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,341 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,342 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,343 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,344 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,346 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:48:56,346 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:48:56,346 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:48:56,346 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,348 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:48:56,348 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:48:56,351 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:48:56,351 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:48:56,351 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:48:56,351 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:48:56,352 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:48:56,352 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:48:56,352 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.9ms
2025-11-24 18:49:01,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 18:49:01,152 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.7ms
2025-11-24 18:49:01,154 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 18:49:01,154 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:49:01,154 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:49:01,154 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:49:01,155 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:49:01,155 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:49:01,156 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:49:01,156 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:49:01,156 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 18:49:01,157 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:01,158 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:01,160 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 18:49:01,160 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 18:49:01,160 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 18:49:01,161 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 7.5ms
2025-11-24 18:49:14,030 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 18:49:14,031 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:49:14,031 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:49:14,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:49:14,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:49:14,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:49:14,033 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:49:14,033 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:49:14,033 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 18:49:14,038 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 18:49:14,038 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=2
2025-11-24 18:49:14,038 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 18:49:14,038 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:14,043 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_tech', cliente_id_buscado=2
2025-11-24 18:49:14,044 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 13.7ms
2025-11-24 18:49:22,724 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 18:49:22,724 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:49:22,724 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:49:22,725 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:49:22,725 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:49:22,725 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:49:22,726 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:49:22,726 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:49:22,727 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 18:49:22,730 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 18:49:22,730 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 18:49:22,731 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 18:49:22,731 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:22,966 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:22,969 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:22,970 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 18:49:22,970 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 18:49:22,970 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:22,975 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:22,976 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 18:49:22,976 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:22,977 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 18:49:22,978 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 15, Rotación: False
2025-11-24 18:49:22,978 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 15
2025-11-24 18:49:22,978 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 18:49:22,979 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 255.6ms
2025-11-24 18:49:22,999 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:49:23,000 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:49:23,000 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:49:23,000 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:49:23,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:49:23,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:49:23,003 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:49:23,003 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:49:23,003 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 18:49:23,004 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:49:23,004 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,006 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,008 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,009 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,010 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 18:49:23,010 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:49:23,010 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,013 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 18:49:23,013 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 18:49:23,014 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:49:23,014 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:49:23,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:49:23,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:49:23,015 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:49:23,016 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:49:23,016 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:49:23,016 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:49:23,017 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,019 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,020 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,021 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,023 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,023 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,025 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:49:23,025 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:49:23,025 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:49:23,025 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,027 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:49:23,027 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,030 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:49:23,030 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:49:23,030 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:49:23,031 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:49:23,031 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:49:23,031 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:49:23,032 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 32.8ms
2025-11-24 18:49:23,033 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 29.3ms
2025-11-24 18:49:23,035 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:49:23,035 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:49:23,036 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:49:23,036 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:49:23,036 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:49:23,036 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:49:23,037 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:49:23,038 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:49:23,038 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 18:49:23,039 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,040 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,042 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,043 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,044 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 18:49:23,044 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:49:23,044 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,046 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 18:49:23,046 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 18:49:23,047 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:49:23,048 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:49:23,048 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:49:23,048 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:49:23,049 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:49:23,049 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:49:23,050 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:49:23,050 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:49:23,051 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:49:23,051 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,053 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,055 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,056 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,057 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,058 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,059 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:49:23,059 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:49:23,059 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:49:23,059 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,061 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:49:23,062 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:23,064 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:49:23,064 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:49:23,065 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:49:23,065 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:49:23,065 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:49:23,065 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:49:23,066 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 31.3ms
2025-11-24 18:49:23,067 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 19.6ms
2025-11-24 18:49:34,358 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 18:49:34,359 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:49:34,359 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:49:34,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:49:34,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:49:34,360 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:49:34,361 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:49:34,362 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:49:34,362 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 18:49:34,363 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,365 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,367 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,369 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,370 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,372 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,374 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:49:34,374 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:49:34,375 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,378 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,382 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:49:34,382 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:49:34,382 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:49:34,382 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 18:49:34,382 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 18:49:34,383 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 18:49:34,384 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 18:49:34,384 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:49:34,385 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:49:34,385 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:49:34,385 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:49:34,385 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:49:34,386 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:49:34,387 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:49:34,387 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 18:49:34,387 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 29.2ms
2025-11-24 18:49:34,388 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,389 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,390 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,392 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,393 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,395 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,396 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:49:34,396 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,397 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 18:49:34,397 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 18:49:34,399 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 15.3ms
2025-11-24 18:49:34,401 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 18:49:34,402 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:49:34,402 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:49:34,402 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:49:34,402 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:49:34,402 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:49:34,404 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:49:34,404 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:49:34,404 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 18:49:34,405 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,407 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,408 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,410 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,414 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,416 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,417 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:49:34,418 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:49:34,418 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,420 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,423 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:49:34,424 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:49:34,424 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:49:34,425 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 18:49:34,425 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 18:49:34,425 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 18:49:34,427 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 18:49:34,427 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:49:34,428 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:49:34,428 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:49:34,428 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:49:34,428 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:49:34,429 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:49:34,430 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:49:34,430 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 18:49:34,430 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 29.5ms
2025-11-24 18:49:34,431 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,432 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,433 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,434 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,435 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,435 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,436 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:49:34,437 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:49:34,438 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 18:49:34,438 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 18:49:34,439 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.3ms
2025-11-24 18:50:49,695 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 18:50:49,695 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 18:50:49,696 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.1ms
2025-11-24 18:50:49,697 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.7ms
2025-11-24 18:50:49,702 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:50:49,702 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:50:49,702 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:50:49,703 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:50:49,703 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:50:49,703 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:50:49,722 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:50:49,722 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:50:49,723 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:50:49,724 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,734 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,738 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,739 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,741 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,742 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,745 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:50:49,745 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:50:49,746 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:50:49,746 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,762 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:50:49,762 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,768 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:50:49,769 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:50:49,769 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:50:49,769 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:50:49,769 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:50:49,770 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:50:49,770 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 68.8ms
2025-11-24 18:50:49,773 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:50:49,774 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:50:49,774 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:50:49,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:50:49,775 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:50:49,775 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:50:49,780 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:50:49,781 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:50:49,781 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:50:49,782 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,784 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,786 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,788 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,790 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,791 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,792 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:50:49,793 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:50:49,793 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:50:49,793 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,798 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:50:49,798 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:49,804 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:50:49,805 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:50:49,805 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:50:49,805 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:50:49,805 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:50:49,805 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:50:49,806 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 33.5ms
2025-11-24 18:50:52,020 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 18:50:52,021 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:50:52,021 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:50:52,021 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:50:52,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:50:52,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:50:52,025 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:50:52,026 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:50:52,026 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 18:50:52,027 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,029 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,032 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,033 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,034 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,036 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,037 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 18:50:52,037 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 18:50:52,037 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,040 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,044 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 18:50:52,044 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 18:50:52,045 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 24.5ms
2025-11-24 18:50:52,047 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 18:50:52,047 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:50:52,048 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:50:52,048 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:50:52,048 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:50:52,048 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:50:52,050 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:50:52,050 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:50:52,050 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 18:50:52,051 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,052 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,053 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,053 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,054 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,055 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,056 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 18:50:52,056 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 18:50:52,056 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,058 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:50:52,061 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 18:50:52,061 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 18:50:52,062 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.4ms
2025-11-24 18:51:09,697 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:51:09,697 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:09,698 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:09,698 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:09,698 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:09,698 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:09,699 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:09,700 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:09,700 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:51:09,701 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,702 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,704 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,705 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,707 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,709 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,710 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:51:09,711 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:51:09,711 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:51:09,711 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,714 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:51:09,715 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,720 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:51:09,720 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:09,720 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:09,721 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:09,721 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:51:09,721 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:51:09,722 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 25.1ms
2025-11-24 18:51:09,724 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:51:09,724 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:09,725 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:09,725 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:09,725 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:09,725 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:09,726 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:09,727 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:09,727 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:51:09,728 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,729 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,731 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,732 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,734 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,735 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,736 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:51:09,736 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:51:09,737 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:51:09,737 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,739 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:51:09,739 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:09,741 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:51:09,742 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:09,742 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:09,742 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:09,742 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:51:09,742 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:51:09,743 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 19.1ms
2025-11-24 18:51:11,858 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 18:51:11,858 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:11,858 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:11,859 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:11,859 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:11,859 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:11,861 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:11,861 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:11,861 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 18:51:11,862 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,864 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,865 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,867 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,869 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,870 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,871 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:51:11,871 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:51:11,871 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,874 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,884 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:11,885 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:11,885 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:11,885 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 18:51:11,885 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 18:51:11,885 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 18:51:11,887 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 18:51:11,887 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 29.4ms
2025-11-24 18:51:11,887 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:11,888 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:11,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:11,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:11,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:11,889 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:11,889 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:11,889 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 18:51:11,890 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,892 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,893 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,893 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,894 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,895 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,896 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:51:11,896 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,897 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 18:51:11,898 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 18:51:11,900 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 13.0ms
2025-11-24 18:51:11,900 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 18:51:11,901 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:11,901 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:11,902 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:11,902 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:11,902 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:11,903 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:11,903 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:11,903 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 18:51:11,904 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,905 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,906 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,907 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,908 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,909 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,910 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:51:11,910 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:51:11,910 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,912 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,915 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:11,915 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:11,915 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:11,915 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 18:51:11,916 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 18:51:11,916 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 18:51:11,918 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 18:51:11,919 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:11,919 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:11,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:11,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:11,920 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:11,921 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:11,921 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:11,921 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 18:51:11,922 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,923 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,924 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,925 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,926 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,926 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,927 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:51:11,928 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:11,928 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 18:51:11,929 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 18:51:11,929 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 29.1ms
2025-11-24 18:51:11,930 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.4ms
2025-11-24 18:51:16,191 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:51:16,192 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:16,192 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:16,192 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:16,193 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:16,193 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:16,194 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:16,194 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:16,194 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:51:16,195 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,197 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,198 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,201 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,203 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,206 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,207 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:51:16,208 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:51:16,208 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:51:16,208 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,211 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:51:16,211 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,214 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:51:16,214 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:16,214 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:16,215 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:16,215 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:51:16,215 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:51:16,216 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 24.2ms
2025-11-24 18:51:16,218 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:51:16,218 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:16,219 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:16,219 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:16,219 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:16,219 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:16,221 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:16,221 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:16,222 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:51:16,223 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,225 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,227 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,229 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,231 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,232 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,233 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:51:16,233 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:51:16,234 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:51:16,234 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,236 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:51:16,236 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,239 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:51:16,239 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:16,239 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:16,239 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:16,239 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:51:16,240 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:51:16,241 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 22.6ms
2025-11-24 18:51:16,763 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 18:51:16,764 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:16,765 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:16,765 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:16,765 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:16,765 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:16,767 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:16,767 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:16,767 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 18:51:16,768 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,770 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,772 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,774 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,775 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,777 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,778 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 18:51:16,778 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 18:51:16,778 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,780 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,782 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 18:51:16,783 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 18:51:16,783 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 20.4ms
2025-11-24 18:51:16,785 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 18:51:16,786 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:16,786 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:16,786 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:16,786 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:16,786 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:16,788 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:16,788 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:16,789 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 18:51:16,790 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,791 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,792 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,793 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,794 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,795 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,796 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 18:51:16,796 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 18:51:16,796 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,798 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:16,800 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 18:51:16,800 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 18:51:16,801 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.6ms
2025-11-24 18:51:17,575 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 18:51:17,576 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:17,576 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:17,576 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:17,576 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:17,577 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:17,578 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:17,578 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:17,579 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 18:51:17,579 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,584 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,592 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:51:17,592 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 18:51:17,592 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,594 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 18:51:17,594 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 18:51:17,595 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 19.8ms
2025-11-24 18:51:17,597 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 18:51:17,598 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:17,598 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:17,598 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:17,598 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:17,598 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:17,600 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:17,600 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:17,600 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 18:51:17,601 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,602 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,604 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,606 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,607 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,609 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,610 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:51:17,610 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 18:51:17,610 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:17,611 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 18:51:17,611 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 18:51:17,612 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 15.0ms
2025-11-24 18:51:18,660 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:51:18,661 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:18,661 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:18,661 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:18,662 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:18,662 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:18,663 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:18,664 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:18,664 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:51:18,665 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,666 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,668 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,669 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,671 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,672 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,674 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:51:18,675 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:51:18,675 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:51:18,675 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,677 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:51:18,678 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,680 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:51:18,680 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:18,680 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:18,680 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:18,680 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:51:18,681 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:51:18,681 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 21.1ms
2025-11-24 18:51:18,683 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:51:18,684 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:51:18,684 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:51:18,685 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:51:18,685 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:51:18,685 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:51:18,686 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:51:18,687 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:51:18,687 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:51:18,688 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,689 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,691 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,692 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,693 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,694 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,695 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:51:18,695 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:51:18,695 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:51:18,696 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,698 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:51:18,698 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:51:18,700 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:51:18,700 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:18,700 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:18,700 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:51:18,701 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:51:18,701 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:51:18,701 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.0ms
2025-11-24 18:52:10,282 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 18:52:10,283 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.8ms
2025-11-24 18:52:10,285 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 18:52:10,285 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:10,286 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:52:10,286 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:52:10,286 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:10,286 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:52:10,286 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:52:10,286 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:52:10,287 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 18:52:10,293 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 18:52:10,293 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 18:52:10,293 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 18:52:10,543 - app.core.auth - WARNING - [AUTH] Contraseña incorrecta para: username='superadmin', usuario_id=1
2025-11-24 18:52:10,544 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 259.1ms
2025-11-24 18:52:15,532 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 18:52:15,533 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:15,533 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:52:15,533 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:52:15,534 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:15,534 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:52:15,534 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:52:15,534 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A

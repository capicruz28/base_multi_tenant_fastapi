2025-11-18 14:44:03,924 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,927 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,927 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,928 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,928 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,928 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,929 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:03,933 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:03,933 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:03,934 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:03,934 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.0ms
2025-11-18 14:44:04,164 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:04,164 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,165 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,165 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,165 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,165 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,165 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,166 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,166 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:04,168 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:04,169 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:04,179 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:44:04,180 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2172, Rotación: True
2025-11-18 14:44:04,182 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:44:04,182 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:44:04,182 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:44:04,183 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2172
2025-11-18 14:44:04,183 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:04,184 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 19.8ms
2025-11-18 14:44:04,188 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:04,189 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,189 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,189 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,189 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,190 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,190 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,190 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,190 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:04,192 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:04,192 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:04,195 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:04,195 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:04,196 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.6ms
2025-11-18 14:44:04,207 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:04,208 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,208 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,208 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,208 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,209 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,209 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,209 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,209 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:04,213 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:04,214 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:04,215 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:04,215 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 14:44:04,217 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:04,217 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,217 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,218 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,218 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,218 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,218 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:04,221 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:04,222 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:04,222 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:04,223 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.7ms
2025-11-18 14:44:04,421 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:04,421 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,421 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,422 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,422 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,422 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,422 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,422 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,423 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:04,425 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:04,427 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:04,430 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2172
2025-11-18 14:44:04,430 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2172
2025-11-18 14:44:04,431 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:04,431 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.5ms
2025-11-18 14:44:04,476 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:04,477 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,477 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,478 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,478 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,478 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,478 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,479 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:04,481 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:04,482 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:04,485 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:04,485 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:04,486 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.9ms
2025-11-18 14:44:04,505 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:04,505 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,505 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,506 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,506 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,506 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,506 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,507 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,507 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:04,513 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:04,513 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:04,514 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:04,515 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.7ms
2025-11-18 14:44:04,517 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:04,517 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,517 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,518 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,518 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,518 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,518 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,518 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,518 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:04,523 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:04,523 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:04,524 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:04,525 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.3ms
2025-11-18 14:44:04,671 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:04,671 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,672 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,672 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,673 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,673 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,673 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:04,676 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:04,677 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:04,679 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2172
2025-11-18 14:44:04,679 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2172
2025-11-18 14:44:04,679 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:04,680 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.0ms
2025-11-18 14:44:04,687 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:04,687 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,687 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,688 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,688 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,688 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,688 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,688 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,688 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:04,690 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:04,691 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:04,694 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:04,694 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:04,695 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.6ms
2025-11-18 14:44:04,709 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:04,711 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,712 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,712 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,713 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,713 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,713 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,714 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:04,719 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:04,719 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:04,721 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:04,721 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.7ms
2025-11-18 14:44:04,723 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:04,724 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,724 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,724 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,724 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,724 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,724 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,724 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,725 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:04,730 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:04,730 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:04,732 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:04,732 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.2ms
2025-11-18 14:44:04,881 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:04,881 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,881 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,882 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,882 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,882 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,882 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,882 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:04,885 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:04,886 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:04,888 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2172
2025-11-18 14:44:04,888 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2172
2025-11-18 14:44:04,888 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:04,889 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.1ms
2025-11-18 14:44:04,896 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:04,896 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,897 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,897 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,897 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,898 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,898 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:04,900 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:04,901 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:04,903 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:04,903 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:04,904 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.6ms
2025-11-18 14:44:04,920 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:04,920 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,920 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,921 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,921 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,921 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,921 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,921 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,922 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:04,925 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:04,925 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:04,926 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:04,927 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.1ms
2025-11-18 14:44:04,929 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:04,930 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:04,930 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:04,931 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:04,931 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:04,931 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:04,931 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:04,931 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:04,931 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:04,935 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:04,935 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:04,936 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:04,937 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 14:44:05,120 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:05,120 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:05,120 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:05,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:05,121 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:05,121 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:05,121 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:05,121 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:05,121 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:05,125 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:05,126 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:05,128 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:44:05,129 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2173, Rotación: True
2025-11-18 14:44:05,130 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:44:05,131 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:44:05,131 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:44:05,131 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2173
2025-11-18 14:44:05,131 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:05,132 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.6ms
2025-11-18 14:44:05,137 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:05,138 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:05,138 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:05,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:05,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:05,139 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:05,139 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:05,139 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:05,139 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:05,141 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:05,142 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:05,145 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:05,145 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:05,146 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.5ms
2025-11-18 14:44:05,157 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:05,158 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:05,158 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:05,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:05,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:05,158 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:05,159 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:05,159 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:05,159 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:05,164 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:05,164 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:05,165 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:05,166 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.5ms
2025-11-18 14:44:05,168 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:05,168 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:05,168 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:05,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:05,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:05,169 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:05,169 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:05,169 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:05,169 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:05,174 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:05,174 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:05,176 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:05,176 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.8ms
2025-11-18 14:44:05,334 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:05,335 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:05,335 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:05,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:05,336 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:05,336 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:05,336 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:05,336 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:05,336 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:05,339 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:05,341 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:05,343 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2173
2025-11-18 14:44:05,343 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2173
2025-11-18 14:44:05,344 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:05,344 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.9ms
2025-11-18 14:44:05,353 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:05,354 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:05,354 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:05,354 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:05,354 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:05,355 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:05,355 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:05,355 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:05,355 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:05,357 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:05,357 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:05,361 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:05,361 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:05,362 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.7ms
2025-11-18 14:44:05,374 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:05,374 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:05,375 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:05,375 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:05,375 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:05,375 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:05,375 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:05,375 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:05,376 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:05,381 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:05,381 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:05,382 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:05,383 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.9ms
2025-11-18 14:44:05,385 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:05,385 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:05,385 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:05,386 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:05,386 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:05,386 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:05,386 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:05,386 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:05,386 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:05,390 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:05,390 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:05,391 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:05,392 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.8ms
2025-11-18 14:46:53,002 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-18 14:49:07,244 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-18 14:49:11,758 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:11,759 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:11,759 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:11,759 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:11,759 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:11,759 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:11,759 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:11,760 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:11,760 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:11,841 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:11,846 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:11,853 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:11,853 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2174, Rotación: True
2025-11-18 14:49:11,859 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:11,859 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:11,859 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:11,859 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2174
2025-11-18 14:49:11,860 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:11,860 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 102.3ms
2025-11-18 14:49:11,864 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:11,865 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:11,865 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:11,865 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:11,865 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:11,866 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:11,866 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:11,866 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:11,866 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:11,868 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:11,868 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:11,891 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:11,891 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:11,892 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 27.5ms
2025-11-18 14:49:11,914 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:11,914 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:11,915 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:11,915 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:11,915 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:11,915 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:11,915 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:11,916 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:11,916 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:11,933 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:11,934 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:11,986 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:11,987 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 72.8ms
2025-11-18 14:49:11,989 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:11,989 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:11,989 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:11,989 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:11,990 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:11,990 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:11,990 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:11,990 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:11,990 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:11,994 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:11,994 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:11,995 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:11,996 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.9ms
2025-11-18 14:49:12,680 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:12,681 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:12,681 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:12,681 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:12,682 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:12,682 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:12,682 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:12,682 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:12,683 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:12,686 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:12,688 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:12,692 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:12,692 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2175, Rotación: True
2025-11-18 14:49:12,694 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:12,694 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:12,695 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:12,695 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2175
2025-11-18 14:49:12,695 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:12,696 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.1ms
2025-11-18 14:49:12,701 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:12,702 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:12,702 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:12,703 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:12,703 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:12,703 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:12,703 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:12,704 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:12,704 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:12,706 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:12,706 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:12,712 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:12,712 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:12,713 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 11.6ms
2025-11-18 14:49:12,730 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:12,731 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:12,731 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:12,731 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:12,731 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:12,731 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:12,731 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:12,732 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:12,732 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:12,736 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:12,737 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:12,738 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:12,739 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.8ms
2025-11-18 14:49:12,741 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:12,741 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:12,742 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:12,742 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:12,742 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:12,742 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:12,742 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:12,743 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:12,743 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:12,753 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:12,753 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:12,755 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:12,756 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.4ms
2025-11-18 14:49:13,371 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:13,371 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:13,372 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:13,372 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:13,372 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:13,372 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:13,372 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:13,373 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:13,373 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:13,378 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:13,380 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:13,392 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:13,393 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2176, Rotación: True
2025-11-18 14:49:13,395 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:13,396 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:13,396 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:13,397 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2176
2025-11-18 14:49:13,397 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:13,398 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 26.8ms
2025-11-18 14:49:13,402 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:13,403 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:13,403 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:13,403 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:13,404 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:13,404 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:13,404 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:13,404 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:13,404 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:13,406 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:13,406 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:13,409 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:13,409 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:13,411 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.4ms
2025-11-18 14:49:13,426 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:13,427 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:13,427 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:13,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:13,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:13,428 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:13,428 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:13,428 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:13,428 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:13,432 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:13,432 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:13,433 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:13,433 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.7ms
2025-11-18 14:49:13,435 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:13,435 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:13,435 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:13,436 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:13,436 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:13,436 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:13,437 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:13,437 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:13,437 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:13,442 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:13,443 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:13,444 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:13,445 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.0ms
2025-11-18 14:49:13,879 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:13,879 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:13,880 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:13,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:13,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:13,880 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:13,880 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:13,881 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:13,881 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:13,884 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:13,885 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:13,888 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2176
2025-11-18 14:49:13,888 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2176
2025-11-18 14:49:13,889 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:13,890 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.2ms
2025-11-18 14:49:13,897 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:13,897 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:13,898 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:13,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:13,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:13,898 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:13,898 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:13,899 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:13,899 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:13,901 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:13,901 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:13,907 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:13,908 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:13,908 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 11.7ms
2025-11-18 14:49:13,923 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:13,923 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:13,924 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:13,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:13,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:13,924 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:13,924 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:13,925 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:13,925 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:13,928 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:13,929 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:13,930 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:13,930 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-18 14:49:13,932 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:13,933 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:13,933 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:13,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:13,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:13,934 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:13,934 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:13,935 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:13,935 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:13,942 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:13,942 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:13,944 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:13,945 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 12.5ms
2025-11-18 14:49:14,094 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:14,094 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,094 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,094 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,095 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,095 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,095 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,095 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:14,098 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:14,099 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:14,103 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:14,104 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2177, Rotación: True
2025-11-18 14:49:14,107 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:14,107 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:14,108 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:14,108 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2177
2025-11-18 14:49:14,108 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:14,110 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.1ms
2025-11-18 14:49:14,115 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:14,115 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,116 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,116 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,117 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,117 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,117 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:14,119 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:14,119 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:14,124 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:14,125 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:14,125 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.4ms
2025-11-18 14:49:14,138 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:14,138 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,139 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,139 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,139 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,139 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,140 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,140 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,140 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:14,146 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:14,146 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:14,147 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:14,148 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.1ms
2025-11-18 14:49:14,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:14,151 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,152 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,152 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,153 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,153 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,153 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,154 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:14,158 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:14,158 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:14,160 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:14,160 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.7ms
2025-11-18 14:49:14,347 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:14,347 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,347 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,347 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,348 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,348 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,348 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,348 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,349 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:14,353 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:14,358 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:14,360 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2177
2025-11-18 14:49:14,360 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2177
2025-11-18 14:49:14,360 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:14,361 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.4ms
2025-11-18 14:49:14,366 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:14,367 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,367 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,367 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,368 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,368 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,368 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:14,371 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:14,371 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:14,374 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:14,374 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:14,375 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.7ms
2025-11-18 14:49:14,389 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:14,390 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,390 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,391 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,391 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,391 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,391 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,391 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,391 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:14,395 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:14,395 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:14,396 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:14,397 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-18 14:49:14,399 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:14,399 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,399 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,400 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,400 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,400 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,400 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:14,407 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:14,407 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:14,409 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:14,409 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.7ms
2025-11-18 14:49:14,708 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:14,708 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,708 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,709 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,709 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,709 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,710 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,710 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,710 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:14,722 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:14,723 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:14,725 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2177
2025-11-18 14:49:14,725 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2177
2025-11-18 14:49:14,726 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:14,727 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 18.9ms
2025-11-18 14:49:14,733 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:14,734 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,734 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,734 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,734 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,735 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,735 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,735 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,735 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:14,738 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:14,738 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:14,742 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:14,743 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:14,744 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 11.3ms
2025-11-18 14:49:14,760 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:14,760 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,761 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,761 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,761 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,761 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,761 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,762 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,762 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:14,765 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:14,765 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:14,766 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:14,767 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.5ms
2025-11-18 14:49:14,768 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:14,769 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,769 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,770 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,770 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,770 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,770 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,771 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,771 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:14,775 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:14,776 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:14,777 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:14,778 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.7ms
2025-11-18 14:49:14,938 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:14,939 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,939 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,940 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,940 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,940 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,941 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,941 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,941 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:14,944 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:14,947 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:14,951 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2177
2025-11-18 14:49:14,951 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2177
2025-11-18 14:49:14,952 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:14,953 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.1ms
2025-11-18 14:49:14,962 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:14,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,963 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,963 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,963 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,964 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,964 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:14,966 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:14,967 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:14,972 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:14,973 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:14,974 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 12.6ms
2025-11-18 14:49:14,993 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:14,993 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:14,994 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:14,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:14,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:14,994 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:14,994 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:14,995 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:14,995 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:14,999 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:15,000 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:15,001 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:15,002 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.8ms
2025-11-18 14:49:15,004 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:15,004 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:15,004 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:15,005 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:15,005 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:15,006 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:15,006 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:15,006 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:15,007 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:15,013 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:15,013 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:15,015 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:15,015 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.7ms
2025-11-18 14:49:15,180 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:15,180 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:15,181 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:15,181 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:15,181 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:15,182 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:15,182 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:15,182 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:15,182 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:15,185 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:15,186 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:15,189 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:15,190 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2178, Rotación: True
2025-11-18 14:49:15,191 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:15,192 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:15,192 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:15,192 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2178
2025-11-18 14:49:15,192 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:15,193 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.0ms
2025-11-18 14:49:15,199 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:15,200 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:15,200 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:15,200 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:15,200 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:15,200 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:15,201 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:15,201 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:15,201 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:15,203 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:15,203 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:15,209 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:15,209 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:15,210 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 11.2ms
2025-11-18 14:49:15,369 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:15,369 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:15,370 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:15,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:15,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:15,370 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:15,371 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:15,371 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:15,371 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:15,374 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:15,376 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:15,379 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2178
2025-11-18 14:49:15,379 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2178
2025-11-18 14:49:15,379 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:15,380 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.6ms
2025-11-18 14:49:15,501 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:15,501 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:15,501 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:15,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:15,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:15,502 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:15,502 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:15,502 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:15,502 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:15,505 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:15,507 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:15,517 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2178
2025-11-18 14:49:15,517 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2178
2025-11-18 14:49:15,517 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:15,518 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 17.5ms
2025-11-18 14:49:15,527 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:15,527 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:15,528 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:15,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:15,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:15,528 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:15,529 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:15,529 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:15,529 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:15,531 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:15,531 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:15,534 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:15,534 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:15,535 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.8ms
2025-11-18 14:49:15,551 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:15,551 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:15,551 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:15,551 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:15,551 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:15,552 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:15,552 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:15,552 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:15,552 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:15,557 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:15,557 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:15,558 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:15,559 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.4ms
2025-11-18 14:49:15,561 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:15,561 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:15,562 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:15,562 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:15,562 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:15,562 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:15,562 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:15,562 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:15,563 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:15,567 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:15,567 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:15,568 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:15,569 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.6ms
2025-11-18 14:49:16,455 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-18 14:49:16,456 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-18 14:49:16,458 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-18 14:49:16,458 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:16,458 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:16,459 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:16,459 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:16,459 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:16,459 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:16,459 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:16,459 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-18 14:49:16,462 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:16,463 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:16,463 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-18 14:49:16,463 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 5.6ms
2025-11-18 14:49:25,042 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 14:49:25,043 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:25,043 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:25,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:25,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:25,043 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:25,043 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:25,043 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:25,044 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 14:49:25,064 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 14:49:25,064 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 14:49:25,065 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 14:49:25,337 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 14:49:25,337 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 14:49:25,337 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 14:49:25,342 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:25,343 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2179, Rotación: False
2025-11-18 14:49:25,343 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2179
2025-11-18 14:49:25,343 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 14:49:25,344 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 302.0ms
2025-11-18 14:49:25,368 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:25,368 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:25,368 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:25,368 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:25,369 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:25,369 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:25,369 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:25,369 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:25,370 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:25,388 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:25,389 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:25,439 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:25,440 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 72.2ms
2025-11-18 14:49:25,442 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:49:25,442 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:25,442 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:25,443 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:25,443 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:25,443 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:25,443 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:25,443 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:25,443 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:49:25,453 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:49:25,453 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:49:25,471 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:49:25,472 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:49:25,472 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 30.5ms
2025-11-18 14:49:25,475 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:49:25,475 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:25,475 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:25,475 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:25,475 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:25,476 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:25,476 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:25,476 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:25,476 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:49:25,485 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:49:25,487 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:49:25,488 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:49:25,488 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 13.5ms
2025-11-18 14:49:25,491 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:25,491 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:25,492 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:25,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:25,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:25,492 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:25,493 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:25,493 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:25,493 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:25,497 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:25,497 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:25,498 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:25,499 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.8ms
2025-11-18 14:49:25,501 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:49:25,501 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:25,501 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:25,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:25,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:25,502 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:25,502 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:25,502 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:25,503 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:49:25,508 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:49:25,508 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:49:25,511 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:49:25,512 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:49:25,512 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 11.4ms
2025-11-18 14:49:25,514 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:49:25,515 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:25,515 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:25,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:25,516 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:25,516 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:25,516 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:25,516 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:25,516 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:49:25,529 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:49:25,531 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:49:25,531 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:49:25,532 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 17.4ms
2025-11-18 14:49:26,514 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:49:26,515 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:26,515 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:26,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:26,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:26,516 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:26,516 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:26,516 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:26,516 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:49:26,522 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:49:26,522 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk2MjY1LCJpYXQiOjE3NjM0OTUzNjUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.zuN5F6S_xAADn45XEEu3I3OOvtTvssa2DPvpBtbHxK8', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTAwMTY1LCJpYXQiOjE3NjM0OTUzNjUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.M0Fy-2bof-um5Jj9CF7lIv5PX90s84xU0BjG-h_rzvg'}
2025-11-18 14:49:26,523 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:49:26,523 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:49:26,523 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:49:26,523 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:49:26,527 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:49:26,528 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.4ms
2025-11-18 14:49:26,531 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:49:26,532 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:26,532 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:26,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:26,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:26,532 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:26,533 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:26,533 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:26,533 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:49:26,537 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:49:26,538 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk2MjY1LCJpYXQiOjE3NjM0OTUzNjUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.zuN5F6S_xAADn45XEEu3I3OOvtTvssa2DPvpBtbHxK8', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTAwMTY1LCJpYXQiOjE3NjM0OTUzNjUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.M0Fy-2bof-um5Jj9CF7lIv5PX90s84xU0BjG-h_rzvg'}
2025-11-18 14:49:26,538 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:49:26,538 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:49:26,538 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:49:26,538 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:49:26,540 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:49:26,541 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.5ms
2025-11-18 14:49:28,041 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:28,042 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:28,042 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:28,042 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:28,042 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:28,043 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:28,043 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:28,043 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:28,043 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:28,046 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:28,047 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:28,050 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:28,051 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2180, Rotación: True
2025-11-18 14:49:28,058 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:28,059 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:28,059 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:28,059 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2180
2025-11-18 14:49:28,060 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:28,060 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 18.9ms
2025-11-18 14:49:28,064 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:28,064 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:28,064 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:28,064 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:28,065 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:28,065 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:28,065 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:28,066 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:28,066 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:28,068 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:28,068 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:28,071 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:28,071 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:28,072 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.9ms
2025-11-18 14:49:29,058 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:29,059 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:29,059 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:29,059 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:29,059 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:29,060 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:29,060 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:29,060 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:29,060 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:29,065 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:29,066 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:29,067 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:29,068 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.5ms
2025-11-18 14:49:29,071 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:29,072 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:29,072 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:29,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:29,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:29,073 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:29,073 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:29,074 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:29,074 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:29,078 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:29,079 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:29,080 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:29,081 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.6ms
2025-11-18 14:49:29,962 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:29,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:29,962 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:29,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:29,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:29,963 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:29,963 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:29,963 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:29,964 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:29,976 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:29,978 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:29,981 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:29,982 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2181, Rotación: True
2025-11-18 14:49:29,983 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:29,984 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:29,985 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:29,985 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2181
2025-11-18 14:49:29,985 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:29,986 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 24.1ms
2025-11-18 14:49:29,992 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:29,993 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:29,993 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:29,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:29,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:29,994 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:29,994 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:29,994 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:29,994 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:29,997 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:29,997 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:29,999 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:29,999 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:30,000 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.7ms
2025-11-18 14:49:30,013 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:30,014 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:30,014 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:30,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:30,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:30,014 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:30,015 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:30,015 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:30,015 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:30,021 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:30,021 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:30,023 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:30,023 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.1ms
2025-11-18 14:49:30,026 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:30,026 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:30,026 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:30,026 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:30,027 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:30,027 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:30,027 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:30,027 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:30,027 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:30,032 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:30,032 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:30,033 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:30,034 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 14:49:30,431 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:30,432 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:30,432 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:30,432 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:30,432 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:30,433 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:30,433 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:30,433 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:30,433 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:30,436 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:30,437 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:30,441 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:30,441 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2182, Rotación: True
2025-11-18 14:49:30,443 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:30,443 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:30,444 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:30,444 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2182
2025-11-18 14:49:30,444 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:30,445 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.6ms
2025-11-18 14:49:30,450 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:30,451 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:30,451 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:30,451 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:30,451 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:30,452 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:30,452 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:30,452 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:30,452 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:30,455 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:30,455 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:30,458 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:30,458 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:30,459 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.5ms
2025-11-18 14:49:30,476 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:30,477 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:30,477 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:30,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:30,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:30,477 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:30,477 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:30,478 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:30,478 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:30,482 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:30,482 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:30,484 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:30,484 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.2ms
2025-11-18 14:49:30,488 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:30,489 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:30,489 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:30,489 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:30,490 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:30,490 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:30,490 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:30,490 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:30,491 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:30,496 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:30,496 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:30,497 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:30,498 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.6ms
2025-11-18 14:49:30,756 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:30,757 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:30,757 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:30,757 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:30,758 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:30,758 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:30,758 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:30,758 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:30,758 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:30,761 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:30,762 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:30,764 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2182
2025-11-18 14:49:30,764 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2182
2025-11-18 14:49:30,764 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:30,765 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.8ms
2025-11-18 14:49:30,771 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:30,771 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:30,771 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:30,772 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:30,772 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:30,772 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:30,772 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:30,772 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:30,773 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:30,774 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:30,774 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:30,777 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:30,777 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:30,777 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.6ms
2025-11-18 14:49:30,796 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:30,796 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:30,796 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:30,797 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:30,797 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:30,797 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:30,797 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:30,797 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:30,798 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:30,805 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:30,805 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:30,806 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:30,807 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.1ms
2025-11-18 14:49:30,809 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:30,809 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:30,809 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:30,810 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:30,810 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:30,810 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:30,810 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:30,810 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:30,811 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:30,815 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:30,815 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:30,816 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:30,817 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 14:49:31,047 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:31,048 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,048 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,048 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,048 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,048 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,049 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,049 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,049 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:31,052 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:31,054 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:31,061 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:31,062 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2183, Rotación: True
2025-11-18 14:49:31,063 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:31,063 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:31,064 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:31,064 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2183
2025-11-18 14:49:31,064 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:31,065 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 17.5ms
2025-11-18 14:49:31,070 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:31,070 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,071 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,071 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,072 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,072 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,072 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,072 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:31,074 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:31,074 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:31,077 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:31,077 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:31,078 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.1ms
2025-11-18 14:49:31,094 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:31,095 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,095 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,095 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,096 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,096 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,096 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:31,100 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:31,100 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:31,101 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:31,102 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.5ms
2025-11-18 14:49:31,104 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:31,105 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,105 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,106 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,106 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,106 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,106 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:31,110 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:31,110 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:31,111 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:31,112 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 14:49:31,298 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:31,298 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,298 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,299 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,299 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,299 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,299 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,299 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,300 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:31,303 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:31,304 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:31,306 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2183
2025-11-18 14:49:31,306 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2183
2025-11-18 14:49:31,306 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:31,307 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.2ms
2025-11-18 14:49:31,313 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:31,314 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,314 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,314 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,315 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,315 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,315 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:31,317 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:31,317 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:31,322 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:31,322 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:31,323 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.6ms
2025-11-18 14:49:31,336 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:31,336 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,337 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,337 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,337 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,338 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,338 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:31,342 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:31,343 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:31,344 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:31,344 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.4ms
2025-11-18 14:49:31,346 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:31,347 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,347 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,347 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,347 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,347 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,348 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,348 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,348 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:31,353 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:31,353 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:31,356 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:31,357 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.5ms
2025-11-18 14:49:31,549 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:31,550 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,550 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,551 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,551 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,551 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,551 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:31,554 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:31,557 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:31,559 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2183
2025-11-18 14:49:31,560 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2183
2025-11-18 14:49:31,560 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:31,561 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.3ms
2025-11-18 14:49:31,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:31,566 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,566 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,567 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,567 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,568 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,568 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:31,570 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:31,571 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:31,574 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:31,574 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:31,575 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.4ms
2025-11-18 14:49:31,589 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:31,590 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,590 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,591 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,591 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,591 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,592 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:31,595 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:31,595 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:31,597 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:31,597 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.8ms
2025-11-18 14:49:31,599 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:31,600 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,600 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,601 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,601 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,601 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,601 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:31,606 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:31,606 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:31,608 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:31,608 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.8ms
2025-11-18 14:49:31,789 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:31,790 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,790 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,790 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,790 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,791 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,791 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,791 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,791 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:31,794 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:31,795 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:31,797 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2183
2025-11-18 14:49:31,797 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2183
2025-11-18 14:49:31,797 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:31,798 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.2ms
2025-11-18 14:49:31,805 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:31,806 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,806 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,806 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,806 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,806 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,807 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,807 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,807 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:31,809 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:31,809 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:31,811 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:31,812 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:31,812 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.3ms
2025-11-18 14:49:31,827 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:31,828 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,828 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,829 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,829 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,829 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,829 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,829 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,829 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:31,834 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:31,834 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:31,836 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:31,837 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.1ms
2025-11-18 14:49:31,840 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:31,840 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:31,840 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:31,841 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:31,841 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:31,841 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:31,841 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:31,841 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:31,842 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:31,845 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:31,846 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:31,847 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:31,847 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.5ms
2025-11-18 14:49:32,005 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:32,006 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,006 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,006 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,006 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,006 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,007 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,007 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,007 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:32,010 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:32,011 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:32,014 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:32,014 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2184, Rotación: True
2025-11-18 14:49:32,016 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:32,017 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:32,017 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:32,017 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2184
2025-11-18 14:49:32,017 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:32,018 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.0ms
2025-11-18 14:49:32,026 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:32,027 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,027 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,027 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,027 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,027 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,028 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,028 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,028 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:32,030 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:32,030 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:32,033 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:32,034 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:32,034 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.2ms
2025-11-18 14:49:32,048 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:32,048 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,049 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,049 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,049 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,049 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,049 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,050 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,050 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:32,055 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:32,056 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:32,058 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:32,059 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.9ms
2025-11-18 14:49:32,062 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:32,062 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,062 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,062 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,062 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,063 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,063 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,063 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,063 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:32,067 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:32,067 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:32,068 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:32,069 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-18 14:49:32,269 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:32,269 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,270 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,270 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,271 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,271 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,271 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:32,274 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:32,275 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:32,284 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2184
2025-11-18 14:49:32,285 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2184
2025-11-18 14:49:32,285 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:32,286 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 17.1ms
2025-11-18 14:49:32,295 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:32,296 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,296 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,297 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,297 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,297 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,297 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,297 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:32,299 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:32,300 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:32,303 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:32,303 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:32,303 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.1ms
2025-11-18 14:49:32,320 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:32,320 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,322 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,322 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,322 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,323 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,323 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,324 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,324 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:32,329 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:32,330 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:32,331 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:32,331 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.8ms
2025-11-18 14:49:32,333 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:32,334 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,334 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,334 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,334 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,335 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,335 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:32,340 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:32,341 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:32,342 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:32,342 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.2ms
2025-11-18 14:49:32,477 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:32,478 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,478 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,478 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,478 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,478 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,478 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,478 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,479 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:32,481 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:32,482 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:32,484 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2184
2025-11-18 14:49:32,484 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2184
2025-11-18 14:49:32,484 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:32,485 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 7.5ms
2025-11-18 14:49:32,493 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:32,493 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,494 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,494 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,494 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,494 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,494 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,495 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,495 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:32,497 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:32,497 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:32,500 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:32,500 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:32,501 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.8ms
2025-11-18 14:49:32,515 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:32,516 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,516 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,516 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,516 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,516 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,517 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,517 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,517 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:32,522 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:32,522 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:32,524 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:32,525 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.1ms
2025-11-18 14:49:32,527 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:32,527 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,527 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,527 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,528 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,528 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,528 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,528 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:32,532 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:32,533 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:32,534 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:32,534 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-18 14:49:32,716 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:32,716 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,716 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,717 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,717 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,717 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,717 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,717 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,717 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:32,720 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:32,721 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:32,724 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2184
2025-11-18 14:49:32,724 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2184
2025-11-18 14:49:32,725 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:32,725 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.3ms
2025-11-18 14:49:32,732 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:32,732 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,733 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,733 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,733 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,733 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,733 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,734 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,734 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:32,735 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:32,736 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:32,739 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:32,739 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:32,740 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.8ms
2025-11-18 14:49:32,755 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:32,756 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,756 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,757 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,757 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,757 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,757 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,757 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,758 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:32,763 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:32,763 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:32,764 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:32,764 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.5ms
2025-11-18 14:49:32,766 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:32,767 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,767 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,767 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,767 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,767 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,768 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,768 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,768 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:32,773 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:32,773 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:32,775 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:32,775 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.9ms
2025-11-18 14:49:32,950 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:32,951 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,951 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,951 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,951 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,951 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,952 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,952 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,952 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:32,956 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:32,963 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:32,967 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2184
2025-11-18 14:49:32,968 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2184
2025-11-18 14:49:32,968 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:32,969 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 18.5ms
2025-11-18 14:49:32,977 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:32,977 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:32,977 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:32,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:32,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:32,978 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:32,978 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:32,978 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:32,978 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:32,980 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:32,980 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:32,983 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:32,983 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:32,984 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.9ms
2025-11-18 14:49:33,000 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:33,000 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,000 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,001 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,001 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,001 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,002 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:33,006 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:33,007 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:33,008 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:33,008 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.6ms
2025-11-18 14:49:33,011 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:33,011 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,012 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,012 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,012 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,012 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,012 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,013 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,013 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:33,017 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:33,017 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:33,018 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:33,018 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 14:49:33,163 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:33,163 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,163 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,164 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,164 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,164 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,164 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,164 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,165 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:33,167 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:33,168 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:33,172 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:33,172 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2185, Rotación: True
2025-11-18 14:49:33,174 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:33,174 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:33,175 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:33,175 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2185
2025-11-18 14:49:33,175 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:33,176 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.5ms
2025-11-18 14:49:33,181 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:33,182 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,182 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,182 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,182 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,182 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,183 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,183 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,183 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:33,185 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:33,185 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:33,190 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:33,191 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:33,191 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.1ms
2025-11-18 14:49:33,207 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:33,208 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,208 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,208 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,208 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,209 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,209 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,209 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,209 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:33,213 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:33,214 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:33,215 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:33,215 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.2ms
2025-11-18 14:49:33,217 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:33,218 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,218 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,218 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,218 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,219 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,219 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:33,226 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:33,227 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:33,228 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:33,229 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.4ms
2025-11-18 14:49:33,407 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:33,408 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,408 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,408 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,408 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,408 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,408 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,409 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,409 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:33,412 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:33,413 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:33,414 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2185
2025-11-18 14:49:33,414 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2185
2025-11-18 14:49:33,415 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:33,415 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.3ms
2025-11-18 14:49:33,424 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:33,425 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,425 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,425 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,425 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,425 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,426 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,426 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,426 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:33,428 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:33,429 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:33,432 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:33,432 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:33,433 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.9ms
2025-11-18 14:49:33,448 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:33,448 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,448 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,449 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,449 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,449 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,449 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,450 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,450 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:33,454 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:33,455 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:33,458 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:33,459 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.0ms
2025-11-18 14:49:33,461 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:33,462 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,462 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,463 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,463 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,463 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,463 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,463 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,463 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:33,467 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:33,467 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:33,468 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:33,469 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-18 14:49:33,639 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:33,640 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,640 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,640 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,640 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,640 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,641 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,641 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,641 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:33,644 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:33,645 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:33,646 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2185
2025-11-18 14:49:33,647 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2185
2025-11-18 14:49:33,647 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:33,648 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.0ms
2025-11-18 14:49:33,662 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:33,662 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,663 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,663 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,663 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,663 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,664 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,664 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,664 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:33,666 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:33,667 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:33,670 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:33,671 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:33,671 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.2ms
2025-11-18 14:49:33,685 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:33,685 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,686 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,686 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,686 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,686 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,686 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,686 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,687 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:33,693 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:33,693 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:33,695 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:33,696 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.7ms
2025-11-18 14:49:33,698 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:33,699 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,699 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,699 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,700 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,700 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,700 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,700 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,701 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:33,705 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:33,705 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:33,707 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:33,708 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.4ms
2025-11-18 14:49:33,847 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:33,848 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,848 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,848 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,848 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,848 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,848 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,849 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,849 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:33,851 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:33,852 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:33,853 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2185
2025-11-18 14:49:33,853 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2185
2025-11-18 14:49:33,854 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:33,854 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 7.3ms
2025-11-18 14:49:33,865 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:33,865 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,866 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,866 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,866 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,866 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,867 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,867 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,867 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:33,869 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:33,869 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:33,873 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:33,873 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:33,874 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.1ms
2025-11-18 14:49:33,896 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:33,896 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,897 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,897 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,897 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,897 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,898 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:33,904 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:33,905 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:33,907 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:33,908 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 12.1ms
2025-11-18 14:49:33,910 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:33,910 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:33,911 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:33,911 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:33,911 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:33,911 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:33,911 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:33,912 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:33,912 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:33,915 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:33,915 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:33,917 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:33,917 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-18 14:49:34,063 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:34,063 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,063 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,064 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,064 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,064 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,064 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,064 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,065 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:34,067 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:34,069 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:34,073 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:34,073 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2186, Rotación: True
2025-11-18 14:49:34,074 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:34,075 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:34,075 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:34,075 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2186
2025-11-18 14:49:34,076 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:34,076 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.5ms
2025-11-18 14:49:34,082 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:34,083 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,083 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,083 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,083 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,084 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,084 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:34,086 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:34,086 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:34,092 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:34,092 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:34,093 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.7ms
2025-11-18 14:49:34,108 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:34,109 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,109 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,110 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,110 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,110 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,110 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,110 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:34,115 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:34,115 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:34,116 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:34,117 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.3ms
2025-11-18 14:49:34,119 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:34,119 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,119 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,120 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,120 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,120 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,121 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:34,127 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:34,128 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:34,129 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:34,130 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.9ms
2025-11-18 14:49:34,294 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:34,295 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,296 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,296 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,297 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,297 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,297 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:34,302 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:34,315 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:34,317 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2186
2025-11-18 14:49:34,318 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2186
2025-11-18 14:49:34,318 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:34,319 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 24.7ms
2025-11-18 14:49:34,326 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:34,327 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,327 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,327 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,328 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,328 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,328 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:34,331 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:34,331 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:34,334 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:34,334 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:34,335 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.8ms
2025-11-18 14:49:34,352 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:34,352 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,353 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,353 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,353 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,353 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,353 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,354 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,354 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:34,363 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:34,363 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:34,364 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:34,365 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 12.8ms
2025-11-18 14:49:34,368 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:34,369 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,369 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,369 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,370 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,370 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,370 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,370 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:34,377 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:34,377 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:34,379 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:34,380 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.6ms
2025-11-18 14:49:34,508 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:34,509 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,509 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,509 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,509 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,509 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,510 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,510 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,510 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:34,514 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:34,515 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:34,517 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2186
2025-11-18 14:49:34,517 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2186
2025-11-18 14:49:34,518 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:34,518 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.0ms
2025-11-18 14:49:34,527 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:34,528 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,528 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,529 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,529 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,529 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,529 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,530 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:34,532 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:34,532 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:34,535 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:34,535 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:34,536 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.4ms
2025-11-18 14:49:34,549 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:34,550 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,550 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,551 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,551 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,551 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,551 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:34,558 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:34,558 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:34,561 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:34,561 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 12.2ms
2025-11-18 14:49:34,564 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:34,564 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,564 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,565 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,565 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,565 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,566 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:34,571 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:34,571 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:34,573 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:34,574 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.1ms
2025-11-18 14:49:34,781 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:34,782 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,782 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,782 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,783 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,783 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,783 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,783 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,783 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:34,786 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:34,788 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:34,792 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2186
2025-11-18 14:49:34,792 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2186
2025-11-18 14:49:34,792 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:34,793 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.6ms
2025-11-18 14:49:34,940 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:34,941 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,941 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,941 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,941 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,942 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,942 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,942 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,942 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:34,944 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:34,945 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:34,955 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2186
2025-11-18 14:49:34,956 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2186
2025-11-18 14:49:34,956 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:34,957 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 17.1ms
2025-11-18 14:49:34,965 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:34,966 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,966 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,967 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,967 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,967 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,968 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:34,970 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:34,970 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:34,973 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:34,974 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:34,974 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.2ms
2025-11-18 14:49:34,988 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:34,989 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:34,989 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:34,990 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:34,990 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:34,990 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:34,991 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:34,991 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:34,991 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:34,997 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:34,998 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:35,009 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:35,010 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 21.5ms
2025-11-18 14:49:35,036 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:35,038 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,039 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,040 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,040 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,042 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,043 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,044 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,045 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:35,052 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:35,052 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:35,053 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:35,054 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 17.8ms
2025-11-18 14:49:35,172 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:35,173 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,173 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,173 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,173 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,173 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,174 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,174 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,174 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:35,176 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:35,178 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:35,180 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:49:35,181 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2187, Rotación: True
2025-11-18 14:49:35,182 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:49:35,183 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:49:35,183 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 14:49:35,184 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2187
2025-11-18 14:49:35,184 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:35,184 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.4ms
2025-11-18 14:49:35,192 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:35,193 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,194 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,194 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,194 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,194 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,195 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,195 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,195 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:35,198 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:35,198 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:35,201 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:35,201 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:35,202 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.7ms
2025-11-18 14:49:35,217 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:35,217 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,217 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,218 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,218 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,218 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,219 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:35,225 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:35,225 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:35,227 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:35,227 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.7ms
2025-11-18 14:49:35,230 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:35,230 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,231 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,231 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,232 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,232 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,232 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,232 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,233 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:35,237 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:35,237 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:35,238 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:35,238 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.6ms
2025-11-18 14:49:35,405 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:35,405 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,405 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,406 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,406 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,406 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,406 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,406 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,407 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:35,409 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:35,410 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:35,412 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2187
2025-11-18 14:49:35,413 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2187
2025-11-18 14:49:35,413 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:35,413 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.6ms
2025-11-18 14:49:35,418 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:35,418 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,419 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,419 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,420 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,420 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,420 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:35,422 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:35,422 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:35,429 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:35,429 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:35,430 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 12.5ms
2025-11-18 14:49:35,445 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:35,445 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,445 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,446 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,446 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,446 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,446 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,446 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,446 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:35,450 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:35,451 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:35,452 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:35,452 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.8ms
2025-11-18 14:49:35,455 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:35,455 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,455 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,456 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,456 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,456 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,456 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,457 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,457 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:35,464 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:35,465 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:35,466 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:35,467 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 12.0ms
2025-11-18 14:49:35,626 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:35,627 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,627 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,627 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,627 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,627 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,628 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,628 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,628 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:35,631 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:35,632 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:35,636 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2187
2025-11-18 14:49:35,636 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2187
2025-11-18 14:49:35,637 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:35,638 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.4ms
2025-11-18 14:49:35,647 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:35,647 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,648 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,648 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,649 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,649 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,649 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:35,651 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:35,651 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:35,654 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:35,654 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:35,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.9ms
2025-11-18 14:49:35,671 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:35,671 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,671 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,671 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,672 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,672 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,672 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,672 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:35,677 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:35,677 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:35,679 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:35,679 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.6ms
2025-11-18 14:49:35,682 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:35,682 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,682 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,683 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,683 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,683 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,683 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,683 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,683 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:35,688 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:35,688 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:35,689 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:35,690 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.1ms
2025-11-18 14:49:35,839 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:49:35,839 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,840 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,840 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,840 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,840 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,840 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,841 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,841 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:49:35,843 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:49:35,844 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:49:35,846 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2187
2025-11-18 14:49:35,846 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2187
2025-11-18 14:49:35,846 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 14:49:35,847 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.5ms
2025-11-18 14:49:35,853 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:49:35,854 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,854 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,854 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,854 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,855 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,855 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,855 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,856 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:49:35,859 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:49:35,861 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:49:35,865 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:49:35,866 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:49:35,866 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 13.7ms
2025-11-18 14:49:35,881 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:35,881 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,881 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,882 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,882 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,882 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,882 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,882 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:35,887 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:35,887 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:35,888 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:35,890 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.0ms
2025-11-18 14:49:35,893 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:49:35,893 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:49:35,893 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:49:35,894 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:49:35,894 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:49:35,894 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:49:35,894 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:49:35,894 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:49:35,895 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:49:35,899 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:49:35,900 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:49:35,902 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:49:35,902 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.6ms
2025-11-18 15:02:54,983 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 15:02:54,984 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-18 15:02:55,297 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:02:55,298 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:02:55,298 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:02:55,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:02:55,299 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:02:55,299 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:02:55,299 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:02:55,299 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:02:55,299 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:02:55,316 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:02:55,317 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:02:55,323 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:02:55,324 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2188, Rotación: True
2025-11-18 15:02:55,330 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:02:55,331 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:02:55,331 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:02:55,332 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2188
2025-11-18 15:02:55,332 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:02:55,333 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 35.1ms
2025-11-18 15:02:55,337 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 15:02:55,337 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.6ms
2025-11-18 15:02:55,339 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:02:55,340 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:02:55,340 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:02:55,340 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:02:55,340 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:02:55,340 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:02:55,341 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:02:55,341 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:02:55,341 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:02:55,342 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:02:55,342 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:02:55,345 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:02:55,346 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:02:55,346 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.0ms
2025-11-18 15:02:55,361 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 15:02:55,362 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 15:02:55,363 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.5ms
2025-11-18 15:02:55,365 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.1ms
2025-11-18 15:02:55,367 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:02:55,367 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:02:55,368 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:02:55,368 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:02:55,368 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:02:55,368 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:02:55,368 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:02:55,369 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:02:55,369 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:02:55,392 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:02:55,392 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:02:55,444 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:02:55,444 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 77.2ms
2025-11-18 15:02:55,447 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:02:55,447 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:02:55,447 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:02:55,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:02:55,448 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:02:55,448 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:02:55,448 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:02:55,448 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:02:55,448 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:02:55,452 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:02:55,453 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:02:55,453 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:02:55,454 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 15:02:56,887 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:02:56,888 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:02:56,888 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:02:56,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:02:56,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:02:56,889 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:02:56,889 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:02:56,889 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:02:56,889 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:02:56,892 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:02:56,894 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:02:56,900 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:02:56,901 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2189, Rotación: True
2025-11-18 15:02:56,903 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:02:56,904 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:02:56,904 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:02:56,904 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2189
2025-11-18 15:02:56,905 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:02:56,905 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 18.0ms
2025-11-18 15:02:56,910 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:02:56,910 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:02:56,911 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:02:56,911 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:02:56,911 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:02:56,911 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:02:56,911 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:02:56,911 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:02:56,912 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:02:56,913 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:02:56,914 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:02:56,917 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:02:56,917 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:02:56,918 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.8ms
2025-11-18 15:02:56,931 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:02:56,932 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:02:56,932 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:02:56,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:02:56,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:02:56,933 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:02:56,933 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:02:56,933 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:02:56,934 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:02:56,937 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:02:56,938 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:02:56,939 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:02:56,940 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.3ms
2025-11-18 15:02:56,941 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:02:56,942 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:02:56,942 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:02:56,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:02:56,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:02:56,942 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:02:56,942 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:02:56,942 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:02:56,943 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:02:56,946 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:02:56,946 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:02:56,947 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:02:56,947 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.9ms
2025-11-18 15:14:57,414 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 15:14:57,414 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-18 15:14:57,723 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:14:57,724 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:14:57,724 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:14:57,724 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:14:57,724 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:14:57,724 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:14:57,725 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:14:57,725 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:14:57,725 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:14:57,742 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:14:57,744 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:14:57,771 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:14:57,772 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2190, Rotación: True
2025-11-18 15:14:57,780 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:14:57,781 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:14:57,781 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:14:57,781 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2190
2025-11-18 15:14:57,782 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:14:57,782 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 58.9ms
2025-11-18 15:14:57,787 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 15:14:57,787 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.4ms
2025-11-18 15:14:57,790 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:14:57,790 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:14:57,790 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:14:57,790 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:14:57,790 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:14:57,790 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:14:57,791 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:14:57,791 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:14:57,791 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:14:57,793 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:14:57,793 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:14:57,799 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:14:57,799 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:14:57,800 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.0ms
2025-11-18 15:14:57,820 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 15:14:57,820 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 15:14:57,821 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.0ms
2025-11-18 15:14:57,821 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.6ms
2025-11-18 15:14:57,823 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:14:57,824 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:14:57,824 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:14:57,824 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:14:57,824 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:14:57,824 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:14:57,824 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:14:57,824 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:14:57,825 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:14:57,843 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:14:57,844 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:14:57,905 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:14:57,906 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 82.6ms
2025-11-18 15:14:57,908 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:14:57,908 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:14:57,909 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:14:57,909 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:14:57,909 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:14:57,909 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:14:57,909 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:14:57,910 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:14:57,910 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:14:57,915 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:14:57,915 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:14:57,916 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:14:57,917 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.9ms
2025-11-18 15:15:12,073 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 15:15:12,074 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-18 15:15:12,382 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 15:15:12,382 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:12,383 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:15:12,383 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:15:12,383 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:12,383 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:15:12,387 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:15:12,396 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 15:15:12,396 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 4: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 15:15:12,399 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 4, usando Single-DB como fallback
2025-11-18 15:15:12,399 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:12,400 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 15:15:12,404 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-18 15:15:12,404 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-18 15:15:12,405 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-18 15:15:12,679 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 15:15:12,679 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-18 15:15:12,684 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:15:12,685 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2191, Rotación: False
2025-11-18 15:15:12,685 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2191
2025-11-18 15:15:12,685 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-18 15:15:12,686 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 304.2ms
2025-11-18 15:15:12,731 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 15:15:12,732 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.6ms
2025-11-18 15:15:12,733 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 15:15:12,734 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.7ms
2025-11-18 15:15:12,735 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 15:15:12,736 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:15:12,736 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:12,737 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:15:12,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:15:12,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:12,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:15:12,740 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:15:12,740 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:12,741 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:15:12,741 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 6.0ms
2025-11-18 15:15:12,748 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 15:15:12,748 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 15:15:12,751 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 15:15:12,753 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:15:12,754 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:12,754 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:15:12,754 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:15:12,754 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:12,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:15:12,756 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:15:12,756 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:12,756 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:15:12,759 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 15:15:12,819 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 15:15:12,820 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 84.5ms
2025-11-18 15:15:12,821 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 62.4ms
2025-11-18 15:15:12,822 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 69.5ms
2025-11-18 15:15:12,824 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:15:12,825 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:12,825 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:15:12,825 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:15:12,825 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:12,826 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:15:12,827 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:15:12,827 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:12,827 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:15:12,832 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 15:15:12,832 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 15:15:12,834 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 15:15:12,834 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:15:12,834 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:12,835 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:15:12,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:15:12,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:12,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:15:12,836 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:15:12,837 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:12,837 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:15:12,842 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 15:15:12,843 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.2ms
2025-11-18 15:15:12,844 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 10.2ms
2025-11-18 15:15:14,636 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-18 15:15:14,637 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.7ms
2025-11-18 15:15:14,639 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-18 15:15:14,639 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.6ms
2025-11-18 15:15:14,641 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-18 15:15:14,641 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:14,641 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:15:14,642 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:15:14,642 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:14,642 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:15:14,644 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:15:14,644 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:14,644 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-18 15:15:14,652 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 15:15:14,653 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 11.9ms
2025-11-18 15:15:14,655 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-18 15:15:14,655 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:14,656 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:15:14,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:15:14,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:14,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:15:14,659 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:15:14,660 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:14,660 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-18 15:15:14,672 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 15:15:14,673 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 17.9ms
2025-11-18 15:15:16,293 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 15:15:16,294 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-18 15:15:16,297 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:15:16,298 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:16,299 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:15:16,300 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:15:16,300 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:16,300 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:15:16,305 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:15:16,305 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:16,305 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:15:16,307 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 15:15:16,307 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 10.3ms
2025-11-18 15:15:38,476 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-18 15:15:47,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:15:47,566 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:47,566 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:15:47,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:15:47,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:47,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:15:47,685 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:15:47,691 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 15:15:47,691 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 4: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 15:15:47,692 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 4, usando Single-DB como fallback
2025-11-18 15:15:47,692 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:47,692 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:15:47,695 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 15:15:47,696 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 130.7ms
2025-11-18 15:15:47,703 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:15:47,704 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:47,704 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:15:47,705 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:15:47,705 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:47,705 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:15:47,705 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:15:47,706 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:47,706 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:15:47,714 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:15:47,716 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:15:47,725 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:15:47,725 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2192, Rotación: True
2025-11-18 15:15:47,735 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:15:47,736 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:15:47,737 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:15:47,737 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2192
2025-11-18 15:15:47,737 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:15:47,738 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 34.5ms
2025-11-18 15:15:47,749 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:15:47,750 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:47,750 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:15:47,750 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:15:47,750 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:47,751 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:15:47,751 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:15:47,751 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:47,751 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:15:47,753 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:15:47,753 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:15:47,759 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:15:47,759 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:15:47,760 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.5ms
2025-11-18 15:15:47,787 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:15:47,787 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:47,787 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:15:47,787 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:15:47,788 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:47,788 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:15:47,788 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:15:47,788 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:47,789 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:15:47,814 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:15:47,814 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:15:47,875 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:15:47,876 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 89.0ms
2025-11-18 15:15:47,877 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 15:15:47,877 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-18 15:15:47,878 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:15:47,879 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:47,879 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:15:47,879 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:15:47,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:47,880 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:15:47,880 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:15:47,880 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:47,880 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:15:47,884 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:15:47,884 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:15:47,885 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:15:47,886 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:15:47,886 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:47,886 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': acme.midominio.com:5173
2025-11-18 15:15:47,886 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-18 15:15:47,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:47,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-18 15:15:47,889 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-18 15:15:47,889 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 15:15:47,890 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 2: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 15:15:47,890 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 2, usando Single-DB como fallback
2025-11-18 15:15:47,890 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:47,890 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:15:47,891 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 12.5ms
2025-11-18 15:15:47,892 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 15:15:47,892 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 6.5ms
2025-11-18 15:15:53,456 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-18 15:15:53,457 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.4ms
2025-11-18 15:15:53,459 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-18 15:15:53,460 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:53,460 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:15:53,460 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:15:53,460 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:53,460 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:15:53,460 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:15:53,461 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:53,461 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-18 15:15:53,463 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:15:53,464 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:15:53,466 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-18 15:15:53,466 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 7.2ms
2025-11-18 15:15:55,171 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:15:55,172 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:55,172 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:15:55,172 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:15:55,172 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:55,172 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:15:55,173 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:15:55,173 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:55,173 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:15:55,174 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 15:15:55,175 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.1ms
2025-11-18 15:15:56,575 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:15:56,575 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:15:56,576 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:15:56,576 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:15:56,576 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:15:56,576 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:15:56,576 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:15:56,577 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:15:56,577 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:15:56,578 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 15:15:56,579 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.9ms
2025-11-18 15:16:00,240 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:16:00,241 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:00,241 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:16:00,241 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:16:00,242 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:00,242 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:16:00,244 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:16:00,244 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:00,244 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:16:00,245 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 15:16:00,246 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.7ms
2025-11-18 15:16:09,966 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 15:16:09,967 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:09,967 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:16:09,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:16:09,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:09,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:16:09,968 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:16:09,969 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:09,969 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 15:16:09,975 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-18 15:16:09,975 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-18 15:16:09,976 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-18 15:16:10,237 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 15:16:10,237 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-18 15:16:10,245 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:16:10,246 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2193, Rotación: False
2025-11-18 15:16:10,246 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2193
2025-11-18 15:16:10,246 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-18 15:16:10,248 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 281.4ms
2025-11-18 15:16:10,275 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:16:10,275 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:10,275 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:16:10,275 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:16:10,276 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:10,276 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:16:10,278 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:16:10,279 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:10,279 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:16:10,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-18 15:16:10,286 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 15:16:10,286 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 15:16:10,288 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 15:16:10,288 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:10,288 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:16:10,289 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:16:10,289 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:10,289 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:16:10,290 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:16:10,291 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:10,291 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-18 15:16:10,310 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 15:16:10,311 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 36.0ms
2025-11-18 15:16:10,311 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 31.3ms
2025-11-18 15:16:10,314 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:16:10,315 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:10,315 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:16:10,316 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:16:10,316 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:10,316 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:16:10,318 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:16:10,318 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:10,318 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:16:10,319 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-18 15:16:10,323 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 15:16:10,323 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 15:16:10,324 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 15:16:10,325 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:10,325 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:16:10,325 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:16:10,325 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:10,326 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:16:10,327 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:16:10,327 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:10,327 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-18 15:16:10,334 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 15:16:10,335 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.8ms
2025-11-18 15:16:10,335 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 16.5ms
2025-11-18 15:16:11,006 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:16:11,006 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:11,006 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:16:11,007 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:16:11,007 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:11,007 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:16:11,010 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:16:11,010 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:11,011 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:16:11,018 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 15:16:11,019 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 12.8ms
2025-11-18 15:16:11,021 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:16:11,021 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:11,022 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:16:11,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:16:11,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:11,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:16:11,023 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:16:11,024 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:11,024 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:16:11,030 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 15:16:11,031 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 10.3ms
2025-11-18 15:16:11,891 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:16:11,892 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:11,892 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 15:16:11,892 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 15:16:11,892 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:11,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 15:16:11,894 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 15:16:11,894 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:11,894 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:16:11,895 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 15:16:11,896 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.6ms
2025-11-18 15:16:19,737 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 15:16:19,738 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-18 15:16:20,045 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 15:16:20,045 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:20,045 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:20,046 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:20,046 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:20,046 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:20,046 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:20,046 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:20,046 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 15:16:20,049 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 15:16:20,050 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 15:16:20,050 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 15:16:20,287 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 15:16:20,287 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 15:16:20,287 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 15:16:20,288 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:16:20,289 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2194, Rotación: False
2025-11-18 15:16:20,289 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2194
2025-11-18 15:16:20,289 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 15:16:20,290 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 245.1ms
2025-11-18 15:16:20,318 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 15:16:20,319 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.0ms
2025-11-18 15:16:20,319 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:16:20,320 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:20,320 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:20,321 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:20,321 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:20,321 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:20,321 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:20,321 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:20,322 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:16:20,330 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:16:20,330 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:16:20,332 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:16:20,333 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 15:16:20,333 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 13.9ms
2025-11-18 15:16:20,334 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:20,334 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:20,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:20,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:20,334 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:20,335 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:20,335 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:20,335 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 15:16:20,347 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 15:16:20,347 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 15:16:20,365 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 15:16:20,365 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 15:16:20,366 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 15:16:20,367 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.0ms
2025-11-18 15:16:20,367 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 34.1ms
2025-11-18 15:16:20,369 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:16:20,369 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:20,370 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:20,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:20,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:20,370 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:20,370 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:20,371 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:20,371 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:16:20,376 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:16:20,376 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:16:20,378 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:16:20,380 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 15:16:20,381 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 15:16:20,381 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:20,381 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:20,382 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:20,382 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:20,382 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:20,382 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:20,382 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:20,382 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 15:16:20,383 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 13.8ms
2025-11-18 15:16:20,388 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 15:16:20,392 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 15:16:20,393 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 15:16:20,393 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 13.1ms
2025-11-18 15:16:20,395 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 14.0ms
2025-11-18 15:16:20,397 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 15:16:20,397 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 15:16:20,398 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:20,399 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:20,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:20,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:20,399 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:20,399 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:20,399 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:20,400 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 15:16:20,405 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 15:16:20,405 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 15:16:20,411 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 15:16:20,412 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 15:16:20,412 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 14.6ms
2025-11-18 15:16:20,413 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.2ms
2025-11-18 15:16:20,415 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 15:16:20,416 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:20,416 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:20,416 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:20,417 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:20,417 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:20,417 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:20,417 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:20,417 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 15:16:20,424 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 15:16:20,425 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 15:16:20,426 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 15:16:20,426 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.3ms
2025-11-18 15:16:21,000 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 15:16:21,001 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-18 15:16:21,001 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 15:16:21,002 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.0ms
2025-11-18 15:16:21,004 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 15:16:21,004 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:21,005 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:21,005 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:21,005 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:21,005 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:21,006 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:21,006 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:21,006 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 15:16:21,014 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 15:16:21,014 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk3ODgwLCJpYXQiOjE3NjM0OTY5ODAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.xTbY5KzUiPcOaFkMvOGsz5_4H_AVFs9X6a5ZECw2fCo', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTAxNzgwLCJpYXQiOjE3NjM0OTY5ODAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.IVR_c6KNoHjWT5KuBXP4lqlnCL_Y0GImwbpifrRYLOU'}
2025-11-18 15:16:21,015 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 15:16:21,015 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 15:16:21,015 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 15:16:21,015 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 15:16:21,019 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 15:16:21,020 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 16.2ms
2025-11-18 15:16:21,022 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 15:16:21,023 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:21,023 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:21,023 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:21,023 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:21,023 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:21,024 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:21,024 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:21,024 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 15:16:21,030 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 15:16:21,030 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk3ODgwLCJpYXQiOjE3NjM0OTY5ODAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.xTbY5KzUiPcOaFkMvOGsz5_4H_AVFs9X6a5ZECw2fCo', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTAxNzgwLCJpYXQiOjE3NjM0OTY5ODAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.IVR_c6KNoHjWT5KuBXP4lqlnCL_Y0GImwbpifrRYLOU'}
2025-11-18 15:16:21,031 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 15:16:21,031 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 15:16:21,031 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 15:16:21,031 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 15:16:21,033 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 15:16:21,034 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 11.4ms
2025-11-18 15:16:22,160 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:16:22,160 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:22,160 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:22,161 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:22,161 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:22,161 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:22,161 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:22,161 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:22,161 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:16:22,165 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:16:22,166 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:16:22,170 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:16:22,170 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2195, Rotación: True
2025-11-18 15:16:22,172 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:16:22,172 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:16:22,172 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:16:22,173 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2195
2025-11-18 15:16:22,173 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:16:22,174 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.8ms
2025-11-18 15:16:22,182 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:16:22,183 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:22,184 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:22,184 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:22,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:22,185 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:22,185 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:22,185 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:22,185 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:16:22,188 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:16:22,188 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:16:22,197 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:16:22,197 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:16:22,198 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 15.4ms
2025-11-18 15:16:22,740 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:16:22,740 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:22,740 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:22,740 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:22,741 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:22,741 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:22,741 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:22,741 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:22,741 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:16:22,745 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:16:22,748 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:16:22,751 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2195
2025-11-18 15:16:22,751 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2195
2025-11-18 15:16:22,751 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:16:22,752 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.1ms
2025-11-18 15:16:22,759 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:16:22,760 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:16:22,760 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:16:22,761 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:16:22,761 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:16:22,761 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:16:22,761 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:16:22,761 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:16:22,761 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:16:22,764 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:16:22,764 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:16:22,767 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:16:22,767 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:16:22,768 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.3ms
2025-11-18 15:30:29,769 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 15:30:29,769 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 15:30:29,770 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-18 15:30:29,770 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.7ms
2025-11-18 15:30:30,079 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:30,079 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:30,079 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:30,079 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:30,080 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:30,080 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:30,080 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:30,080 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:30,080 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:30,125 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:30,125 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:30,171 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:30,172 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 93.3ms
2025-11-18 15:30:30,174 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:30,174 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:30,174 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:30,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:30,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:30,175 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:30,175 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:30,175 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:30,175 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:30,181 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:30,182 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:30,183 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:30,184 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.7ms
2025-11-18 15:30:32,088 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 15:30:32,089 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-18 15:30:32,091 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:32,092 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:32,092 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:32,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:32,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:32,092 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:32,093 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:32,093 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:32,093 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:32,097 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:32,099 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:32,109 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:30:32,110 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2196, Rotación: True
2025-11-18 15:30:32,117 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:30:32,118 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:30:32,118 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:30:32,118 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2196
2025-11-18 15:30:32,119 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:32,119 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 28.3ms
2025-11-18 15:30:32,255 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:32,255 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:32,255 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:32,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:32,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:32,256 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:32,256 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:32,256 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:32,257 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:32,259 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:32,260 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:32,262 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2196
2025-11-18 15:30:32,262 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2196
2025-11-18 15:30:32,263 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:32,263 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.6ms
2025-11-18 15:30:32,268 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 15:30:32,269 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.7ms
2025-11-18 15:30:32,271 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:32,271 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:32,271 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:32,271 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:32,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:32,272 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:32,272 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:32,272 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:32,272 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:32,274 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:32,274 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:32,277 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:32,277 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:32,278 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.9ms
2025-11-18 15:30:32,293 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:32,293 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:32,294 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:32,294 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:32,294 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:32,294 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:32,294 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:32,295 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:32,295 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:32,301 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:32,301 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:32,302 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:32,303 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.9ms
2025-11-18 15:30:32,305 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:32,305 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:32,305 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:32,305 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:32,306 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:32,306 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:32,306 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:32,306 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:32,306 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:32,315 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:32,315 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:32,317 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:32,319 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 13.9ms
2025-11-18 15:30:32,451 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:32,451 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:32,451 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:32,452 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:32,452 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:32,452 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:32,452 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:32,452 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:32,453 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:32,455 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:32,458 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:32,460 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2196
2025-11-18 15:30:32,460 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2196
2025-11-18 15:30:32,460 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:32,461 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.2ms
2025-11-18 15:30:32,466 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:32,467 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:32,467 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:32,467 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:32,468 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:32,468 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:32,468 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:32,468 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:32,468 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:32,471 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:32,471 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:32,474 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:32,475 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:32,475 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.0ms
2025-11-18 15:30:32,491 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:32,492 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:32,492 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:32,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:32,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:32,493 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:32,493 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:32,493 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:32,493 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:32,497 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:32,498 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:32,499 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:32,500 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.8ms
2025-11-18 15:30:32,502 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:32,502 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:32,502 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:32,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:32,503 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:32,503 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:32,503 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:32,503 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:32,503 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:32,507 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:32,507 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:32,509 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:32,510 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 15:30:33,135 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:33,135 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:33,135 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:33,135 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:33,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:33,136 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:33,136 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:33,136 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:33,136 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:33,139 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:33,140 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:33,144 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:30:33,145 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2197, Rotación: True
2025-11-18 15:30:33,150 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:30:33,151 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:30:33,152 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:30:33,152 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2197
2025-11-18 15:30:33,152 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:33,153 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 18.1ms
2025-11-18 15:30:33,158 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:33,158 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:33,158 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:33,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:33,159 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:33,159 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:33,159 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:33,159 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:33,159 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:33,161 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:33,161 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:33,164 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:33,165 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:33,165 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.7ms
2025-11-18 15:30:33,178 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:33,178 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:33,178 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:33,179 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:33,179 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:33,179 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:33,179 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:33,179 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:33,179 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:33,185 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:33,186 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:33,187 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:33,187 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.6ms
2025-11-18 15:30:33,190 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:33,190 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:33,190 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:33,190 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:33,191 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:33,191 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:33,191 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:33,191 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:33,191 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:33,195 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:33,195 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:33,196 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:33,197 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.5ms
2025-11-18 15:30:33,612 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:33,612 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:33,613 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:33,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:33,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:33,613 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:33,613 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:33,613 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:33,614 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:33,617 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:33,618 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:33,620 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2197
2025-11-18 15:30:33,621 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2197
2025-11-18 15:30:33,621 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:33,622 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.6ms
2025-11-18 15:30:33,628 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:33,628 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:33,628 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:33,629 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:33,629 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:33,629 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:33,629 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:33,629 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:33,629 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:33,632 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:33,632 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:33,635 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:33,635 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:33,636 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.5ms
2025-11-18 15:30:33,653 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:33,653 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:33,653 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:33,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:33,654 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:33,654 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:33,654 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:33,654 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:33,654 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:33,659 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:33,659 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:33,660 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:33,661 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 15:30:33,662 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:33,663 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:33,663 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:33,663 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:33,663 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:33,663 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:33,664 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:33,664 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:33,664 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:33,669 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:33,669 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:33,670 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:33,671 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.4ms
2025-11-18 15:30:34,044 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:34,044 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:34,044 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:34,045 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:34,045 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:34,045 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:34,045 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:34,045 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:34,046 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:34,049 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:34,051 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:34,054 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:30:34,055 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2198, Rotación: True
2025-11-18 15:30:34,056 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:30:34,057 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:30:34,057 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:30:34,057 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2198
2025-11-18 15:30:34,058 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:34,058 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.4ms
2025-11-18 15:30:34,062 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:34,063 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:34,063 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:34,064 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:34,064 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:34,064 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:34,064 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:34,064 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:34,065 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:34,067 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:34,067 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:34,070 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:34,070 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:34,071 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.4ms
2025-11-18 15:30:34,086 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:34,086 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:34,086 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:34,086 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:34,087 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:34,087 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:34,087 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:34,087 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:34,087 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:34,092 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:34,092 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:34,093 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:34,094 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 15:30:34,096 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:34,096 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:34,096 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:34,096 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:34,097 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:34,097 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:34,097 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:34,097 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:34,098 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:34,104 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:34,104 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:34,105 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:34,106 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.7ms
2025-11-18 15:30:34,458 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:34,459 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:34,459 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:34,459 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:34,459 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:34,459 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:34,459 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:34,460 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:34,460 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:34,463 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:34,465 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:34,468 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2198
2025-11-18 15:30:34,468 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2198
2025-11-18 15:30:34,468 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:34,469 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.6ms
2025-11-18 15:30:34,475 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:34,476 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:34,476 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:34,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:34,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:34,476 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:34,477 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:34,477 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:34,477 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:34,479 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:34,479 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:34,482 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:34,483 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:34,483 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.8ms
2025-11-18 15:30:34,496 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:34,497 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:34,497 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:34,497 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:34,497 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:34,498 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:34,498 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:34,498 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:34,498 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:34,504 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:34,504 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:34,505 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:34,505 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.2ms
2025-11-18 15:30:34,507 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:34,508 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:34,508 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:34,508 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:34,508 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:34,509 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:34,509 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:34,509 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:34,509 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:34,513 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:34,514 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:34,516 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:34,517 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.2ms
2025-11-18 15:30:34,899 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:34,899 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:34,899 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:34,899 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:34,900 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:34,900 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:34,900 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:34,900 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:34,900 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:34,903 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:34,904 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:34,906 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2198
2025-11-18 15:30:34,906 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2198
2025-11-18 15:30:34,907 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:34,907 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.9ms
2025-11-18 15:30:34,917 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:34,918 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:34,918 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:34,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:34,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:34,919 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:34,919 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:34,919 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:34,919 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:34,921 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:34,922 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:34,924 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:34,925 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:34,925 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.7ms
2025-11-18 15:30:34,940 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:34,941 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:34,941 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:34,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:34,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:34,942 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:34,942 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:34,942 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:34,942 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:34,947 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:34,947 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:34,949 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:34,950 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.3ms
2025-11-18 15:30:34,952 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:34,953 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:34,953 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:34,954 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:34,954 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:34,954 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:34,954 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:34,954 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:34,954 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:34,959 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:34,959 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:34,961 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:34,961 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.7ms
2025-11-18 15:30:35,272 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:35,272 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:35,272 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:35,273 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:35,273 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:35,273 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:35,273 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:35,273 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:35,274 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:35,277 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:35,279 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:35,285 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:30:35,285 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2199, Rotación: True
2025-11-18 15:30:35,287 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:30:35,288 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:30:35,288 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:30:35,288 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2199
2025-11-18 15:30:35,289 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:35,289 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 17.7ms
2025-11-18 15:30:35,295 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:35,295 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:35,296 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:35,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:35,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:35,296 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:35,296 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:35,296 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:35,297 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:35,299 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:35,299 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:35,302 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:35,302 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:35,303 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.3ms
2025-11-18 15:30:35,318 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:35,319 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:35,319 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:35,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:35,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:35,320 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:35,320 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:35,320 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:35,320 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:35,324 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:35,324 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:35,325 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:35,326 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.2ms
2025-11-18 15:30:35,328 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:35,328 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:35,328 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:35,328 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:35,328 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:35,329 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:35,329 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:35,329 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:35,329 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:35,333 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:35,333 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:35,335 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:35,336 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.3ms
2025-11-18 15:30:35,528 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:35,528 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:35,528 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:35,529 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:35,529 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:35,529 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:35,529 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:35,529 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:35,529 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:35,532 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:35,534 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:35,536 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2199
2025-11-18 15:30:35,536 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2199
2025-11-18 15:30:35,537 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:35,537 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.6ms
2025-11-18 15:30:35,543 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:35,543 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:35,543 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:35,544 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:35,544 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:35,544 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:35,544 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:35,545 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:35,545 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:35,547 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:35,547 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:35,552 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:35,553 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:35,554 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 11.0ms
2025-11-18 15:30:35,567 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:35,568 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:35,568 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:35,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:35,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:35,569 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:35,569 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:35,569 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:35,569 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:35,573 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:35,573 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:35,574 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:35,575 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.1ms
2025-11-18 15:30:35,577 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:35,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:35,578 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:35,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:35,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:35,578 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:35,579 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:35,579 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:35,579 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:35,585 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:35,585 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:35,587 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:35,587 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.3ms
2025-11-18 15:30:35,846 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:35,847 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:35,847 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:35,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:35,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:35,848 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:35,848 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:35,848 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:35,848 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:35,851 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:35,855 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:35,857 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2199
2025-11-18 15:30:35,858 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2199
2025-11-18 15:30:35,858 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:35,859 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.8ms
2025-11-18 15:30:35,865 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:35,865 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:35,865 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:35,866 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:35,866 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:35,866 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:35,866 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:35,867 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:35,867 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:35,869 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:35,869 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:35,873 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:35,873 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:35,874 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.9ms
2025-11-18 15:30:35,892 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:35,892 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:35,893 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:35,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:35,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:35,893 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:35,893 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:35,893 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:35,894 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:35,897 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:35,898 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:35,899 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:35,900 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.9ms
2025-11-18 15:30:35,902 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:35,903 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:35,903 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:35,903 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:35,903 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:35,904 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:35,904 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:35,904 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:35,904 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:35,909 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:35,910 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:35,911 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:35,912 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.6ms
2025-11-18 15:30:36,269 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-18 15:30:36,270 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:36,271 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.4ms
2025-11-18 15:30:36,271 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:36,271 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:36,271 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:36,271 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:36,272 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:36,272 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:36,272 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:36,272 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:36,277 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:36,277 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:36,279 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:36,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-18 15:30:36,281 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.2ms
2025-11-18 15:30:36,281 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.3ms
2025-11-18 15:30:36,286 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-18 15:30:36,286 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:36,286 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:36,286 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:36,287 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:36,287 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:36,287 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:36,287 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:36,287 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-18 15:30:36,299 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 15:30:36,299 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 15:30:36,315 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-18 15:30:36,316 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 30.6ms
2025-11-18 15:30:36,319 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:36,320 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:36,320 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:36,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:36,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:36,321 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:36,321 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:36,321 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:36,321 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:36,325 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:36,325 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:36,326 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:36,326 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.1ms
2025-11-18 15:30:36,328 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-18 15:30:36,329 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:36,329 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:36,329 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:36,329 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:36,330 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:36,330 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:36,330 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:36,330 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-18 15:30:36,336 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 15:30:36,336 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 15:30:36,341 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-18 15:30:36,342 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.3ms
2025-11-18 15:30:37,067 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 15:30:37,068 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 15:30:37,068 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.2ms
2025-11-18 15:30:37,068 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.7ms
2025-11-18 15:30:37,072 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:37,072 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:37,073 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:37,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:37,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:37,073 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:37,073 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:37,074 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:37,074 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:37,083 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:37,084 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:37,091 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:37,091 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:37,092 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 20.3ms
2025-11-18 15:30:37,094 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:37,095 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:37,095 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:37,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:37,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:37,095 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:37,095 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:37,096 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:37,096 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:37,102 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:37,103 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:37,114 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:37,114 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:37,115 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 20.7ms
2025-11-18 15:30:37,904 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 15:30:37,905 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.5ms
2025-11-18 15:30:37,907 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 15:30:37,907 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:37,907 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:37,908 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:37,908 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:37,908 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:37,908 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:37,908 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:37,909 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 15:30:37,922 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 15:30:37,922 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 15:30:37,934 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 15:30:37,934 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 15:30:37,936 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 15:30:37,937 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 15:30:37,937 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 30.5ms
2025-11-18 15:30:37,938 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.8ms
2025-11-18 15:30:37,939 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.8ms
2025-11-18 15:30:37,941 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 15:30:37,941 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:37,941 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:37,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:37,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:37,942 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:37,942 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:37,942 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:37,943 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 15:30:37,949 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 15:30:37,950 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 15:30:37,955 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 15:30:37,955 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 15:30:37,956 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 15:30:37,956 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:37,956 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:37,956 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:37,956 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:37,957 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:37,957 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:37,957 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:37,957 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 15:30:37,957 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.9ms
2025-11-18 15:30:37,962 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 15:30:37,965 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 15:30:37,965 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 15:30:37,966 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.1ms
2025-11-18 15:30:37,968 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 15:30:37,968 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:37,968 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:37,969 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:37,969 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:37,969 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:37,969 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:37,970 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:37,970 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 15:30:37,976 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 15:30:37,977 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 15:30:37,977 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 15:30:37,978 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.9ms
2025-11-18 15:30:39,171 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-18 15:30:39,172 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:39,172 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:39,172 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:39,173 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:39,173 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:39,173 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:39,173 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:39,173 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-18 15:30:39,180 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 15:30:39,181 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 15:30:39,186 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-18 15:30:39,187 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.8ms
2025-11-18 15:30:39,190 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-18 15:30:39,191 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:39,191 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:39,191 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:39,192 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:39,192 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:39,192 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:39,192 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:39,192 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-18 15:30:39,198 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 15:30:39,198 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 15:30:39,202 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-18 15:30:39,203 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 12.7ms
2025-11-18 15:30:39,822 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:39,822 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:39,823 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:39,823 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:39,823 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:39,823 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:39,823 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:39,824 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:39,824 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:39,830 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:39,830 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:39,833 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:39,833 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:39,834 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.0ms
2025-11-18 15:30:39,836 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:39,837 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:39,837 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:39,838 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:39,838 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:39,838 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:39,838 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:39,839 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:39,839 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:39,846 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:39,846 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:39,849 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:39,849 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:39,850 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.6ms
2025-11-18 15:30:40,670 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:40,671 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:40,671 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:40,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:40,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:40,672 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:40,672 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:40,672 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:40,673 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:40,676 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:40,678 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:40,681 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:30:40,681 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2200, Rotación: True
2025-11-18 15:30:40,683 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:30:40,683 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:30:40,684 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:30:40,684 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2200
2025-11-18 15:30:40,684 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:40,685 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.1ms
2025-11-18 15:30:40,693 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:40,694 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:40,694 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:40,694 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:40,695 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:40,695 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:40,695 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:40,695 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:40,696 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:40,698 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:40,698 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:40,701 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:40,701 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:40,702 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.4ms
2025-11-18 15:30:40,727 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:40,728 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:40,728 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:40,729 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:40,729 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:40,729 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:40,729 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:40,729 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:40,730 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:40,730 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:40,734 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:40,734 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:40,736 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:40,736 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:40,737 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:40,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:40,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:40,738 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:40,738 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:40,738 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:40,738 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:40,745 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:40,745 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:40,747 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:40,747 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:40,748 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.2ms
2025-11-18 15:30:40,748 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 18.0ms
2025-11-18 15:30:40,750 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:40,751 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:40,751 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:40,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:40,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:40,751 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:40,752 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:40,752 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:40,752 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:40,757 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:40,758 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:40,759 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:40,760 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:40,760 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:40,761 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:40,761 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:40,761 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:40,761 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:40,761 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:40,762 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:40,762 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:40,767 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:40,767 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:40,769 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:40,769 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:40,770 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.1ms
2025-11-18 15:30:40,771 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 11.4ms
2025-11-18 15:30:41,222 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:41,222 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,223 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,223 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,223 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,223 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,223 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,223 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,224 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:41,227 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:41,229 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:41,231 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:30:41,232 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2201, Rotación: True
2025-11-18 15:30:41,233 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:30:41,234 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:30:41,234 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:30:41,234 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2201
2025-11-18 15:30:41,234 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:41,235 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.3ms
2025-11-18 15:30:41,243 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:41,244 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,244 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,244 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,244 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,245 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,245 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,245 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,245 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:41,247 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:41,247 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:41,250 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:41,250 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:41,251 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.8ms
2025-11-18 15:30:41,278 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:41,278 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,279 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,279 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,279 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,279 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,279 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,279 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,280 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:41,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:41,283 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:41,283 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:41,284 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:41,284 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,284 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,284 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,285 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,285 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,285 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,285 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,285 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:41,291 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:41,292 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:41,294 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:41,294 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:41,295 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 17.2ms
2025-11-18 15:30:41,295 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.4ms
2025-11-18 15:30:41,297 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:41,297 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,298 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,298 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,298 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,299 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,299 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:41,304 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:41,304 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:41,306 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:41,307 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:41,308 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,308 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,309 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,310 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,310 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,310 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:41,317 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:41,317 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:41,319 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:41,319 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:41,320 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 22.8ms
2025-11-18 15:30:41,321 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.7ms
2025-11-18 15:30:41,524 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:41,524 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,524 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,525 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,525 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,525 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,525 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,525 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,525 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:41,528 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:41,530 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:41,532 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2201
2025-11-18 15:30:41,533 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2201
2025-11-18 15:30:41,533 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:41,534 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.0ms
2025-11-18 15:30:41,545 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:41,546 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,546 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,546 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,547 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,547 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,547 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,547 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:41,550 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:41,550 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:41,553 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:41,554 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:41,554 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.3ms
2025-11-18 15:30:41,579 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:41,580 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,580 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,580 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,580 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,581 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,581 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,581 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,581 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:41,581 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:41,585 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:41,585 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:41,586 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:41,586 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,587 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,587 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,587 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,588 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,588 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:41,594 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:41,594 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:41,597 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:41,597 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:41,598 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.8ms
2025-11-18 15:30:41,598 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.8ms
2025-11-18 15:30:41,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:41,601 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,601 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,601 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,602 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,602 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,602 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:41,608 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:41,608 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:41,609 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:41,610 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:41,611 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,611 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,611 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,611 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,612 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,612 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,612 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,612 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:41,617 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:41,617 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:41,619 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:41,619 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:41,620 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.5ms
2025-11-18 15:30:41,621 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 10.5ms
2025-11-18 15:30:41,804 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:41,805 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,805 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,805 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,805 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,805 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,806 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,806 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,806 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:41,809 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:41,811 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:41,812 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2201
2025-11-18 15:30:41,813 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2201
2025-11-18 15:30:41,813 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:41,814 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.9ms
2025-11-18 15:30:41,819 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:41,820 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,820 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,820 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,820 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,821 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,821 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,821 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,821 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:41,824 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:41,825 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:41,828 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:41,828 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:41,829 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.9ms
2025-11-18 15:30:41,852 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:41,852 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,852 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,853 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,853 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,853 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,853 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:41,854 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:41,860 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:41,860 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:41,861 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:41,862 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,862 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,862 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,863 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,863 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,863 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,863 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,863 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:41,870 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:41,870 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:41,872 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:41,872 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:41,873 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 21.7ms
2025-11-18 15:30:41,874 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 20.2ms
2025-11-18 15:30:41,876 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:41,877 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,877 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,877 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,878 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,878 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,878 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,878 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,878 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:41,883 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:41,883 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:41,884 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:41,885 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:41,885 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:41,886 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:41,886 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:41,886 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:41,886 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:41,886 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:41,886 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:41,887 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:41,895 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:41,895 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:41,897 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:41,897 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:41,898 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 21.4ms
2025-11-18 15:30:41,899 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 14.2ms
2025-11-18 15:30:42,067 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:42,067 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,068 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,068 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,068 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,068 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,068 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,068 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,069 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:42,071 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:42,073 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:42,077 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:30:42,078 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2202, Rotación: True
2025-11-18 15:30:42,079 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:30:42,080 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:30:42,080 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:30:42,080 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2202
2025-11-18 15:30:42,080 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:42,081 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.2ms
2025-11-18 15:30:42,087 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:42,087 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,088 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,088 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,088 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,088 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,089 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,089 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,089 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:42,091 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:42,092 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:42,094 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:42,094 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:42,095 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.1ms
2025-11-18 15:30:42,118 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:42,118 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,118 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,118 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,119 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,119 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,119 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,119 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,119 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:42,119 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:42,124 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:42,124 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:42,126 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:42,126 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,126 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,127 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,127 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,127 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,127 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,127 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,127 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:42,132 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:42,132 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:42,134 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:42,134 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:42,135 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 17.3ms
2025-11-18 15:30:42,135 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.8ms
2025-11-18 15:30:42,137 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:42,137 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,137 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,138 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,138 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,139 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,139 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:42,144 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:42,144 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:42,145 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:42,146 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:42,146 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,147 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,147 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,147 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,147 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,147 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,147 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,148 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:42,152 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:42,153 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:42,155 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:42,155 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:42,156 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.9ms
2025-11-18 15:30:42,157 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 10.8ms
2025-11-18 15:30:42,332 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:42,333 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,333 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,333 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,333 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,333 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,333 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,334 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,334 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:42,336 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:42,337 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:42,339 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2202
2025-11-18 15:30:42,339 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2202
2025-11-18 15:30:42,339 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:42,340 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.2ms
2025-11-18 15:30:42,348 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:42,349 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,349 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,349 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,349 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,349 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,349 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,350 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,350 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:42,352 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:42,352 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:42,355 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:42,355 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:42,356 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.8ms
2025-11-18 15:30:42,382 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:42,383 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,383 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,383 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,383 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,384 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,384 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,384 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,384 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:42,384 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:42,388 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:42,388 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:42,389 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:42,390 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,390 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,391 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,391 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,391 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,391 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,391 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:42,397 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:42,397 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:42,399 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:42,399 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:42,400 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 17.4ms
2025-11-18 15:30:42,400 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.8ms
2025-11-18 15:30:42,402 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:42,402 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,402 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,403 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,403 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,403 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,403 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,403 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,404 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:42,409 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:42,409 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:42,411 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:42,411 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:42,412 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,412 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,412 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,412 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,412 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,413 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:42,418 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:42,418 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:42,420 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:42,420 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:42,420 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.4ms
2025-11-18 15:30:42,421 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 9.8ms
2025-11-18 15:30:42,564 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:42,564 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,564 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,565 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,565 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,565 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,566 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:42,568 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:42,570 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:42,571 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2202
2025-11-18 15:30:42,572 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2202
2025-11-18 15:30:42,572 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:42,573 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.9ms
2025-11-18 15:30:42,579 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:42,580 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,580 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,580 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,581 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,581 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,581 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,581 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:42,583 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:42,583 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:42,586 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:42,586 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:42,587 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.7ms
2025-11-18 15:30:42,608 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:42,609 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,609 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,609 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,609 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,610 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,610 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,610 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,610 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:42,610 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:42,614 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:42,614 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:42,615 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:42,616 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,616 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,616 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,616 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,617 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,617 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,617 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,617 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:42,622 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:42,623 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:42,626 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:42,626 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:42,627 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.5ms
2025-11-18 15:30:42,627 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.6ms
2025-11-18 15:30:42,629 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:42,630 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,630 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,630 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,630 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,630 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,631 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,631 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,631 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:42,636 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:42,636 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:42,637 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:42,638 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:42,638 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,638 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,638 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,639 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,639 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,639 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,639 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,639 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:42,646 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:42,646 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:42,648 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:42,648 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:42,649 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.5ms
2025-11-18 15:30:42,650 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.0ms
2025-11-18 15:30:42,798 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:42,798 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,798 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,798 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,799 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,799 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,799 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,799 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,800 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:42,802 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:42,812 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:42,814 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2202
2025-11-18 15:30:42,814 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2202
2025-11-18 15:30:42,815 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:42,815 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 17.5ms
2025-11-18 15:30:42,821 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:42,821 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,822 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,822 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,823 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,823 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,823 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:42,825 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:42,825 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:42,829 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:42,829 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:42,830 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.0ms
2025-11-18 15:30:42,850 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:42,851 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,851 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,851 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,851 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,852 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,852 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,852 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,852 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:42,852 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:42,856 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:42,857 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:42,859 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:42,860 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,860 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,860 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,860 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,860 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,860 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,861 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,861 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:42,866 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:42,866 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:42,868 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:42,868 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:42,869 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.6ms
2025-11-18 15:30:42,869 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.8ms
2025-11-18 15:30:42,871 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:42,872 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,872 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,872 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,872 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,872 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,873 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,873 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,873 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:42,879 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:42,879 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:42,880 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:42,881 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:42,882 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:42,882 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:42,882 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:42,882 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:42,882 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:42,882 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:42,883 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:42,883 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:42,888 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:42,888 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:42,890 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:42,891 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:42,892 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.7ms
2025-11-18 15:30:42,893 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 11.6ms
2025-11-18 15:30:43,045 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:43,045 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,046 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,046 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,046 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,046 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,046 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,046 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,047 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:43,049 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:43,051 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:43,053 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:30:43,054 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2203, Rotación: True
2025-11-18 15:30:43,055 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:30:43,056 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:30:43,056 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:30:43,057 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2203
2025-11-18 15:30:43,057 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:43,058 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.4ms
2025-11-18 15:30:43,065 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:43,066 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,066 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,066 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,066 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,066 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,066 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,066 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,067 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:43,069 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:43,069 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:43,072 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:43,073 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:43,074 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.5ms
2025-11-18 15:30:43,115 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:43,116 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,116 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,116 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,116 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,117 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,117 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:43,117 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:43,122 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:43,122 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:43,129 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:43,132 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,132 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,132 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,132 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,133 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,133 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:43,139 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:43,142 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:43,144 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:43,145 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:43,145 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.4ms
2025-11-18 15:30:43,146 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 28.5ms
2025-11-18 15:30:43,148 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:43,148 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,149 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,149 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,149 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,149 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,149 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,150 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,150 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:43,154 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:43,154 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:43,155 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:43,156 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:43,157 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,158 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,159 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,159 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,159 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,159 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,160 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:43,165 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:43,165 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:43,167 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:43,168 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:43,168 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.3ms
2025-11-18 15:30:43,169 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.8ms
2025-11-18 15:30:43,308 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:43,308 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,309 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,309 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,310 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,310 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,310 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:43,313 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:43,314 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:43,316 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2203
2025-11-18 15:30:43,316 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2203
2025-11-18 15:30:43,316 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:43,317 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.2ms
2025-11-18 15:30:43,325 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:43,325 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,325 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,326 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,326 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,326 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,326 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,326 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,327 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:43,329 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:43,329 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:43,332 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:43,332 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:43,333 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.3ms
2025-11-18 15:30:43,362 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:43,363 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,363 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,363 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,363 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,364 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,364 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,364 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,364 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:43,364 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:43,369 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:43,369 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:43,370 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:43,370 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,370 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,371 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,371 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,371 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,371 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,371 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,371 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:43,379 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:43,379 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:43,381 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:43,382 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:43,382 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.3ms
2025-11-18 15:30:43,383 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 18.1ms
2025-11-18 15:30:43,385 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:43,385 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,385 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,385 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,386 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,386 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,386 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,386 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,386 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:43,392 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:43,392 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:43,394 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:43,394 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:43,395 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,395 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,395 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,395 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,395 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,396 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,396 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,396 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:43,402 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:43,403 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:43,405 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:43,405 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:43,406 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 21.0ms
2025-11-18 15:30:43,407 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.3ms
2025-11-18 15:30:43,527 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:43,527 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,527 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,528 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,528 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,528 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,528 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:43,531 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:43,532 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:43,535 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2203
2025-11-18 15:30:43,535 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2203
2025-11-18 15:30:43,535 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:43,536 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.5ms
2025-11-18 15:30:43,548 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:43,549 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,549 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,550 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,550 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,550 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,551 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:43,552 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:43,553 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:43,556 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:43,556 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:43,557 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.9ms
2025-11-18 15:30:43,580 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:43,580 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,580 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,581 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,581 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,581 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,581 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:43,582 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:43,585 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:43,585 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:43,587 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:43,587 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,587 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,588 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,588 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,588 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,588 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,588 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:43,594 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:43,594 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:43,596 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:43,597 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:43,597 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 17.7ms
2025-11-18 15:30:43,598 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.9ms
2025-11-18 15:30:43,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:43,601 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,601 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,602 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,602 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,602 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,602 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:43,602 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:43,606 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:43,606 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:43,608 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:43,609 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:43,609 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:43,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:43,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:43,610 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:43,610 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:43,610 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:43,610 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:43,616 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:43,616 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:43,618 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:43,618 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:43,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.8ms
2025-11-18 15:30:43,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 17.1ms
2025-11-18 15:30:55,347 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:55,348 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:55,348 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:55,348 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:55,348 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:55,348 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:55,348 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:55,349 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:55,349 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:55,359 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:55,360 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:55,362 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:30:55,363 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2204, Rotación: True
2025-11-18 15:30:55,364 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:30:55,365 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:30:55,365 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:30:55,365 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2204
2025-11-18 15:30:55,365 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:55,366 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 19.1ms
2025-11-18 15:30:55,373 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:55,373 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:55,374 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:55,374 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:55,374 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:55,374 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:55,374 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:55,375 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:55,375 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:55,377 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:55,377 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:55,380 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:55,381 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:55,381 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.5ms
2025-11-18 15:30:55,407 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:55,408 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:55,408 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:55,409 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:55,409 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:55,409 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:55,409 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:55,409 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:55,409 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:55,414 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:55,415 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:55,416 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:55,417 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.2ms
2025-11-18 15:30:55,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:55,421 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:55,421 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:55,421 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:55,421 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:55,422 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:55,422 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:55,422 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:55,422 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:55,429 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:55,429 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:55,432 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:55,432 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:55,433 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.3ms
2025-11-18 15:30:55,435 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:55,436 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:55,436 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:55,436 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:55,436 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:55,437 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:55,437 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:55,437 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:55,437 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:55,442 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:55,442 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:55,444 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:55,444 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.8ms
2025-11-18 15:30:55,447 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:55,447 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:55,447 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:55,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:55,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:55,448 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:55,448 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:55,448 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:55,449 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:55,457 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:55,457 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:55,460 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:55,461 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:55,462 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.1ms
2025-11-18 15:30:56,103 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:56,103 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,103 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,103 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,104 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,104 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,104 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,104 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,104 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:56,107 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:56,109 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:56,112 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:30:56,113 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2205, Rotación: True
2025-11-18 15:30:56,115 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:30:56,116 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:30:56,116 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:30:56,116 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2205
2025-11-18 15:30:56,116 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:56,117 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.2ms
2025-11-18 15:30:56,126 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:56,126 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,126 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,127 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,127 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,127 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,127 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,127 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:56,129 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:56,129 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:56,133 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:56,133 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:56,134 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.3ms
2025-11-18 15:30:56,161 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:56,161 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,162 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,162 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,162 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,162 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,163 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:56,163 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:56,169 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:56,170 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:56,172 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:56,173 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,173 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,174 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,174 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,174 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,175 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:56,183 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:56,183 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:56,188 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:56,189 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:56,190 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 29.0ms
2025-11-18 15:30:56,190 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 26.9ms
2025-11-18 15:30:56,194 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:56,194 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,195 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,195 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,196 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,196 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,196 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,197 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,197 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:56,201 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:56,202 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:56,205 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:56,206 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:56,206 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,207 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,207 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,207 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,207 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,207 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,207 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,208 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:56,215 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:56,215 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:56,217 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:56,218 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:56,219 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 25.1ms
2025-11-18 15:30:56,220 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.8ms
2025-11-18 15:30:56,403 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:56,404 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,404 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,404 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,404 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,405 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,405 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,405 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,405 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:56,408 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:56,409 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:56,411 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2205
2025-11-18 15:30:56,411 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2205
2025-11-18 15:30:56,411 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:56,412 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.0ms
2025-11-18 15:30:56,418 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:56,418 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,419 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,419 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,419 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,420 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,420 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:56,422 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:56,422 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:56,425 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:56,425 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:56,426 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.2ms
2025-11-18 15:30:56,451 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:56,452 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,452 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,453 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,453 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,453 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,454 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,454 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,454 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:56,455 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:56,460 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:56,460 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:56,462 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:56,462 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,463 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,463 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,463 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,463 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,463 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,464 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,464 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:56,469 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:56,469 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:56,473 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:56,473 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:56,474 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 22.6ms
2025-11-18 15:30:56,474 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 19.4ms
2025-11-18 15:30:56,476 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:56,477 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,477 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,477 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,478 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,478 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,478 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:56,482 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:56,483 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:56,484 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:56,485 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:56,485 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,487 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,488 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,489 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,490 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,490 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:56,496 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:56,496 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:56,499 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:56,500 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:56,500 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 23.9ms
2025-11-18 15:30:56,501 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.1ms
2025-11-18 15:30:56,645 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:56,646 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,646 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,646 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,647 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,647 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,647 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,647 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,647 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:56,650 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:56,651 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:56,661 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2205
2025-11-18 15:30:56,661 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2205
2025-11-18 15:30:56,661 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:56,662 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.7ms
2025-11-18 15:30:56,668 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:56,669 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,670 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,671 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,671 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,671 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,671 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,671 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,672 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:56,674 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:56,674 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:56,677 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:56,678 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:56,678 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.9ms
2025-11-18 15:30:56,715 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:56,715 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,716 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,716 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,716 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,716 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,716 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,716 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,717 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:56,717 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:56,724 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:56,724 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:56,725 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:56,726 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:56,726 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:56,726 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:56,726 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:56,727 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:56,727 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:56,727 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:56,727 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:56,739 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:56,739 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:56,742 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:56,742 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:56,743 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 28.0ms
2025-11-18 15:30:56,743 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 26.1ms
2025-11-18 15:30:57,052 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:57,052 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:57,052 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:57,053 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:57,053 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:57,053 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:57,053 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:57,053 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:57,053 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:57,056 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:57,057 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:57,059 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:30:57,060 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2206, Rotación: True
2025-11-18 15:30:57,061 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:30:57,061 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:30:57,061 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:30:57,062 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2206
2025-11-18 15:30:57,062 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:57,063 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.3ms
2025-11-18 15:30:57,070 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:57,070 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:57,070 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:57,071 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:57,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:57,072 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:57,072 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:57,072 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:57,073 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:57,075 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:57,075 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:57,079 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:57,079 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:57,080 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.9ms
2025-11-18 15:30:57,110 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:57,111 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:57,111 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:57,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:57,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:57,111 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:57,111 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:57,112 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:57,112 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:57,116 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:57,116 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:57,118 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:57,118 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.8ms
2025-11-18 15:30:57,121 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:57,121 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:57,121 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:57,122 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:57,122 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:57,123 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:57,123 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:57,123 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:57,123 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:57,131 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:57,131 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:57,133 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:57,133 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:57,134 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.3ms
2025-11-18 15:30:57,137 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:57,137 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:57,138 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:57,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:57,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:57,139 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:57,139 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:57,139 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:57,139 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:57,143 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:57,144 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:57,146 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:57,147 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.3ms
2025-11-18 15:30:57,148 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:57,149 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:57,149 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:57,149 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:57,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:57,150 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:57,150 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:57,151 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:57,151 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:57,162 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:57,162 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:57,165 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:57,165 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:57,166 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 17.6ms
2025-11-18 15:30:57,300 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:30:57,300 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:57,301 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:57,301 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:57,301 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:57,301 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:57,301 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:57,302 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:57,302 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:30:57,305 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:30:57,307 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:30:57,309 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2206
2025-11-18 15:30:57,309 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2206
2025-11-18 15:30:57,309 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:30:57,310 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.0ms
2025-11-18 15:30:57,323 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:30:57,324 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:57,325 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:57,325 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:57,325 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:57,325 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:57,325 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:57,326 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:57,326 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:30:57,328 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:30:57,329 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:30:57,332 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:30:57,332 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:30:57,333 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.7ms
2025-11-18 15:30:57,358 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:57,359 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:57,359 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:57,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:57,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:57,359 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:57,360 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:57,360 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:57,360 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:57,366 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:57,366 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:57,368 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:57,368 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:57,369 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 10.8ms
2025-11-18 15:30:57,372 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:57,372 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:57,373 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:57,373 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:57,373 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:57,373 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:57,373 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:57,374 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:57,374 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:57,378 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:57,379 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:57,380 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:57,381 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.6ms
2025-11-18 15:30:57,382 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 15:30:57,383 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:57,383 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:57,383 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:57,384 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:57,384 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:57,384 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:57,384 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:57,384 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 15:30:57,391 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-18 15:30:57,391 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-18 15:30:57,395 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 0 totales
2025-11-18 15:30:57,395 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 0, Página: 1
2025-11-18 15:30:57,396 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.1ms
2025-11-18 15:30:57,398 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:30:57,398 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:30:57,398 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:30:57,398 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:30:57,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:30:57,399 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:30:57,399 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:30:57,399 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:30:57,399 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:30:57,403 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:30:57,404 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:30:57,405 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:30:57,406 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.2ms
2025-11-18 15:31:00,040 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-18 15:31:00,040 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-18 15:31:00,042 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-18 15:31:00,043 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:31:00,043 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:31:00,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:31:00,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:31:00,043 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:31:00,044 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:31:00,044 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:31:00,044 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-18 15:31:00,047 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:31:00,047 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:31:00,048 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-18 15:31:00,048 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 6.2ms
2025-11-18 15:38:17,506 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 15:38:17,506 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-18 15:38:17,809 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 15:38:17,809 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:17,810 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:17,810 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:17,810 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:17,810 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:17,810 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:17,811 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:17,811 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 15:38:17,840 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 15:38:17,841 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 15:38:17,841 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 15:38:18,108 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 15:38:18,108 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 15:38:18,109 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 15:38:18,118 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:38:18,119 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2207, Rotación: False
2025-11-18 15:38:18,119 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2207
2025-11-18 15:38:18,119 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 15:38:18,120 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 311.1ms
2025-11-18 15:38:18,187 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:38:18,188 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:18,188 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:18,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:18,189 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:18,189 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:18,189 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:18,189 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:18,189 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:38:18,230 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:38:18,230 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:38:18,299 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:38:18,300 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 15:38:18,300 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:18,300 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:18,301 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:18,301 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:18,301 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:18,301 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:18,301 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:18,301 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 15:38:18,312 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 15:38:18,312 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 15:38:18,328 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 15:38:18,329 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 15:38:18,329 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 142.2ms
2025-11-18 15:38:18,330 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 30.5ms
2025-11-18 15:38:18,332 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 15:38:18,333 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:18,333 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:18,333 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:18,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:18,334 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:18,334 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:18,334 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:18,334 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 15:38:18,344 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 15:38:18,346 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 15:38:18,346 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 15:38:18,347 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:38:18,347 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:18,347 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:18,348 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:18,348 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:18,348 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:18,348 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:18,348 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:18,349 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:38:18,352 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:38:18,352 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:38:18,353 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:38:18,353 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 21.0ms
2025-11-18 15:38:18,354 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 15:38:18,357 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 15:38:18,358 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:18,359 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:18,360 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:18,360 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:18,360 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:18,360 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:18,360 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:18,361 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 15:38:18,367 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 15:38:18,367 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 15:38:18,372 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 15:38:18,372 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 15:38:18,373 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 15:38:18,373 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:18,374 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:18,374 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:18,374 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:18,374 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:18,374 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:18,374 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:18,374 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 15:38:18,380 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 15:38:18,381 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 15:38:18,381 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 15:38:18,381 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.8ms
2025-11-18 15:38:18,382 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.1ms
2025-11-18 15:38:19,026 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 15:38:19,027 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.7ms
2025-11-18 15:38:19,031 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 15:38:19,032 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:19,032 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:19,032 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:19,032 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:19,033 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:19,033 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:19,033 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:19,034 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 15:38:19,042 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 15:38:19,042 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk5MTk4LCJpYXQiOjE3NjM0OTgyOTgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.J0FUOIIFul4LF_zcr3jjVdbUXV-HholLOWm2ndEB5Es', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTAzMDk4LCJpYXQiOjE3NjM0OTgyOTgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.jbV1JwqSvXYeam1sj6GGxyylCKCqhhtojd34wClEI8U'}
2025-11-18 15:38:19,042 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 15:38:19,043 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 15:38:19,043 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 15:38:19,043 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 15:38:19,047 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 15:38:19,049 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 15:38:19,049 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 15:38:19,050 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 18.1ms
2025-11-18 15:38:19,050 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.5ms
2025-11-18 15:38:19,050 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.3ms
2025-11-18 15:38:19,052 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 15:38:19,053 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:19,053 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:19,053 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:19,053 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:19,053 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:19,054 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:19,054 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:19,054 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 15:38:19,065 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 15:38:19,065 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk5MTk4LCJpYXQiOjE3NjM0OTgyOTgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.J0FUOIIFul4LF_zcr3jjVdbUXV-HholLOWm2ndEB5Es', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTAzMDk4LCJpYXQiOjE3NjM0OTgyOTgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.jbV1JwqSvXYeam1sj6GGxyylCKCqhhtojd34wClEI8U'}
2025-11-18 15:38:19,066 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 15:38:19,066 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 15:38:19,066 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 15:38:19,066 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 15:38:19,069 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 15:38:19,069 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 15:38:19,070 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:19,070 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:19,070 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:19,071 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:19,071 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:19,071 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:19,071 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:19,071 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 15:38:19,076 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 15:38:19,076 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 15:38:19,080 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 15:38:19,081 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/conexiones/clientes/2
2025-11-18 15:38:19,081 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 29.2ms
2025-11-18 15:38:19,082 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/conexiones/clientes/2 200 1.3ms
2025-11-18 15:38:19,083 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 13.2ms
2025-11-18 15:38:19,084 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 15:38:19,085 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:19,085 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:19,085 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:19,085 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:19,086 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:19,086 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:19,086 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:19,086 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 15:38:19,094 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 15:38:19,094 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk5MTk4LCJpYXQiOjE3NjM0OTgyOTgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.J0FUOIIFul4LF_zcr3jjVdbUXV-HholLOWm2ndEB5Es', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTAzMDk4LCJpYXQiOjE3NjM0OTgyOTgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.jbV1JwqSvXYeam1sj6GGxyylCKCqhhtojd34wClEI8U'}
2025-11-18 15:38:19,094 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 15:38:19,094 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 15:38:19,095 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 15:38:19,095 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 15:38:19,096 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 15:38:19,097 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 15:38:19,098 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:19,098 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:19,098 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:19,098 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:19,099 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:19,099 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:19,099 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:19,099 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 15:38:19,099 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 15:38:19,104 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 15:38:19,104 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 15:38:19,110 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 15:38:19,110 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:19,111 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:19,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:19,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:19,111 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:19,111 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:19,112 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:19,112 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 15:38:19,115 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 15:38:19,115 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 15:38:19,116 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 15:38:19,117 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 32.4ms
2025-11-18 15:38:19,118 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 20.8ms
2025-11-18 15:38:19,118 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 18.6ms
2025-11-18 15:38:19,121 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 15:38:19,122 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:19,122 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:19,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:19,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:19,123 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:19,124 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:19,124 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:19,124 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 15:38:19,124 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 15:38:19,131 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 15:38:19,131 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 15:38:19,133 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 15:38:19,134 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:19,134 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:19,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:19,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:19,134 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:19,134 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:19,135 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:19,135 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 15:38:19,144 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 15:38:19,145 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 15:38:19,146 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 15:38:19,147 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 25.9ms
2025-11-18 15:38:19,147 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 22.7ms
2025-11-18 15:38:19,149 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 15:38:19,149 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:19,150 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:19,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:19,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:19,150 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:19,150 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:19,151 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:19,151 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 15:38:19,155 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 15:38:19,155 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 15:38:19,157 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 15:38:19,158 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 8.5ms
2025-11-18 15:38:19,166 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 15:38:19,166 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:19,166 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:19,167 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:19,167 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:19,168 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:19,168 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:19,168 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:19,168 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 15:38:19,174 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 15:38:19,174 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 15:38:19,175 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 15:38:19,176 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 10.2ms
2025-11-18 15:38:20,133 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 15:38:20,134 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:20,134 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:20,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:20,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:20,135 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:20,135 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:20,135 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:20,135 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 15:38:20,138 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 15:38:20,141 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 15:38:20,143 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 15:38:20,144 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2208, Rotación: True
2025-11-18 15:38:20,152 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 15:38:20,153 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 15:38:20,153 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 15:38:20,153 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2208
2025-11-18 15:38:20,154 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 15:38:20,154 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 21.0ms
2025-11-18 15:38:20,163 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 15:38:20,163 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:20,163 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:20,163 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:20,164 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:20,164 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:20,164 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:20,164 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:20,164 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 15:38:20,167 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 15:38:20,168 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 15:38:20,172 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 15:38:20,172 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 15:38:20,173 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.6ms
2025-11-18 15:38:48,912 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:38:48,912 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:48,912 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:48,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:48,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:48,913 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:48,913 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:48,913 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:48,913 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:38:48,949 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:38:48,949 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:38:49,010 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:38:49,011 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 98.9ms
2025-11-18 15:38:49,013 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 15:38:49,013 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 15:38:49,013 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 15:38:49,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 15:38:49,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 15:38:49,014 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 15:38:49,014 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 15:38:49,014 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 15:38:49,014 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 15:38:49,020 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 15:38:49,021 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 15:38:49,022 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 15:38:49,022 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.7ms
2025-11-18 16:53:16,330 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-18 17:02:37,149 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-18 17:05:41,076 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-18 17:05:54,872 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 17:05:54,873 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-18 17:05:54,877 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 17:05:54,878 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 17:05:54,879 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.7ms
2025-11-18 17:05:54,879 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.3ms
2025-11-18 17:05:55,192 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:05:55,192 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:05:55,193 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:05:55,193 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:05:55,193 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:05:55,193 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:05:55,193 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:05:55,193 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:05:55,194 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:05:55,194 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:05:55,194 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:05:55,195 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:05:55,195 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': acme.midominio.com:5173
2025-11-18 17:05:55,195 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-18 17:05:55,196 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:05:55,196 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-18 17:05:55,321 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-18 17:05:55,327 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 17:05:55,327 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 2: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 17:05:55,328 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 2, usando Single-DB como fallback
2025-11-18 17:05:55,328 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:05:55,328 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:05:55,329 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:05:55,329 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 17:05:55,329 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 17:05:55,329 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:05:55,330 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 17:05:55,333 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 17:05:55,334 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 17:05:55,334 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 4: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 17:05:55,334 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 4, usando Single-DB como fallback
2025-11-18 17:05:55,335 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:05:55,335 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:05:55,345 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 17:05:55,347 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 17:05:55,351 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:05:55,360 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 17:05:55,360 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2209, Rotación: True
2025-11-18 17:05:55,368 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 17:05:55,369 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 17:05:55,369 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 17:05:55,369 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2209
2025-11-18 17:05:55,369 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 17:05:55,370 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 17:05:55,371 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 17:05:55,371 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 179.7ms
2025-11-18 17:05:55,372 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 177.7ms
2025-11-18 17:05:55,372 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 177.6ms
2025-11-18 17:05:55,380 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 17:05:55,380 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-18 17:05:55,383 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 17:05:55,383 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:05:55,384 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:05:55,384 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:05:55,384 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:05:55,384 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:05:55,385 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:05:55,385 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:05:55,385 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 17:05:55,387 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 17:05:55,387 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 17:05:55,391 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 17:05:55,392 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 17:05:55,393 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.8ms
2025-11-18 17:05:55,426 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 17:05:55,426 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 17:05:55,427 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.0ms
2025-11-18 17:05:55,427 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.8ms
2025-11-18 17:05:55,430 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:05:55,431 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:05:55,431 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:05:55,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:05:55,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:05:55,432 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:05:55,432 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:05:55,432 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:05:55,432 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:05:55,455 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:05:55,455 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:05:55,518 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:05:55,519 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 88.7ms
2025-11-18 17:05:55,522 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:05:55,522 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:05:55,523 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:05:55,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:05:55,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:05:55,523 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:05:55,523 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:05:55,524 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:05:55,524 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:05:55,529 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:05:55,529 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:05:55,531 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:05:55,532 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.6ms
2025-11-18 17:06:01,345 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:06:01,346 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:01,346 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:01,346 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:01,346 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:01,347 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:01,347 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:01,347 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:01,347 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:06:01,350 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 17:06:01,351 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 17:06:01,353 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:06:01,356 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 17:06:01,357 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2210, Rotación: True
2025-11-18 17:06:01,361 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 17:06:01,362 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 17:06:01,362 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 17:06:01,362 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2210
2025-11-18 17:06:01,363 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 17:06:01,363 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 17.9ms
2025-11-18 17:06:01,371 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 17:06:01,372 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:01,372 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:01,372 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:01,373 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:01,373 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:01,373 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:01,373 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:01,373 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 17:06:01,375 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 17:06:01,375 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 17:06:01,378 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 17:06:01,378 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 17:06:01,379 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.5ms
2025-11-18 17:06:01,394 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:06:01,395 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:01,395 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:01,395 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:01,395 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:01,396 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:01,396 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:01,396 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:01,396 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:06:01,401 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:06:01,401 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:06:01,403 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:06:01,403 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.2ms
2025-11-18 17:06:01,405 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:06:01,406 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:01,406 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:01,406 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:01,406 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:01,406 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:01,406 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:01,407 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:01,407 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:06:01,411 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:06:01,411 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:06:01,413 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:06:01,413 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 17:06:10,774 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-18 17:06:10,774 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-18 17:06:11,087 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-18 17:06:11,087 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:11,087 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:11,087 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:11,088 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:11,088 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:11,088 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:11,088 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:11,088 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-18 17:06:11,091 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 17:06:11,092 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 17:06:11,092 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-18 17:06:11,093 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 5.8ms
2025-11-18 17:06:23,703 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 17:06:23,703 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.7ms
2025-11-18 17:06:23,705 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 17:06:23,706 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:23,706 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:23,706 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:23,706 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:23,707 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:23,707 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:23,707 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:23,707 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 17:06:23,715 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 17:06:23,716 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 17:06:23,716 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 17:06:23,972 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:06:23,973 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 17:06:23,973 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 17:06:23,974 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:06:23,976 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 17:06:23,976 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2211, Rotación: False
2025-11-18 17:06:23,977 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2211
2025-11-18 17:06:23,977 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 17:06:23,977 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 272.2ms
2025-11-18 17:06:24,005 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 17:06:24,006 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.7ms
2025-11-18 17:06:24,007 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:06:24,008 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:24,008 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:24,008 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:24,008 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:24,009 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:24,009 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:24,009 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:24,009 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:06:24,016 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:06:24,016 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:06:24,017 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:06:24,018 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.2ms
2025-11-18 17:06:24,020 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 17:06:24,021 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.0ms
2025-11-18 17:06:24,022 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:06:24,023 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:24,023 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:24,023 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:24,023 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:24,024 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:24,024 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:24,024 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:24,024 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:06:24,038 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:06:24,039 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:06:24,054 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:06:24,055 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:06:24,056 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 17:06:24,056 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 33.8ms
2025-11-18 17:06:24,057 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.9ms
2025-11-18 17:06:24,059 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 17:06:24,060 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:06:24,060 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:24,060 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:24,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:24,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:24,060 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:24,061 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:24,061 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:24,061 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:06:24,061 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.1ms
2025-11-18 17:06:24,066 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:06:24,066 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:06:24,067 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:06:24,068 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.4ms
2025-11-18 17:06:24,070 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:06:24,071 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:24,071 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:24,071 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:24,071 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:24,072 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:24,072 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:24,073 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:24,073 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:06:24,082 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:06:24,085 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:06:24,085 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:06:24,085 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 15.6ms
2025-11-18 17:06:24,088 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:06:24,088 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:24,088 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:24,089 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:24,089 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:24,089 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:24,089 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:24,089 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:24,089 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:06:24,095 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:06:24,095 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:06:24,099 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:06:24,099 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:06:24,099 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 11.5ms
2025-11-18 17:06:24,101 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:06:24,101 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:24,102 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:24,102 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:24,102 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:24,102 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:24,102 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:24,103 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:24,103 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:06:24,110 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:06:24,111 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:06:24,111 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:06:24,111 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.3ms
2025-11-18 17:06:35,856 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:06:35,856 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:35,857 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:35,857 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:35,857 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:35,857 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:35,857 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:35,857 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:35,858 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:06:35,868 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 17:06:35,870 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 17:06:35,874 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:06:35,888 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 17:06:35,888 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2212, Rotación: True
2025-11-18 17:06:35,899 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 17:06:35,899 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 17:06:35,900 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 17:06:35,900 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2212
2025-11-18 17:06:35,900 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 17:06:35,901 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 45.1ms
2025-11-18 17:06:35,906 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 17:06:35,906 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:35,906 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:35,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:35,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:35,907 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:35,907 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:35,907 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:35,907 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 17:06:35,909 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 17:06:35,909 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 17:06:35,912 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 17:06:35,912 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 17:06:35,913 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.8ms
2025-11-18 17:06:35,936 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:06:35,937 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:35,937 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:35,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:35,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:35,938 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:35,938 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:35,938 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:35,938 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:06:35,939 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:06:35,939 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:06:35,960 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:06:35,961 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:06:36,029 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:06:36,029 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:36,030 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:36,030 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:36,030 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:36,031 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:36,031 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:36,031 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:36,031 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:06:36,032 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:36,032 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:36,032 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:36,032 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:36,033 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:36,033 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:36,033 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:36,033 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:06:36,072 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:06:36,076 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:06:36,076 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:06:36,111 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:06:36,111 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:06:36,124 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:06:36,124 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:06:36,125 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 188.8ms
2025-11-18 17:06:36,125 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 186.4ms
2025-11-18 17:06:36,125 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 186.4ms
2025-11-18 17:06:36,128 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:06:36,129 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:36,129 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:36,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:36,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:36,129 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:36,130 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:36,130 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:36,131 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:06:36,146 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:06:36,146 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:06:36,192 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:06:36,193 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:06:36,193 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:36,193 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:36,193 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:36,194 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:36,194 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:36,194 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:36,194 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:36,194 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:06:36,194 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:06:36,203 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:06:36,206 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:06:36,206 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:06:36,206 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:36,206 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:36,207 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:36,207 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:36,207 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:36,207 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:36,207 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:36,208 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:06:36,208 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 80.1ms
2025-11-18 17:06:36,240 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:06:36,241 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:06:36,258 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:06:36,258 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:06:36,260 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 66.9ms
2025-11-18 17:06:36,260 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 65.9ms
2025-11-18 17:06:54,634 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:06:54,635 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:54,635 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:54,635 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:54,635 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:54,636 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:54,636 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:54,636 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:54,636 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:06:54,637 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:06:54,637 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:06:54,660 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:06:54,660 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:06:54,721 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:06:54,721 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:54,721 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:54,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:54,722 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:54,722 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:54,722 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:54,722 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:54,722 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:06:54,723 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:54,723 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:54,723 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:54,723 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:54,724 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:54,724 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:54,724 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:54,724 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:06:54,735 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:06:54,738 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:06:54,739 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:06:54,747 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:06:54,747 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:06:54,759 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:06:54,760 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:06:54,760 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 126.2ms
2025-11-18 17:06:54,761 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 124.1ms
2025-11-18 17:06:54,761 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 124.0ms
2025-11-18 17:06:54,764 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:06:54,766 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:54,767 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:54,767 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:54,767 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:54,767 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:54,768 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:54,768 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:54,768 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:06:54,774 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:06:54,774 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:06:54,775 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:06:54,776 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:06:54,776 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:06:54,776 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:54,776 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:54,777 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:54,777 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:54,777 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:54,777 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:54,777 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:54,777 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:06:54,777 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:54,778 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:54,778 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:54,778 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:54,778 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:54,778 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:54,778 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:54,778 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:06:54,784 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:06:54,784 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:06:54,789 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:06:54,789 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:06:54,794 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:06:54,795 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:06:54,795 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:06:54,795 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 31.0ms
2025-11-18 17:06:54,796 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 20.3ms
2025-11-18 17:06:54,796 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 20.2ms
2025-11-18 17:06:56,560 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-18 17:06:56,560 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:06:56,561 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:06:56,561 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:06:56,561 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:06:56,561 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:06:56,561 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:06:56,561 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:06:56,561 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-18 17:06:56,569 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 17:06:56,570 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 17:06:56,570 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-18 17:06:56,571 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 10.9ms
2025-11-18 17:07:03,213 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 17:07:03,213 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:03,214 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:03,214 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:03,214 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:03,214 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:03,214 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:03,214 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:03,214 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 17:07:03,218 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 17:07:03,218 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 17:07:03,218 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 17:07:03,458 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:07:03,459 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 17:07:03,459 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 17:07:03,460 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:07:03,464 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 17:07:03,466 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2213, Rotación: False
2025-11-18 17:07:03,467 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2213
2025-11-18 17:07:03,467 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 17:07:03,468 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 255.0ms
2025-11-18 17:07:03,491 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:07:03,491 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:03,491 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:03,491 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:03,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:03,492 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:03,492 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:03,493 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:03,493 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:07:03,499 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:07:03,501 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:07:03,502 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:07:03,504 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:07:03,504 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 13.4ms
2025-11-18 17:07:03,504 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:03,504 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:03,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:03,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:03,505 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:03,505 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:03,505 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:03,506 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:07:03,513 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:07:03,514 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:07:03,518 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:07:03,518 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:07:03,520 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.0ms
2025-11-18 17:07:03,522 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:07:03,522 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:03,522 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:03,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:03,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:03,523 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:03,523 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:03,524 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:03,524 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:07:03,530 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:07:03,532 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:07:03,532 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:07:03,533 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:07:03,534 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:03,534 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:03,534 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:03,535 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:03,535 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:03,535 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:03,535 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:03,535 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:07:03,540 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:07:03,540 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:07:03,541 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:07:03,542 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 19.9ms
2025-11-18 17:07:03,543 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.6ms
2025-11-18 17:07:03,545 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:07:03,545 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:03,546 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:03,546 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:03,546 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:03,546 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:03,546 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:03,547 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:03,547 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:07:03,551 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:07:03,551 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:07:03,555 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:07:03,555 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:07:03,556 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:07:03,557 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:03,557 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:03,557 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:03,557 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:03,557 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:03,558 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:03,558 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:03,558 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:07:03,563 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:07:03,564 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:07:03,564 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:07:03,564 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 19.2ms
2025-11-18 17:07:03,565 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.1ms
2025-11-18 17:07:15,210 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 17:07:15,211 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 17:07:15,211 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.6ms
2025-11-18 17:07:15,212 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.5ms
2025-11-18 17:07:15,215 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 17:07:15,215 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:15,215 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:15,216 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:15,216 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:15,216 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:15,216 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:15,216 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:15,217 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 17:07:15,222 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 17:07:15,222 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTA0NTIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.yva_-4z34sMeuVCIjeqK5Ev2kN1LxV1zA9xPTqh8cBo', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTA4NDIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.6CaOBhc2aBxbnELg-1KBtMH6Pr6LzywZnjMWRBNOx6o'}
2025-11-18 17:07:15,223 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 17:07:15,223 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 17:07:15,223 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 17:07:15,223 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 17:07:15,227 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 17:07:15,228 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.4ms
2025-11-18 17:07:15,231 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 17:07:15,231 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:15,232 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:15,232 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:15,232 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:15,233 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:15,233 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:15,233 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:15,233 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 17:07:15,239 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 17:07:15,239 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTA0NTIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.yva_-4z34sMeuVCIjeqK5Ev2kN1LxV1zA9xPTqh8cBo', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTA4NDIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.6CaOBhc2aBxbnELg-1KBtMH6Pr6LzywZnjMWRBNOx6o'}
2025-11-18 17:07:15,240 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 17:07:15,240 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 17:07:15,240 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 17:07:15,240 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 17:07:15,242 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 17:07:15,243 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 11.7ms
2025-11-18 17:07:15,772 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 17:07:15,773 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.9ms
2025-11-18 17:07:15,773 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 17:07:15,774 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.0ms
2025-11-18 17:07:15,776 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 17:07:15,776 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:15,776 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:15,776 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:15,776 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:15,777 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:15,777 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:15,777 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:15,777 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 17:07:15,783 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 17:07:15,783 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 17:07:15,795 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 17:07:15,796 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 20.6ms
2025-11-18 17:07:15,799 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 17:07:15,800 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:15,800 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:15,800 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:15,800 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:15,801 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:15,801 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:15,801 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:15,801 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 17:07:15,806 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 17:07:15,807 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 17:07:15,808 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 17:07:15,808 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.1ms
2025-11-18 17:07:16,820 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 17:07:16,820 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.7ms
2025-11-18 17:07:16,823 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 17:07:16,824 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:16,824 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:16,824 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:16,824 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:16,825 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:16,825 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:16,825 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:16,825 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 17:07:16,832 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 17:07:16,833 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTA0NTIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.yva_-4z34sMeuVCIjeqK5Ev2kN1LxV1zA9xPTqh8cBo', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTA4NDIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.6CaOBhc2aBxbnELg-1KBtMH6Pr6LzywZnjMWRBNOx6o'}
2025-11-18 17:07:16,833 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 17:07:16,833 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 17:07:16,834 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 17:07:16,834 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 17:07:16,836 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 17:07:16,837 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 17:07:16,837 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 17:07:16,839 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 15.3ms
2025-11-18 17:07:16,839 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 2.3ms
2025-11-18 17:07:16,839 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 2.1ms
2025-11-18 17:07:16,842 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 17:07:16,842 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:16,842 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:16,843 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:16,843 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:16,843 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:16,843 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:16,843 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:16,843 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 17:07:16,848 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 17:07:16,849 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTA0NTIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.yva_-4z34sMeuVCIjeqK5Ev2kN1LxV1zA9xPTqh8cBo', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTA4NDIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.6CaOBhc2aBxbnELg-1KBtMH6Pr6LzywZnjMWRBNOx6o'}
2025-11-18 17:07:16,849 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 17:07:16,849 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 17:07:16,849 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 17:07:16,849 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 17:07:16,851 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 17:07:16,852 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 17:07:16,853 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:16,853 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:16,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:16,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:16,854 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:16,854 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:16,854 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:16,854 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 17:07:16,864 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 17:07:16,864 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 17:07:16,866 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 17:07:16,867 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/conexiones/clientes/2
2025-11-18 17:07:16,867 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 25.5ms
2025-11-18 17:07:16,869 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/conexiones/clientes/2 200 1.8ms
2025-11-18 17:07:16,869 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 17.3ms
2025-11-18 17:07:16,871 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 17:07:16,872 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:16,872 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:16,872 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:16,872 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:16,873 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:16,873 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:16,873 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:16,873 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 17:07:16,877 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 17:07:16,877 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTA0NTIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.yva_-4z34sMeuVCIjeqK5Ev2kN1LxV1zA9xPTqh8cBo', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTA4NDIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.6CaOBhc2aBxbnELg-1KBtMH6Pr6LzywZnjMWRBNOx6o'}
2025-11-18 17:07:16,878 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 17:07:16,878 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 17:07:16,878 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 17:07:16,878 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 17:07:16,880 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 17:07:16,881 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 17:07:16,881 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 17:07:16,881 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:16,881 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:16,882 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:16,882 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:16,882 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:16,882 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:16,882 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:16,882 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 17:07:16,883 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:16,883 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:16,883 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:16,883 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:16,883 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:16,884 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:16,884 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:16,884 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 17:07:16,884 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.1ms
2025-11-18 17:07:16,889 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 17:07:16,889 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 17:07:16,892 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 17:07:16,896 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 17:07:16,896 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 17:07:16,898 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 17:07:16,899 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 18.2ms
2025-11-18 17:07:16,899 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 18.1ms
2025-11-18 17:07:16,902 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 17:07:16,902 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:16,903 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:16,903 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:16,903 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:16,903 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:16,903 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:16,904 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:16,904 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 17:07:16,908 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 17:07:16,908 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 17:07:16,909 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 17:07:16,910 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 17:07:16,910 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:16,910 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:16,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:16,911 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:16,911 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:16,911 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:16,911 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:16,911 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 17:07:16,915 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 17:07:16,916 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 17:07:16,917 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 17:07:16,917 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 15.7ms
2025-11-18 17:07:16,918 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 8.2ms
2025-11-18 17:07:16,920 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 17:07:16,920 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:16,920 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:16,920 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:16,921 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:16,921 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:16,921 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:16,921 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:16,922 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 17:07:16,926 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 17:07:16,926 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 17:07:16,928 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 17:07:16,929 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 9.0ms
2025-11-18 17:07:16,931 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 17:07:16,931 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:16,931 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:16,931 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:16,932 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:16,932 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:16,932 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:16,932 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:16,932 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 17:07:16,937 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 17:07:16,938 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 17:07:16,939 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 17:07:16,940 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 9.0ms
2025-11-18 17:07:17,302 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 17:07:17,302 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:17,303 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:17,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:17,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:17,303 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:17,303 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:17,303 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:17,304 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 17:07:17,308 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 17:07:17,309 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 17:07:17,310 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 17:07:17,311 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.2ms
2025-11-18 17:07:17,314 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 17:07:17,314 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:17,314 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:17,315 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:17,315 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:17,315 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:17,315 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:17,316 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:17,316 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 17:07:17,321 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 17:07:17,322 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 17:07:17,323 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 17:07:17,324 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.5ms
2025-11-18 17:07:17,707 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 17:07:17,708 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:17,708 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:17,708 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:17,708 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:17,708 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:17,709 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:17,709 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:17,709 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 17:07:17,714 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 17:07:17,714 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTA0NTIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.yva_-4z34sMeuVCIjeqK5Ev2kN1LxV1zA9xPTqh8cBo', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTA4NDIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.6CaOBhc2aBxbnELg-1KBtMH6Pr6LzywZnjMWRBNOx6o'}
2025-11-18 17:07:17,714 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 17:07:17,714 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 17:07:17,715 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 17:07:17,715 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 17:07:17,717 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 17:07:17,717 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.2ms
2025-11-18 17:07:17,720 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 17:07:17,720 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:17,720 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:17,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:17,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:17,721 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:17,722 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:17,722 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:17,722 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 17:07:17,726 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 17:07:17,727 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTA0NTIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.yva_-4z34sMeuVCIjeqK5Ev2kN1LxV1zA9xPTqh8cBo', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTA4NDIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.6CaOBhc2aBxbnELg-1KBtMH6Pr6LzywZnjMWRBNOx6o'}
2025-11-18 17:07:17,727 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 17:07:17,727 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 17:07:17,728 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 17:07:17,728 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 17:07:17,730 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 17:07:17,730 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.5ms
2025-11-18 17:07:19,572 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 17:07:19,573 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:19,573 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:19,573 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:19,573 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:19,574 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:19,574 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:19,574 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:19,574 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 17:07:19,579 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 17:07:19,579 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 17:07:19,581 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 17:07:19,582 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.6ms
2025-11-18 17:07:19,585 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 17:07:19,585 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:19,585 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:19,585 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:19,585 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:19,586 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:19,586 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:19,586 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:19,586 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 17:07:19,592 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 17:07:19,592 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 17:07:19,596 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 17:07:19,596 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 11.8ms
2025-11-18 17:07:20,369 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 17:07:20,369 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:20,369 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:20,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:20,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:20,370 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:20,370 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:20,370 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:20,371 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 17:07:20,375 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 17:07:20,375 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTA0NTIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.yva_-4z34sMeuVCIjeqK5Ev2kN1LxV1zA9xPTqh8cBo', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTA4NDIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.6CaOBhc2aBxbnELg-1KBtMH6Pr6LzywZnjMWRBNOx6o'}
2025-11-18 17:07:20,376 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 17:07:20,376 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 17:07:20,376 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 17:07:20,376 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 17:07:20,379 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 17:07:20,380 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 17:07:20,380 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:20,381 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:20,381 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:20,381 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:20,381 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:20,381 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:20,382 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:20,382 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 17:07:20,382 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.5ms
2025-11-18 17:07:20,387 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 17:07:20,387 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 17:07:20,388 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 17:07:20,390 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.9ms
2025-11-18 17:07:20,392 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 17:07:20,392 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:20,392 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:20,393 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:20,393 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:20,393 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:20,393 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:20,394 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:20,394 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 17:07:20,398 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 17:07:20,399 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTA0NTIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.yva_-4z34sMeuVCIjeqK5Ev2kN1LxV1zA9xPTqh8cBo', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTA4NDIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.6CaOBhc2aBxbnELg-1KBtMH6Pr6LzywZnjMWRBNOx6o'}
2025-11-18 17:07:20,399 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 17:07:20,399 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 17:07:20,400 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 17:07:20,400 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 17:07:20,402 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 17:07:20,403 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 17:07:20,404 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:20,404 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:20,404 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:20,404 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:20,404 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:20,405 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:20,405 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:20,405 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 17:07:20,405 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 17:07:20,406 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.0ms
2025-11-18 17:07:20,410 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 17:07:20,410 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 17:07:20,411 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 17:07:20,412 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:20,412 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:20,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:20,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:20,412 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:20,413 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:20,413 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:20,413 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 17:07:20,416 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 17:07:20,416 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 17:07:20,417 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 17:07:20,418 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 15.1ms
2025-11-18 17:07:20,419 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 13.4ms
2025-11-18 17:07:20,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 17:07:20,421 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:20,421 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:20,422 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:20,422 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:20,422 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:20,422 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:20,423 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:20,423 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 17:07:20,430 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 17:07:20,431 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTA0NTIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.yva_-4z34sMeuVCIjeqK5Ev2kN1LxV1zA9xPTqh8cBo', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTA4NDIzLCJpYXQiOjE3NjM1MDM2MjMsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.6CaOBhc2aBxbnELg-1KBtMH6Pr6LzywZnjMWRBNOx6o'}
2025-11-18 17:07:20,431 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 17:07:20,431 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 17:07:20,431 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 17:07:20,432 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 17:07:20,433 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 17:07:20,434 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 17:07:20,435 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:20,435 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:20,435 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:20,435 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:20,435 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:20,436 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:20,436 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:20,436 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 17:07:20,436 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 17:07:20,440 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 17:07:20,440 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 17:07:20,441 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 17:07:20,442 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:20,442 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:20,442 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:20,443 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:20,443 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:20,443 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:20,443 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:20,443 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 17:07:20,447 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 17:07:20,447 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 17:07:20,448 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 17:07:20,449 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 28.2ms
2025-11-18 17:07:20,450 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 15.5ms
2025-11-18 17:07:20,450 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 13.7ms
2025-11-18 17:07:20,452 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 17:07:20,452 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:20,453 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:20,453 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:20,453 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:20,453 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:20,454 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:20,454 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:20,454 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 17:07:20,459 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 17:07:20,459 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 17:07:20,461 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 17:07:20,461 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 9.2ms
2025-11-18 17:07:20,464 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 17:07:20,464 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:20,465 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:20,465 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:20,465 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:20,465 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:20,466 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:20,466 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:20,466 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 17:07:20,470 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 17:07:20,470 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 17:07:20,471 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 17:07:20,472 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 8.0ms
2025-11-18 17:07:22,628 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:07:22,629 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:22,629 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:22,630 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:22,630 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:22,630 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:22,630 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:22,630 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:22,631 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:07:22,634 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 17:07:22,636 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 17:07:22,637 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:07:22,640 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 17:07:22,641 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2214, Rotación: True
2025-11-18 17:07:22,647 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 17:07:22,648 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 17:07:22,648 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 17:07:22,648 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2214
2025-11-18 17:07:22,648 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 17:07:22,649 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 20.7ms
2025-11-18 17:07:22,654 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 17:07:22,655 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:22,655 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:22,655 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:22,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:22,656 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:22,656 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:22,656 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:22,656 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 17:07:22,659 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 17:07:22,659 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 17:07:22,664 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 17:07:22,664 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 17:07:22,665 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.4ms
2025-11-18 17:07:30,645 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:07:30,645 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:30,645 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:30,645 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:30,645 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:30,646 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:30,646 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:30,646 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:30,646 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:07:30,651 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:07:30,652 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:07:30,653 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:07:30,654 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.2ms
2025-11-18 17:07:30,656 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:07:30,657 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:30,657 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:30,657 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:30,657 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:30,658 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:30,658 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:30,658 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:30,658 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:07:30,666 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:07:30,666 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:07:30,670 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:07:30,670 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:07:30,671 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 14.8ms
2025-11-18 17:07:30,674 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:07:30,674 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:30,674 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:30,674 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:30,674 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:30,675 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:30,675 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:30,675 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:30,675 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:07:30,680 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:07:30,681 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:07:30,681 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:07:30,682 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 8.1ms
2025-11-18 17:07:30,685 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:07:30,686 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:30,686 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:30,686 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:30,686 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:30,686 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:30,686 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:30,687 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:30,687 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:07:30,690 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:07:30,690 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:07:30,691 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:07:30,691 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.1ms
2025-11-18 17:07:30,694 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:07:30,695 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:30,695 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:30,695 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:30,695 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:30,695 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:30,696 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:30,696 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:30,696 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:07:30,704 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:07:30,704 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:07:30,707 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:07:30,707 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:07:30,708 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 13.6ms
2025-11-18 17:07:30,709 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:07:30,710 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:30,710 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:30,710 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:30,710 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:30,710 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:30,710 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:30,711 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:30,711 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:07:30,715 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:07:30,715 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:07:30,715 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:07:30,716 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 6.7ms
2025-11-18 17:07:32,049 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-18 17:07:32,049 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:32,049 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:07:32,049 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:07:32,049 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:32,050 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:07:32,050 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:07:32,050 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:32,050 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-18 17:07:32,053 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 17:07:32,053 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 17:07:32,053 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-18 17:07:32,054 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 5.2ms
2025-11-18 17:07:36,827 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:07:36,827 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:36,827 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 17:07:36,827 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 17:07:36,828 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:36,828 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 17:07:36,833 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 17:07:36,834 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:36,834 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:07:36,835 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 17:07:36,836 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 9.2ms
2025-11-18 17:07:43,675 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 17:07:43,675 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.4ms
2025-11-18 17:07:43,677 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 17:07:43,677 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:43,678 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 17:07:43,678 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 17:07:43,678 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:43,678 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 17:07:43,681 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 17:07:43,681 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:43,681 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 17:07:43,686 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-18 17:07:43,686 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-18 17:07:43,686 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-18 17:07:43,916 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 17:07:43,916 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-18 17:07:43,921 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 17:07:43,926 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 17:07:43,926 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2215, Rotación: False
2025-11-18 17:07:43,926 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2215
2025-11-18 17:07:43,927 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-18 17:07:43,928 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 250.8ms
2025-11-18 17:07:43,965 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 17:07:43,965 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.6ms
2025-11-18 17:07:43,966 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 17:07:43,967 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.6ms
2025-11-18 17:07:43,968 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:07:43,969 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:43,969 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 17:07:43,969 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 17:07:43,969 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:43,970 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 17:07:43,971 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 17:07:43,971 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:43,971 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:07:43,972 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 17:07:43,991 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 17:07:43,992 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 17:07:44,047 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 17:07:44,048 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 17:07:44,049 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 77.0ms
2025-11-18 17:07:44,049 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 80.6ms
2025-11-18 17:07:44,050 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.5ms
2025-11-18 17:07:44,052 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 17:07:44,052 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:44,052 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 17:07:44,053 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 17:07:44,053 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:44,053 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 17:07:44,054 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 17:07:44,054 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:44,055 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 17:07:44,067 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 17:07:44,068 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 16.2ms
2025-11-18 17:07:44,070 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:07:44,071 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:44,071 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 17:07:44,071 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 17:07:44,071 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:44,071 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 17:07:44,073 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 17:07:44,073 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:44,073 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:07:44,077 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 17:07:44,077 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 17:07:44,078 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 17:07:44,079 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.2ms
2025-11-18 17:07:44,081 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 17:07:44,081 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:44,082 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 17:07:44,082 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 17:07:44,082 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:44,082 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 17:07:44,084 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 17:07:44,084 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:44,084 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 17:07:44,089 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 17:07:44,089 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 8.6ms
2025-11-18 17:07:45,143 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-18 17:07:45,144 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.9ms
2025-11-18 17:07:45,144 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-18 17:07:45,145 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.9ms
2025-11-18 17:07:45,147 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-18 17:07:45,147 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:45,148 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 17:07:45,148 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 17:07:45,148 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:45,148 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 17:07:45,150 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 17:07:45,150 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:45,150 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-18 17:07:45,156 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 17:07:45,157 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 10.1ms
2025-11-18 17:07:45,159 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-18 17:07:45,159 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:45,160 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 17:07:45,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 17:07:45,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:45,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 17:07:45,162 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 17:07:45,162 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:45,162 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-18 17:07:45,169 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 17:07:45,170 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 10.7ms
2025-11-18 17:07:47,152 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:07:47,152 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:47,153 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 17:07:47,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 17:07:47,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:47,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 17:07:47,154 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 17:07:47,154 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:47,155 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:07:47,156 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 17:07:47,156 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.8ms
2025-11-18 17:07:48,030 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:07:48,030 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:48,030 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 17:07:48,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 17:07:48,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:48,032 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 17:07:48,034 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 17:07:48,034 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:48,035 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:07:48,037 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 17:07:48,037 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 7.5ms
2025-11-18 17:07:48,258 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:07:48,258 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:07:48,258 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 17:07:48,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 17:07:48,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:07:48,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 17:07:48,261 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 17:07:48,261 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:07:48,261 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:07:48,263 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 17:07:48,263 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.7ms
2025-11-18 17:32:57,647 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 17:32:57,649 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.7ms
2025-11-18 17:32:59,363 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-18 17:32:59,415 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:32:59,415 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:32:59,415 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:32:59,416 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:32:59,416 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:32:59,416 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:32:59,416 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:32:59,416 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:32:59,416 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:32:59,419 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 17:32:59,420 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.4ms
2025-11-18 17:33:05,103 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 17:33:05,104 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-18 17:33:05,106 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 17:33:05,106 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:33:05,106 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:33:05,106 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:33:05,107 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:33:05,107 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:33:05,107 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:33:05,107 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:33:05,107 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 17:33:05,205 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 17:33:05,206 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 17:33:05,206 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 17:33:05,468 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:33:05,469 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 17:33:05,469 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 17:33:05,470 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:33:05,478 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 17:33:05,479 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2216, Rotación: False
2025-11-18 17:33:05,479 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2216
2025-11-18 17:33:05,479 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 17:33:05,480 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 374.4ms
2025-11-18 17:33:05,516 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 17:33:05,517 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-18 17:33:05,527 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 17:33:05,528 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:33:05,528 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:33:05,528 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:33:05,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:33:05,529 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:33:05,529 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:33:05,529 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:33:05,529 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:33:05,529 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:33:05,530 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 3.0ms
2025-11-18 17:33:05,561 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:33:05,562 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:33:05,630 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:33:05,631 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 103.7ms
2025-11-18 17:33:05,633 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 17:33:05,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 0.8ms
2025-11-18 17:33:05,634 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:33:05,635 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:33:05,636 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:33:05,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:33:05,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:33:05,637 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:33:05,637 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:33:05,638 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:33:05,638 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:33:05,650 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:33:05,651 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:33:05,669 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:33:05,669 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:33:05,670 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 35.9ms
2025-11-18 17:33:05,671 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 17:33:05,672 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.7ms
2025-11-18 17:33:05,673 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:33:05,674 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:33:05,674 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:33:05,674 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:33:05,674 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:33:05,675 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:33:05,675 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:33:05,675 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:33:05,675 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:33:05,684 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:33:05,689 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:33:05,689 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:33:05,690 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 17:33:05,691 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 17.9ms
2025-11-18 17:33:05,692 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.1ms
2025-11-18 17:33:05,694 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 17:33:05,695 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 0.7ms
2025-11-18 17:33:05,695 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:33:05,696 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:33:05,696 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:33:05,696 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:33:05,696 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:33:05,697 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:33:05,697 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:33:05,697 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:33:05,697 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:33:05,702 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:33:05,702 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:33:05,704 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:33:05,705 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.2ms
2025-11-18 17:33:05,706 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:33:05,707 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:33:05,707 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:33:05,707 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:33:05,707 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:33:05,708 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:33:05,708 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:33:05,708 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:33:05,708 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:33:05,714 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:33:05,714 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:33:05,718 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:33:05,718 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:33:05,719 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 12.8ms
2025-11-18 17:33:05,722 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:33:05,723 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:33:05,723 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:33:05,723 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:33:05,723 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:33:05,724 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:33:05,724 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:33:05,724 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:33:05,724 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:33:05,730 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:33:05,731 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:33:05,731 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:33:05,731 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 8.9ms
2025-11-18 17:33:07,245 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 17:33:07,246 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.6ms
2025-11-18 17:33:07,249 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 17:33:07,249 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 17:33:07,250 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:33:07,250 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:33:07,250 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:33:07,250 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:33:07,250 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:33:07,250 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:33:07,251 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:33:07,251 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 17:33:07,251 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 2.6ms
2025-11-18 17:33:07,262 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 17:33:07,263 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'pragma': 'no-cache', 'cache-control': 'no-cache', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTA2MDg1LCJpYXQiOjE3NjM1MDUxODUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.R5ktiqwSvC1g1dO8IZrfckzQcmCXFxV74oZLvLfuCHM', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTA5OTg1LCJpYXQiOjE3NjM1MDUxODUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.gfnW_ToQq0y13WR_IMtYzxLTIMMI_F8_yxyTh0PLOho'}
2025-11-18 17:33:07,263 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 17:33:07,263 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 17:33:07,263 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 17:33:07,264 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 17:33:07,268 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 17:33:07,274 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 24.6ms
2025-11-18 17:33:07,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 17:33:07,280 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:33:07,281 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:33:07,281 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:33:07,281 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:33:07,281 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:33:07,282 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:33:07,282 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:33:07,282 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 17:33:07,290 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 17:33:07,291 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'pragma': 'no-cache', 'cache-control': 'no-cache', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTA2MDg1LCJpYXQiOjE3NjM1MDUxODUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.R5ktiqwSvC1g1dO8IZrfckzQcmCXFxV74oZLvLfuCHM', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MTA5OTg1LCJpYXQiOjE3NjM1MDUxODUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.gfnW_ToQq0y13WR_IMtYzxLTIMMI_F8_yxyTh0PLOho'}
2025-11-18 17:33:07,291 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 17:33:07,292 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 17:33:07,292 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 17:33:07,292 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 17:33:07,294 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 17:33:07,295 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.9ms
2025-11-18 17:33:09,360 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 17:33:09,360 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-18 17:33:09,364 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:33:09,364 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:33:09,364 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:33:09,364 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:33:09,365 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:33:09,365 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:33:09,365 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:33:09,365 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:33:09,366 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:33:09,369 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 17:33:09,371 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 17:33:09,374 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:33:09,377 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 17:33:09,377 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2217, Rotación: True
2025-11-18 17:33:09,385 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 17:33:09,385 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 17:33:09,386 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 17:33:09,386 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2217
2025-11-18 17:33:09,386 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 17:33:09,387 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 23.1ms
2025-11-18 17:33:09,394 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 17:33:09,394 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.6ms
2025-11-18 17:33:09,397 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 17:33:09,398 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:33:09,398 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:33:09,398 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:33:09,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:33:09,399 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:33:09,399 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:33:09,399 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:33:09,400 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 17:33:09,402 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 17:33:09,402 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 17:33:09,405 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 17:33:09,405 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 17:33:09,406 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.2ms
2025-11-18 17:41:36,405 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 17:41:36,407 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 17:41:36,407 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 17:41:36,407 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 17:41:36,408 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 17:41:36,408 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 17:41:36,408 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 3.2ms
2025-11-18 17:41:36,409 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.1ms
2025-11-18 17:41:36,409 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.9ms
2025-11-18 17:41:36,409 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.8ms
2025-11-18 17:41:36,409 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.7ms
2025-11-18 17:41:36,410 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.9ms
2025-11-18 17:41:36,715 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:41:36,716 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:36,716 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:36,716 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:36,717 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:36,717 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:36,717 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:36,717 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:36,717 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:41:36,767 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:41:36,768 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:41:36,832 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:41:36,832 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:41:36,833 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:36,834 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:36,834 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:36,834 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:36,834 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:36,834 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:36,834 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:36,835 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:41:36,846 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:41:36,848 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:41:36,848 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:41:36,849 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:41:36,849 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:41:36,850 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:36,850 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:36,850 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:36,850 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:36,851 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:36,851 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:36,851 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:36,852 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:41:36,852 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:36,852 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:36,852 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:36,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:36,853 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:36,853 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:36,853 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:36,853 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:41:36,854 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 138.9ms
2025-11-18 17:41:36,858 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:41:36,858 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:41:36,860 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:41:36,874 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:41:36,875 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:41:36,888 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:41:36,888 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:41:36,888 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:41:36,889 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:41:36,889 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:36,889 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:36,889 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:36,889 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:36,890 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:36,890 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:36,890 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:36,890 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:41:36,890 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:36,891 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:36,891 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:36,891 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:36,891 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:36,891 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:36,892 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:36,892 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:41:36,893 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 60.9ms
2025-11-18 17:41:36,899 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:41:36,900 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:41:36,900 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:41:36,906 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:41:36,906 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:41:36,910 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:41:36,911 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:41:36,912 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 63.0ms
2025-11-18 17:41:36,912 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 63.0ms
2025-11-18 17:41:36,914 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 25.6ms
2025-11-18 17:41:36,914 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 25.5ms
2025-11-18 17:41:39,920 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 17:41:39,921 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-18 17:41:39,924 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:41:39,925 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:39,925 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:39,925 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:39,926 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:39,926 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:39,926 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:39,926 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:39,926 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:41:39,930 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 17:41:39,931 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 17:41:39,939 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:41:39,951 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 17:41:39,952 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2218, Rotación: True
2025-11-18 17:41:39,959 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 17:41:39,960 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 17:41:39,960 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 17:41:39,960 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2218
2025-11-18 17:41:39,961 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 17:41:39,961 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 37.0ms
2025-11-18 17:41:39,967 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 17:41:39,968 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.8ms
2025-11-18 17:41:39,971 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 17:41:39,971 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:39,972 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:39,972 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:39,972 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:39,972 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:39,973 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:39,973 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:39,973 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 17:41:39,975 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 17:41:39,976 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 17:41:39,978 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 17:41:39,979 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 17:41:39,979 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.3ms
2025-11-18 17:41:40,008 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 17:41:40,009 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-11-18 17:41:40,009 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 17:41:40,009 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 17:41:40,010 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 17:41:40,011 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.6ms
2025-11-18 17:41:40,012 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 17:41:40,012 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 17:41:40,013 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 3.4ms
2025-11-18 17:41:40,013 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 3.3ms
2025-11-18 17:41:40,015 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 3.5ms
2025-11-18 17:41:40,016 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 3.4ms
2025-11-18 17:41:40,016 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:41:40,017 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:40,017 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:40,017 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:40,017 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:40,017 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:40,018 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:40,018 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:40,018 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:41:40,036 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:41:40,037 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:41:40,100 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:41:40,101 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:41:40,103 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:40,103 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:40,103 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:40,104 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:40,104 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:40,104 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:40,104 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:40,104 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:41:40,105 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:41:40,105 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:41:40,145 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:41:40,145 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:41:40,165 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:41:40,165 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:41:40,166 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:40,166 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:40,166 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:40,166 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:40,167 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:40,167 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:40,167 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:40,167 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:41:40,168 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:40,168 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:40,168 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:40,168 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:40,168 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:40,168 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:40,169 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:40,169 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:41:40,169 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 17:41:40,170 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:41:40,170 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 153.9ms
2025-11-18 17:41:40,206 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:41:40,212 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:41:40,212 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:41:40,240 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:41:40,240 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:41:40,295 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:41:40,296 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:40,296 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:40,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:40,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:40,296 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:40,297 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:40,297 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:40,297 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 17:41:40,297 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:40,297 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:40,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:40,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:40,298 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:40,298 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:40,298 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:40,298 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 17:41:40,319 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 17:41:40,322 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 17:41:40,322 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 17:41:40,328 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 17:41:40,328 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 17:41:40,338 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 17:41:40,338 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 17:41:40,340 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 238.5ms
2025-11-18 17:41:40,341 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 235.8ms
2025-11-18 17:41:40,341 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 235.6ms
2025-11-18 17:41:40,342 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 172.5ms
2025-11-18 17:41:40,342 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 172.5ms
2025-11-18 17:41:41,190 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 17:41:41,190 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-18 17:41:41,195 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 17:41:41,195 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:41,195 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:41,196 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:41,196 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:41,196 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:41,196 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:41,197 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:41,197 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 17:41:41,201 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 17:41:41,203 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 17:41:41,206 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 17:41:41,217 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 17:41:41,218 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2219, Rotación: True
2025-11-18 17:41:41,228 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 17:41:41,229 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 17:41:41,230 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 17:41:41,230 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2219
2025-11-18 17:41:41,230 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 17:41:41,231 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 36.1ms
2025-11-18 17:41:41,237 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 17:41:41,239 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 1.1ms
2025-11-18 17:41:41,243 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 17:41:41,244 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:41,244 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:41,244 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:41,245 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:41,245 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:41,245 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:41,245 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:41,245 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 17:41:41,248 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 17:41:41,248 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 17:41:41,253 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 17:41:41,253 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 17:41:41,254 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.9ms
2025-11-18 17:41:41,294 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 17:41:41,295 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 17:41:41,296 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.2ms
2025-11-18 17:41:41,297 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 17:41:41,297 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 17:41:41,297 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 17:41:41,298 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 17:41:41,299 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 3.6ms
2025-11-18 17:41:41,300 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 3.2ms
2025-11-18 17:41:41,301 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 3.9ms
2025-11-18 17:41:41,301 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 4.0ms
2025-11-18 17:41:41,302 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 4.0ms
2025-11-18 17:41:41,305 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 17:41:41,306 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:41,307 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:41,307 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:41,307 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:41,308 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 17:41:41,308 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 17:41:41,308 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 17:41:41,308 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 17:41:41,354 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 17:41:41,354 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 17:41:41,413 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 17:41:41,414 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 17:41:41,415 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 17:41:41,416 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 17:41:41,416 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 17:41:41,416 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 17:41:41,416 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'

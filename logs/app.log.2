2025-12-04 07:49:27,349 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 07:49:27,789 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 07:49:27,819 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 07:49:27,833 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 07:49:27,833 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 07:49:27,839 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 07:49:27,839 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 07:49:27,839 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 07:49:28,537 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 07:49:28,537 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 07:49:28,700 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 07:49:28,700 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 07:49:28,700 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 07:49:28,938 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 07:49:28,939 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 07:49:29,109 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'admin', 'api', 'www', 'assets', 'static', 'cdn', 'backend'}
2025-12-04 07:49:41,266 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-12-04 07:49:41,267 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.0ms
2025-12-04 07:49:41,269 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 07:49:41,269 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:49:41,269 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:49:41,269 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:49:41,269 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:49:41,269 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:49:41,275 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 07:49:41,405 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:49:41,405 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:49:41,405 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:49:41,409 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:45,561 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 07:49:45,561 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 07:49:45,569 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:49:45,569 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/refresh/
2025-12-04 07:49:45,578 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:45,625 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token v√°lido - Cliente EE7BFC14-995F-4209-B4B9-99C307534A43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web
2025-12-04 07:49:45,629 - app.modules.auth.application.services.auth_service - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Level: 1, Type: user)
2025-12-04 07:49:45,636 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 07:49:45,646 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: 743992C4-BB7A-47C7-B53F-45CC770EDCFD, Rotaci√≥n: True
2025-12-04 07:49:45,651 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 07:49:45,651 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no cr√≠tico)
2025-12-04 07:49:45,651 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 743992C4-BB7A-47C7-B53F-45CC770EDCFD
2025-12-04 07:49:45,651 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-12-04 07:49:45,659 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 07:49:45,660 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 4391.0ms
2025-12-04 07:49:45,665 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-12-04 07:49:45,666 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-12-04 07:49:45,668 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-12-04 07:49:45,668 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:49:45,668 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:49:45,668 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:49:45,668 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:49:45,668 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:49:45,672 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:49:45,672 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:49:45,673 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:49:45,677 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:45,677 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:49:45,677 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/me/
2025-12-04 07:49:45,682 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-12-04 07:49:45,682 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 1, Super Admin: False, Type: user
2025-12-04 07:49:45,682 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 2458D1EA-816B-4C3C-8D13-B90271F59558 para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:45,684 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 07:49:45,689 - app.modules.users.application.services.user_service - WARNING - Usuario ID 2458D1EA-816B-4C3C-8D13-B90271F59558 no encontrado en cliente ee7bfc14-995f-4209-b4b9-99c307534a43 o est√° eliminado
2025-12-04 07:49:45,689 - app.modules.auth.presentation.endpoints - ERROR - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558 no encontrado en cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:45,689 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 404 25.4ms
2025-12-04 07:49:50,152 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 07:49:50,153 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:49:50,153 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:49:50,153 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:49:50,153 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:49:50,154 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:49:50,159 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:49:50,159 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:49:50,159 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:49:50,166 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:50,166 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:49:50,166 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/refresh/
2025-12-04 07:49:50,172 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token v√°lido - Cliente EE7BFC14-995F-4209-B4B9-99C307534A43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web
2025-12-04 07:49:50,175 - app.modules.auth.application.services.auth_service - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Level: 1, Type: user)
2025-12-04 07:49:50,178 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 07:49:50,186 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: 9C4B78EF-A02C-4DD2-AD04-CD721BDD73D2, Rotaci√≥n: True
2025-12-04 07:49:50,189 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 07:49:50,189 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no cr√≠tico)
2025-12-04 07:49:50,189 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 9C4B78EF-A02C-4DD2-AD04-CD721BDD73D2
2025-12-04 07:49:50,190 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-12-04 07:49:50,193 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 07:49:50,193 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 41.2ms
2025-12-04 07:49:50,198 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-12-04 07:49:50,198 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:49:50,198 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:49:50,198 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:49:50,199 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:49:50,199 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:49:50,204 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:49:50,204 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:49:50,204 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:49:50,208 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:50,208 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:49:50,208 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/me/
2025-12-04 07:49:50,209 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-12-04 07:49:50,209 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 1, Super Admin: False, Type: user
2025-12-04 07:49:50,209 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 2458D1EA-816B-4C3C-8D13-B90271F59558 para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:50,209 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 07:49:50,215 - app.modules.users.application.services.user_service - WARNING - Usuario ID 2458D1EA-816B-4C3C-8D13-B90271F59558 no encontrado en cliente ee7bfc14-995f-4209-b4b9-99c307534a43 o est√° eliminado
2025-12-04 07:49:50,215 - app.modules.auth.presentation.endpoints - ERROR - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558 no encontrado en cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:50,216 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 404 17.4ms
2025-12-04 07:49:53,449 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 07:49:53,450 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:49:53,450 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:49:53,451 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:49:53,451 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:49:53,451 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:49:53,457 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:49:53,457 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:49:53,457 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:49:53,462 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:53,463 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:49:53,463 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/refresh/
2025-12-04 07:49:53,468 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token v√°lido - Cliente EE7BFC14-995F-4209-B4B9-99C307534A43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web
2025-12-04 07:49:53,472 - app.modules.auth.application.services.auth_service - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Level: 1, Type: user)
2025-12-04 07:49:53,475 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 07:49:53,481 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: BBF92E42-D8A5-4EFD-AD06-6AA7378F001C, Rotaci√≥n: True
2025-12-04 07:49:53,484 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 07:49:53,485 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no cr√≠tico)
2025-12-04 07:49:53,485 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: BBF92E42-D8A5-4EFD-AD06-6AA7378F001C
2025-12-04 07:49:53,485 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-12-04 07:49:53,490 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 07:49:53,490 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 40.4ms
2025-12-04 07:49:53,493 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-12-04 07:49:53,493 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:49:53,495 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:49:53,495 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:49:53,495 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:49:53,495 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:49:53,498 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:49:53,500 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:49:53,500 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:49:53,503 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:53,503 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:49:53,503 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/me/
2025-12-04 07:49:53,507 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-12-04 07:49:53,507 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 1, Super Admin: False, Type: user
2025-12-04 07:49:53,507 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 2458D1EA-816B-4C3C-8D13-B90271F59558 para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:53,507 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 07:49:53,511 - app.modules.users.application.services.user_service - WARNING - Usuario ID 2458D1EA-816B-4C3C-8D13-B90271F59558 no encontrado en cliente ee7bfc14-995f-4209-b4b9-99c307534a43 o est√° eliminado
2025-12-04 07:49:53,511 - app.modules.auth.presentation.endpoints - ERROR - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558 no encontrado en cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:49:53,511 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 404 17.3ms
2025-12-04 07:50:07,039 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 07:50:07,039 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 07:50:07,039 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 07:50:07,039 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 07:50:07,039 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 07:50:07,039 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 07:50:07,134 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001D7DC1EB530>
2025-12-04 07:50:07,134 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001D7DC9DA240>
2025-12-04 07:50:09,030 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 07:50:09,220 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 07:50:09,224 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 07:50:09,228 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 07:50:09,228 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 07:50:09,229 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 07:50:09,229 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 07:50:09,229 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 07:50:09,540 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 07:50:09,540 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 07:50:09,610 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 07:50:09,610 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 07:50:09,610 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 07:50:09,767 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 07:50:09,767 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 07:50:09,914 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'api', 'cdn', 'static', 'www', 'backend', 'admin', 'assets'}
2025-12-04 07:50:24,005 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-12-04 07:50:24,006 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.7ms
2025-12-04 07:50:24,007 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 07:50:24,008 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:50:24,008 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:50:24,008 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:50:24,008 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:50:24,008 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:50:24,011 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 07:50:24,044 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:50:24,044 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:50:24,044 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:50:24,050 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:50:28,106 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 07:50:28,106 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 07:50:28,112 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:50:28,112 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 07:50:28,121 - app.modules.auth.presentation.endpoints - INFO - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43 resuelto y validado para login.
2025-12-04 07:50:28,122 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:50:28,122 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:50:28,123 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:50:28,360 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 07:50:28,360 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, cliente_origen=ee7bfc14-995f-4209-b4b9-99c307534a43, cliente_destino=N/A, access_level=1, user_type=user
2025-12-04 07:50:28,365 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 07:50:28,372 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 07:50:28,378 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: B27DA641-B8D6-4D4D-BEA7-C16D0054D6C9, Rotaci√≥n: False
2025-12-04 07:50:28,378 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: B27DA641-B8D6-4D4D-BEA7-C16D0054D6C9
2025-12-04 07:50:28,378 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:50:28,383 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 07:50:28,384 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 4376.5ms
2025-12-04 07:50:28,393 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-12-04 07:50:28,395 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.6ms
2025-12-04 07:50:28,397 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 07:50:28,398 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:50:28,398 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:50:28,398 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:50:28,398 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:50:28,398 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:50:28,403 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:50:28,405 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:50:28,405 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:50:28,410 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:50:28,411 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:50:28,411 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 07:50:28,418 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 07:50:28,420 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.5ms
2025-12-04 07:50:28,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 07:50:28,421 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-12-04 07:50:28,425 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 07:50:28,425 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:50:28,425 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:50:28,425 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:50:28,425 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:50:28,427 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:50:28,435 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:50:28,435 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:50:28,435 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:50:28,444 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:50:28,445 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:50:28,445 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 07:50:28,450 - app.api.deps - ERROR - Error construyendo objeto completo para usuario 'admin_acme'
2025-12-04 07:50:28,450 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 54.8ms
2025-12-04 07:50:28,461 - app.api.deps - ERROR - Error construyendo objeto completo para usuario 'admin_acme'
2025-12-04 07:50:28,462 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 37.2ms
2025-12-04 07:50:28,463 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 07:50:28,463 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:50:28,463 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:50:28,463 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:50:28,463 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:50:28,463 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:50:28,463 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:50:28,463 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:50:28,470 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:50:28,474 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:50:28,475 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:50:28,475 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 07:50:28,485 - app.api.deps - ERROR - Error construyendo objeto completo para usuario 'admin_acme'
2025-12-04 07:50:28,486 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 22.0ms
2025-12-04 07:51:18,236 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 07:51:18,236 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:51:18,236 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:51:18,236 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:51:18,236 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:51:18,236 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:51:18,243 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:51:18,243 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:51:18,243 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:51:18,249 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:51:18,249 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:51:18,249 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/refresh/
2025-12-04 07:51:18,253 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token v√°lido - Cliente EE7BFC14-995F-4209-B4B9-99C307534A43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web
2025-12-04 07:51:18,261 - app.modules.auth.application.services.auth_service - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Level: 1, Type: user)
2025-12-04 07:51:18,264 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 07:51:18,324 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: AF541731-C9E5-4EC5-A3D7-95DFDE4AAC08, Rotaci√≥n: True
2025-12-04 07:51:18,324 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 07:51:18,324 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no cr√≠tico)
2025-12-04 07:51:18,324 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: AF541731-C9E5-4EC5-A3D7-95DFDE4AAC08
2025-12-04 07:51:18,324 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-12-04 07:51:18,331 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 07:51:18,331 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 97.3ms
2025-12-04 07:51:18,337 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-12-04 07:51:18,337 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:51:18,337 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:51:18,337 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:51:18,337 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:51:18,339 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:51:18,343 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:51:18,343 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:51:18,343 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:51:18,347 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:51:18,347 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:51:18,348 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/me/
2025-12-04 07:51:18,351 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-12-04 07:51:18,351 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 1, Super Admin: False, Type: user
2025-12-04 07:51:18,351 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 2458D1EA-816B-4C3C-8D13-B90271F59558 para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:51:18,352 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 07:51:18,354 - app.modules.users.application.services.user_service - WARNING - Usuario ID 2458D1EA-816B-4C3C-8D13-B90271F59558 no encontrado en cliente ee7bfc14-995f-4209-b4b9-99c307534a43 o est√° eliminado
2025-12-04 07:51:18,354 - app.modules.auth.presentation.endpoints - ERROR - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558 no encontrado en cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:51:18,354 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 404 17.9ms
2025-12-04 07:54:27,791 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 07:54:27,791 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 07:54:27,791 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 07:54:27,791 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 07:54:27,792 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 07:54:27,792 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 07:54:27,894 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001FD813CC5F0>
2025-12-04 07:54:27,894 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001FD81C9A9F0>
2025-12-04 07:54:27,894 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001FD81CF8C50>
2025-12-04 07:54:28,803 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 07:54:29,065 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 07:54:29,073 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 07:54:29,073 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 07:54:29,073 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 07:54:29,073 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 07:54:29,073 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 07:54:29,073 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 07:54:29,594 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 07:54:29,594 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 07:54:29,702 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 07:54:29,702 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 07:54:29,702 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 07:54:29,928 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 07:54:29,929 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 07:54:30,111 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'www', 'cdn', 'api', 'static', 'assets', 'backend', 'admin'}
2025-12-04 07:54:33,339 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 07:54:33,339 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 07:54:33,339 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 07:54:33,339 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 07:54:33,340 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 07:54:33,340 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 07:54:34,093 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 07:54:34,292 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 07:54:34,293 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 07:54:34,301 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 07:54:34,301 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 07:54:34,301 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 07:54:34,301 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 07:54:34,302 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 07:54:34,653 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 07:54:34,655 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 07:54:34,733 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 07:54:34,733 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 07:54:34,733 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 07:54:34,887 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 07:54:34,888 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 07:54:35,031 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'api', 'backend', 'cdn', 'static', 'admin', 'assets', 'www'}
2025-12-04 07:54:48,770 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 07:54:48,771 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:54:48,771 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:54:48,771 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:54:48,772 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:54:48,772 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:54:48,774 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 07:54:48,814 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:54:48,814 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:54:48,814 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:54:48,822 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:54:52,925 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 07:54:52,925 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 07:54:52,931 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:54:52,931 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 07:54:52,937 - app.modules.auth.presentation.endpoints - INFO - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43 resuelto y validado para login.
2025-12-04 07:54:52,937 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:54:52,937 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:54:52,938 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:54:53,172 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 07:54:53,172 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, cliente_origen=ee7bfc14-995f-4209-b4b9-99c307534a43, cliente_destino=N/A, access_level=1, user_type=user
2025-12-04 07:54:53,172 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 07:54:53,178 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 07:54:53,184 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: B33C9066-4DAE-46C7-8D32-934A29A68EFA, Rotaci√≥n: False
2025-12-04 07:54:53,185 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: B33C9066-4DAE-46C7-8D32-934A29A68EFA
2025-12-04 07:54:53,185 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:54:53,189 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 07:54:53,190 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 4419.7ms
2025-12-04 07:54:53,196 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 07:54:53,196 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:54:53,196 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:54:53,196 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:54:53,196 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:54:53,196 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:54:53,205 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:54:53,206 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:54:53,206 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:54:53,209 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 07:54:53,210 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:54:53,210 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:54:53,211 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:54:53,211 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:54:53,211 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:54:53,216 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:54:53,216 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:54:53,216 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 07:54:53,220 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:54:53,220 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:54:53,223 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:54:53,233 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:54:53,233 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:54:53,233 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 07:54:53,253 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 07:54:53,254 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:54:53,260 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente 00000000-0000-0000-0000-000000000000
2025-12-04 07:54:53,260 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 07:54:53,261 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:54:53,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 62.6ms
2025-12-04 07:54:53,266 - app.infrastructure.database.queries_async - ERROR - Error en execute_procedure_params async: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:54:53,267 - app.infrastructure.database.connection_async - ERROR - [ASYNC_CONNECTION] Error en sesi√≥n async: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 642, in execute_procedure_params
    result = await session.execute(query, param_bindings)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2258, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.ProgrammingError: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_async.py", line 326, in get_db_connection
    yield session
  File "D:\base_multi_tenant_fastapi\app\core\tenant\routing.py", line 869, in get_connection_for_tenant
    yield session
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 665, in execute_procedure_params
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:54:53,357 - app.modules.menus.application.services.menu_service - ERROR - Error de BD al obtener men√∫ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:54:53,357 - app.modules.menus.presentation.endpoints - ERROR - Error de servicio en GET /getmenu/ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error de base de datos al obtener men√∫ del usuario
2025-12-04 07:54:53,357 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 147.9ms
2025-12-04 07:54:53,359 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 07:54:53,359 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:54:53,359 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:54:53,359 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:54:53,360 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:54:53,360 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:54:53,363 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:54:53,363 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:54:53,363 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:54:53,368 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:54:53,368 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:54:53,368 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 07:54:53,386 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente 00000000-0000-0000-0000-000000000000
2025-12-04 07:54:53,386 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 07:54:53,386 - app.infrastructure.database.queries_async - ERROR - Error en execute_procedure_params async: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:54:53,386 - app.infrastructure.database.connection_async - ERROR - [ASYNC_CONNECTION] Error en sesi√≥n async: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 642, in execute_procedure_params
    result = await session.execute(query, param_bindings)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2258, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.ProgrammingError: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_async.py", line 326, in get_db_connection
    yield session
  File "D:\base_multi_tenant_fastapi\app\core\tenant\routing.py", line 869, in get_connection_for_tenant
    yield session
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 665, in execute_procedure_params
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:54:53,394 - app.modules.menus.application.services.menu_service - ERROR - Error de BD al obtener men√∫ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:54:53,395 - app.modules.menus.presentation.endpoints - ERROR - Error de servicio en GET /getmenu/ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error de base de datos al obtener men√∫ del usuario
2025-12-04 07:54:53,395 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 35.9ms
2025-12-04 07:59:23,859 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 07:59:23,860 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:59:23,860 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:59:23,860 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:23,860 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:23,861 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:23,865 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:23,865 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:23,865 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:23,872 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:23,873 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:59:23,873 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/refresh/
2025-12-04 07:59:23,881 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token v√°lido - Cliente EE7BFC14-995F-4209-B4B9-99C307534A43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web
2025-12-04 07:59:23,885 - app.modules.auth.application.services.auth_service - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Level: 1, Type: user)
2025-12-04 07:59:23,888 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 07:59:23,898 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: D8DBF395-B5D4-4B46-96A8-EF09F092F326, Rotaci√≥n: True
2025-12-04 07:59:23,898 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 07:59:23,898 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no cr√≠tico)
2025-12-04 07:59:23,898 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: D8DBF395-B5D4-4B46-96A8-EF09F092F326
2025-12-04 07:59:23,898 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-12-04 07:59:23,906 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 07:59:23,906 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 47.7ms
2025-12-04 07:59:23,911 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-12-04 07:59:23,911 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:59:23,911 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:59:23,911 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:23,912 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:23,912 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:23,915 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:23,916 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:23,916 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:23,919 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:23,920 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:59:23,920 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/me/
2025-12-04 07:59:23,925 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-12-04 07:59:23,925 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 1, Super Admin: False, Type: user
2025-12-04 07:59:23,925 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 2458D1EA-816B-4C3C-8D13-B90271F59558 para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:23,925 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 07:59:23,946 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 2458D1EA-816B-4C3C-8D13-B90271F59558 con 1 roles activos
2025-12-04 07:59:23,946 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: user, Level: 1, Super Admin: False, Roles: 1
2025-12-04 07:59:23,946 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 36.1ms
2025-12-04 07:59:23,950 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 07:59:23,950 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:59:23,950 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:59:23,950 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:23,950 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:23,950 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:23,956 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:23,956 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:23,956 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:23,958 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:23,958 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:59:23,958 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 07:59:23,963 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 07:59:23,967 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:59:23,967 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:59:23,967 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:23,967 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:23,967 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:23,975 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:23,975 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:23,975 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:23,978 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:23,978 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:59:23,982 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 07:59:23,990 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 07:59:23,990 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:23,990 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:23,990 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 46.7ms
2025-12-04 07:59:24,008 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente 00000000-0000-0000-0000-000000000000
2025-12-04 07:59:24,008 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 07:59:24,012 - app.infrastructure.database.queries_async - ERROR - Error en execute_procedure_params async: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:59:24,012 - app.infrastructure.database.connection_async - ERROR - [ASYNC_CONNECTION] Error en sesi√≥n async: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 642, in execute_procedure_params
    result = await session.execute(query, param_bindings)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2258, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.ProgrammingError: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_async.py", line 326, in get_db_connection
    yield session
  File "D:\base_multi_tenant_fastapi\app\core\tenant\routing.py", line 869, in get_connection_for_tenant
    yield session
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 665, in execute_procedure_params
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:59:24,012 - app.modules.menus.application.services.menu_service - ERROR - Error de BD al obtener men√∫ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:59:24,012 - app.modules.menus.presentation.endpoints - ERROR - Error de servicio en GET /getmenu/ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error de base de datos al obtener men√∫ del usuario
2025-12-04 07:59:24,012 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 49.8ms
2025-12-04 07:59:24,018 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 07:59:24,018 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:59:24,018 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:59:24,018 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:24,018 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:24,018 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:24,024 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:24,024 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:24,024 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:24,029 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:24,029 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:59:24,030 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 07:59:24,044 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente 00000000-0000-0000-0000-000000000000
2025-12-04 07:59:24,044 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 07:59:24,048 - app.infrastructure.database.queries_async - ERROR - Error en execute_procedure_params async: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:59:24,048 - app.infrastructure.database.connection_async - ERROR - [ASYNC_CONNECTION] Error en sesi√≥n async: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 642, in execute_procedure_params
    result = await session.execute(query, param_bindings)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2258, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.ProgrammingError: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_async.py", line 326, in get_db_connection
    yield session
  File "D:\base_multi_tenant_fastapi\app\core\tenant\routing.py", line 869, in get_connection_for_tenant
    yield session
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 665, in execute_procedure_params
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:59:24,051 - app.modules.menus.application.services.menu_service - ERROR - Error de BD al obtener men√∫ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:59:24,051 - app.modules.menus.presentation.endpoints - ERROR - Error de servicio en GET /getmenu/ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error de base de datos al obtener men√∫ del usuario
2025-12-04 07:59:24,052 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 34.0ms
2025-12-04 07:59:35,836 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-12-04 07:59:35,838 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.4ms
2025-12-04 07:59:35,839 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 07:59:35,839 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:59:35,840 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:59:35,840 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:35,840 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:35,840 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:35,844 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:35,844 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:35,844 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:35,848 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:35,848 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:59:35,848 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/logout/
2025-12-04 07:59:35,853 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 07:59:35,856 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario: 2458D1EA-816B-4C3C-8D13-B90271F59558 (admin_acme)
2025-12-04 07:59:35,861 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 07:59:35,862 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 22.7ms
2025-12-04 07:59:38,056 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 07:59:38,056 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 07:59:38,058 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 07:59:38,058 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 07:59:38,058 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 07:59:38,058 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 07:59:38,164 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001E16C805C10>
2025-12-04 07:59:38,165 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001E16E8BAAE0>
2025-12-04 07:59:38,165 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001E16E8F4170>
2025-12-04 07:59:38,166 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001E16E8F7A10>
2025-12-04 07:59:40,448 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 07:59:40,651 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 07:59:40,658 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 07:59:40,660 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 07:59:40,660 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 07:59:40,660 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 07:59:40,661 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 07:59:40,661 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 07:59:40,991 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 07:59:40,991 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 07:59:41,062 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 07:59:41,062 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 07:59:41,062 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 07:59:41,221 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 07:59:41,222 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 07:59:41,364 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'static', 'assets', 'api', 'backend', 'www', 'cdn', 'admin'}
2025-12-04 07:59:51,100 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 07:59:51,100 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:59:51,101 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:59:51,101 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:51,101 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:51,101 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:51,103 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 07:59:51,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:51,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:51,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:51,139 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:55,201 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 07:59:55,201 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 07:59:55,208 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:59:55,208 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 07:59:55,217 - app.modules.auth.presentation.endpoints - INFO - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43 resuelto y validado para login.
2025-12-04 07:59:55,218 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:55,218 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:55,219 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:55,456 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 07:59:55,456 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, cliente_origen=ee7bfc14-995f-4209-b4b9-99c307534a43, cliente_destino=N/A, access_level=1, user_type=user
2025-12-04 07:59:55,456 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 07:59:55,460 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 07:59:55,466 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: E53EF83A-3DAF-44F7-8F12-3E1AABC9BE3A, Rotaci√≥n: False
2025-12-04 07:59:55,466 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: E53EF83A-3DAF-44F7-8F12-3E1AABC9BE3A
2025-12-04 07:59:55,466 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:55,471 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 07:59:55,472 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 4371.8ms
2025-12-04 07:59:55,480 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 07:59:55,481 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:59:55,481 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:59:55,481 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:55,481 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:55,481 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:55,487 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:55,487 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:55,487 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:55,492 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 07:59:55,492 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:59:55,492 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:59:55,493 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:55,493 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:55,493 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:55,493 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:55,493 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:59:55,493 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 07:59:55,503 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:55,503 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:55,503 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:55,512 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:55,513 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:59:55,513 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 07:59:55,528 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 07:59:55,528 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:55,532 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:55,533 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 52.6ms
2025-12-04 07:59:55,539 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente 00000000-0000-0000-0000-000000000000
2025-12-04 07:59:55,539 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 07:59:55,543 - app.infrastructure.database.queries_async - ERROR - Error en execute_procedure_params async: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:59:55,543 - app.infrastructure.database.connection_async - ERROR - [ASYNC_CONNECTION] Error en sesi√≥n async: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 642, in execute_procedure_params
    result = await session.execute(query, param_bindings)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2258, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.ProgrammingError: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_async.py", line 326, in get_db_connection
    yield session
  File "D:\base_multi_tenant_fastapi\app\core\tenant\routing.py", line 869, in get_connection_for_tenant
    yield session
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 665, in execute_procedure_params
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:59:55,550 - app.modules.menus.application.services.menu_service - ERROR - Error de BD al obtener men√∫ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:59:55,550 - app.modules.menus.presentation.endpoints - ERROR - Error de servicio en GET /getmenu/ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error de base de datos al obtener men√∫ del usuario
2025-12-04 07:59:55,551 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 59.5ms
2025-12-04 07:59:55,553 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 07:59:55,553 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 07:59:55,553 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 07:59:55,553 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:55,553 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:55,553 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:55,558 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 07:59:55,558 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 07:59:55,558 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 07:59:55,558 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 07:59:55,558 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 07:59:55,558 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 07:59:55,578 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente 00000000-0000-0000-0000-000000000000
2025-12-04 07:59:55,578 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 07:59:55,580 - app.infrastructure.database.queries_async - ERROR - Error en execute_procedure_params async: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:59:55,581 - app.infrastructure.database.connection_async - ERROR - [ASYNC_CONNECTION] Error en sesi√≥n async: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 642, in execute_procedure_params
    result = await session.execute(query, param_bindings)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2258, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.ProgrammingError: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_async.py", line 326, in get_db_connection
    yield session
  File "D:\base_multi_tenant_fastapi\app\core\tenant\routing.py", line 869, in get_connection_for_tenant
    yield session
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 665, in execute_procedure_params
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:59:55,584 - app.modules.menus.application.services.menu_service - ERROR - Error de BD al obtener men√∫ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Error converting data type nvarchar to int. (8114) (SQLExecDirectW)')
[SQL: EXEC sp_GetMenuForUser @UsuarioID = ?]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 07:59:55,584 - app.modules.menus.presentation.endpoints - ERROR - Error de servicio en GET /getmenu/ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error de base de datos al obtener men√∫ del usuario
2025-12-04 07:59:55,585 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 31.7ms
2025-12-04 08:02:46,755 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:02:46,755 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:02:46,755 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:02:46,756 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:02:46,756 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:02:46,756 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:02:46,860 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001CC30096C00>
2025-12-04 08:02:46,861 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001CC30BE6840>
2025-12-04 08:02:46,861 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001CC30BFBD70>
2025-12-04 08:02:46,862 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001CC30C23110>
2025-12-04 08:02:47,582 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:02:47,770 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:02:47,775 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:02:47,786 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:02:47,786 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:02:47,786 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:02:47,786 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:02:47,786 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:02:48,121 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:02:48,121 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:02:48,191 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:02:48,191 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:02:48,191 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:02:48,345 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:02:48,346 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:02:48,485 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'www', 'cdn', 'backend', 'assets', 'api', 'static', 'admin'}
2025-12-04 08:02:50,901 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-12-04 08:02:50,901 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.9ms
2025-12-04 08:02:50,901 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 08:02:50,901 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:02:50,901 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:02:50,901 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:02:50,901 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:02:50,901 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:02:50,909 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:02:50,956 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:02:50,956 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:02:50,956 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:02:50,961 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:02:55,069 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:02:55,069 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:02:55,075 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:02:55,075 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/refresh/
2025-12-04 08:02:55,081 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:02:55,092 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token v√°lido - Cliente EE7BFC14-995F-4209-B4B9-99C307534A43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web
2025-12-04 08:02:55,095 - app.modules.auth.application.services.auth_service - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Level: 1, Type: user)
2025-12-04 08:02:55,095 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 08:02:55,103 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: 7C656AAB-B5E5-4A6F-BE03-B936296FCA8F, Rotaci√≥n: True
2025-12-04 08:02:55,105 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 08:02:55,105 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no cr√≠tico)
2025-12-04 08:02:55,105 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 7C656AAB-B5E5-4A6F-BE03-B936296FCA8F
2025-12-04 08:02:55,105 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-12-04 08:02:55,105 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:02:55,111 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 4206.1ms
2025-12-04 08:02:55,113 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-12-04 08:02:55,115 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.4ms
2025-12-04 08:02:55,116 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-12-04 08:02:55,117 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:02:55,117 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:02:55,117 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:02:55,117 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:02:55,117 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:02:55,121 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:02:55,121 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:02:55,122 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:02:55,125 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:02:55,126 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:02:55,126 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/me/
2025-12-04 08:02:55,128 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-12-04 08:02:55,128 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 1, Super Admin: False, Type: user
2025-12-04 08:02:55,128 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 2458D1EA-816B-4C3C-8D13-B90271F59558 para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:02:55,128 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:02:55,137 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 2458D1EA-816B-4C3C-8D13-B90271F59558 con 1 roles activos
2025-12-04 08:02:55,137 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: user, Level: 1, Super Admin: False, Roles: 1
2025-12-04 08:02:55,138 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 21.3ms
2025-12-04 08:02:55,141 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-12-04 08:02:55,141 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.4ms
2025-12-04 08:02:55,142 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:02:55,143 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:02:55,143 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:02:55,143 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:02:55,143 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:02:55,143 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:02:55,145 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:02:55,145 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:02:55,145 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:02:55,151 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:02:55,151 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:02:55,152 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:02:55,153 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:02:55,154 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-12-04 08:02:55,155 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:02:55,159 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 3.9ms
2025-12-04 08:02:55,161 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:02:55,161 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:02:55,161 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:02:55,161 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:02:55,161 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:02:55,161 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:02:55,171 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:02:55,171 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:02:55,171 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:02:55,176 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:02:55,176 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:02:55,176 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:02:55,186 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 08:02:55,186 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:02:55,193 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:02:55,193 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 50.6ms
2025-12-04 08:02:55,201 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente 00000000-0000-0000-0000-000000000000
2025-12-04 08:02:55,201 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:02:55,206 - app.infrastructure.database.queries_async - ERROR - Error en execute_procedure_params async: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 08:02:55,206 - app.infrastructure.database.connection_async - ERROR - [ASYNC_CONNECTION] Error en sesi√≥n async: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 646, in execute_procedure_params
    result = await session.execute(query, param_bindings)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2258, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.ProgrammingError: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_async.py", line 326, in get_db_connection
    yield session
  File "D:\base_multi_tenant_fastapi\app\core\tenant\routing.py", line 869, in get_connection_for_tenant
    yield session
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 669, in execute_procedure_params
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 08:02:55,215 - app.modules.menus.application.services.menu_service - ERROR - Error de BD al obtener men√∫ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 08:02:55,215 - app.modules.menus.presentation.endpoints - ERROR - Error de servicio en GET /getmenu/ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error de base de datos al obtener men√∫ del usuario
2025-12-04 08:02:55,215 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 56.4ms
2025-12-04 08:02:55,218 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:02:55,219 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:02:55,219 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:02:55,219 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:02:55,219 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:02:55,219 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:02:55,225 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:02:55,225 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:02:55,225 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:02:55,228 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:02:55,228 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:02:55,229 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:02:55,245 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente 00000000-0000-0000-0000-000000000000
2025-12-04 08:02:55,245 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:02:55,247 - app.infrastructure.database.queries_async - ERROR - Error en execute_procedure_params async: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 08:02:55,248 - app.infrastructure.database.connection_async - ERROR - [ASYNC_CONNECTION] Error en sesi√≥n async: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 646, in execute_procedure_params
    result = await session.execute(query, param_bindings)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2258, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.ProgrammingError: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_async.py", line 326, in get_db_connection
    yield session
  File "D:\base_multi_tenant_fastapi\app\core\tenant\routing.py", line 869, in get_connection_for_tenant
    yield session
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 669, in execute_procedure_params
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 08:02:55,251 - app.modules.menus.application.services.menu_service - ERROR - Error de BD al obtener men√∫ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 08:02:55,252 - app.modules.menus.presentation.endpoints - ERROR - Error de servicio en GET /getmenu/ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error de base de datos al obtener men√∫ del usuario
2025-12-04 08:02:55,252 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 33.6ms
2025-12-04 08:02:56,963 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:02:56,963 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:02:56,963 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:02:56,964 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:02:56,964 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:02:56,964 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:02:56,968 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:02:56,968 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:02:56,968 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:02:56,971 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:02:56,972 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:02:56,972 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/logout/
2025-12-04 08:02:56,979 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 08:02:56,980 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario: 2458D1EA-816B-4C3C-8D13-B90271F59558 (admin_acme)
2025-12-04 08:02:56,984 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:02:56,984 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 21.9ms
2025-12-04 08:02:59,942 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:02:59,943 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:02:59,943 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:02:59,943 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:02:59,943 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:02:59,943 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:03:00,043 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001ED8B9B5910>
2025-12-04 08:03:00,043 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001ED8DEA2090>
2025-12-04 08:03:00,043 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001ED8DF00980>
2025-12-04 08:03:01,577 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:03:01,773 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:03:01,781 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:03:01,783 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:03:01,783 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:03:01,784 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:03:01,784 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:03:01,784 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:03:02,103 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:03:02,103 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:03:02,173 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:03:02,173 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:03:02,174 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:03:02,327 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:03:02,328 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:03:02,471 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'assets', 'backend', 'cdn', 'api', 'static', 'www', 'admin'}
2025-12-04 08:03:09,897 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-12-04 08:03:09,897 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.7ms
2025-12-04 08:03:09,899 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:03:09,900 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:03:09,900 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:03:09,900 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:03:09,900 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:03:09,900 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:03:09,903 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:03:09,937 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:03:09,941 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:03:09,941 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:03:09,945 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:03:14,037 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:03:14,037 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:03:14,044 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:03:14,044 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 08:03:14,049 - app.modules.auth.presentation.endpoints - INFO - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43 resuelto y validado para login.
2025-12-04 08:03:14,050 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:03:14,050 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:03:14,050 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:03:14,281 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 08:03:14,281 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, cliente_origen=ee7bfc14-995f-4209-b4b9-99c307534a43, cliente_destino=N/A, access_level=1, user_type=user
2025-12-04 08:03:14,281 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:03:14,289 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 08:03:14,295 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: E7B0A5DC-031A-4761-A677-29667B90FD91, Rotaci√≥n: False
2025-12-04 08:03:14,295 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: E7B0A5DC-031A-4761-A677-29667B90FD91
2025-12-04 08:03:14,295 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:03:14,299 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:03:14,300 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 4400.5ms
2025-12-04 08:03:14,309 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:03:14,309 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:03:14,310 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:03:14,310 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:03:14,310 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:03:14,310 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:03:14,316 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:03:14,317 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:03:14,317 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:03:14,318 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:03:14,319 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:03:14,319 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:03:14,319 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:03:14,319 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:03:14,319 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:03:14,325 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:03:14,325 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:03:14,326 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:03:14,332 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:03:14,333 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:03:14,333 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:03:14,343 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:03:14,344 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:03:14,344 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:03:14,359 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 08:03:14,359 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:03:14,363 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:03:14,364 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 55.2ms
2025-12-04 08:03:14,371 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente 00000000-0000-0000-0000-000000000000
2025-12-04 08:03:14,371 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:03:14,375 - app.infrastructure.database.queries_async - ERROR - Error en execute_procedure_params async: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 08:03:14,375 - app.infrastructure.database.connection_async - ERROR - [ASYNC_CONNECTION] Error en sesi√≥n async: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 646, in execute_procedure_params
    result = await session.execute(query, param_bindings)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2258, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.ProgrammingError: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_async.py", line 326, in get_db_connection
    yield session
  File "D:\base_multi_tenant_fastapi\app\core\tenant\routing.py", line 869, in get_connection_for_tenant
    yield session
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 669, in execute_procedure_params
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 08:03:14,384 - app.modules.menus.application.services.menu_service - ERROR - Error de BD al obtener men√∫ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 08:03:14,384 - app.modules.menus.presentation.endpoints - ERROR - Error de servicio en GET /getmenu/ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error de base de datos al obtener men√∫ del usuario
2025-12-04 08:03:14,385 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 65.9ms
2025-12-04 08:03:14,386 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:03:14,387 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:03:14,387 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:03:14,387 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:03:14,387 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:03:14,388 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:03:14,392 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:03:14,392 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:03:14,393 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:03:14,397 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:03:14,397 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:03:14,398 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:03:14,413 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente 00000000-0000-0000-0000-000000000000
2025-12-04 08:03:14,415 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:03:14,418 - app.infrastructure.database.queries_async - ERROR - Error en execute_procedure_params async: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 08:03:14,419 - app.infrastructure.database.connection_async - ERROR - [ASYNC_CONNECTION] Error en sesi√≥n async: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 646, in execute_procedure_params
    result = await session.execute(query, param_bindings)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2258, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 230, in execute
    self._adapt_connection._handle_exception(error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 368, in _handle_exception
    raise error.with_traceback(exc_info[2])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 228, in execute
    return self.await_(self._execute_async(operation, parameters))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 251, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 132, in execute
    await self._run_operation(self._impl.execute, sql, *params)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\aioodbc\cursor.py", line 30, in _run_operation
    result = await self._conn._execute(func, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.ProgrammingError: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_async.py", line 326, in get_db_connection
    yield session
  File "D:\base_multi_tenant_fastapi\app\core\tenant\routing.py", line 869, in get_connection_for_tenant
    yield session
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries_async.py", line 669, in execute_procedure_params
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 08:03:14,422 - app.modules.menus.application.services.menu_service - ERROR - Error de BD al obtener men√∫ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error ejecutando stored procedure sp_GetMenuForUser: (pyodbc.ProgrammingError) ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Incorrect syntax near '@P1'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
[SQL: EXEC sp_GetMenuForUser @UsuarioID = CAST(? AS UNIQUEIDENTIFIER)]
[parameters: ('2458d1ea-816b-4c3c-8d13-b90271f59558',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-04 08:03:14,423 - app.modules.menus.presentation.endpoints - ERROR - Error de servicio en GET /getmenu/ para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558: Error de base de datos al obtener men√∫ del usuario
2025-12-04 08:03:14,423 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 36.8ms
2025-12-04 08:03:43,532 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:03:43,532 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:03:43,532 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:03:43,532 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:03:43,532 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:03:43,532 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:03:43,537 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:03:43,537 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:03:43,537 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:03:43,541 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:03:43,541 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:03:43,541 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/logout/
2025-12-04 08:03:43,550 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 08:03:43,550 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario: 2458D1EA-816B-4C3C-8D13-B90271F59558 (admin_acme)
2025-12-04 08:03:43,556 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:03:43,557 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 24.9ms
2025-12-04 08:04:28,425 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:04:28,425 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:04:28,425 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:04:28,425 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:04:28,425 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:04:28,425 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:04:28,524 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000018DCDBF2240>
2025-12-04 08:04:28,524 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000018DCFB35730>
2025-12-04 08:04:28,526 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000018DCED7E870>
2025-12-04 08:04:28,526 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000018DCFABF0E0>
2025-12-04 08:04:29,386 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:04:29,622 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:04:29,622 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:04:29,636 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:04:29,636 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:04:29,636 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:04:29,636 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:04:29,636 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:04:30,094 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:04:30,094 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:04:30,203 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:04:30,203 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:04:30,203 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:04:30,422 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:04:30,422 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:04:30,572 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'api', 'backend', 'www', 'cdn', 'assets', 'admin', 'static'}
2025-12-04 08:04:42,999 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:04:43,000 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:04:43,000 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:04:43,000 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:04:43,000 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:04:43,000 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:04:43,793 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:04:43,993 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:04:44,001 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:04:44,010 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:04:44,011 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:04:44,011 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:04:44,012 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:04:44,012 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:04:44,347 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:04:44,347 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:04:44,416 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:04:44,416 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:04:44,416 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:04:44,572 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:04:44,572 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:04:44,723 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'assets', 'cdn', 'api', 'www', 'static', 'backend', 'admin'}
2025-12-04 08:04:46,350 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:04:46,350 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:04:46,350 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:04:46,353 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:04:46,353 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:04:46,353 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:04:48,011 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:04:48,207 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:04:48,212 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:04:48,213 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:04:48,215 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:04:48,215 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:04:48,215 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:04:48,215 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:04:48,538 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:04:48,538 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:04:48,609 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:04:48,609 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:04:48,609 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:04:48,768 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:04:48,769 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:04:48,922 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'api', 'static', 'backend', 'admin', 'cdn', 'assets', 'www'}
2025-12-04 08:04:57,243 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:04:57,243 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:04:57,244 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:04:57,244 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:04:57,244 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:04:57,244 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:04:57,246 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:04:57,282 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:04:57,283 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:04:57,283 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:04:57,286 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:01,366 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:05:01,366 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:05:01,372 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:05:01,372 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 08:05:01,378 - app.modules.auth.presentation.endpoints - INFO - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43 resuelto y validado para login.
2025-12-04 08:05:01,378 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:01,379 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:01,379 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:01,616 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 08:05:01,616 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, cliente_origen=ee7bfc14-995f-4209-b4b9-99c307534a43, cliente_destino=N/A, access_level=1, user_type=user
2025-12-04 08:05:01,616 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:05:01,625 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 08:05:01,631 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: DDB35C85-7EA3-440A-BEF8-F202BC07DE6D, Rotaci√≥n: False
2025-12-04 08:05:01,631 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: DDB35C85-7EA3-440A-BEF8-F202BC07DE6D
2025-12-04 08:05:01,631 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:01,634 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:05:01,637 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 4394.0ms
2025-12-04 08:05:01,643 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:05:01,643 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:05:01,643 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:05:01,643 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:01,643 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:01,646 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:01,650 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:01,650 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:01,650 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:01,654 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:05:01,654 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:05:01,655 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:05:01,655 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:01,655 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:01,655 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:01,658 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:01,658 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:05:01,658 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:05:01,667 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:01,668 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:01,668 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:01,674 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:01,674 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:05:01,674 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:05:01,695 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 08:05:01,695 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:01,700 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:01,701 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 56.8ms
2025-12-04 08:05:01,705 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:01,705 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:05:01,743 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:05:01,743 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:05:01,743 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 92.6ms
2025-12-04 08:05:01,743 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:05:01,743 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:05:01,743 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:05:01,743 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:01,743 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:01,743 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:01,754 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:01,754 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:01,754 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:01,758 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:01,758 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:05:01,759 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:05:01,773 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:01,775 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:05:01,778 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:05:01,778 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:05:01,778 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 29.9ms
2025-12-04 08:05:51,288 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 08:05:51,289 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:05:51,289 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:05:51,289 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:51,289 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:51,289 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:51,294 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:51,294 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:51,294 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:51,299 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:51,299 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:05:51,300 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/refresh/
2025-12-04 08:05:51,306 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token v√°lido - Cliente EE7BFC14-995F-4209-B4B9-99C307534A43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web
2025-12-04 08:05:51,309 - app.modules.auth.application.services.auth_service - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Level: 1, Type: user)
2025-12-04 08:05:51,312 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 08:05:51,319 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: F385F75A-ABD9-428C-8ACD-86F83AEB4570, Rotaci√≥n: True
2025-12-04 08:05:51,323 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 08:05:51,323 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no cr√≠tico)
2025-12-04 08:05:51,324 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: F385F75A-ABD9-428C-8ACD-86F83AEB4570
2025-12-04 08:05:51,324 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-12-04 08:05:51,327 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:05:51,327 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 39.0ms
2025-12-04 08:05:51,331 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-12-04 08:05:51,331 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:05:51,331 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:05:51,331 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:51,331 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:51,331 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:51,337 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:51,338 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:51,338 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:51,341 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:51,342 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:05:51,342 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/me/
2025-12-04 08:05:51,346 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-12-04 08:05:51,346 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 1, Super Admin: False, Type: user
2025-12-04 08:05:51,347 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 2458D1EA-816B-4C3C-8D13-B90271F59558 para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:51,347 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:05:51,357 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 2458D1EA-816B-4C3C-8D13-B90271F59558 con 1 roles activos
2025-12-04 08:05:51,357 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: user, Level: 1, Super Admin: False, Roles: 1
2025-12-04 08:05:51,357 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 26.1ms
2025-12-04 08:05:51,358 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:05:51,360 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:05:51,360 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:05:51,360 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:51,360 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:51,360 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:51,365 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:51,365 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:51,365 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:51,372 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:05:51,373 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:05:51,373 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:05:51,374 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:51,374 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:51,374 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:51,377 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:51,377 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:05:51,378 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:05:51,379 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:51,379 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:51,379 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:51,390 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:51,390 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:05:51,390 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:05:51,420 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 08:05:51,420 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:51,424 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:51,427 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 66.8ms
2025-12-04 08:05:51,429 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:51,430 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:05:51,433 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:05:51,433 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:05:51,433 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 62.0ms
2025-12-04 08:05:51,436 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:05:51,437 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:05:51,437 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:05:51,437 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:51,437 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:51,437 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:51,439 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:05:51,439 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:05:51,439 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:05:51,445 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:51,446 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:05:51,446 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:05:51,459 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:05:51,459 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:05:51,466 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:05:51,466 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:05:51,466 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 29.9ms
2025-12-04 08:08:55,839 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:08:55,839 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:08:55,840 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:08:55,840 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:08:55,840 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:08:55,840 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:08:55,843 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:08:55,844 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:08:55,844 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:08:55,848 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:08:55,848 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:08:55,848 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/logout/
2025-12-04 08:08:55,854 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 08:08:55,855 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario: 2458D1EA-816B-4C3C-8D13-B90271F59558 (admin_acme)
2025-12-04 08:08:55,859 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:08:55,860 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 21.2ms
2025-12-04 08:09:06,805 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-12-04 08:09:06,805 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-12-04 08:09:06,807 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:09:06,807 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:06,807 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:09:06,807 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:09:06,808 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:06,808 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:09:06,812 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:09:06,812 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:06,813 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:09:06,817 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:06,820 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:09:06,820 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 08:09:06,825 - app.modules.auth.presentation.endpoints - INFO - Cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60 resuelto y validado para login.
2025-12-04 08:09:06,825 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_innova', cliente_id_destino=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:06,825 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:06,826 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:07,101 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF: level=1, super_admin=False, type=user
2025-12-04 08:09:07,101 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_innova', usuario_id=726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, cliente_origen=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, cliente_destino=N/A, access_level=1, user_type=user
2025-12-04 08:09:07,101 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:09:07,111 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF: level=1, super_admin=False, type=user
2025-12-04 08:09:07,117 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, Tipo: web, Token ID: 7E09A24B-0EB3-4A29-B4E2-47B4775AD159, Rotaci√≥n: False
2025-12-04 08:09:07,118 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 7E09A24B-0EB3-4A29-B4E2-47B4775AD159
2025-12-04 08:09:07,118 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_innova autenticado exitosamente (WEB) para cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:07,125 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, usuario_id=726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, exito=True
2025-12-04 08:09:07,126 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 318.8ms
2025-12-04 08:09:07,136 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-12-04 08:09:07,136 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.6ms
2025-12-04 08:09:07,138 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:09:07,139 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:07,139 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:09:07,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:09:07,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:07,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:09:07,145 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:09:07,145 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:07,145 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:09:07,152 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:07,152 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:09:07,152 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:09:07,186 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60 por usuario: admin_innova
2025-12-04 08:09:07,186 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:07,186 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:07,186 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 51.4ms
2025-12-04 08:09:12,188 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:09:12,190 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.3ms
2025-12-04 08:09:12,190 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:09:12,191 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.0ms
2025-12-04 08:09:12,192 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:09:12,193 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:12,193 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:09:12,193 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:09:12,193 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:12,193 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:09:12,198 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:09:12,199 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:12,199 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:09:12,199 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:12,199 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:09:12,199 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:09:12,216 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf del cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:12,216 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf
2025-12-04 08:09:12,263 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 3 items ra√≠z.
2025-12-04 08:09:12,263 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 726d3aed-dff3-4ee0-8084-4e2e4fecdedf con 3 items ra√≠z.
2025-12-04 08:09:12,263 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 70.8ms
2025-12-04 08:09:12,265 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:09:12,265 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:12,265 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:09:12,266 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:09:12,266 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:12,266 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:09:12,268 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:09:12,268 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:12,268 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:09:12,275 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:12,275 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:09:12,275 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:09:12,286 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf del cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:12,286 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf
2025-12-04 08:09:12,293 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 3 items ra√≠z.
2025-12-04 08:09:12,293 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 726d3aed-dff3-4ee0-8084-4e2e4fecdedf con 3 items ra√≠z.
2025-12-04 08:09:12,294 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 28.5ms
2025-12-04 08:09:16,319 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-12-04 08:09:16,320 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-12-04 08:09:16,321 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:09:16,321 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:16,321 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:09:16,322 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:09:16,322 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:16,322 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:09:16,325 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:09:16,325 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:16,325 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:09:16,330 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:09:16,330 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:09:16,330 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/auth/logout/
2025-12-04 08:09:16,341 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF
2025-12-04 08:09:16,341 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, Usuario: 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF (admin_innova)
2025-12-04 08:09:16,348 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, usuario_id=726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, exito=True
2025-12-04 08:09:16,348 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 27.4ms
2025-12-04 08:09:28,032 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-12-04 08:09:28,033 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.4ms
2025-12-04 08:09:28,034 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:09:28,034 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:28,034 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:09:28,035 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:28,035 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:28,035 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:28,035 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:28,035 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:28,035 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:28,035 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:28,036 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:09:28,036 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/auth/login/
2025-12-04 08:09:28,043 - app.modules.auth.presentation.endpoints - INFO - Cliente bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7 resuelto y validado para login.
2025-12-04 08:09:28,043 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:28,043 - app.modules.auth.application.services.auth_service - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7), accediendo a cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:28,257 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E: level=5, super_admin=True, type=super_admin
2025-12-04 08:09:28,257 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=154134AD-A5EB-4F45-AEF0-5F9AAA282C8E, cliente_origen=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, cliente_destino=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, access_level=5, user_type=super_admin
2025-12-04 08:09:28,257 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:28,267 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E: level=5, super_admin=True, type=super_admin
2025-12-04 08:09:28,276 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, Usuario 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E, Tipo: web, Token ID: 0A6FD6CC-A2BB-4105-BAD7-D67A477F1C5E, Rotaci√≥n: False
2025-12-04 08:09:28,276 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 0A6FD6CC-A2BB-4105-BAD7-D67A477F1C5E
2025-12-04 08:09:28,276 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:28,284 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, usuario_id=154134AD-A5EB-4F45-AEF0-5F9AAA282C8E, exito=True
2025-12-04 08:09:28,284 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 251.5ms
2025-12-04 08:09:28,299 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-12-04 08:09:28,299 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.6ms
2025-12-04 08:09:28,302 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:09:28,302 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:28,303 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:09:28,303 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:28,303 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:28,303 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:28,303 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:28,303 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:28,304 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:28,304 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:28,304 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:09:28,304 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/clientes/tenant/branding
2025-12-04 08:09:28,334 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7 por usuario: superadmin
2025-12-04 08:09:28,334 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:28,338 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:28,338 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 36.3ms
2025-12-04 08:09:28,341 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:09:28,342 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.5ms
2025-12-04 08:09:28,344 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:09:28,344 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.5ms
2025-12-04 08:09:28,345 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:09:28,346 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:28,346 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:09:28,346 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:28,346 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:28,346 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:28,346 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:28,347 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:28,347 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:28,347 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:28,347 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:09:28,347 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/menus/getmenu/
2025-12-04 08:09:28,358 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e del cliente bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:28,358 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e
2025-12-04 08:09:28,408 - app.modules.menus.application.services.menu_service - INFO - No se encontraron men√∫s permitidos para el usuario ID: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e.
2025-12-04 08:09:28,408 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 75.9ms
2025-12-04 08:09:28,423 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:09:28,424 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:28,424 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:09:28,424 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:28,424 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:28,424 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:28,424 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:28,424 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:28,424 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:28,424 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:28,424 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:09:28,424 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/menus/getmenu/
2025-12-04 08:09:28,441 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e del cliente bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:28,441 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e
2025-12-04 08:09:28,447 - app.modules.menus.application.services.menu_service - INFO - No se encontraron men√∫s permitidos para el usuario ID: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e.
2025-12-04 08:09:28,447 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 24.5ms
2025-12-04 08:09:31,010 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-12-04 08:09:31,011 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-12-04 08:09:31,011 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.2ms
2025-12-04 08:09:31,012 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.2ms
2025-12-04 08:09:31,014 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-12-04 08:09:31,014 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:31,014 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:09:31,014 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:31,015 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:31,015 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:31,015 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:31,015 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:31,015 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:31,015 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:31,015 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:09:31,015 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/clientes/
2025-12-04 08:09:31,035 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-12-04 08:09:31,035 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-12-04 08:09:31,045 - app.modules.tenant.application.services.cliente_service - INFO - Listados 5 clientes de 5 totales
2025-12-04 08:09:31,047 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 33.0ms
2025-12-04 08:09:31,049 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-12-04 08:09:31,049 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:31,049 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:09:31,049 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:31,050 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:31,050 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:31,050 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:31,050 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:31,050 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:31,050 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:31,050 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:09:31,051 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/clientes/
2025-12-04 08:09:31,066 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-12-04 08:09:31,067 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-12-04 08:09:31,072 - app.modules.tenant.application.services.cliente_service - INFO - Listados 5 clientes de 5 totales
2025-12-04 08:09:31,073 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 23.9ms
2025-12-04 08:09:39,928 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/NaN/
2025-12-04 08:09:39,929 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/NaN/ 200 0.9ms
2025-12-04 08:09:39,930 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/NaN/
2025-12-04 08:09:39,931 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/NaN/estadisticas/
2025-12-04 08:09:39,931 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/NaN/estadisticas/
2025-12-04 08:09:39,932 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/NaN/ 200 1.5ms
2025-12-04 08:09:39,932 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/NaN/estadisticas/ 200 1.3ms
2025-12-04 08:09:39,932 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/NaN/estadisticas/ 200 1.3ms
2025-12-04 08:09:39,934 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/NaN/
2025-12-04 08:09:39,935 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:39,935 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:09:39,935 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:39,935 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:39,935 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:39,935 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:39,935 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:39,935 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:39,937 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:39,937 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:09:39,937 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/clientes/NaN/
2025-12-04 08:09:39,939 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/NaN/estadisticas/
2025-12-04 08:09:39,940 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:39,940 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:09:39,940 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:39,940 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:39,940 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:39,940 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:39,941 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:39,941 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:39,941 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:39,941 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:09:39,941 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/clientes/NaN/estadisticas/
2025-12-04 08:09:39,967 - app.core.exceptions - WARNING - RequestValidationError en /api/v1/clientes/NaN/: ["El par√°metro 'path.cliente_id' tiene un valor inv√°lido (NaN). Se espera un UUID v√°lido."]
2025-12-04 08:09:39,967 - app.core.exceptions - WARNING - RequestValidationError en /api/v1/clientes/NaN/estadisticas/: ["El par√°metro 'path.cliente_id' tiene un valor inv√°lido (NaN). Se espera un UUID v√°lido."]
2025-12-04 08:09:39,967 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/NaN/ 422 33.2ms
2025-12-04 08:09:39,968 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/NaN/estadisticas/ 422 29.2ms
2025-12-04 08:09:39,970 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/NaN/
2025-12-04 08:09:39,970 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:39,970 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:09:39,970 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:39,970 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:39,970 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:39,970 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:39,970 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:39,973 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:39,973 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:39,973 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:09:39,973 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/clientes/NaN/
2025-12-04 08:09:39,973 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/NaN/estadisticas/
2025-12-04 08:09:39,974 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:09:39,974 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:09:39,974 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:39,974 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:39,974 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:39,975 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:09:39,975 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:09:39,975 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:09:39,975 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:09:39,975 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:09:39,975 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/clientes/NaN/estadisticas/
2025-12-04 08:09:39,998 - app.core.exceptions - WARNING - RequestValidationError en /api/v1/clientes/NaN/estadisticas/: ["El par√°metro 'path.cliente_id' tiene un valor inv√°lido (NaN). Se espera un UUID v√°lido."]
2025-12-04 08:09:39,999 - app.core.exceptions - WARNING - RequestValidationError en /api/v1/clientes/NaN/: ["El par√°metro 'path.cliente_id' tiene un valor inv√°lido (NaN). Se espera un UUID v√°lido."]
2025-12-04 08:09:39,999 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/NaN/estadisticas/ 422 26.2ms
2025-12-04 08:09:40,000 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/NaN/ 422 29.5ms
2025-12-04 08:10:40,242 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 08:10:40,242 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:10:40,242 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:10:40,243 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:10:40,243 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:10:40,243 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:10:40,256 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:10:40,258 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:10:40,258 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:10:40,270 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:10:40,271 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:10:40,272 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/refresh/
2025-12-04 08:10:40,284 - app.modules.auth.application.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:10:40,285 - app.modules.auth.application.services.auth_service - WARNING - [REFRESH] Token JWT v√°lido, pero inactivo/revocado en BD. Usuario: superadmin
2025-12-04 08:10:40,295 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_invalid_or_revoked, cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, usuario_id=None, exito=False
2025-12-04 08:10:40,296 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 55.0ms
2025-12-04 08:21:19,549 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-12-04 08:21:19,550 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.4ms
2025-12-04 08:21:19,551 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:21:19,551 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:21:19,552 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:21:19,552 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:21:19,552 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:21:19,552 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:21:19,552 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:21:19,552 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:21:19,552 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:21:19,552 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:21:19,553 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:21:19,553 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/auth/logout/
2025-12-04 08:21:19,566 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, Usuario 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E
2025-12-04 08:21:19,566 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, Usuario: 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E (superadmin)
2025-12-04 08:21:19,578 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, usuario_id=154134AD-A5EB-4F45-AEF0-5F9AAA282C8E, exito=True
2025-12-04 08:21:19,578 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 27.6ms
2025-12-04 08:21:30,433 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-12-04 08:21:30,434 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-12-04 08:21:30,436 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:21:30,436 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:21:30,436 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:21:30,436 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:21:30,436 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:21:30,437 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:21:30,441 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:21:30,442 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:21:30,442 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:21:30,446 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:21:30,446 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:21:30,446 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 08:21:30,447 - app.modules.auth.presentation.endpoints - INFO - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43 resuelto y validado para login.
2025-12-04 08:21:30,447 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:21:30,447 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:21:30,667 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 08:21:30,667 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, cliente_origen=ee7bfc14-995f-4209-b4b9-99c307534a43, cliente_destino=N/A, access_level=1, user_type=user
2025-12-04 08:21:30,667 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:21:30,667 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 08:21:30,680 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: 5B11695C-D7EB-49B4-9AE5-7DF2C03CD890, Rotaci√≥n: False
2025-12-04 08:21:30,680 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 5B11695C-D7EB-49B4-9AE5-7DF2C03CD890
2025-12-04 08:21:30,680 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:21:30,686 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:21:30,686 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 250.1ms
2025-12-04 08:21:30,693 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-12-04 08:21:30,694 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-12-04 08:21:30,696 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:21:30,696 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:21:30,696 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:21:30,696 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:21:30,696 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:21:30,697 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:21:30,703 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:21:30,703 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:21:30,703 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:21:30,706 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:21:30,707 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-12-04 08:21:30,707 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:21:30,707 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.7ms
2025-12-04 08:21:30,710 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:21:30,711 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:21:30,711 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:21:30,711 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:21:30,711 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:21:30,711 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:21:30,715 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:21:30,716 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:21:30,716 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:21:30,718 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:21:30,718 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:21:30,718 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:21:30,725 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:21:30,725 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:21:30,725 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:21:30,744 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 08:21:30,744 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:21:30,746 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:21:30,746 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:21:30,748 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:21:30,749 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 53.7ms
2025-12-04 08:21:30,777 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:21:30,780 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:21:30,780 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 69.9ms
2025-12-04 08:21:30,782 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:21:30,782 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:21:30,782 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:21:30,782 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:21:30,782 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:21:30,782 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:21:30,782 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:21:30,782 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:21:30,782 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:21:30,791 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:21:30,791 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:21:30,791 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:21:30,798 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:21:30,798 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:21:30,808 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:21:30,809 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:21:30,809 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 27.4ms
2025-12-04 08:22:07,324 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-12-04 08:22:07,325 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-12-04 08:22:07,328 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 08:22:07,328 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:22:07,328 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:22:07,328 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:22:07,328 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:22:07,329 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:22:07,334 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:22:07,334 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:22:07,334 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:22:07,341 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:22:07,341 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:22:07,341 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/refresh/
2025-12-04 08:22:07,350 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token v√°lido - Cliente EE7BFC14-995F-4209-B4B9-99C307534A43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web
2025-12-04 08:22:07,356 - app.modules.auth.application.services.auth_service - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Level: 1, Type: user)
2025-12-04 08:22:07,360 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 08:22:07,366 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: E09D0463-E521-4177-B8BA-C5DB61DE8003, Rotaci√≥n: True
2025-12-04 08:22:07,373 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 08:22:07,374 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no cr√≠tico)
2025-12-04 08:22:07,374 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: E09D0463-E521-4177-B8BA-C5DB61DE8003
2025-12-04 08:22:07,374 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-12-04 08:22:07,380 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:22:07,381 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 53.4ms
2025-12-04 08:22:07,388 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-12-04 08:22:07,388 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.7ms
2025-12-04 08:22:07,390 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-12-04 08:22:07,390 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:22:07,390 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:22:07,391 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:22:07,391 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:22:07,391 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:22:07,394 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:22:07,394 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:22:07,394 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:22:07,399 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:22:07,400 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:22:07,400 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/me/
2025-12-04 08:22:07,406 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-12-04 08:22:07,406 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 1, Super Admin: False, Type: user
2025-12-04 08:22:07,406 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 2458D1EA-816B-4C3C-8D13-B90271F59558 para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:22:07,406 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:22:07,424 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 2458D1EA-816B-4C3C-8D13-B90271F59558 con 1 roles activos
2025-12-04 08:22:07,424 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: user, Level: 1, Super Admin: False, Roles: 1
2025-12-04 08:22:07,426 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 36.2ms
2025-12-04 08:22:07,428 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:22:07,428 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:22:07,428 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:22:07,428 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:22:07,428 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:22:07,428 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:22:07,436 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:22:07,436 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:22:07,436 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:22:07,442 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:22:07,442 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:22:07,442 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:22:07,445 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:22:07,445 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:22:07,445 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:22:07,445 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:22:07,445 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:22:07,445 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:22:07,455 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:22:07,455 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:22:07,455 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:22:07,461 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:22:07,461 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:22:07,461 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:22:07,473 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 08:22:07,473 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:22:07,478 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:22:07,479 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 49.4ms
2025-12-04 08:22:07,486 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:22:07,486 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:22:07,491 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:22:07,491 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:22:07,492 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 46.8ms
2025-12-04 08:22:07,494 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:22:07,494 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:22:07,494 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:22:07,494 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:22:07,494 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:22:07,494 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:22:07,498 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:22:07,498 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:22:07,498 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:22:07,503 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:22:07,503 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:22:07,505 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:22:07,524 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:22:07,524 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:22:07,526 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:22:07,526 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:22:07,528 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 34.2ms
2025-12-04 08:28:30,329 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 08:28:30,330 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:28:30,330 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:28:30,330 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:28:30,330 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:28:30,330 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:28:30,336 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:28:30,336 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:28:30,336 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:28:30,340 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:28:30,340 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:28:30,340 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/refresh/
2025-12-04 08:28:30,346 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token v√°lido - Cliente EE7BFC14-995F-4209-B4B9-99C307534A43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web
2025-12-04 08:28:30,346 - app.modules.auth.application.services.auth_service - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Level: 1, Type: user)
2025-12-04 08:28:30,353 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=1, super_admin=False, type=user
2025-12-04 08:28:30,357 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: 14C3658E-6F42-494D-8313-9A3B495FC293, Rotaci√≥n: True
2025-12-04 08:28:30,362 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 08:28:30,363 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no cr√≠tico)
2025-12-04 08:28:30,363 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14C3658E-6F42-494D-8313-9A3B495FC293
2025-12-04 08:28:30,363 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-12-04 08:28:30,367 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:28:30,367 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 39.0ms
2025-12-04 08:28:30,367 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-12-04 08:28:30,367 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:28:30,367 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:28:30,367 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:28:30,367 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:28:30,367 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:28:30,374 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:28:30,374 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:28:30,374 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:28:30,380 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:28:30,381 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:28:30,381 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/me/
2025-12-04 08:28:30,384 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-12-04 08:28:30,384 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 1, Super Admin: False, Type: user
2025-12-04 08:28:30,384 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 2458D1EA-816B-4C3C-8D13-B90271F59558 para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:28:30,384 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:28:30,393 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 2458D1EA-816B-4C3C-8D13-B90271F59558 con 1 roles activos
2025-12-04 08:28:30,393 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: user, Level: 1, Super Admin: False, Roles: 1
2025-12-04 08:28:30,395 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 23.8ms
2025-12-04 08:28:30,510 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:28:30,510 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:28:30,510 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:28:30,510 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:28:30,510 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:28:30,510 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:28:30,617 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000023A21B16690>
2025-12-04 08:28:30,617 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000023A222F6690>
2025-12-04 08:28:30,617 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000023A22323BF0>
2025-12-04 08:28:30,617 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000023A22368320>
2025-12-04 08:28:30,619 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000023A223874D0>
2025-12-04 08:28:31,507 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:28:31,745 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:28:31,753 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:28:31,753 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:28:31,753 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:28:31,760 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:28:31,760 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:28:31,760 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:28:32,194 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:28:32,194 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:28:32,285 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:28:32,285 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:28:32,285 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:28:32,482 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:28:32,482 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:28:32,627 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'cdn', 'assets', 'backend', 'api', 'static', 'www', 'admin'}
2025-12-04 08:28:32,634 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:28:32,636 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:28:32,636 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:28:32,636 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:28:32,636 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:28:32,636 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:28:32,636 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:28:32,636 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:28:32,636 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:28:32,636 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:28:32,636 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:28:32,636 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:28:32,636 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:28:32,707 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:28:32,707 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:28:32,708 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:28:32,709 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:28:32,709 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:28:32,709 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:28:32,715 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:28:36,816 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:28:36,816 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:28:36,817 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:28:36,826 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:28:36,826 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:28:36,826 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:28:36,827 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:28:36,830 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:28:36,897 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 08:28:36,898 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:28:36,898 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:28:36,899 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:28:36,902 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:28:36,903 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 4266.7ms
2025-12-04 08:28:36,904 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:28:36,904 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:28:36,905 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 4269.7ms
2025-12-04 08:28:36,907 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:28:36,907 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:28:36,907 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:28:36,907 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:28:36,908 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:28:36,908 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:28:36,912 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:28:36,912 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:28:36,912 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:28:36,916 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:28:36,917 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:28:36,917 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:28:36,930 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:28:36,930 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:28:36,936 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:28:36,937 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:28:36,937 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 29.5ms
2025-12-04 08:28:44,792 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-12-04 08:28:44,792 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-12-04 08:28:44,795 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:28:44,795 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:28:44,795 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:28:44,796 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:28:44,796 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:28:44,796 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:28:44,800 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:28:44,800 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:28:44,800 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:28:44,804 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:28:44,804 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:28:44,804 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/logout/
2025-12-04 08:28:44,809 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 08:28:44,809 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario: 2458D1EA-816B-4C3C-8D13-B90271F59558 (admin_acme)
2025-12-04 08:28:44,817 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:28:44,818 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 22.5ms
2025-12-04 08:28:47,027 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:28:47,027 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:28:47,027 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:28:47,027 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:28:47,027 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:28:47,027 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:28:47,120 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001EFA17B14F0>
2025-12-04 08:28:47,120 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001EFA17B05F0>
2025-12-04 08:28:47,122 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001EFA2017F50>
2025-12-04 08:28:47,122 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001EFA2040B60>
2025-12-04 08:28:48,686 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:28:48,887 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:28:48,892 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:28:48,894 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:28:48,895 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:28:48,896 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:28:48,896 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:28:48,896 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:28:49,220 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:28:49,220 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:28:49,289 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:28:49,289 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:28:49,289 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:28:49,450 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:28:49,451 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:28:49,593 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'api', 'www', 'static', 'assets', 'admin', 'cdn', 'backend'}
2025-12-04 08:29:04,602 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-12-04 08:29:04,602 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.7ms
2025-12-04 08:29:04,604 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:29:04,605 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:04,605 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:29:04,605 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:04,605 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:04,605 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:04,605 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:04,605 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:04,606 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:04,606 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:04,606 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:29:04,606 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/auth/login/
2025-12-04 08:29:04,607 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:29:04,646 - app.modules.auth.presentation.endpoints - INFO - Cliente bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7 resuelto y validado para login.
2025-12-04 08:29:04,646 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:04,646 - app.modules.auth.application.services.auth_service - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7), accediendo a cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:04,895 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E: level=5, super_admin=True, type=super_admin
2025-12-04 08:29:04,895 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=154134AD-A5EB-4F45-AEF0-5F9AAA282C8E, cliente_origen=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, cliente_destino=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, access_level=5, user_type=super_admin
2025-12-04 08:29:04,895 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:04,902 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E: level=5, super_admin=True, type=super_admin
2025-12-04 08:29:04,910 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, Usuario 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E, Tipo: web, Token ID: D169517C-5EFB-440C-A5A5-B78BEB863F19, Rotaci√≥n: False
2025-12-04 08:29:04,912 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: D169517C-5EFB-440C-A5A5-B78BEB863F19
2025-12-04 08:29:04,912 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:04,917 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, usuario_id=154134AD-A5EB-4F45-AEF0-5F9AAA282C8E, exito=True
2025-12-04 08:29:04,917 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 314.2ms
2025-12-04 08:29:04,925 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-12-04 08:29:04,925 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-12-04 08:29:04,929 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:29:04,929 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:04,929 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:29:04,929 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:04,929 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:04,930 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:04,930 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:04,930 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:04,930 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:04,930 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:04,930 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:29:04,931 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/clientes/tenant/branding
2025-12-04 08:29:04,939 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:29:04,939 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.7ms
2025-12-04 08:29:04,940 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:29:04,941 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.8ms
2025-12-04 08:29:04,943 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:29:04,944 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:04,944 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:29:04,944 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:04,944 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:04,944 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:04,944 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:04,944 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:04,944 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:04,944 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:04,944 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:29:04,945 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/menus/getmenu/
2025-12-04 08:29:04,976 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7 por usuario: superadmin
2025-12-04 08:29:04,976 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:04,978 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e del cliente bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:04,978 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e
2025-12-04 08:29:04,981 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:04,981 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 53.9ms
2025-12-04 08:29:05,024 - app.modules.menus.application.services.menu_service - INFO - No se encontraron men√∫s permitidos para el usuario ID: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e.
2025-12-04 08:29:05,027 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 83.9ms
2025-12-04 08:29:05,027 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:29:05,029 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:05,029 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:29:05,029 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:05,029 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:05,029 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:05,030 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:05,030 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:05,030 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:05,030 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:05,030 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:29:05,030 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/menus/getmenu/
2025-12-04 08:29:05,048 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e del cliente bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:05,048 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e
2025-12-04 08:29:05,051 - app.modules.menus.application.services.menu_service - INFO - No se encontraron men√∫s permitidos para el usuario ID: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e.
2025-12-04 08:29:05,051 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 23.1ms
2025-12-04 08:29:08,668 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-12-04 08:29:08,669 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-12-04 08:29:08,670 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 08:29:08,671 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:08,671 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:29:08,671 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:08,671 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:08,671 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:08,671 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:08,672 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:08,672 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:08,672 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:08,672 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:29:08,672 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/auth/refresh/
2025-12-04 08:29:08,681 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token v√°lido - Cliente BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, Usuario 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E, Tipo: web
2025-12-04 08:29:08,687 - app.modules.auth.application.services.auth_service - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, Level: 5, Type: super_admin)
2025-12-04 08:29:08,691 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E: level=5, super_admin=True, type=super_admin
2025-12-04 08:29:08,703 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, Usuario 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E, Tipo: web, Token ID: 86C477C0-DFB5-4B2E-8887-07E8A12DC1F9, Rotaci√≥n: True
2025-12-04 08:29:08,708 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, Usuario 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E
2025-12-04 08:29:08,708 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no cr√≠tico)
2025-12-04 08:29:08,708 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 86C477C0-DFB5-4B2E-8887-07E8A12DC1F9
2025-12-04 08:29:08,708 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-12-04 08:29:08,717 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, usuario_id=154134AD-A5EB-4F45-AEF0-5F9AAA282C8E, exito=True
2025-12-04 08:29:08,718 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 47.4ms
2025-12-04 08:29:08,723 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-12-04 08:29:08,723 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.4ms
2025-12-04 08:29:08,724 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-12-04 08:29:08,725 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:08,725 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:29:08,725 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:08,725 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:08,725 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:08,725 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:08,725 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:08,726 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:08,726 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:08,726 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:29:08,726 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/auth/me/
2025-12-04 08:29:08,734 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-12-04 08:29:08,734 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-12-04 08:29:08,735 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E para cliente BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7
2025-12-04 08:29:08,735 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:29:08,757 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E con 1 roles activos
2025-12-04 08:29:08,757 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-12-04 08:29:08,757 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 33.0ms
2025-12-04 08:29:08,761 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:29:08,762 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:08,762 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:29:08,762 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:08,762 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:08,763 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:08,763 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:08,763 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:08,763 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:08,763 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:08,764 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:29:08,764 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/clientes/tenant/branding
2025-12-04 08:29:08,788 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7 por usuario: superadmin
2025-12-04 08:29:08,788 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:08,792 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:08,793 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 31.7ms
2025-12-04 08:29:08,798 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:29:08,799 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:08,799 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:29:08,799 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:08,800 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:08,800 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:08,800 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:08,800 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:08,801 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:08,801 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:08,802 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:29:08,802 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/menus/getmenu/
2025-12-04 08:29:08,822 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e del cliente bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:08,822 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e
2025-12-04 08:29:08,825 - app.modules.menus.application.services.menu_service - INFO - No se encontraron men√∫s permitidos para el usuario ID: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e.
2025-12-04 08:29:08,825 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 28.6ms
2025-12-04 08:29:08,825 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:29:08,825 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:08,825 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:29:08,825 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:08,825 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:08,830 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:08,830 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:08,830 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:08,830 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:08,830 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:08,830 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:29:08,830 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/menus/getmenu/
2025-12-04 08:29:08,844 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e del cliente bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:08,849 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e
2025-12-04 08:29:08,851 - app.modules.menus.application.services.menu_service - INFO - No se encontraron men√∫s permitidos para el usuario ID: 154134ad-a5eb-4f45-aef0-5f9aaa282c8e.
2025-12-04 08:29:08,854 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 25.4ms
2025-12-04 08:29:09,766 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:29:09,766 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:09,766 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': platform.app.local:5173
2025-12-04 08:29:09,766 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:09,767 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:09,767 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:09,767 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-12-04 08:29:09,767 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:09,767 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-12-04 08:29:09,767 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7
2025-12-04 08:29:09,768 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-12-04 08:29:09,768 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, tipo_instalacion=cloud, db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A, path=/api/v1/auth/logout/
2025-12-04 08:29:09,774 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, Usuario 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E
2025-12-04 08:29:09,774 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, Usuario: 154134AD-A5EB-4F45-AEF0-5F9AAA282C8E (superadmin)
2025-12-04 08:29:09,778 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, usuario_id=154134AD-A5EB-4F45-AEF0-5F9AAA282C8E, exito=True
2025-12-04 08:29:09,779 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 13.2ms
2025-12-04 08:29:11,169 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:29:11,169 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:29:11,169 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:29:11,169 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:29:11,169 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:29:11,169 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:29:13,224 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:29:13,424 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:29:13,424 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:29:13,433 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:29:13,434 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:29:13,434 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:29:13,434 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:29:13,434 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:29:13,764 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:29:13,764 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:29:13,834 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:29:13,834 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:29:13,834 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:29:14,001 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:29:14,001 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:29:14,147 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'www', 'assets', 'admin', 'backend', 'static', 'api', 'cdn'}
2025-12-04 08:29:22,171 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:29:22,172 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:22,172 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:29:22,172 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:29:22,172 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:22,172 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:29:22,174 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:29:22,204 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:29:22,204 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:22,204 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:29:22,214 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:29:26,300 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:29:26,300 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:29:26,305 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:29:26,305 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 08:29:26,312 - app.modules.auth.presentation.endpoints - INFO - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43 resuelto y validado para login.
2025-12-04 08:29:26,312 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:29:26,312 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:29:26,314 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:29:26,555 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:29:26,555 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, cliente_origen=ee7bfc14-995f-4209-b4b9-99c307534a43, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-12-04 08:29:26,555 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:29:26,555 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:29:26,568 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: AE561306-664E-4095-BDB1-B2390DA1BBAE, Rotaci√≥n: False
2025-12-04 08:29:26,568 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: AE561306-664E-4095-BDB1-B2390DA1BBAE
2025-12-04 08:29:26,568 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:29:26,568 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:29:26,574 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 4402.5ms
2025-12-04 08:29:26,579 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:29:26,579 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:26,579 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:29:26,579 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:29:26,579 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:26,582 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:29:26,588 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:29:26,588 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:26,588 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:29:26,592 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:29:26,593 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:26,593 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:29:26,593 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:29:26,593 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:26,593 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:29:26,594 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:29:26,594 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:29:26,594 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:29:26,604 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:29:26,604 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:26,604 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:29:26,613 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:29:26,613 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:29:26,613 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:29:26,629 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 08:29:26,629 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:29:26,633 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:29:26,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 54.2ms
2025-12-04 08:29:26,642 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:29:26,642 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:29:26,645 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:29:26,645 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:29:26,645 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 54.3ms
2025-12-04 08:29:26,648 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:29:26,648 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:29:26,648 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:29:26,648 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:29:26,648 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:26,649 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:29:26,653 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:29:26,653 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:29:26,653 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:29:26,658 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:29:26,658 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:29:26,658 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:29:26,674 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:29:26,674 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:29:26,675 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:29:26,675 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:29:26,675 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.5ms
2025-12-04 08:30:20,136 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:30:20,136 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:20,136 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:30:20,137 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:30:20,137 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:20,137 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:30:20,141 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:30:20,141 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:20,141 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:30:20,144 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:30:20,144 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:30:20,144 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/logout/
2025-12-04 08:30:20,152 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 08:30:20,152 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario: 2458D1EA-816B-4C3C-8D13-B90271F59558 (admin_acme)
2025-12-04 08:30:20,156 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:30:20,156 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 21.2ms
2025-12-04 08:30:29,474 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-12-04 08:30:29,474 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-12-04 08:30:29,477 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:30:29,477 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:29,477 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:29,477 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:29,477 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:29,477 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:29,483 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:29,483 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:29,483 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:29,487 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:29,491 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:29,491 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 08:30:29,497 - app.modules.auth.presentation.endpoints - INFO - Cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60 resuelto y validado para login.
2025-12-04 08:30:29,498 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_innova', cliente_id_destino=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:29,498 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:29,498 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:29,755 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:30:29,755 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_innova', usuario_id=726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, cliente_origen=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-12-04 08:30:29,755 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:29,760 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:30:29,769 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, Tipo: web, Token ID: 3831FF37-68E7-488C-AE8C-83737F10CC06, Rotaci√≥n: False
2025-12-04 08:30:29,769 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 3831FF37-68E7-488C-AE8C-83737F10CC06
2025-12-04 08:30:29,769 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_innova autenticado exitosamente (WEB) para cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:29,769 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, usuario_id=726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, exito=True
2025-12-04 08:30:29,775 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 299.0ms
2025-12-04 08:30:29,783 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-12-04 08:30:29,783 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.6ms
2025-12-04 08:30:29,785 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:30:29,785 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:29,787 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:29,787 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:29,787 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:29,787 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:29,790 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:30:29,791 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-12-04 08:30:29,793 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:30:29,794 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.0ms
2025-12-04 08:30:29,795 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:30:29,795 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:29,795 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:29,795 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:29,797 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:29,797 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:29,801 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:29,801 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:29,801 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:29,805 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:29,805 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:29,805 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:29,807 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:29,807 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:29,807 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:30:29,807 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:29,807 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:29,807 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:30:29,837 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60 por usuario: admin_innova
2025-12-04 08:30:29,837 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:29,837 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf del cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:29,837 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf
2025-12-04 08:30:29,845 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:29,845 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 62.3ms
2025-12-04 08:30:29,880 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 3 items ra√≠z.
2025-12-04 08:30:29,881 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 726d3aed-dff3-4ee0-8084-4e2e4fecdedf con 3 items ra√≠z.
2025-12-04 08:30:29,881 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 85.6ms
2025-12-04 08:30:29,884 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:30:29,884 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:29,884 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:29,884 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:29,884 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:29,884 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:29,889 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:29,890 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:29,890 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:29,901 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:29,901 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:29,901 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:30:29,920 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf del cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:29,920 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf
2025-12-04 08:30:29,924 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 3 items ra√≠z.
2025-12-04 08:30:29,924 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 726d3aed-dff3-4ee0-8084-4e2e4fecdedf con 3 items ra√≠z.
2025-12-04 08:30:29,924 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 40.8ms
2025-12-04 08:30:40,419 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-12-04 08:30:40,426 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-12-04 08:30:40,428 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 08:30:40,428 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:40,429 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:40,429 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:40,429 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:40,429 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:40,434 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:40,435 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:40,435 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:40,438 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:40,439 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:40,439 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/auth/refresh/
2025-12-04 08:30:40,450 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token v√°lido - Cliente A4FC62C0-6D3B-4FA3-B5EE-6294343DAF60, Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, Tipo: web
2025-12-04 08:30:40,454 - app.modules.auth.application.services.auth_service - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_innova (Cliente: a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, Level: 4, Type: tenant_admin)
2025-12-04 08:30:40,455 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:30:40,465 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, Tipo: web, Token ID: 47EE2126-E566-4F17-8B46-4344E3495DE7, Rotaci√≥n: True
2025-12-04 08:30:40,471 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF
2025-12-04 08:30:40,471 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no cr√≠tico)
2025-12-04 08:30:40,471 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 47EE2126-E566-4F17-8B46-4344E3495DE7
2025-12-04 08:30:40,471 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_innova
2025-12-04 08:30:40,479 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, usuario_id=726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, exito=True
2025-12-04 08:30:40,481 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 52.7ms
2025-12-04 08:30:40,484 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-12-04 08:30:40,484 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.4ms
2025-12-04 08:30:40,486 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-12-04 08:30:40,486 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:40,486 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:40,486 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:40,486 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:40,487 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:40,490 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:40,490 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:40,490 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:40,494 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:40,494 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:40,494 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/auth/me/
2025-12-04 08:30:40,496 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: admin_innova
2025-12-04 08:30:40,496 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-12-04 08:30:40,496 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF para cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:40,496 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:40,519 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF con 1 roles activos
2025-12-04 08:30:40,519 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: admin_innova, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-12-04 08:30:40,519 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 34.0ms
2025-12-04 08:30:40,523 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:30:40,523 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:40,523 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:40,523 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:40,523 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:40,524 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:40,529 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:40,529 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:40,529 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:40,533 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:40,533 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:40,533 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:30:40,537 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:30:40,538 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:40,538 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:40,538 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:40,538 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:40,538 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:40,546 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:40,546 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:40,546 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:40,552 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:40,552 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:40,553 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:30:40,560 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60 por usuario: admin_innova
2025-12-04 08:30:40,560 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:40,567 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:40,568 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 44.6ms
2025-12-04 08:30:40,576 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf del cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:40,576 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf
2025-12-04 08:30:40,581 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 3 items ra√≠z.
2025-12-04 08:30:40,581 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 726d3aed-dff3-4ee0-8084-4e2e4fecdedf con 3 items ra√≠z.
2025-12-04 08:30:40,581 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 44.5ms
2025-12-04 08:30:40,584 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:30:40,584 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:40,584 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:40,584 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:40,584 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:40,584 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:40,585 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:40,585 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:40,585 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:40,592 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:40,592 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:40,592 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:30:40,611 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf del cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:40,611 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf
2025-12-04 08:30:40,614 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 3 items ra√≠z.
2025-12-04 08:30:40,614 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 726d3aed-dff3-4ee0-8084-4e2e4fecdedf con 3 items ra√≠z.
2025-12-04 08:30:40,616 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 32.0ms
2025-12-04 08:30:41,723 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-12-04 08:30:41,724 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:41,724 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:41,724 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:41,724 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:41,724 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:41,730 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:41,730 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:41,730 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:41,736 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:41,737 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:41,737 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/auth/refresh/
2025-12-04 08:30:41,741 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token v√°lido - Cliente A4FC62C0-6D3B-4FA3-B5EE-6294343DAF60, Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, Tipo: web
2025-12-04 08:30:41,745 - app.modules.auth.application.services.auth_service - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_innova (Cliente: a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, Level: 4, Type: tenant_admin)
2025-12-04 08:30:41,749 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:30:41,755 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, Tipo: web, Token ID: B2704179-B6D7-4F23-B998-AEF84248B04F, Rotaci√≥n: True
2025-12-04 08:30:41,758 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF
2025-12-04 08:30:41,758 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no cr√≠tico)
2025-12-04 08:30:41,758 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: B2704179-B6D7-4F23-B998-AEF84248B04F
2025-12-04 08:30:41,759 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_innova
2025-12-04 08:30:41,764 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, usuario_id=726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, exito=True
2025-12-04 08:30:41,765 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 42.1ms
2025-12-04 08:30:41,768 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-12-04 08:30:41,769 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:41,769 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:41,769 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:41,769 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:41,769 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:41,770 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:41,770 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:41,770 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:41,775 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:41,778 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:41,778 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/auth/me/
2025-12-04 08:30:41,781 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: admin_innova
2025-12-04 08:30:41,782 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-12-04 08:30:41,782 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF para cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:41,782 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:41,790 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF con 1 roles activos
2025-12-04 08:30:41,791 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: admin_innova, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-12-04 08:30:41,791 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 22.8ms
2025-12-04 08:30:41,794 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:30:41,795 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:41,795 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:41,795 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:41,795 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:41,795 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:41,801 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:41,801 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:41,802 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:41,803 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:30:41,803 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:41,803 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:41,803 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:41,803 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:41,803 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:41,805 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:41,805 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:41,805 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:30:41,811 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:41,811 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:41,811 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:41,819 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:41,819 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:41,820 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:30:41,837 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60 por usuario: admin_innova
2025-12-04 08:30:41,837 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:41,848 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:41,849 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 54.6ms
2025-12-04 08:30:41,850 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf del cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:41,850 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf
2025-12-04 08:30:41,856 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 3 items ra√≠z.
2025-12-04 08:30:41,856 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 726d3aed-dff3-4ee0-8084-4e2e4fecdedf con 3 items ra√≠z.
2025-12-04 08:30:41,857 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 53.4ms
2025-12-04 08:30:41,865 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:30:41,866 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:41,868 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:41,868 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:41,869 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:41,869 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:41,872 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:41,872 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:41,872 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:41,881 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:41,883 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:41,883 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:30:41,903 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf del cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:41,904 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf
2025-12-04 08:30:41,908 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 3 items ra√≠z.
2025-12-04 08:30:41,908 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 726d3aed-dff3-4ee0-8084-4e2e4fecdedf con 3 items ra√≠z.
2025-12-04 08:30:41,909 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 44.3ms
2025-12-04 08:30:46,081 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:30:46,082 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:46,082 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:46,083 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:46,083 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:46,083 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:46,087 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-12-04 08:30:46,088 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.9ms
2025-12-04 08:30:46,089 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-12-04 08:30:46,089 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-12-04 08:30:46,090 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.8ms
2025-12-04 08:30:46,091 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.6ms
2025-12-04 08:30:46,091 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-12-04 08:30:46,092 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.3ms
2025-12-04 08:30:46,094 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:30:46,094 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:46,095 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:46,095 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:46,095 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:46,095 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:46,099 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:30:46,100 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:46,100 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:46,100 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:46,100 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:46,100 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:46,104 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:46,104 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:46,104 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:46,108 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:46,109 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:46,109 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:46,111 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:46,111 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:46,112 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:46,114 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:46,114 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:46,114 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:30:46,119 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:46,119 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:46,119 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:30:46,123 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:46,123 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:46,123 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:30:46,153 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf del cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:46,153 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf
2025-12-04 08:30:46,158 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:46,161 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 3 items ra√≠z.
2025-12-04 08:30:46,162 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 726d3aed-dff3-4ee0-8084-4e2e4fecdedf con 3 items ra√≠z.
2025-12-04 08:30:46,162 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 80.8ms
2025-12-04 08:30:46,163 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:46,165 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:30:46,165 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:46,165 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:46,167 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:46,167 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:46,167 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:46,169 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:46,170 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:46,170 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 403 76.6ms
2025-12-04 08:30:46,173 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:46,173 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:46,174 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:30:46,176 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:46,176 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:46,176 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:46,176 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:46,176 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:46,178 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 403 78.8ms
2025-12-04 08:30:46,179 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:46,179 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:46,179 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:46,181 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:30:46,181 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:46,182 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:46,182 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:46,182 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:46,182 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:46,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:46,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:46,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:46,192 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:46,192 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:46,192 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:30:46,195 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:46,195 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:46,195 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:46,198 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:46,198 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:46,198 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:30:46,203 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:46,203 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:46,203 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:30:46,233 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf del cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:46,234 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 726d3aed-dff3-4ee0-8084-4e2e4fecdedf
2025-12-04 08:30:46,240 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:46,241 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:46,242 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 3 items ra√≠z.
2025-12-04 08:30:46,242 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 726d3aed-dff3-4ee0-8084-4e2e4fecdedf con 3 items ra√≠z.
2025-12-04 08:30:46,243 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 78.0ms
2025-12-04 08:30:46,245 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:46,247 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:46,247 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:46,247 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:46,248 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 403 74.1ms
2025-12-04 08:30:46,250 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 403 68.2ms
2025-12-04 08:30:48,001 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-12-04 08:30:48,003 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-12-04 08:30:48,003 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.5ms
2025-12-04 08:30:48,004 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.3ms
2025-12-04 08:30:48,006 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:30:48,006 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:48,006 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:48,006 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:48,006 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:48,007 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:48,009 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:48,009 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:48,009 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:48,015 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:48,017 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:48,017 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:30:48,034 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:48,038 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:48,038 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:48,039 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 33.3ms
2025-12-04 08:30:48,040 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:30:48,041 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:48,041 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:48,041 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:48,041 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:48,041 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:48,045 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:48,045 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:48,045 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:48,051 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:48,051 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:48,051 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:30:48,067 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:48,070 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:48,070 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:48,070 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 31.2ms
2025-12-04 08:30:48,708 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-12-04 08:30:48,708 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-12-04 08:30:48,709 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.2ms
2025-12-04 08:30:48,709 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.1ms
2025-12-04 08:30:48,711 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-12-04 08:30:48,711 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:48,711 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:48,711 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:48,711 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:48,711 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:48,716 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:48,716 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:48,716 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:48,720 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:48,722 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:48,722 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/areas/
2025-12-04 08:30:48,738 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:48,741 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:48,741 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:48,741 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 31.2ms
2025-12-04 08:30:48,743 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-12-04 08:30:48,743 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:48,743 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:48,743 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:48,743 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:48,743 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:48,745 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:48,745 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:48,745 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:48,752 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:48,753 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:48,754 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/areas/
2025-12-04 08:30:48,771 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:48,774 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:48,774 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:48,774 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 31.0ms
2025-12-04 08:30:49,278 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-12-04 08:30:49,278 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-12-04 08:30:49,279 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.0ms
2025-12-04 08:30:49,279 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.9ms
2025-12-04 08:30:49,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-12-04 08:30:49,281 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:49,281 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:49,281 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:49,281 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:49,282 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:49,287 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:49,287 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:49,287 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:49,292 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:49,293 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:49,293 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/areas/list/
2025-12-04 08:30:49,311 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:49,315 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:49,315 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:49,315 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 403 34.0ms
2025-12-04 08:30:49,316 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-12-04 08:30:49,317 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:49,317 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:49,317 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:49,317 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:49,317 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:49,322 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:49,322 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:49,322 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:49,326 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:49,326 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:49,326 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/areas/list/
2025-12-04 08:30:49,342 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:49,345 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:49,345 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:49,345 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 403 29.7ms
2025-12-04 08:30:49,935 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-12-04 08:30:49,936 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:49,936 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:49,936 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:49,936 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:49,936 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:49,941 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:49,942 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:49,942 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:49,947 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:49,947 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:49,947 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/areas/
2025-12-04 08:30:49,956 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:49,956 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:49,956 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:49,966 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 30.0ms
2025-12-04 08:30:49,966 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-12-04 08:30:49,966 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:49,968 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:49,968 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:49,968 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:49,968 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:49,972 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:49,972 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:49,972 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:49,976 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:49,977 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:49,977 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/areas/
2025-12-04 08:30:49,992 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:49,994 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:49,994 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:49,994 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 28.0ms
2025-12-04 08:30:52,802 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-12-04 08:30:52,803 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 0.9ms
2025-12-04 08:30:52,803 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-12-04 08:30:52,804 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 0.7ms
2025-12-04 08:30:52,805 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-12-04 08:30:52,806 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:52,806 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:52,806 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:52,806 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:52,806 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:52,809 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:52,809 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:52,809 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:52,818 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:52,818 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:52,818 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/auth/sessions/admin/
2025-12-04 08:30:52,836 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:52,839 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:52,840 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:52,840 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 403 34.7ms
2025-12-04 08:30:52,843 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-12-04 08:30:52,843 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:52,843 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:52,843 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:52,844 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:52,844 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:52,848 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:52,848 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:52,848 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:52,853 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:52,853 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:52,853 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/auth/sessions/admin/
2025-12-04 08:30:52,870 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:52,873 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:52,873 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:52,874 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 403 31.7ms
2025-12-04 08:30:53,649 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-12-04 08:30:53,649 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:53,649 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:53,649 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:53,649 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:53,650 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:53,654 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:53,654 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:53,654 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:53,660 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:53,660 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:53,660 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/areas/list/
2025-12-04 08:30:53,676 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:53,681 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:53,681 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:53,682 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 403 33.2ms
2025-12-04 08:30:53,683 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-12-04 08:30:53,683 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:53,684 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:53,684 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:53,684 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:53,684 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:53,686 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:53,686 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:53,686 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:53,693 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:53,693 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:53,693 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/areas/list/
2025-12-04 08:30:53,710 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:53,713 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:53,714 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:53,714 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 403 30.5ms
2025-12-04 08:30:56,125 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:30:56,126 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:56,126 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:56,126 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:56,126 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:56,126 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:56,130 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:30:56,130 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:56,131 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:56,131 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:56,131 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:56,131 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:56,136 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:56,136 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:56,137 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:56,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:56,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:56,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:56,143 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:56,144 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:56,144 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:30:56,146 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:56,146 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:56,146 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:30:56,169 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:56,169 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:56,172 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:56,173 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:56,173 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:56,173 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:56,173 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 403 44.1ms
2025-12-04 08:30:56,174 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 403 48.7ms
2025-12-04 08:30:56,177 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:30:56,177 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:30:56,177 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:56,178 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:56,178 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:56,178 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:56,178 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:56,180 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:30:56,180 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:30:56,180 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:56,180 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:56,180 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:56,184 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:56,185 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:56,185 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:56,186 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:30:56,186 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:30:56,186 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:30:56,190 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:56,190 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:56,190 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:30:56,191 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:30:56,191 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:30:56,191 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:30:56,213 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:56,214 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:30:56,217 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:56,217 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:56,217 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60)
2025-12-04 08:30:56,217 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_innova'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:30:56,217 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 403 43.0ms
2025-12-04 08:30:56,217 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 403 43.2ms
2025-12-04 08:31:13,622 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-12-04 08:31:13,622 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-12-04 08:31:13,624 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:31:13,624 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:31:13,625 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:31:13,625 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:31:13,625 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:13,625 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:31:13,628 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:31:13,628 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:13,629 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:31:13,632 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:31:13,633 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:31:13,633 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/auth/logout/
2025-12-04 08:31:13,640 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, Usuario 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF
2025-12-04 08:31:13,640 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, Usuario: 726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF (admin_innova)
2025-12-04 08:31:13,646 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, usuario_id=726D3AED-DFF3-4EE0-8084-4E2E4FECDEDF, exito=True
2025-12-04 08:31:13,646 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 22.4ms
2025-12-04 08:31:32,012 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:31:32,012 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:31:32,012 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': innova.app.local:5173
2025-12-04 08:31:32,012 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:31:32,013 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:32,013 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:31:32,016 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-12-04 08:31:32,016 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:32,016 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-12-04 08:31:32,021 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', C√≥digo='INNOVA002', ID=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:31:32,021 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC
2025-12-04 08:31:32,021 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_innova, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 08:31:32,024 - app.modules.auth.presentation.endpoints - INFO - Cliente a4fc62c0-6d3b-4fa3-b5ee-6294343daf60 resuelto y validado para login.
2025-12-04 08:31:32,024 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='usuario_acme', cliente_id_destino=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:31:32,024 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:31:32,029 - app.modules.auth.application.services.auth_service - WARNING - [AUTH] Usuario NO ENCONTRADO: username='usuario_acme', cliente_id_buscado=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60
2025-12-04 08:31:32,034 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_failed, cliente_id=a4fc62c0-6d3b-4fa3-b5ee-6294343daf60, usuario_id=None, exito=False
2025-12-04 08:31:32,035 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 23.3ms
2025-12-04 08:31:52,988 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-12-04 08:31:52,988 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-12-04 08:31:52,989 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:31:52,990 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:31:52,990 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:31:52,990 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:31:52,990 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:52,990 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:31:52,994 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:31:52,994 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:52,994 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:31:52,997 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:31:52,998 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:31:52,998 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 08:31:53,002 - app.modules.auth.presentation.endpoints - INFO - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43 resuelto y validado para login.
2025-12-04 08:31:53,002 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='usuario_acme', cliente_id_destino=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:31:53,002 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:31:53,211 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario E74ECDBB-16AE-41C0-B536-B602580BC5C2: level=1, super_admin=False, type=user
2025-12-04 08:31:53,211 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='usuario_acme', usuario_id=E74ECDBB-16AE-41C0-B536-B602580BC5C2, cliente_origen=ee7bfc14-995f-4209-b4b9-99c307534a43, cliente_destino=N/A, access_level=1, user_type=user
2025-12-04 08:31:53,211 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:31:53,218 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario E74ECDBB-16AE-41C0-B536-B602580BC5C2: level=1, super_admin=False, type=user
2025-12-04 08:31:53,218 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario E74ECDBB-16AE-41C0-B536-B602580BC5C2, Tipo: web, Token ID: 7D8D9D0C-1831-4F38-88C4-2266C27E6D0C, Rotaci√≥n: False
2025-12-04 08:31:53,218 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 7D8D9D0C-1831-4F38-88C4-2266C27E6D0C
2025-12-04 08:31:53,218 - app.modules.auth.presentation.endpoints - INFO - Usuario usuario_acme autenticado exitosamente (WEB) para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:31:53,227 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=E74ECDBB-16AE-41C0-B536-B602580BC5C2, exito=True
2025-12-04 08:31:53,227 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 241.2ms
2025-12-04 08:31:53,237 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-12-04 08:31:53,238 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-12-04 08:31:53,239 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:31:53,240 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:31:53,240 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:31:53,240 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:31:53,240 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:53,241 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:31:53,244 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:31:53,245 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.4ms
2025-12-04 08:31:53,247 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:31:53,247 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.8ms
2025-12-04 08:31:53,247 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:31:53,247 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:31:53,247 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:31:53,247 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:31:53,247 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:53,251 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:31:53,254 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:31:53,255 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:53,255 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:31:53,257 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:31:53,257 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:53,257 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:31:53,257 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:31:53,257 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:31:53,257 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:31:53,257 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:31:53,257 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:31:53,257 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:31:53,289 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: usuario_acme
2025-12-04 08:31:53,289 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:31:53,290 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: e74ecdbb-16ae-41c0-b536-b602580bc5c2 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:31:53,290 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: e74ecdbb-16ae-41c0-b536-b602580bc5c2
2025-12-04 08:31:53,293 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:31:53,294 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 53.4ms
2025-12-04 08:31:53,295 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:31:53,295 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario e74ecdbb-16ae-41c0-b536-b602580bc5c2 con 5 items ra√≠z.
2025-12-04 08:31:53,295 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 46.4ms
2025-12-04 08:31:53,297 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:31:53,297 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:31:53,297 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:31:53,298 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:31:53,298 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:53,298 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:31:53,302 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:31:53,302 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:53,304 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:31:53,307 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:31:53,308 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:31:53,308 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:31:53,323 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: e74ecdbb-16ae-41c0-b536-b602580bc5c2 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:31:53,323 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: e74ecdbb-16ae-41c0-b536-b602580bc5c2
2025-12-04 08:31:53,327 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:31:53,327 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario e74ecdbb-16ae-41c0-b536-b602580bc5c2 con 5 items ra√≠z.
2025-12-04 08:31:53,327 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.2ms
2025-12-04 08:31:56,080 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:31:56,081 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:31:56,081 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:31:56,081 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:31:56,081 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:56,081 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:31:56,085 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:31:56,085 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:31:56,085 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:31:56,089 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:31:56,090 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:31:56,090 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/logout/
2025-12-04 08:31:56,096 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario E74ECDBB-16AE-41C0-B536-B602580BC5C2
2025-12-04 08:31:56,096 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario: E74ECDBB-16AE-41C0-B536-B602580BC5C2 (usuario_acme)
2025-12-04 08:31:56,101 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=E74ECDBB-16AE-41C0-B536-B602580BC5C2, exito=True
2025-12-04 08:31:56,102 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 22.1ms
2025-12-04 08:36:45,064 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:36:45,065 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:36:45,065 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:36:45,065 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:45,065 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:45,065 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:45,069 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:45,069 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:45,069 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:45,074 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:45,074 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:36:45,074 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 08:36:45,079 - app.modules.auth.presentation.endpoints - INFO - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43 resuelto y validado para login.
2025-12-04 08:36:45,079 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:45,079 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:45,287 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:36:45,287 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, cliente_origen=ee7bfc14-995f-4209-b4b9-99c307534a43, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-12-04 08:36:45,287 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:36:45,292 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:36:45,295 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: DBDDC6AB-9A29-4221-873A-8BF3E14A31D8, Rotaci√≥n: False
2025-12-04 08:36:45,296 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: DBDDC6AB-9A29-4221-873A-8BF3E14A31D8
2025-12-04 08:36:45,296 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:45,299 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:36:45,300 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 235.6ms
2025-12-04 08:36:45,309 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:36:45,309 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:36:45,309 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:36:45,309 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:45,309 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:45,310 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:45,314 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:45,315 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:45,315 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:45,318 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:36:45,319 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:36:45,319 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:36:45,319 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:45,319 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:45,319 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:45,325 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:45,325 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:36:45,325 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:36:45,327 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:45,327 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:45,328 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:45,334 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:45,334 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:36:45,334 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:36:45,360 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 08:36:45,360 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:45,364 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:45,364 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:36:45,365 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:45,366 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 57.8ms
2025-12-04 08:36:45,371 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:36:45,371 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:36:45,371 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 54.7ms
2025-12-04 08:36:45,371 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:36:45,371 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:36:45,371 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:36:45,371 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:45,371 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:45,371 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:45,371 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:45,371 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:45,371 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:45,384 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:45,384 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:36:45,385 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:36:45,402 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:45,402 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:36:45,406 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:36:45,406 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:36:45,407 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 32.9ms
2025-12-04 08:36:58,228 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-12-04 08:36:58,228 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-12-04 08:36:58,229 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.9ms
2025-12-04 08:36:58,230 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.8ms
2025-12-04 08:36:58,232 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-12-04 08:36:58,232 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:36:58,233 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:36:58,234 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:36:58,234 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:58,235 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:58,235 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:58,236 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-12-04 08:36:58,236 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 5.1ms
2025-12-04 08:36:58,237 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.8ms
2025-12-04 08:36:58,239 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:36:58,239 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:36:58,240 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:36:58,240 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:36:58,241 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:58,241 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:58,241 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:58,243 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:36:58,244 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:36:58,244 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:58,244 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:58,245 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:58,250 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:58,250 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:58,250 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:58,253 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:58,253 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:58,253 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:58,254 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:58,255 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:58,255 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:58,257 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:58,257 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:36:58,257 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:36:58,263 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:58,263 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:36:58,263 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:36:58,264 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:58,265 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:36:58,265 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:36:58,298 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:58,298 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:36:58,298 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:36:58,301 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:36:58,305 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:36:58,305 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:36:58,307 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 74.2ms
2025-12-04 08:36:58,308 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:36:58,309 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:36:58,309 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:36:58,309 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:58,309 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:58,310 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:58,311 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:58,314 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:58,314 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:58,320 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43)
2025-12-04 08:36:58,321 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:36:58,321 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 403 82.6ms
2025-12-04 08:36:58,321 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:58,321 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:36:58,321 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:36:58,321 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43)
2025-12-04 08:36:58,321 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:36:58,326 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:36:58,327 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:36:58,327 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:36:58,327 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:58,327 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:58,327 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:58,329 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 403 89.4ms
2025-12-04 08:36:58,331 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:36:58,332 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:36:58,333 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:36:58,333 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:58,333 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:58,333 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:58,339 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:58,341 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:58,341 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:58,344 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:36:58,344 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:36:58,345 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:36:58,349 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:58,350 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:36:58,350 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:36:58,354 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:58,354 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:36:58,354 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:36:58,371 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:36:58,372 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:36:58,384 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:36:58,384 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:36:58,387 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 78.5ms
2025-12-04 08:36:58,392 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:36:58,392 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:36:58,397 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43)
2025-12-04 08:36:58,397 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:36:58,397 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43)
2025-12-04 08:36:58,397 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:36:58,398 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 403 71.5ms
2025-12-04 08:36:58,399 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 403 66.4ms
2025-12-04 08:37:15,329 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:37:15,329 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:37:15,329 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:37:15,329 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:37:15,329 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:37:15,329 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:37:15,432 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000271ED65D910>
2025-12-04 08:37:15,432 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000271EE461880>
2025-12-04 08:37:15,432 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000271EE4C4DA0>
2025-12-04 08:37:15,432 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000271EE460FB0>
2025-12-04 08:37:15,432 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000271EE5003E0>
2025-12-04 08:37:15,432 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000271EE503380>
2025-12-04 08:37:15,432 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000271EE2EF590>
2025-12-04 08:37:15,432 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000271EE53A360>
2025-12-04 08:37:15,432 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000271EE48A000>
2025-12-04 08:37:18,232 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:37:18,422 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:37:18,427 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:37:18,430 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:37:18,430 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:37:18,432 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:37:18,432 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:37:18,432 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:37:18,750 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:37:18,752 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:37:18,820 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:37:18,820 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:37:18,820 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:37:18,993 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:37:18,993 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:37:19,138 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'assets', 'backend', 'www', 'cdn', 'admin', 'api', 'static'}
2025-12-04 08:37:20,905 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-12-04 08:37:20,906 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.3ms
2025-12-04 08:37:20,907 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-12-04 08:37:20,908 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.7ms
2025-12-04 08:37:20,910 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:37:20,910 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:37:20,911 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:37:20,911 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:37:20,911 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:37:20,911 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:37:20,914 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:37:20,957 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:37:20,957 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:37:20,957 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:37:20,961 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:37:25,074 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:37:25,074 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:37:25,074 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:37:25,074 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:37:25,083 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:37:25,111 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:37:25,114 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43)
2025-12-04 08:37:25,114 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:37:25,114 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 4204.6ms
2025-12-04 08:37:25,116 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:37:25,116 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:37:25,117 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:37:25,117 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:37:25,117 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:37:25,117 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:37:25,121 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:37:25,121 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:37:25,121 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:37:25,126 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:37:25,126 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:37:25,126 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:37:25,142 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:37:25,146 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43)
2025-12-04 08:37:25,146 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:37:25,146 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 30.4ms
2025-12-04 08:37:27,560 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:37:27,560 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:37:27,560 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:37:27,560 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:37:27,562 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:37:27,562 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:37:27,660 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002A51420F590>
2025-12-04 08:37:27,660 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002A514A5DE80>
2025-12-04 08:37:29,287 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:37:29,485 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:37:29,490 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:37:29,492 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:37:29,492 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:37:29,493 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:37:29,493 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:37:29,494 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:37:29,824 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:37:29,824 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:37:29,894 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:37:29,895 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:37:29,895 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:37:30,049 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:37:30,049 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:37:30,190 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'cdn', 'assets', 'admin', 'www', 'static', 'backend', 'api'}
2025-12-04 08:37:42,730 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:37:42,732 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:37:42,732 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:37:42,732 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:37:42,732 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:37:42,732 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:37:42,732 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:37:42,739 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:37:42,739 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:37:42,739 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:37:42,739 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:37:42,739 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:37:42,739 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:37:42,778 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:37:42,778 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:37:42,778 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:37:42,780 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:37:42,780 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:37:42,780 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:37:42,785 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:37:46,864 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:37:46,864 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:37:46,864 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:37:46,872 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:37:46,872 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:37:46,872 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:37:46,872 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:37:46,876 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:37:46,904 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:37:46,904 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:37:46,915 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43)
2025-12-04 08:37:46,915 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:37:46,916 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43)
2025-12-04 08:37:46,916 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:37:46,916 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 403 4178.5ms
2025-12-04 08:37:46,916 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 403 4186.0ms
2025-12-04 08:37:46,920 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:37:46,920 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:37:46,921 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:37:46,921 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:37:46,921 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:37:46,921 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:37:46,921 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:37:46,922 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:37:46,922 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:37:46,922 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:37:46,922 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:37:46,922 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:37:46,922 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:37:46,922 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:37:46,922 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:37:46,930 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:37:46,930 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:37:46,930 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:37:46,935 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:37:46,935 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:37:46,935 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:37:46,935 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:37:46,935 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:37:46,938 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:37:46,963 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:37:46,964 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:37:46,968 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43)
2025-12-04 08:37:46,968 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:37:46,969 - app.modules.rbac.application.services.rol_service - WARNING - No se encontraron niveles de acceso para los roles: ['Administrador'] (cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43)
2025-12-04 08:37:46,969 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 999
2025-12-04 08:37:46,969 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 403 48.9ms
2025-12-04 08:37:46,970 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 403 49.6ms
2025-12-04 08:39:30,719 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:39:30,719 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:39:30,719 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:39:30,719 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:39:30,719 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:39:30,719 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:39:30,821 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001EFB9A64C50>
2025-12-04 08:39:30,822 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001EFB837BFB0>
2025-12-04 08:39:30,822 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001EFBA3818B0>
2025-12-04 08:39:30,822 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001EFBA380C80>
2025-12-04 08:39:31,637 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:39:31,884 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:39:31,888 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:39:31,888 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:39:31,888 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:39:31,894 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:39:31,894 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:39:31,894 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:39:32,313 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:39:32,313 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:39:32,416 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:39:32,416 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:39:32,416 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:39:32,611 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:39:32,611 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:39:32,778 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'static', 'backend', 'api', 'admin', 'assets', 'www', 'cdn'}
2025-12-04 08:40:16,726 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:40:16,726 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:16,726 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:16,726 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:16,726 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:16,726 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:16,726 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:40:16,785 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:16,785 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:16,785 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:16,785 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:21,139 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:40:21,139 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:40:21,144 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:21,144 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:40:21,161 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:21,179 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:40:21,187 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 4
2025-12-04 08:40:21,187 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 4460.4ms
2025-12-04 08:40:21,255 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:40:21,256 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:40:21,256 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:40:21,256 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:40:21,256 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:40:21,256 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:40:21,351 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001C507E3E8D0>
2025-12-04 08:40:21,351 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000001C50880CE90>
2025-12-04 08:40:22,024 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:40:22,224 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:40:22,224 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:40:22,234 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:40:22,234 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:40:22,234 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:40:22,234 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:40:22,235 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:40:22,558 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:40:22,558 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:40:22,625 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:40:22,625 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:40:22,625 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:40:22,797 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:40:22,797 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:40:22,944 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'cdn', 'static', 'api', 'admin', 'www', 'backend', 'assets'}
2025-12-04 08:40:22,944 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:40:22,944 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:22,944 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:22,944 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:22,952 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:22,952 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:22,954 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:40:22,987 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:22,987 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:22,987 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:22,990 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:27,090 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:40:27,090 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:40:27,092 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:40:27,093 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:40:27,093 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:27,093 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:27,093 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:27,093 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:27,093 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:27,096 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:27,096 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:27,096 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:27,096 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:27,096 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:27,104 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:27,104 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:27,104 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:27,107 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:27,107 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:27,107 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:27,109 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:27,109 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:40:27,111 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:27,114 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:27,114 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:27,115 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:40:27,116 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:27,116 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:27,116 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:40:27,155 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:40:27,155 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:40:27,155 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:40:27,163 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 4
2025-12-04 08:40:27,163 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 4
2025-12-04 08:40:27,165 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 4
2025-12-04 08:40:27,165 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 403 72.1ms
2025-12-04 08:40:27,165 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 4214.4ms
2025-12-04 08:40:27,165 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 403 72.9ms
2025-12-04 08:40:27,168 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:40:27,168 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:40:27,169 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:27,169 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:27,169 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:27,169 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:27,170 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:27,171 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:27,171 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:27,172 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:27,172 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:27,172 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:27,176 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:27,176 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:27,176 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:27,177 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:27,177 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:27,177 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:27,183 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:27,183 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:27,183 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:40:27,183 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:27,183 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:27,184 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:40:27,206 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:40:27,206 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:40:27,209 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 4
2025-12-04 08:40:27,210 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 4
2025-12-04 08:40:27,210 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 403 41.8ms
2025-12-04 08:40:27,210 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 403 42.4ms
2025-12-04 08:40:30,996 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-12-04 08:40:30,996 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-12-04 08:40:30,998 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:40:30,998 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:30,998 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:30,998 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:30,998 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:30,998 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:31,003 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:31,003 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:31,003 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:31,006 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:31,007 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:31,007 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/logout/
2025-12-04 08:40:31,011 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 08:40:31,014 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario: 2458D1EA-816B-4C3C-8D13-B90271F59558 (admin_acme)
2025-12-04 08:40:31,019 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:40:31,020 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 22.0ms
2025-12-04 08:40:35,069 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:40:35,069 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:40:35,069 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:40:35,069 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:40:35,070 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:40:35,070 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:40:35,161 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002724C96FFB0>
2025-12-04 08:40:35,161 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002724E772300>
2025-12-04 08:40:35,163 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002724E7733B0>
2025-12-04 08:40:35,163 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002724E7A26F0>
2025-12-04 08:40:35,163 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002724E7A0800>
2025-12-04 08:40:35,164 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002724E7A39E0>
2025-12-04 08:40:36,825 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:40:37,027 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:40:37,034 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:40:37,036 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:40:37,036 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:40:37,037 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:40:37,037 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:40:37,037 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:40:37,382 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:40:37,382 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:40:37,451 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:40:37,451 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:40:37,452 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:40:37,655 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:40:37,656 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:40:37,828 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'assets', 'api', 'backend', 'static', 'cdn', 'www', 'admin'}
2025-12-04 08:40:45,675 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:40:45,675 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:45,675 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:45,675 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:45,676 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:45,676 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:45,678 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:40:45,718 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:45,718 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:45,718 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:45,718 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:49,850 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:40:49,850 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:40:49,855 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:49,855 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 08:40:49,866 - app.modules.auth.presentation.endpoints - INFO - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43 resuelto y validado para login.
2025-12-04 08:40:49,866 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:49,866 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:49,867 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,105 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:40:50,105 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, cliente_origen=ee7bfc14-995f-4209-b4b9-99c307534a43, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-12-04 08:40:50,105 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:40:50,115 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:40:50,121 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: 179A0076-AC04-4FD3-B5EE-08C06D89D705, Rotaci√≥n: False
2025-12-04 08:40:50,121 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 179A0076-AC04-4FD3-B5EE-08C06D89D705
2025-12-04 08:40:50,122 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,125 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:40:50,127 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 4452.9ms
2025-12-04 08:40:50,137 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:40:50,137 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:50,137 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:50,137 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,138 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,138 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,144 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:40:50,146 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:50,146 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:50,146 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,146 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,146 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,149 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:40:50,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:40:50,151 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,151 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,151 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,153 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:50,153 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:50,153 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,155 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,155 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,156 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:50,156 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:50,156 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,156 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,157 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,165 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,165 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,165 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,166 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,166 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,168 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,171 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,171 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:50,171 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:40:50,173 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,173 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,173 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,177 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,177 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:50,177 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:40:50,183 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,185 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:50,185 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:40:50,188 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,188 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:50,188 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:40:50,236 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 08:40:50,236 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,236 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,236 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:40:50,236 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:40:50,236 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:40:50,246 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,246 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 110.0ms
2025-12-04 08:40:50,246 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 4
2025-12-04 08:40:50,249 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:40:50,249 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:40:50,249 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 403 99.5ms
2025-12-04 08:40:50,250 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 4
2025-12-04 08:40:50,251 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 107.6ms
2025-12-04 08:40:50,253 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:40:50,253 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 403 103.6ms
2025-12-04 08:40:50,255 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:50,255 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:50,255 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,255 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,255 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,257 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:40:50,257 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:50,257 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:50,257 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,257 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,257 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,257 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:40:50,257 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:40:50,257 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:40:50,263 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,263 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,263 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,269 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,269 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,269 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,272 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,272 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,272 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,274 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:40:50,274 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:40:50,274 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:40:50,279 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,279 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:50,279 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:40:50,280 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,280 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:50,282 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:40:50,283 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,283 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:40:50,283 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:40:50,313 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:40:50,313 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:40:50,313 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:40:50,316 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:40:50,320 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:40:50,320 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:40:50,322 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 4
2025-12-04 08:40:50,322 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 64.7ms
2025-12-04 08:40:50,322 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 4
2025-12-04 08:40:50,323 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 403 61.0ms
2025-12-04 08:40:50,324 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 403 70.7ms
2025-12-04 08:44:31,195 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:44:31,195 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:44:31,196 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:44:31,196 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:44:31,196 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:44:31,196 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:44:31,288 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000016D291D3E00>
2025-12-04 08:44:31,288 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000016D29CB3C80>
2025-12-04 08:44:31,288 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000016D29CD1430>
2025-12-04 08:44:31,288 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000016D29CB0BC0>
2025-12-04 08:44:31,288 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000016D29CF1A30>
2025-12-04 08:44:31,288 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000016D29CF03E0>
2025-12-04 08:44:31,288 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000016D29B26D80>
2025-12-04 08:44:31,288 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000016D29CF2660>
2025-12-04 08:44:32,068 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:44:32,313 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:44:32,319 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:44:32,319 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:44:32,319 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:44:32,319 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:44:32,319 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:44:32,319 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:44:32,699 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:44:32,699 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:44:32,818 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:44:32,818 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:44:32,818 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:44:33,041 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:44:33,044 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:44:33,212 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'backend', 'admin', 'static', 'assets', 'api', 'www', 'cdn'}
2025-12-04 08:44:46,647 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:44:46,649 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:44:46,649 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:44:46,650 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:44:46,650 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:44:46,650 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:44:46,651 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:44:46,702 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:44:46,702 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:44:46,702 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:44:46,702 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:44:50,816 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:44:50,816 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:44:50,821 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:44:50,822 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:44:50,824 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:44:50,851 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:44:50,852 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:44:50,854 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles: []. Nivel: 1. Requerido: 4
2025-12-04 08:44:50,855 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 4207.4ms
2025-12-04 08:44:50,930 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:44:50,930 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:44:50,930 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:44:50,931 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:44:50,931 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:44:50,931 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:44:51,033 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002635E007E60>
2025-12-04 08:44:51,037 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002635E84D190>
2025-12-04 08:44:51,749 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:44:51,952 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:44:51,957 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:44:51,960 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:44:51,960 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:44:51,960 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:44:51,961 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:44:51,961 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:44:52,299 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:44:52,299 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:44:52,368 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:44:52,368 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:44:52,368 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:44:52,518 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:44:52,518 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:44:52,668 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'admin', 'assets', 'api', 'cdn', 'backend', 'static', 'www'}
2025-12-04 08:44:52,673 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:44:52,673 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:44:52,674 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:44:52,674 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:44:52,674 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:44:52,674 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:44:52,676 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:44:52,709 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:44:52,710 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:44:52,710 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:44:52,713 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:44:56,785 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:44:56,785 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:44:56,789 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:44:56,789 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:44:56,794 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:44:56,811 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:44:56,811 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:44:56,818 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:44:56,820 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 4147.1ms
2025-12-04 08:44:56,821 - app.core.exceptions - ERROR - Error no manejado: '<=' not supported between instances of 'UUID' and 'int'
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    |     if not current_user.cliente_id or current_user.cliente_id <= 0:
    |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | TypeError: '<=' not supported between instances of 'UUID' and 'int'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    if not current_user.cliente_id or current_user.cliente_id <= 0:
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: '<=' not supported between instances of 'UUID' and 'int'
2025-12-04 08:45:00,120 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:45:00,121 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:00,121 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:00,121 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:00,122 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:00,122 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:00,124 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:45:00,124 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:00,124 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:00,124 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:00,125 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:00,125 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:00,129 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:00,129 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:00,130 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:00,134 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:00,134 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:00,134 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:00,136 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:00,136 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:00,136 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:45:00,141 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:00,141 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:00,141 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:45:00,161 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:00,162 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:00,165 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:00,166 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:00,166 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:45:00,166 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:45:00,166 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:00,169 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:45:00,170 - app.modules.rbac.application.services.rol_service - ERROR - Error inesperado en get_all_active_roles: 'coroutine' object is not iterable
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\modules\rbac\application\services\rol_service.py", line 832, in get_all_active_roles
    for rol_dict in resultados:
                    ^^^^^^^^^^
TypeError: 'coroutine' object is not iterable
2025-12-04 08:45:00,170 - app.modules.rbac.presentation.endpoints - ERROR - Error de servicio en endpoint /roles/all-active/ para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: Error interno al obtener roles activos
2025-12-04 08:45:00,173 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 500 49.8ms
2025-12-04 08:45:00,175 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:45:00,176 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:00,176 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:00,176 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:00,178 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:00,178 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:00,179 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:00,183 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:00,183 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:00,184 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:00,188 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:00,188 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:00,188 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:45:00,190 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:45:00,191 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:45:00,191 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:45:00,192 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 71.7ms
2025-12-04 08:45:00,194 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:45:00,194 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:00,194 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:00,195 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:00,195 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:00,195 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:00,200 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:00,200 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:00,200 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:00,207 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:00,207 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:00,207 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:45:00,218 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:00,218 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:00,222 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:45:00,222 - app.modules.rbac.application.services.rol_service - ERROR - Error inesperado en get_all_active_roles: 'coroutine' object is not iterable
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\modules\rbac\application\services\rol_service.py", line 832, in get_all_active_roles
    for rol_dict in resultados:
                    ^^^^^^^^^^
TypeError: 'coroutine' object is not iterable
2025-12-04 08:45:00,223 - app.modules.rbac.presentation.endpoints - ERROR - Error de servicio en endpoint /roles/all-active/ para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: Error interno al obtener roles activos
2025-12-04 08:45:00,223 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 500 47.2ms
2025-12-04 08:45:00,234 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:00,234 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:00,237 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:45:00,237 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:45:00,237 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:00,240 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:00,245 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:45:00,245 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:45:00,245 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:45:00,246 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 52.3ms
2025-12-04 08:45:04,683 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:45:04,684 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:04,684 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:04,684 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:04,684 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:04,684 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:04,689 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:04,689 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:04,689 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:04,693 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:04,693 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:04,694 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/logout/
2025-12-04 08:45:04,700 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 08:45:04,700 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario: 2458D1EA-816B-4C3C-8D13-B90271F59558 (admin_acme)
2025-12-04 08:45:04,706 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:45:04,707 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 23.3ms
2025-12-04 08:45:06,253 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:45:06,253 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:45:06,253 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:45:06,253 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:45:06,253 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:45:06,253 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:45:06,350 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000192817FBE00>
2025-12-04 08:45:06,351 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000192823C9F70>
2025-12-04 08:45:06,351 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000192823CA6F0>
2025-12-04 08:45:06,351 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000019282230F80>
2025-12-04 08:45:08,164 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:45:08,369 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:45:08,375 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:45:08,377 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:45:08,377 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:45:08,378 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:45:08,378 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:45:08,378 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:45:08,709 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:45:08,709 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:45:08,790 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:45:08,790 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:45:08,790 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:45:08,994 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:45:08,995 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:45:09,149 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'assets', 'api', 'static', 'backend', 'admin', 'www', 'cdn'}
2025-12-04 08:45:14,640 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-12-04 08:45:14,640 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.7ms
2025-12-04 08:45:14,642 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:45:14,643 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:14,643 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:14,643 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:14,643 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:14,643 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:14,646 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:45:14,674 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:14,674 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:14,674 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:14,674 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:18,726 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:45:18,726 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:45:18,729 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:18,729 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 08:45:18,740 - app.modules.auth.presentation.endpoints - INFO - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43 resuelto y validado para login.
2025-12-04 08:45:18,740 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:18,740 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:18,740 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:18,982 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:45:18,983 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, cliente_origen=ee7bfc14-995f-4209-b4b9-99c307534a43, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-12-04 08:45:18,983 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:18,987 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:45:18,992 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: 4A45E5F8-AADD-412C-B30A-02C31CDD6D5B, Rotaci√≥n: False
2025-12-04 08:45:18,993 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 4A45E5F8-AADD-412C-B30A-02C31CDD6D5B
2025-12-04 08:45:18,993 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:18,998 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:45:18,998 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 4355.6ms
2025-12-04 08:45:19,004 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-12-04 08:45:19,004 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-12-04 08:45:19,008 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:45:19,008 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:19,008 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:19,008 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,008 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,008 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,013 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:45:19,015 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.2ms
2025-12-04 08:45:19,016 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-12-04 08:45:19,016 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:45:19,018 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:45:19,018 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:19,019 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:19,019 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,019 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,019 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,020 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:19,021 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:19,021 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,021 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,021 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,023 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 6.3ms
2025-12-04 08:45:19,024 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:45:19,024 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:19,027 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:19,027 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,027 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,027 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,029 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,030 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,030 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,034 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,034 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,034 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,036 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,036 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,036 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,041 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,041 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,041 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,043 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:19,043 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:19,043 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:45:19,050 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:19,051 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:19,051 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:45:19,053 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:19,053 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:19,053 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:45:19,055 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:19,056 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:19,056 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:45:19,092 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:19,093 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 08:45:19,093 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:19,098 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:19,098 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:19,100 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:19,101 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:19,104 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:19,104 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:45:19,106 - app.modules.rbac.application.services.rol_service - ERROR - Error inesperado en get_all_active_roles: 'coroutine' object is not iterable
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\modules\rbac\application\services\rol_service.py", line 832, in get_all_active_roles
    for rol_dict in resultados:
                    ^^^^^^^^^^
TypeError: 'coroutine' object is not iterable
2025-12-04 08:45:19,106 - app.modules.rbac.presentation.endpoints - ERROR - Error de servicio en endpoint /roles/all-active/ para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: Error interno al obtener roles activos
2025-12-04 08:45:19,108 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 100.3ms
2025-12-04 08:45:19,109 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:19,109 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:19,109 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:45:19,111 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 500 93.9ms
2025-12-04 08:45:19,113 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:45:19,113 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:45:19,113 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:19,115 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:45:19,116 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:19,116 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:19,116 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,116 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,117 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,122 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:45:19,122 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:45:19,123 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 98.2ms
2025-12-04 08:45:19,124 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:19,125 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,125 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,125 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,128 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:45:19,129 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:19,129 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:19,130 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,130 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,130 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,135 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:19,135 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:19,137 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:45:19,138 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,140 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:45:19,140 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:45:19,140 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:45:19,141 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 123.7ms
2025-12-04 08:45:19,143 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:45:19,143 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:19,143 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:19,143 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,143 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,143 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,149 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:19,149 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:19,149 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:45:19,151 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:19,151 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:19,151 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:19,162 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:19,163 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:19,163 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:45:19,175 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:19,176 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:19,182 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:19,182 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:19,182 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:45:19,183 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:45:19,183 - app.modules.rbac.application.services.rol_service - ERROR - Error inesperado en get_all_active_roles: 'coroutine' object is not iterable
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\modules\rbac\application\services\rol_service.py", line 832, in get_all_active_roles
    for rol_dict in resultados:
                    ^^^^^^^^^^
TypeError: 'coroutine' object is not iterable
2025-12-04 08:45:19,183 - app.modules.rbac.presentation.endpoints - ERROR - Error de servicio en endpoint /roles/all-active/ para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: Error interno al obtener roles activos
2025-12-04 08:45:19,184 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 500 69.1ms
2025-12-04 08:45:19,189 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:45:19,189 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:45:19,192 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 63.5ms
2025-12-04 08:45:19,195 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:19,195 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:19,199 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:45:19,199 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:45:19,199 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:19,199 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:19,199 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:45:19,199 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:45:19,199 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:45:19,208 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 64.3ms
2025-12-04 08:45:52,532 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:45:52,533 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:52,533 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:52,533 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:52,533 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:52,533 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:52,537 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:52,538 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:52,538 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:52,543 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:52,544 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:52,544 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:45:52,564 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:52,565 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:52,568 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:45:52,569 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 37.4ms
2025-12-04 08:45:52,569 - app.core.exceptions - ERROR - Error no manejado: '<=' not supported between instances of 'UUID' and 'int'
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    |     if not current_user.cliente_id or current_user.cliente_id <= 0:
    |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | TypeError: '<=' not supported between instances of 'UUID' and 'int'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    if not current_user.cliente_id or current_user.cliente_id <= 0:
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: '<=' not supported between instances of 'UUID' and 'int'
2025-12-04 08:45:52,590 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:45:52,590 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:52,591 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:52,591 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:52,591 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:52,591 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:52,596 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:52,596 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:52,596 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:52,601 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:52,601 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:52,601 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:45:52,619 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:52,620 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:52,623 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:45:52,624 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 34.2ms
2025-12-04 08:45:52,624 - app.core.exceptions - ERROR - Error no manejado: '<=' not supported between instances of 'UUID' and 'int'
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    |     if not current_user.cliente_id or current_user.cliente_id <= 0:
    |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | TypeError: '<=' not supported between instances of 'UUID' and 'int'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    if not current_user.cliente_id or current_user.cliente_id <= 0:
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: '<=' not supported between instances of 'UUID' and 'int'
2025-12-04 08:45:53,767 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-12-04 08:45:53,768 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.1ms
2025-12-04 08:45:53,768 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-12-04 08:45:53,769 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.6ms
2025-12-04 08:45:53,769 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-12-04 08:45:53,769 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:53,769 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:53,769 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:53,769 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:53,769 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:53,775 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:53,775 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:53,776 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:53,779 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:53,780 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:53,780 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/areas/
2025-12-04 08:45:53,789 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:53,794 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:53,797 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: skip=0, limit=10, B√∫squeda: 'None'
2025-12-04 08:45:53,797 - app.modules.menus.application.services.area_service - INFO - Obteniendo √°reas paginadas para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: skip=0, limit=10, search='None'
2025-12-04 08:45:53,797 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:53,804 - app.modules.menus.application.services.area_service - INFO - Paginaci√≥n completada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0 √°reas de 0 totales
2025-12-04 08:45:53,804 - app.modules.menus.presentation.endpoints_areas - INFO - Lista paginada de √°reas recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:45:53,805 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 34.3ms
2025-12-04 08:45:53,806 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-12-04 08:45:53,806 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:45:53,806 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:45:53,806 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:53,808 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:53,808 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:53,811 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:45:53,812 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:45:53,812 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:45:53,816 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:45:53,816 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:45:53,816 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/areas/
2025-12-04 08:45:53,832 - app.core.auth.user_builder - WARNING - Error construyendo RolRead: 1 validation error for RolRead
  Value error, Un rol de sistema (con c√≥digo de rol) no puede tener cliente_id asignado. Los roles de sistema son globales y no pertenecen a un cliente espec√≠fico. [type=value_error, input_value={'rol_id': UUID('748ece76...000-0000-000000000000')}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/value_error
2025-12-04 08:45:53,832 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:53,835 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: skip=0, limit=10, B√∫squeda: 'None'
2025-12-04 08:45:53,835 - app.modules.menus.application.services.area_service - INFO - Obteniendo √°reas paginadas para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: skip=0, limit=10, search='None'
2025-12-04 08:45:53,835 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:45:53,838 - app.modules.menus.application.services.area_service - INFO - Paginaci√≥n completada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0 √°reas de 0 totales
2025-12-04 08:45:53,838 - app.modules.menus.presentation.endpoints_areas - INFO - Lista paginada de √°reas recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:45:53,839 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 32.7ms
2025-12-04 08:47:42,673 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:47:42,673 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:47:42,673 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:47:42,673 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:47:42,674 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:47:42,674 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:47:42,780 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017A44CE6000>
2025-12-04 08:47:42,780 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017A455B19A0>
2025-12-04 08:47:42,780 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017A455B3E90>
2025-12-04 08:47:42,781 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017A455B0D40>
2025-12-04 08:47:42,781 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017A455B1340>
2025-12-04 08:47:42,781 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017A4555ECF0>
2025-12-04 08:47:42,781 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017A455D3D10>
2025-12-04 08:47:42,782 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017A455D30E0>
2025-12-04 08:47:43,492 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:47:43,699 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:47:43,705 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:47:43,706 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:47:43,706 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:47:43,707 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:47:43,707 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:47:43,707 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:47:44,040 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:47:44,041 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:47:44,110 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:47:44,110 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:47:44,110 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:47:44,262 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:47:44,263 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:47:44,408 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'admin', 'backend', 'api', 'static', 'cdn', 'www', 'assets'}
2025-12-04 08:47:46,105 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-12-04 08:47:46,106 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-12-04 08:47:46,106 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-12-04 08:47:46,106 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-12-04 08:47:46,106 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.4ms
2025-12-04 08:47:46,108 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.6ms
2025-12-04 08:47:46,108 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.5ms
2025-12-04 08:47:46,108 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.3ms
2025-12-04 08:47:46,112 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:47:46,113 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:47:46,114 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:47:46,114 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:47:46,114 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:47:46,114 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:47:46,117 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:47:46,119 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:47:46,120 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:47:46,120 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:47:46,120 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:47:46,120 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:47:46,120 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:47:46,166 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:47:46,166 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:47:46,166 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:47:46,168 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:47:46,168 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:47:46,168 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:47:46,173 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:47:50,266 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:47:50,266 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:47:50,266 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:47:50,271 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:47:50,271 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:47:50,271 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:47:50,271 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:47:50,275 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:47:50,311 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:47:50,311 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:47:50,317 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:47:50,317 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:47:50,319 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:47:50,319 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:47:50,319 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:47:50,324 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:47:50,325 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:47:50,325 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:47:50,326 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 4206.6ms
2025-12-04 08:47:50,326 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:47:50,329 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:47:50,329 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:47:50,329 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:47:50,329 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:47:50,330 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:47:50,332 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:47:50,333 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:47:50,333 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:47:50,334 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 4221.7ms
2025-12-04 08:47:50,336 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:47:50,336 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:47:50,336 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:47:50,339 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:47:50,339 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:47:50,339 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:47:50,339 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:47:50,340 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:47:50,340 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:47:50,343 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:47:50,344 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:47:50,344 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:47:50,345 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:47:50,345 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:47:50,347 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:47:50,351 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:47:50,351 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:47:50,351 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:47:50,372 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:47:50,376 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:47:50,377 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:47:50,377 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:47:50,380 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:47:50,380 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:47:50,380 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:47:50,381 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:47:50,381 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:47:50,381 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 53.4ms
2025-12-04 08:47:50,386 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:47:50,390 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:47:50,390 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:47:50,390 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:47:50,391 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 52.9ms
2025-12-04 08:47:58,046 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-12-04 08:47:58,048 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.0ms
2025-12-04 08:47:58,048 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-12-04 08:47:58,049 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.0ms
2025-12-04 08:47:58,050 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:47:58,052 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:47:58,052 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:47:58,052 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:47:58,052 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:47:58,052 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:47:58,053 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:47:58,053 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:47:58,057 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:47:58,062 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:47:58,062 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:47:58,062 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:47:58,081 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:47:58,083 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:47:58,084 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 33.5ms
2025-12-04 08:47:58,084 - app.core.exceptions - ERROR - Error no manejado: '<=' not supported between instances of 'UUID' and 'int'
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    |     if not current_user.cliente_id or current_user.cliente_id <= 0:
    |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | TypeError: '<=' not supported between instances of 'UUID' and 'int'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    if not current_user.cliente_id or current_user.cliente_id <= 0:
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: '<=' not supported between instances of 'UUID' and 'int'
2025-12-04 08:47:58,106 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:47:58,106 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:47:58,107 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:47:58,107 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:47:58,107 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:47:58,107 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:47:58,112 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:47:58,112 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:47:58,112 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:47:58,116 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:47:58,116 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:47:58,116 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:47:58,131 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:47:58,135 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:47:58,135 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 29.4ms
2025-12-04 08:47:58,135 - app.core.exceptions - ERROR - Error no manejado: '<=' not supported between instances of 'UUID' and 'int'
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    |     if not current_user.cliente_id or current_user.cliente_id <= 0:
    |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | TypeError: '<=' not supported between instances of 'UUID' and 'int'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    if not current_user.cliente_id or current_user.cliente_id <= 0:
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: '<=' not supported between instances of 'UUID' and 'int'
2025-12-04 08:48:04,260 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:48:04,261 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:04,261 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:04,261 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:04,261 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:04,261 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:04,264 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:48:04,264 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:04,265 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:04,265 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:04,265 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:04,265 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:04,272 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:04,272 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:04,272 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:04,274 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:04,274 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:04,274 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:04,278 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:04,278 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:04,278 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:48:04,281 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:04,282 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:04,282 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:48:04,305 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:04,305 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:04,305 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:48:04,305 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:04,311 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:48:04,311 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:48:04,311 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:04,315 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:04,315 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:48:04,316 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 52.3ms
2025-12-04 08:48:04,318 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:04,319 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:48:04,319 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:04,320 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:04,320 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:04,320 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:04,320 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:04,325 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:04,325 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:04,325 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:04,327 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:48:04,328 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:48:04,328 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:48:04,328 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 67.9ms
2025-12-04 08:48:04,330 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:48:04,332 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:04,332 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:04,332 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:04,332 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:04,333 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:04,334 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:04,335 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:04,335 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:48:04,338 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:04,339 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:04,339 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:04,344 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:04,345 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:04,345 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:48:04,351 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:04,360 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:48:04,360 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:04,366 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:04,368 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:04,368 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:48:04,368 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 49.4ms
2025-12-04 08:48:04,372 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:48:04,372 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:48:04,372 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:04,373 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:04,380 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:48:04,380 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:48:04,380 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:48:04,381 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 51.0ms
2025-12-04 08:48:07,262 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-12-04 08:48:07,262 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:07,262 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:07,263 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:07,263 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:07,263 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:07,268 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:07,268 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:07,268 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:07,272 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:07,272 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:07,273 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/areas/
2025-12-04 08:48:07,290 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:07,293 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: skip=0, limit=10, B√∫squeda: 'None'
2025-12-04 08:48:07,294 - app.modules.menus.application.services.area_service - INFO - Obteniendo √°reas paginadas para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: skip=0, limit=10, search='None'
2025-12-04 08:48:07,294 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:07,296 - app.modules.menus.application.services.area_service - INFO - Paginaci√≥n completada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0 √°reas de 0 totales
2025-12-04 08:48:07,296 - app.modules.menus.presentation.endpoints_areas - INFO - Lista paginada de √°reas recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:48:07,296 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 36.6ms
2025-12-04 08:48:07,299 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-12-04 08:48:07,301 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:07,301 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:07,301 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:07,301 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:07,302 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:07,305 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:07,305 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:07,305 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:07,310 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:07,310 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:07,310 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/areas/
2025-12-04 08:48:07,325 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:07,326 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: skip=0, limit=10, B√∫squeda: 'None'
2025-12-04 08:48:07,329 - app.modules.menus.application.services.area_service - INFO - Obteniendo √°reas paginadas para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: skip=0, limit=10, search='None'
2025-12-04 08:48:07,329 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:07,332 - app.modules.menus.application.services.area_service - INFO - Paginaci√≥n completada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0 √°reas de 0 totales
2025-12-04 08:48:07,332 - app.modules.menus.presentation.endpoints_areas - INFO - Lista paginada de √°reas recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:48:07,333 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 33.4ms
2025-12-04 08:48:09,345 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-12-04 08:48:09,346 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.6ms
2025-12-04 08:48:09,347 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-12-04 08:48:09,347 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.7ms
2025-12-04 08:48:09,349 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-12-04 08:48:09,349 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:09,349 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:09,349 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:09,349 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:09,350 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:09,356 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:09,356 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:09,356 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:09,360 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:09,361 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:09,361 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/areas/list/
2025-12-04 08:48:09,372 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:09,382 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/list/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:48:09,382 - app.modules.menus.application.services.area_service - INFO - Obteniendo lista simple de √°reas activas para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:09,382 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:09,389 - app.modules.menus.application.services.area_service - INFO - No se encontraron √°reas activas para el cliente ee7bfc14-995f-4209-b4b9-99c307534a43 en la lista simple
2025-12-04 08:48:09,389 - app.modules.menus.presentation.endpoints_areas - INFO - Lista simple de √°reas recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0 √°reas activas
2025-12-04 08:48:09,390 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 41.1ms
2025-12-04 08:48:09,391 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-12-04 08:48:09,391 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:09,392 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:09,392 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:09,392 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:09,392 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:09,393 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:09,393 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:09,393 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:09,399 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:09,400 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:09,400 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/areas/list/
2025-12-04 08:48:09,417 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:09,421 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/list/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:48:09,421 - app.modules.menus.application.services.area_service - INFO - Obteniendo lista simple de √°reas activas para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:09,421 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:09,424 - app.modules.menus.application.services.area_service - INFO - No se encontraron √°reas activas para el cliente ee7bfc14-995f-4209-b4b9-99c307534a43 en la lista simple
2025-12-04 08:48:09,424 - app.modules.menus.presentation.endpoints_areas - INFO - Lista simple de √°reas recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0 √°reas activas
2025-12-04 08:48:09,425 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 33.2ms
2025-12-04 08:48:15,871 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:48:15,871 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:15,871 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:15,872 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:15,872 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:15,872 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:15,874 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:48:15,876 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:15,876 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:15,876 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:15,876 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:15,877 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:15,880 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:15,880 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:15,882 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:15,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:15,884 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:15,884 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:15,888 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:15,888 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:15,888 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:48:15,890 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:15,891 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:15,891 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:48:15,915 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:15,916 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:15,920 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:48:15,920 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:48:15,920 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:15,920 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:48:15,920 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:15,924 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:15,924 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:48:15,925 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 51.3ms
2025-12-04 08:48:15,926 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:15,928 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:48:15,930 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:15,930 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:15,930 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:15,930 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:15,930 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:15,935 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:15,935 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:15,936 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:15,938 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:48:15,938 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:48:15,938 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:48:15,939 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 68.7ms
2025-12-04 08:48:15,941 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:48:15,942 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:15,942 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:15,942 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:15,942 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:15,942 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:15,944 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:15,944 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:15,945 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:48:15,949 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:15,949 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:15,949 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:15,955 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:15,955 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:15,955 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:48:15,966 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:15,973 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:48:15,973 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:15,978 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:15,978 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:48:15,981 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:15,982 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 53.2ms
2025-12-04 08:48:15,986 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:48:15,986 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:48:15,986 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:15,989 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:15,994 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:48:15,995 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:48:15,995 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:48:15,995 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 54.3ms
2025-12-04 08:48:23,932 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:48:23,932 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:23,933 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:23,933 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:23,933 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:23,933 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:23,938 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:23,939 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:23,939 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:23,943 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:23,944 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:23,944 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:48:23,960 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:23,963 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:48:23,964 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 31.1ms
2025-12-04 08:48:23,964 - app.core.exceptions - ERROR - Error no manejado: '<=' not supported between instances of 'UUID' and 'int'
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    |     if not current_user.cliente_id or current_user.cliente_id <= 0:
    |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | TypeError: '<=' not supported between instances of 'UUID' and 'int'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    if not current_user.cliente_id or current_user.cliente_id <= 0:
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: '<=' not supported between instances of 'UUID' and 'int'
2025-12-04 08:48:23,976 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:48:23,977 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:48:23,978 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:48:23,978 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:23,978 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:23,978 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:23,982 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:48:23,982 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:48:23,982 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:48:23,987 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:48:23,987 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:48:23,987 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:48:24,001 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:48:24,004 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:48:24,005 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 28.3ms
2025-12-04 08:48:24,005 - app.core.exceptions - ERROR - Error no manejado: '<=' not supported between instances of 'UUID' and 'int'
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    |     if not current_user.cliente_id or current_user.cliente_id <= 0:
    |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | TypeError: '<=' not supported between instances of 'UUID' and 'int'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 422, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\modules\rbac\presentation\endpoints.py", line 179, in read_roles_paginated
    if not current_user.cliente_id or current_user.cliente_id <= 0:
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: '<=' not supported between instances of 'UUID' and 'int'
2025-12-04 08:50:07,607 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:50:07,607 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:50:07,607 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:50:07,607 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:50:07,607 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:50:07,607 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:50:07,718 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002906AB3D070>
2025-12-04 08:50:07,719 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002906AB3E900>
2025-12-04 08:50:07,719 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002906B3993D0>
2025-12-04 08:50:07,719 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002906B399FD0>
2025-12-04 08:50:08,633 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:50:08,863 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:50:08,867 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:50:08,867 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:50:08,867 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:50:08,874 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:50:08,874 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:50:08,874 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:50:09,340 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:50:09,341 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:50:09,455 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:50:09,455 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:50:09,455 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:50:09,692 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:50:09,693 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:50:09,848 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'static', 'www', 'cdn', 'backend', 'admin', 'assets', 'api'}
2025-12-04 08:50:20,695 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:50:20,697 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:20,697 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:20,697 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:20,698 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:20,698 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:20,701 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:50:20,707 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:50:20,708 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:20,708 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:20,708 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:20,709 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:20,709 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:20,750 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:20,750 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:20,750 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:20,752 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:20,752 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:20,753 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:20,759 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:24,840 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:50:24,840 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:50:24,840 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:24,848 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:24,848 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:50:24,848 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:24,848 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:24,848 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:50:24,884 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:24,884 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:24,888 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:50:24,888 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:50:24,888 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:24,888 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:50:24,888 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:24,892 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:24,893 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:50:24,893 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 4187.7ms
2025-12-04 08:50:24,893 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:24,898 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:50:24,898 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:50:24,898 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:50:24,898 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 4205.9ms
2025-12-04 08:50:24,941 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:50:24,942 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:50:24,942 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:50:24,942 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:50:24,942 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:50:24,942 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:50:25,036 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017906610BC0>
2025-12-04 08:50:25,036 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017906ADCE60>
2025-12-04 08:50:25,039 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000179073000B0>
2025-12-04 08:50:25,039 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017907300D10>
2025-12-04 08:50:25,862 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:50:26,087 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:50:26,094 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:50:26,094 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:50:26,094 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:50:26,094 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:50:26,094 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:50:26,094 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:50:26,492 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:50:26,492 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:50:26,598 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:50:26,598 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:50:26,598 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:50:26,794 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:50:26,794 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:50:26,948 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'static', 'backend', 'api', 'cdn', 'www', 'admin', 'assets'}
2025-12-04 08:50:26,954 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:50:26,954 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:50:26,954 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:50:26,954 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:26,954 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:26,954 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:26,954 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:26,954 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:26,960 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:50:26,960 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:26,960 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:26,960 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:26,960 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:26,960 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:26,966 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:26,966 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:26,966 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:26,966 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:26,966 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:26,999 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:26,999 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:26,999 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:27,000 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:27,000 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:27,001 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:27,002 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:27,002 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:27,002 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:27,008 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:31,080 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:50:31,080 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:50:31,081 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:31,082 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:31,086 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:31,086 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:50:31,092 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:31,093 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:31,093 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:50:31,094 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:31,094 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:50:31,130 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:31,130 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:31,130 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:31,133 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:50:31,133 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:31,137 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:50:31,137 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:50:31,137 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:50:31,137 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:31,138 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:50:31,138 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:50:31,138 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:31,141 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:31,141 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:50:31,143 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 4188.1ms
2025-12-04 08:50:31,145 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:31,147 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:50:31,147 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:50:31,147 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:50:31,147 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:50:31,147 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 4192.6ms
2025-12-04 08:50:31,150 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:50:31,150 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:31,151 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:31,151 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:31,151 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:31,151 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:31,154 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:50:31,154 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:50:31,154 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:50:31,155 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 4199.3ms
2025-12-04 08:50:31,156 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:31,156 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:31,156 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:31,159 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:31,159 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:31,159 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:50:31,174 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:31,176 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:50:31,176 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:50:31,176 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:50:31,176 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:31,179 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:50:31,179 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:50:31,179 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:50:31,180 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:50:31,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 30.0ms
2025-12-04 08:50:33,107 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-12-04 08:50:33,108 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:33,108 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:33,108 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:33,108 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:33,108 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:33,114 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:33,114 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:33,114 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:33,120 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:33,120 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:33,120 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/areas/
2025-12-04 08:50:33,138 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:33,141 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: skip=0, limit=10, B√∫squeda: 'None'
2025-12-04 08:50:33,141 - app.modules.menus.application.services.area_service - INFO - Obteniendo √°reas paginadas para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: skip=0, limit=10, search='None'
2025-12-04 08:50:33,141 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:33,144 - app.modules.menus.application.services.area_service - INFO - Paginaci√≥n completada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0 √°reas de 0 totales
2025-12-04 08:50:33,145 - app.modules.menus.presentation.endpoints_areas - INFO - Lista paginada de √°reas recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:50:33,145 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 38.0ms
2025-12-04 08:50:33,147 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-12-04 08:50:33,147 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:33,147 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:33,147 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:33,147 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:33,148 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:33,153 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:33,153 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:33,153 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:33,157 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:33,157 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:33,157 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/areas/
2025-12-04 08:50:33,175 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:33,178 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: skip=0, limit=10, B√∫squeda: 'None'
2025-12-04 08:50:33,178 - app.modules.menus.application.services.area_service - INFO - Obteniendo √°reas paginadas para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: skip=0, limit=10, search='None'
2025-12-04 08:50:33,178 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:33,181 - app.modules.menus.application.services.area_service - INFO - Paginaci√≥n completada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0 √°reas de 0 totales
2025-12-04 08:50:33,181 - app.modules.menus.presentation.endpoints_areas - INFO - Lista paginada de √°reas recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:50:33,182 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 35.5ms
2025-12-04 08:50:34,675 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:50:34,676 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:34,676 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:34,676 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:34,676 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:34,676 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:34,681 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:34,681 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:34,681 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:34,686 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:34,687 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:34,687 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:50:34,705 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:34,708 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:50:34,708 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:50:34,708 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:50:34,708 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:34,711 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:50:34,711 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:50:34,711 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:50:34,711 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:50:34,711 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 37.0ms
2025-12-04 08:50:34,714 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:50:34,714 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:34,714 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:34,714 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:34,714 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:34,715 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:34,720 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:34,720 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:34,720 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:34,724 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:34,724 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:34,725 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:50:34,739 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:34,742 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:50:34,742 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:50:34,742 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:50:34,742 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:34,746 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:50:34,746 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:50:34,746 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:50:34,747 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:50:34,747 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 33.1ms
2025-12-04 08:50:37,085 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:50:37,085 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:37,086 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:37,086 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:37,086 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:37,086 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:37,089 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:50:37,090 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:37,090 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:37,091 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:37,091 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:37,091 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:37,095 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:37,096 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:37,096 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:37,097 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:37,097 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:37,098 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:37,102 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:37,103 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:37,103 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:50:37,105 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:37,106 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:37,107 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:50:37,131 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:37,132 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:37,135 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:50:37,135 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:50:37,135 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:37,137 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:50:37,137 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:37,141 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:37,142 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:37,142 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:50:37,142 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 53.7ms
2025-12-04 08:50:37,145 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:50:37,145 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:37,145 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:37,146 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:37,146 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:37,146 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:37,150 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:50:37,150 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:50:37,150 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:50:37,151 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 66.1ms
2025-12-04 08:50:37,152 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:37,154 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:37,154 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:37,156 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:50:37,156 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:37,156 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:37,156 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:37,156 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:37,156 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:37,162 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:37,162 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:37,162 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:50:37,164 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:37,164 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:37,164 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:37,171 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:37,171 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:37,171 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:50:37,184 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:37,192 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:50:37,192 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:37,194 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:37,196 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:37,197 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:50:37,197 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 52.4ms
2025-12-04 08:50:37,198 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:50:37,198 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:50:37,199 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:37,203 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:37,208 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:50:37,208 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:50:37,208 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:50:37,208 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 53.2ms
2025-12-04 08:50:53,238 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:50:53,238 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:53,240 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:53,240 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:53,240 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:53,240 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:53,245 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:53,247 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:53,247 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:53,251 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:53,251 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:53,251 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:50:53,269 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:53,273 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:50:53,273 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:50:53,273 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:50:53,273 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:53,277 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:50:53,277 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:50:53,278 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:50:53,278 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:50:53,278 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 39.3ms
2025-12-04 08:50:53,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:50:53,280 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:50:53,280 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:50:53,280 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:53,280 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:53,281 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:53,284 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:50:53,284 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:50:53,284 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:50:53,288 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:50:53,288 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:50:53,288 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:50:53,304 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:53,308 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:50:53,308 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:50:53,308 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:50:53,308 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:50:53,311 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:50:53,311 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:50:53,312 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:50:53,312 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:50:53,312 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 33.3ms
2025-12-04 08:51:13,610 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-12-04 08:51:13,610 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-12-04 08:51:13,612 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-12-04 08:51:13,613 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:13,613 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:13,613 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:13,613 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:13,613 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:13,616 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:13,616 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:13,616 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:13,620 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:13,620 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:13,622 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/logout/
2025-12-04 08:51:13,628 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558
2025-12-04 08:51:13,628 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario: 2458D1EA-816B-4C3C-8D13-B90271F59558 (admin_acme)
2025-12-04 08:51:13,633 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:51:13,633 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 21.5ms
2025-12-04 08:51:22,045 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-12-04 08:51:22,046 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:22,046 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:22,046 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:22,046 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:22,046 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:22,050 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:22,050 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:22,051 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:22,054 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,055 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:22,055 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/auth/login/
2025-12-04 08:51:22,058 - app.modules.auth.presentation.endpoints - INFO - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43 resuelto y validado para login.
2025-12-04 08:51:22,058 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,058 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,299 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:51:22,299 - app.modules.auth.application.services.auth_service - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, cliente_origen=ee7bfc14-995f-4209-b4b9-99c307534a43, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-12-04 08:51:22,299 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:22,304 - app.modules.auth.application.services.auth_service - INFO - Niveles calculados - Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558: level=4, super_admin=False, type=tenant_admin
2025-12-04 08:51:22,304 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente ee7bfc14-995f-4209-b4b9-99c307534a43, Usuario 2458D1EA-816B-4C3C-8D13-B90271F59558, Tipo: web, Token ID: 7B6B61ED-A6F1-424B-84EF-031D8B672AEC, Rotaci√≥n: False
2025-12-04 08:51:22,304 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 7B6B61ED-A6F1-424B-84EF-031D8B672AEC
2025-12-04 08:51:22,304 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,304 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, usuario_id=2458D1EA-816B-4C3C-8D13-B90271F59558, exito=True
2025-12-04 08:51:22,304 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 268.2ms
2025-12-04 08:51:22,318 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-12-04 08:51:22,318 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:22,318 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:22,318 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:22,318 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:22,318 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:22,324 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:51:22,324 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:22,324 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:22,324 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:22,324 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:22,324 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:22,324 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:51:22,324 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:22,324 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:22,324 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:22,333 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:22,333 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:22,333 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:22,333 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:22,334 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:22,335 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:22,335 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:22,335 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:22,335 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,335 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:22,335 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/clientes/tenant/branding
2025-12-04 08:51:22,335 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:22,335 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:22,335 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:22,344 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,349 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:22,349 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:51:22,354 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,354 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:22,354 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:51:22,374 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43 por usuario: admin_acme
2025-12-04 08:51:22,374 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,383 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,384 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,384 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:51:22,385 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 64.1ms
2025-12-04 08:51:22,387 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:22,392 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:51:22,392 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:51:22,392 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:51:22,392 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:22,393 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:51:22,393 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:51:22,394 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 67.1ms
2025-12-04 08:51:22,396 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-12-04 08:51:22,396 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:22,396 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:22,397 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:22,397 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:22,397 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:22,399 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:51:22,400 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:51:22,400 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:51:22,400 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:51:22,401 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 70.5ms
2025-12-04 08:51:22,403 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:51:22,404 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:22,404 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:22,404 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:22,404 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:22,404 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:22,407 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:22,407 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:22,407 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:22,407 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:22,407 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:22,407 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:22,414 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,414 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:22,414 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/menus/getmenu/
2025-12-04 08:51:22,418 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,418 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:22,418 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:51:22,435 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:22,435 - app.modules.menus.application.services.menu_service - INFO - Obteniendo men√∫ filtrado para usuario_id: 2458d1ea-816b-4c3c-8d13-b90271f59558
2025-12-04 08:51:22,440 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:22,442 - app.modules.menus.application.services.menu_helper - INFO - √Årbol de men√∫ construido con 5 items ra√≠z.
2025-12-04 08:51:22,442 - app.modules.menus.application.services.menu_service - INFO - √Årbol de men√∫ construido para usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 con 5 items ra√≠z.
2025-12-04 08:51:22,442 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 48.4ms
2025-12-04 08:51:22,444 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:51:22,444 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:51:22,444 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:51:22,444 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:22,450 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:51:22,451 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:51:22,451 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:51:22,451 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:51:22,451 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 48.1ms
2025-12-04 08:51:25,486 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:51:25,487 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:25,487 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:25,487 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:25,487 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:25,488 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:25,491 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:51:25,491 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:25,492 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:25,492 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:25,492 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:25,492 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:25,496 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:25,498 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:25,498 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:25,499 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:25,500 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:25,500 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:25,522 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:25,522 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:25,522 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:51:25,523 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:25,524 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:25,524 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:51:25,548 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:25,549 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:25,552 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:51:25,553 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:51:25,553 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:25,553 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:51:25,554 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:25,559 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:25,560 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:25,561 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:51:25,561 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 71.2ms
2025-12-04 08:51:25,563 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:51:25,563 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:25,563 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:25,563 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:25,565 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:25,565 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:25,567 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:51:25,567 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:51:25,568 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:51:25,568 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 82.6ms
2025-12-04 08:51:25,570 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:25,570 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:25,570 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:25,573 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:51:25,573 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:25,573 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:25,573 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:25,575 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:25,575 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:25,579 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:25,579 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:25,579 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:51:25,581 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:25,581 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:25,581 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:25,588 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:25,588 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:25,588 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:51:25,604 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:25,606 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:51:25,606 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:25,606 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:25,614 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:25,614 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:51:25,614 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:51:25,614 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:51:25,614 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:25,614 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 54.7ms
2025-12-04 08:51:25,622 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:25,624 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:51:25,624 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:51:25,624 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:51:25,624 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 55.7ms
2025-12-04 08:51:27,246 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:51:27,246 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:27,246 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:27,247 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:27,247 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:27,247 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:27,251 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:27,251 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:27,251 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:27,258 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:27,258 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:27,258 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:51:27,277 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:27,279 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:51:27,279 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:51:27,279 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:51:27,280 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:27,283 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:51:27,283 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:51:27,283 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:51:27,283 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:51:27,283 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 38.5ms
2025-12-04 08:51:27,286 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:51:27,286 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:27,286 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:27,286 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:27,286 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:27,287 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:27,291 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:27,291 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:27,291 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:27,295 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:27,295 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:27,295 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:51:27,309 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:27,311 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:51:27,311 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:51:27,312 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:51:27,312 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:27,315 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:51:27,316 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:51:27,316 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:51:27,316 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:51:27,316 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 30.7ms
2025-12-04 08:51:29,191 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:51:29,193 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:29,193 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:29,193 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:29,193 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:29,193 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:29,194 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:51:29,196 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:29,196 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:29,196 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:29,196 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:29,196 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:29,198 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:29,198 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:29,198 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:29,198 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:29,198 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:29,198 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:29,209 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:29,209 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:29,209 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:51:29,210 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:29,210 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:29,210 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:51:29,236 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:29,237 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:29,242 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:51:29,243 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:51:29,243 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:29,244 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:51:29,244 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:29,247 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:29,249 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:51:29,250 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 55.3ms
2025-12-04 08:51:29,251 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:29,252 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:51:29,252 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:29,253 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:29,253 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:29,253 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:29,253 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:29,259 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:29,260 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:29,260 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:29,260 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:51:29,260 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:51:29,260 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:51:29,260 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 72.2ms
2025-12-04 08:51:29,264 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:51:29,264 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:29,264 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:29,264 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:29,264 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:29,264 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:29,268 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:29,268 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:29,268 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:51:29,273 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:29,273 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:29,273 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:29,276 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:29,276 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:29,276 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:51:29,292 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:29,295 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:51:29,295 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:29,295 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:29,295 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:51:29,305 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:29,305 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 52.4ms
2025-12-04 08:51:29,309 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:51:29,309 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:51:29,309 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:29,309 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:29,314 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:51:29,314 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:51:29,314 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:51:29,314 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 52.7ms
2025-12-04 08:51:46,987 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:51:46,987 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:46,987 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:46,988 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:46,988 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:46,988 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:46,993 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:46,994 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:46,994 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:46,998 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:46,999 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:46,999 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:51:47,016 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:47,018 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:51:47,019 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:51:47,019 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:51:47,019 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:47,022 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:51:47,022 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:51:47,022 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:51:47,022 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:51:47,023 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 36.2ms
2025-12-04 08:51:47,025 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:51:47,025 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:47,025 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:47,025 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:47,025 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:47,026 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:47,032 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:47,032 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:47,032 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:47,036 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:47,036 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:47,036 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:51:47,050 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:47,054 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:51:47,054 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:51:47,054 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:51:47,054 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:47,057 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:51:47,057 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:51:47,057 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:51:47,058 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:51:47,058 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 34.0ms
2025-12-04 08:51:54,024 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:51:54,024 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:54,024 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:54,025 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:54,025 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:54,025 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:54,029 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:51:54,030 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:54,030 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:54,030 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:54,030 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:54,031 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:54,034 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:54,034 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:54,034 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:54,037 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:54,037 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:54,037 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:54,040 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:54,040 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:54,041 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:51:54,045 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:54,045 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:54,045 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:51:54,066 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:54,068 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:54,068 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:51:54,068 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:51:54,068 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:54,075 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:51:54,075 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:54,077 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:54,077 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:54,077 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:51:54,079 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 50.8ms
2025-12-04 08:51:54,081 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:51:54,081 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:54,082 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:54,082 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:54,082 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:54,082 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:54,086 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:51:54,086 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:51:54,086 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:51:54,087 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 63.5ms
2025-12-04 08:51:54,089 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:51:54,089 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:51:54,089 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:51:54,090 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:54,090 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:54,090 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:54,092 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:54,092 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:54,092 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:54,096 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:51:54,096 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:51:54,096 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:51:54,097 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:54,097 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:54,098 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:51:54,102 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:54,102 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:51:54,102 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:51:54,123 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:54,126 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:54,126 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:51:54,128 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:54,130 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:51:54,130 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:51:54,130 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:54,131 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:51:54,131 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:51:54,132 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 51.7ms
2025-12-04 08:51:54,137 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:51:54,140 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:51:54,140 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:51:54,140 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:51:54,142 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 52.3ms
2025-12-04 08:52:13,474 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:52:13,474 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:52:13,475 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:52:13,475 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:52:13,475 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:52:13,475 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:52:13,481 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:52:13,481 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:52:13,481 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:52:13,486 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:52:13,486 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:52:13,486 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:52:13,502 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:13,506 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:52:13,506 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:52:13,506 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:52:13,506 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:13,510 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:52:13,510 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:52:13,510 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:52:13,510 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:52:13,510 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 37.5ms
2025-12-04 08:52:13,512 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:52:13,513 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:52:13,513 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:52:13,513 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:52:13,513 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:52:13,513 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:52:13,517 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:52:13,517 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:52:13,517 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:52:13,522 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:52:13,522 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:52:13,522 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:52:13,528 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:13,538 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:52:13,538 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:52:13,538 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:52:13,538 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:13,542 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:52:13,542 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:52:13,542 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:52:13,542 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:52:13,543 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 30.2ms
2025-12-04 08:52:54,706 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:52:54,706 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:52:54,707 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:52:54,707 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:52:54,707 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:52:54,707 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:52:54,709 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:52:54,711 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:52:54,711 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:52:54,711 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:52:54,711 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:52:54,711 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:52:54,718 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:52:54,718 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:52:54,718 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:52:54,720 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:52:54,721 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:52:54,721 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:52:54,726 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:52:54,726 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:52:54,726 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:52:54,728 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:52:54,728 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:52:54,728 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:52:54,757 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:54,758 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:54,762 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:52:54,762 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:54,763 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:52:54,763 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:52:54,763 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:54,767 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:52:54,768 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:52:54,769 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 58.9ms
2025-12-04 08:52:54,770 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:54,771 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:52:54,772 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:52:54,772 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:52:54,772 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:52:54,772 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:52:54,772 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:52:54,777 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:52:54,779 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:52:54,779 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:52:54,782 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:52:54,782 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:52:54,782 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:52:54,783 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 77.1ms
2025-12-04 08:52:54,785 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:52:54,786 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:52:54,786 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:52:54,786 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:52:54,786 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:52:54,786 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:52:54,788 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:52:54,788 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:52:54,789 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:52:54,794 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:52:54,794 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:52:54,794 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:52:54,802 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:52:54,802 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:52:54,802 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:52:54,817 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:54,820 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:52:54,820 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:54,826 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:52:54,826 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:52:54,827 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 56.2ms
2025-12-04 08:52:54,828 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:54,833 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:52:54,834 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:52:54,834 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:54,837 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:52:54,842 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:52:54,842 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:52:54,842 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:52:54,843 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 57.9ms
2025-12-04 08:52:56,396 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:52:56,396 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:52:56,396 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:52:56,396 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:52:56,396 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:52:56,396 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:52:56,496 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000024924FFFE30>
2025-12-04 08:52:56,497 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000024925024AA0>
2025-12-04 08:52:56,497 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000024925024560>
2025-12-04 08:52:56,497 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000249246FA000>
2025-12-04 08:52:56,497 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000249246FBB90>
2025-12-04 08:52:56,498 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x00000249246FA960>
2025-12-04 08:52:58,546 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:52:58,744 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:52:58,751 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:52:58,754 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:52:58,754 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:52:58,754 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:52:58,755 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:52:58,755 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:52:59,080 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:52:59,080 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:52:59,156 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:52:59,156 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:52:59,156 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:52:59,318 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:52:59,318 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:52:59,467 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'assets', 'cdn', 'api', 'www', 'backend', 'static', 'admin'}
2025-12-04 08:53:00,809 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:53:00,810 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:53:00,810 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:53:00,810 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:53:00,810 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:53:00,810 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:53:00,813 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:53:00,846 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:53:00,846 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:53:00,846 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:53:00,852 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:53:04,936 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:53:04,936 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:53:04,944 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:53:04,944 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:53:04,946 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:53:04,975 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:04,977 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:53:04,977 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:53:04,977 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:53:04,977 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:04,977 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:53:04,977 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:53:04,977 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:53:04,977 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:53:04,983 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 4173.9ms
2025-12-04 08:53:04,984 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:53:04,986 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:53:04,986 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:53:04,986 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:53:04,986 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:53:04,986 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:53:04,991 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:53:04,991 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:53:04,991 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:53:04,996 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:53:04,996 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:53:04,996 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:53:05,012 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:05,016 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:53:05,016 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:53:05,016 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:53:05,016 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:05,019 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:53:05,020 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:53:05,020 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:53:05,020 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:53:05,020 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 35.1ms
2025-12-04 08:53:42,076 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:53:42,076 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:53:42,076 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:53:42,076 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:53:42,076 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:53:42,076 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:53:42,176 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017AB870DD90>
2025-12-04 08:53:42,176 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x0000017AB8EBD3D0>
2025-12-04 08:53:44,542 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:53:44,731 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:53:44,736 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:53:44,738 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:53:44,739 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:53:44,739 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:53:44,739 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:53:44,740 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:53:45,059 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:53:45,059 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:53:45,130 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:53:45,130 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:53:45,131 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:53:45,289 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:53:45,290 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:53:45,430 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'api', 'www', 'static', 'admin', 'cdn', 'backend', 'assets'}
2025-12-04 08:53:47,369 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:53:47,370 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:53:47,370 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:53:47,371 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:53:47,371 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:53:47,371 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:53:47,374 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:53:47,377 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:53:47,377 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:53:47,377 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:53:47,377 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:53:47,377 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:53:47,377 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:53:47,424 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:53:47,424 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:53:47,424 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:53:47,426 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:53:47,426 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:53:47,426 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:53:47,433 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:53:51,502 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:53:51,502 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:53:51,503 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:53:51,512 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:53:51,512 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:53:51,512 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:53:51,512 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:53:51,516 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:53:51,554 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:51,556 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:51,559 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:53:51,559 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:51,560 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:53:51,560 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:53:51,560 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:51,563 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:53:51,563 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:53:51,564 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 4187.6ms
2025-12-04 08:53:51,567 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:53:51,567 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:51,568 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:53:51,568 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:53:51,568 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:53:51,568 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:53:51,568 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:53:51,573 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:53:51,573 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:53:51,573 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:53:51,577 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:53:51,577 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:53:51,578 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:53:51,578 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 4208.9ms
2025-12-04 08:53:51,580 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:53:51,581 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:53:51,581 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:53:51,581 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:53:51,582 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:53:51,582 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:53:51,582 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:53:51,582 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:53:51,582 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:53:51,588 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:53:51,588 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:53:51,588 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:53:51,595 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:53:51,595 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:53:51,597 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:53:51,609 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:51,613 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:53:51,613 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:51,618 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:53:51,618 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 3
2025-12-04 08:53:51,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 52.8ms
2025-12-04 08:53:51,620 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:51,624 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:53:51,624 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:53:51,624 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:51,628 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:53:51,632 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 0 usuarios √∫nicos de 0 filas crudas
2025-12-04 08:53:51,632 - app.modules.users.application.services.user_service - INFO - Obtenci√≥n paginada de usuarios completada exitosamente
2025-12-04 08:53:51,632 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Total: 0, P√°gina: 1
2025-12-04 08:53:51,633 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 52.4ms
2025-12-04 08:56:32,877 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:56:32,889 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:56:32,893 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:56:32,896 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:56:32,898 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:56:32,899 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:56:32,925 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:56:32,925 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:56:32,925 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:56:32,937 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:56:32,938 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:56:32,938 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:56:32,964 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:56:32,968 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:56:32,968 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:56:32,968 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:56:32,968 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:56:32,974 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: 0
2025-12-04 08:56:32,974 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] No hay roles para mostrar (total=0, limit=10)
2025-12-04 08:56:32,974 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total: 0, P√°gina: 1/0, Resultados: 0
2025-12-04 08:56:32,974 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: ee7bfc14-995f-4209-b4b9-99c307534a43, Total roles: 0
2025-12-04 08:56:32,975 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 97.3ms
2025-12-04 08:56:33,021 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-12-04 08:56:33,021 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Configuraci√≥n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-12-04 08:56:33,021 - app.infrastructure.database.connection_pool - INFO - ‚úÖ M√≥dulo de connection pooling cargado y activo
2025-12-04 08:56:33,021 - app.infrastructure.database.connection_pool - INFO -    Configuraci√≥n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-12-04 08:56:33,022 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-12-04 08:56:33,022 - app.main - INFO - ‚úÖ Pools de conexi√≥n cerrados correctamente
2025-12-04 08:56:33,158 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002B6A0414EC0>
2025-12-04 08:56:33,159 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002B69EB38EC0>
2025-12-04 08:56:33,159 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002B6A0B2BE00>
2025-12-04 08:56:33,159 - asyncio - ERROR - Unclosed connection
connection: <aioodbc.connection.Connection object at 0x000002B6A0B3CA70>
2025-12-04 08:56:33,997 - app.core.tenant.context - INFO - M√≥dulo tenant_context cargado (versi√≥n h√≠brida)
2025-12-04 08:56:34,234 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] SQLAlchemy async disponible
2025-12-04 08:56:34,241 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] aioodbc disponible
2025-12-04 08:56:34,244 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-12-04 08:56:34,244 - app.core.security.encryption - INFO - M√≥dulo de encriptaci√≥n cargado correctamente
2025-12-04 08:56:34,245 - app.core.tenant.cache - INFO - ‚úÖ ConnectionMetadataCache inicializado (TTL: 300s)
2025-12-04 08:56:34,245 - app.core.tenant.cache - INFO - M√≥dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-12-04 08:56:34,245 - app.core.tenant.routing - INFO - M√≥dulo multi_db cargado. SYSTEM_CLIENT_ID=bba6fbad-4090-4ab8-b44a-4e8f5bc0bdb7, DEFAULT_TYPE=single
2025-12-04 08:56:34,640 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. L√≠mites: Login=10/minute, API=200/minute
2025-12-04 08:56:34,641 - app.core.security.rate_limiting - INFO - ‚úÖ M√≥dulo de rate limiting cargado y activo
2025-12-04 08:56:34,749 - app.core.authorization.rbac - INFO - üîê Inicializando sistema de autorizaci√≥n...
2025-12-04 08:56:34,749 - app.core.authorization.rbac - INFO - ‚úÖ Sistema de autorizaci√≥n inicializado correctamente
2025-12-04 08:56:34,749 - app.core.authorization.rbac - INFO - üìä Permisos del sistema: 6 m√≥dulos configurados
2025-12-04 08:56:34,971 - app.core.tenant.middleware - INFO - M√≥dulo tenant_middleware cargado (versi√≥n h√≠brida con soporte para proxies)
2025-12-04 08:56:34,971 - app.main - INFO - ‚úÖ Rate limiting configurado y activo
2025-12-04 08:56:35,120 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=BBA6FBAD-4090-4AB8-B44A-4E8F5BC0BDB7, EXCLUDED_SUBDOMAINS={'assets', 'www', 'static', 'backend', 'cdn', 'admin', 'api'}
2025-12-04 08:56:35,129 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-12-04 08:56:35,129 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-12-04 08:56:35,129 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-12-04 08:56:35,129 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:56:35,129 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:56:35,129 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:56:35,129 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:56:35,129 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:56:35,129 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para admin
2025-12-04 08:56:35,136 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:56:35,137 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:56:35,137 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:56:35,137 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:56:35,137 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:56:35,144 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-12-04 08:56:35,144 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extra√≠do de 'origin': acme.app.local:5173
2025-12-04 08:56:35,144 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:56:35,144 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:56:35,144 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:56:35,171 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:56:35,171 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:56:35,171 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:56:35,171 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:56:35,171 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:56:35,171 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:56:35,171 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-12-04 08:56:35,171 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-12-04 08:56:35,171 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-12-04 08:56:35,179 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:56:39,240 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexi√≥n ya que el equipo de destino deneg√≥ expresamente dicha conexi√≥n.. Cache desactivado autom√°ticamente (usando fallback en memoria).
2025-12-04 08:56:39,241 - app.infrastructure.cache.redis_cache - INFO - ‚ÑπÔ∏è M√≥dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-12-04 08:56:39,241 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:56:39,241 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', C√≥digo='ACME001', ID=ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:56:39,241 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:56:39,241 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/
2025-12-04 08:56:39,241 - app.infrastructure.database.connection_async - INFO - [ASYNC_CONNECTION] AsyncEngine creado para tenant_ee7bfc14-995f-4209-b4b9-99c307534a43
2025-12-04 08:56:39,241 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:56:39,241 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/roles/all-active/
2025-12-04 08:56:39,241 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC
2025-12-04 08:56:39,241 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, tipo_instalacion=dedicated, db_type=multi, bd=bd_cliente_acme, servidor=CARLOSPC, path=/api/v1/usuarios/
2025-12-04 08:56:39,295 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:56:39,296 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:56:39,299 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:56:39,299 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:56:39,299 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:56:39,299 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=ee7bfc14-995f-4209-b4b9-99c307534a43, page=1, limit=10, search='None'
2025-12-04 08:56:39,299 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:56:39,299 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 - Paginaci√≥n: page=1, limit=10, B√∫squeda: 'None'
2025-12-04 08:56:39,299 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente ee7bfc14-995f-4209-b4b9-99c307534a43: page=1, limit=10, search='None'
2025-12-04 08:56:39,299 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.
2025-12-04 08:56:39,299 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2458d1ea-816b-4c3c-8d13-b90271f59558 del cliente ee7bfc14-995f-4209-b4b9-99c307534a43 para lista simple
2025-12-04 08:56:39,299 - app.infrastructure.database.queries_async - WARNING - [QUERY] DEPRECATED: execute_query() recibi√≥ string SQL. Migrar a SQLAlchemy Core.

2025-11-08 02:34:44,842 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-08 02:34:44,843 - app.main - INFO - 127.0.0.1 <- GET /docs 0.7ms
2025-11-08 02:34:45,274 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-08 02:34:45,336 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 61.9ms
2025-11-09 09:50:24,525 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 09:50:24,526 - app.main - INFO - 127.0.0.1 <- GET /docs 1.1ms
2025-11-09 09:50:25,315 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 09:50:25,384 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 68.9ms
2025-11-09 09:51:13,530 - app.main - INFO - 127.0.0.1 -> GET /health
2025-11-09 09:51:30,891 - app.db.connection - ERROR - Error de conexión a la base de datos (admin): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 09:51:30,891 - app.main - ERROR - Error en health check: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-09 09:51:30,892 - app.main - INFO - 127.0.0.1 <- GET /health 17361.2ms
2025-11-09 09:55:30,120 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 09:55:30,121 - app.main - INFO - 127.0.0.1 <- GET /docs 0.8ms
2025-11-09 09:55:30,283 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 09:55:30,340 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 57.1ms
2025-11-09 09:55:33,559 - app.main - INFO - 127.0.0.1 -> GET /health
2025-11-09 09:55:50,843 - app.db.connection - ERROR - Error de conexión a la base de datos (admin): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 09:55:50,843 - app.main - ERROR - Error en health check: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-09 09:55:50,844 - app.main - INFO - 127.0.0.1 <- GET /health 17284.2ms
2025-11-09 09:58:30,413 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 09:58:30,414 - app.main - INFO - 127.0.0.1 <- GET /docs 0.6ms
2025-11-09 09:58:30,498 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 09:58:30,557 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 59.3ms
2025-11-09 09:58:34,988 - app.main - INFO - 127.0.0.1 -> GET /health
2025-11-09 09:58:35,025 - app.main - INFO - 127.0.0.1 <- GET /health 37.2ms
2025-11-09 14:42:28,791 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 14:42:28,792 - app.main - INFO - 127.0.0.1 <- GET /docs 0.7ms
2025-11-09 14:42:28,862 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 14:42:28,917 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 55.3ms
2025-11-09 14:42:43,612 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 14:43:00,884 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 14:43:00,889 - app.main - INFO - 127.0.0.1 <- GET /api/test 17277.0ms
2025-11-09 14:43:18,946 - app.main - INFO - 127.0.0.1 -> GET /health
2025-11-09 14:43:36,211 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 14:43:36,212 - app.main - ERROR - Error en health check: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-09 14:43:36,212 - app.main - INFO - 127.0.0.1 <- GET /health 17265.8ms
2025-11-09 14:44:15,105 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-09 14:44:32,393 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 14:44:32,393 - app.core.auth - ERROR - Error en autenticación: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 74, in get_db_connection
    conn = pyodbc.connect(conn_str)
pyodbc.OperationalError: ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 98, in authenticate_user
    user = execute_auth_query(query, (username,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 31, in execute_auth_query
    with get_db_connection(DatabaseConnection.DEFAULT) as conn:
         ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 141, in __enter__
    return next(self.gen)
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 80, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-09 14:44:32,397 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 17292.2ms
2025-11-09 14:44:32,398 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-09 14:44:49,569 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 14:44:49,569 - app.core.auth - ERROR - Error en autenticación: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 74, in get_db_connection
    conn = pyodbc.connect(conn_str)
pyodbc.OperationalError: ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 98, in authenticate_user
    user = execute_auth_query(query, (username,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 31, in execute_auth_query
    with get_db_connection(DatabaseConnection.DEFAULT) as conn:
         ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 141, in __enter__
    return next(self.gen)
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 80, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-09 14:44:49,572 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 17173.2ms
2025-11-09 14:52:20,660 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 14:52:20,661 - app.main - INFO - 127.0.0.1 <- GET /docs 0.9ms
2025-11-09 14:52:20,751 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 14:52:20,814 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 62.4ms
2025-11-09 14:52:33,478 - app.main - INFO - 127.0.0.1 -> GET /drivers
2025-11-09 14:52:33,478 - app.main - INFO - 127.0.0.1 <- GET /drivers 0.6ms
2025-11-09 14:52:33,478 - app.core.exceptions - ERROR - Error no manejado: cannot import name 'test_drivers' from 'app.db.connection' (D:\base_multi_tenant_fastapi\app\db\connection.py)
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 62, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 53, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 122, in check_drivers
    |     from app.db.connection import test_drivers
    | ImportError: cannot import name 'test_drivers' from 'app.db.connection' (D:\base_multi_tenant_fastapi\app\db\connection.py)
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 62, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 53, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 122, in check_drivers
    from app.db.connection import test_drivers
ImportError: cannot import name 'test_drivers' from 'app.db.connection' (D:\base_multi_tenant_fastapi\app\db\connection.py)
2025-11-09 14:53:08,747 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 14:53:08,748 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.7ms
2025-11-09 14:57:10,008 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 14:57:10,008 - app.main - INFO - 127.0.0.1 <- GET /docs 0.5ms
2025-11-09 14:57:10,069 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 14:57:10,071 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 2.4ms
2025-11-09 14:57:17,801 - app.main - INFO - 127.0.0.1 -> GET /drivers
2025-11-09 14:57:17,802 - app.main - INFO - 127.0.0.1 <- GET /drivers 0.7ms
2025-11-09 14:57:17,802 - app.core.exceptions - ERROR - Error no manejado: cannot import name 'test_drivers' from 'app.db.connection' (D:\base_multi_tenant_fastapi\app\db\connection.py)
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 62, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 53, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 122, in check_drivers
    |     from app.db.connection import test_drivers
    | ImportError: cannot import name 'test_drivers' from 'app.db.connection' (D:\base_multi_tenant_fastapi\app\db\connection.py)
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 62, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 53, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 122, in check_drivers
    from app.db.connection import test_drivers
ImportError: cannot import name 'test_drivers' from 'app.db.connection' (D:\base_multi_tenant_fastapi\app\db\connection.py)
2025-11-09 14:57:30,548 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 14:57:30,548 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.8ms
2025-11-09 14:57:43,249 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 14:57:43,250 - app.main - INFO - 127.0.0.1 <- GET /docs 0.6ms
2025-11-09 14:57:43,329 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 14:57:43,330 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 1.5ms
2025-11-09 14:57:48,157 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 14:57:48,157 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.6ms
2025-11-09 14:58:22,071 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 14:58:22,071 - app.main - INFO - 127.0.0.1 <- GET /docs 0.4ms
2025-11-09 14:58:22,155 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 14:58:22,156 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 1.7ms
2025-11-09 14:58:25,769 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 14:58:25,770 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.7ms
2025-11-09 14:59:19,458 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 14:59:19,459 - app.main - INFO - 127.0.0.1 <- GET /docs 0.6ms
2025-11-09 14:59:19,550 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 14:59:19,552 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 2.1ms
2025-11-09 14:59:26,538 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 14:59:26,539 - app.main - INFO - 127.0.0.1 <- GET /docs 0.7ms
2025-11-09 14:59:26,602 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 14:59:26,659 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 56.7ms
2025-11-09 14:59:30,322 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 14:59:30,323 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.8ms
2025-11-09 14:59:37,719 - app.main - INFO - 127.0.0.1 -> GET /drivers
2025-11-09 14:59:37,720 - app.main - INFO - 127.0.0.1 <- GET /drivers 0.8ms
2025-11-09 14:59:37,721 - app.core.exceptions - ERROR - Error no manejado: cannot import name 'test_drivers' from 'app.db.connection' (D:\base_multi_tenant_fastapi\app\db\connection.py)
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 62, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 53, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 122, in check_drivers
    |     from app.db.connection import test_drivers
    | ImportError: cannot import name 'test_drivers' from 'app.db.connection' (D:\base_multi_tenant_fastapi\app\db\connection.py)
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 62, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 53, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 122, in check_drivers
    from app.db.connection import test_drivers
ImportError: cannot import name 'test_drivers' from 'app.db.connection' (D:\base_multi_tenant_fastapi\app\db\connection.py)
2025-11-09 15:00:03,921 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:00:21,225 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 15:00:21,226 - app.main - INFO - 127.0.0.1 <- GET /api/test 17305.8ms
2025-11-09 15:01:27,196 - app.main - INFO - 127.0.0.1 -> GET /drivers
2025-11-09 15:01:27,199 - app.main - INFO - 127.0.0.1 <- GET /drivers 3.4ms
2025-11-09 15:01:27,200 - app.core.exceptions - ERROR - Error no manejado: cannot import name 'test_drivers' from 'app.db.connection' (D:\base_multi_tenant_fastapi\app\db\connection.py)
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 62, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 53, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 122, in check_drivers
    |     from app.db.connection import test_drivers
    | ImportError: cannot import name 'test_drivers' from 'app.db.connection' (D:\base_multi_tenant_fastapi\app\db\connection.py)
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 62, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 53, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 122, in check_drivers
    from app.db.connection import test_drivers
ImportError: cannot import name 'test_drivers' from 'app.db.connection' (D:\base_multi_tenant_fastapi\app\db\connection.py)
2025-11-09 15:04:41,298 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 15:04:41,299 - app.main - INFO - 127.0.0.1 <- GET /docs 0.6ms
2025-11-09 15:04:41,382 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 15:04:41,439 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 57.6ms
2025-11-09 15:04:45,752 - app.main - INFO - 127.0.0.1 -> GET /drivers
2025-11-09 15:04:45,757 - app.main - INFO - 127.0.0.1 <- GET /drivers 4.5ms
2025-11-09 15:05:02,266 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 15:05:02,266 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.8ms
2025-11-09 15:05:08,902 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:05:26,195 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 15:05:26,197 - app.main - INFO - 127.0.0.1 <- GET /api/test 17295.7ms
2025-11-09 15:09:49,189 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 15:09:49,190 - app.main - INFO - 127.0.0.1 <- GET /docs 0.8ms
2025-11-09 15:09:49,284 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 15:09:49,353 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 68.4ms
2025-11-09 15:09:53,909 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:10:11,182 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 15:10:11,184 - app.main - INFO - 127.0.0.1 <- GET /api/test 17275.8ms
2025-11-09 15:11:58,490 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 15:11:58,490 - app.main - INFO - 127.0.0.1 <- GET /docs 0.5ms
2025-11-09 15:11:58,559 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 15:11:58,561 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 1.7ms
2025-11-09 15:12:03,509 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 15:12:03,510 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.7ms
2025-11-09 15:12:11,619 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 15:12:11,620 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.7ms
2025-11-09 15:12:17,658 - app.main - INFO - 127.0.0.1 -> GET /drivers
2025-11-09 15:12:17,661 - app.main - INFO - 127.0.0.1 <- GET /drivers 3.7ms
2025-11-09 15:12:22,365 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:12:39,639 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 15:12:39,641 - app.main - INFO - 127.0.0.1 <- GET /api/test 17275.9ms
2025-11-09 15:16:14,971 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 15:16:14,972 - app.main - INFO - 127.0.0.1 <- GET /docs 0.6ms
2025-11-09 15:16:15,038 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 15:16:15,094 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 55.7ms
2025-11-09 15:16:21,583 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:16:38,850 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 15:16:38,852 - app.main - INFO - 127.0.0.1 <- GET /api/test 17269.0ms
2025-11-09 15:30:20,268 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 15:30:20,269 - app.main - INFO - 127.0.0.1 <- GET /docs 0.8ms
2025-11-09 15:30:20,352 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 15:30:20,409 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 56.9ms
2025-11-09 15:30:24,794 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:30:42,099 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 15:30:42,101 - app.main - INFO - 127.0.0.1 <- GET /api/test 17307.7ms
2025-11-09 15:31:40,990 - app.main - INFO - 127.0.0.1 -> GET /drivers
2025-11-09 15:31:40,994 - app.main - INFO - 127.0.0.1 <- GET /drivers 4.1ms
2025-11-09 15:31:47,197 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 15:31:47,198 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.8ms
2025-11-09 15:33:28,474 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 15:33:28,476 - app.main - INFO - 127.0.0.1 <- GET /debug-env 2.5ms
2025-11-09 15:33:42,713 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:34:00,018 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 15:34:00,020 - app.main - INFO - 127.0.0.1 <- GET /api/test 17306.6ms
2025-11-09 15:34:19,273 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 15:34:19,273 - app.main - INFO - 127.0.0.1 <- GET /docs 0.6ms
2025-11-09 15:34:19,360 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 15:34:19,417 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 56.8ms
2025-11-09 15:34:22,251 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 15:34:22,252 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.8ms
2025-11-09 15:34:27,368 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:34:44,675 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('08001', '[08001] [Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Host desconocido.\r\n (11001) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0); [08001] [Microsoft][ODBC Driver 17 for SQL Server]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online. (11001)')
2025-11-09 15:34:44,677 - app.main - INFO - 127.0.0.1 <- GET /api/test 17308.9ms
2025-11-09 15:35:21,526 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 15:35:21,527 - app.main - INFO - 127.0.0.1 <- GET /docs 0.6ms
2025-11-09 15:35:21,601 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 15:35:21,657 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 56.1ms
2025-11-09 15:35:25,619 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:35:25,642 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 15:35:25,644 - app.main - INFO - 127.0.0.1 <- GET /api/test 24.7ms
2025-11-09 15:35:54,050 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 15:35:54,051 - app.main - INFO - 127.0.0.1 <- GET /docs 1.1ms
2025-11-09 15:35:54,130 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 15:35:54,187 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 57.0ms
2025-11-09 15:35:59,232 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:35:59,255 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 15:35:59,257 - app.main - INFO - 127.0.0.1 <- GET /api/test 25.5ms
2025-11-09 15:43:10,415 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 15:43:10,415 - app.main - INFO - 127.0.0.1 <- GET /docs 0.8ms
2025-11-09 15:43:10,509 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 15:43:10,580 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 70.9ms
2025-11-09 15:43:18,952 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 15:43:18,953 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.6ms
2025-11-09 15:43:28,956 - app.main - INFO - 127.0.0.1 -> GET /drivers
2025-11-09 15:43:28,960 - app.main - INFO - 127.0.0.1 <- GET /drivers 3.7ms
2025-11-09 15:43:33,229 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:43:33,257 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 15:43:33,259 - app.main - INFO - 127.0.0.1 <- GET /api/test 29.8ms
2025-11-09 15:51:16,321 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:51:16,335 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 15:51:16,336 - app.main - INFO - 127.0.0.1 <- GET /api/test 15.0ms
2025-11-09 15:51:17,456 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 15:51:17,468 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 15:51:17,470 - app.main - INFO - 127.0.0.1 <- GET /api/test 13.5ms
2025-11-09 17:21:17,428 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 17:21:17,432 - app.main - INFO - 127.0.0.1 <- GET /docs 4.6ms
2025-11-09 17:21:17,555 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 17:21:17,562 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 7.0ms
2025-11-09 17:21:25,128 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 17:21:25,146 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 17:21:25,150 - app.main - INFO - 127.0.0.1 <- GET /api/test 22.0ms
2025-11-09 17:22:04,273 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 17:22:04,274 - app.main - INFO - 127.0.0.1 <- GET /docs 0.8ms
2025-11-09 17:22:04,366 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 17:22:04,447 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 81.4ms
2025-11-09 17:22:09,876 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 17:22:09,877 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.7ms
2025-11-09 17:22:17,174 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 17:22:17,205 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 17:22:17,207 - app.main - INFO - 127.0.0.1 <- GET /api/test 33.1ms
2025-11-09 18:13:38,573 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 18:13:38,574 - app.main - INFO - 127.0.0.1 <- GET /docs 1.1ms
2025-11-09 18:13:38,707 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 18:13:38,792 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 84.1ms
2025-11-09 18:13:44,735 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 18:13:44,838 - app.main - INFO - 127.0.0.1 <- GET /api/test 103.2ms
2025-11-09 21:20:43,317 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 21:20:43,318 - app.main - INFO - 127.0.0.1 <- GET /docs 0.7ms
2025-11-09 21:20:43,411 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 21:20:43,465 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 54.3ms
2025-11-09 21:20:47,079 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 21:20:47,103 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 21:20:47,124 - app.main - INFO - 127.0.0.1 <- GET /api/test 44.2ms
2025-11-09 21:23:08,419 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 21:23:08,419 - app.main - INFO - 127.0.0.1 <- GET /docs 0.5ms
2025-11-09 21:23:08,510 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 21:23:08,511 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 1.7ms
2025-11-09 21:23:12,562 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 21:23:12,573 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 21:23:12,574 - app.main - INFO - 127.0.0.1 <- GET /api/test 11.6ms
2025-11-09 21:25:35,202 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 21:25:35,203 - app.main - INFO - 127.0.0.1 <- GET /docs 1.0ms
2025-11-09 21:25:35,289 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 21:25:35,346 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 57.1ms
2025-11-09 21:25:39,018 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 21:25:39,039 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 21:25:39,041 - app.main - INFO - 127.0.0.1 <- GET /api/test 23.3ms
2025-11-09 21:26:45,869 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 21:26:45,870 - app.main - INFO - 127.0.0.1 <- GET /docs 0.9ms
2025-11-09 21:26:45,943 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 21:26:46,000 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 56.2ms
2025-11-09 21:26:49,299 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 21:26:49,320 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 21:26:49,322 - app.main - INFO - 127.0.0.1 <- GET /api/test 23.2ms
2025-11-09 21:28:41,351 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 21:28:41,351 - app.main - INFO - 127.0.0.1 <- GET /docs 0.6ms
2025-11-09 21:28:41,430 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 21:28:41,488 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 58.1ms
2025-11-09 21:28:45,194 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 21:28:45,219 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 21:28:45,221 - app.main - INFO - 127.0.0.1 <- GET /api/test 26.4ms
2025-11-09 21:29:11,490 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 21:29:11,491 - app.main - INFO - 127.0.0.1 <- GET /docs 0.9ms
2025-11-09 21:29:11,572 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 21:29:11,632 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 59.5ms
2025-11-09 21:29:14,810 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 21:29:14,832 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 21:29:14,834 - app.main - INFO - 127.0.0.1 <- GET /api/test 23.3ms
2025-11-09 21:31:28,674 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 21:31:28,674 - app.main - INFO - 127.0.0.1 <- GET /docs 0.6ms
2025-11-09 21:31:28,745 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 21:31:28,802 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 57.2ms
2025-11-09 21:31:31,798 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 21:31:31,819 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 21:31:31,821 - app.main - INFO - 127.0.0.1 <- GET /api/test 23.2ms
2025-11-09 21:38:28,209 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 21:38:28,209 - app.main - INFO - 127.0.0.1 <- GET /docs 0.5ms
2025-11-09 21:38:28,301 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 21:38:28,303 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 2.0ms
2025-11-09 21:38:33,910 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 21:38:33,919 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('28000', "[28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456) (SQLDriverConnect); [28000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Login failed for user 'soporte'. (18456)")
2025-11-09 21:38:33,920 - app.main - INFO - 127.0.0.1 <- GET /api/test 10.4ms
2025-11-09 21:54:03,671 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-09 21:54:03,671 - app.main - INFO - 127.0.0.1 <- GET /docs 0.7ms
2025-11-09 21:54:03,768 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-09 21:54:03,826 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 57.9ms
2025-11-09 21:54:06,731 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 21:54:06,765 - app.main - INFO - 127.0.0.1 <- GET /api/test 34.8ms
2025-11-09 21:54:19,965 - app.main - INFO - 127.0.0.1 -> GET /drivers
2025-11-09 21:54:19,970 - app.main - INFO - 127.0.0.1 <- GET /drivers 4.5ms
2025-11-09 21:54:27,631 - app.main - INFO - 127.0.0.1 -> GET /debug-env
2025-11-09 21:54:27,631 - app.main - INFO - 127.0.0.1 <- GET /debug-env 0.8ms
2025-11-09 21:54:33,531 - app.main - INFO - 127.0.0.1 -> GET /drivers
2025-11-09 21:54:33,534 - app.main - INFO - 127.0.0.1 <- GET /drivers 3.1ms
2025-11-09 21:54:35,816 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-09 21:54:35,817 - app.main - INFO - 127.0.0.1 <- GET /api/test 1.3ms
2025-11-11 10:16:39,995 - app.main - INFO - 127.0.0.1 -> GET /docs
2025-11-11 10:16:39,996 - app.main - INFO - 127.0.0.1 <- GET /docs 1.0ms
2025-11-11 10:16:40,079 - app.main - INFO - 127.0.0.1 -> GET /openapi.json
2025-11-11 10:16:40,139 - app.main - INFO - 127.0.0.1 <- GET /openapi.json 60.0ms
2025-11-11 10:16:44,249 - app.main - INFO - 127.0.0.1 -> GET /api/test
2025-11-11 10:16:44,365 - app.main - INFO - 127.0.0.1 <- GET /api/test 115.9ms
2025-11-11 10:59:27,079 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-11 10:59:27,080 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs N/A 0.8ms
2025-11-11 10:59:27,081 - app.core.exceptions - ERROR - Error no manejado: cannot access local variable 'client_data' where it is not associated with a value
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 78, in dispatch
    |     codigo_cliente=client_data.get('codigo_cliente') if client_data else settings.SUPERADMIN_CLIENTE_CODIGO
    |                                                         ^^^^^^^^^^^
    | UnboundLocalError: cannot access local variable 'client_data' where it is not associated with a value
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 78, in dispatch
    codigo_cliente=client_data.get('codigo_cliente') if client_data else settings.SUPERADMIN_CLIENTE_CODIGO
                                                        ^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'client_data' where it is not associated with a value
2025-11-11 10:59:27,270 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-11 10:59:27,271 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico N/A 0.4ms
2025-11-11 10:59:27,271 - app.core.exceptions - ERROR - Error no manejado: cannot access local variable 'client_data' where it is not associated with a value
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 78, in dispatch
    |     codigo_cliente=client_data.get('codigo_cliente') if client_data else settings.SUPERADMIN_CLIENTE_CODIGO
    |                                                         ^^^^^^^^^^^
    | UnboundLocalError: cannot access local variable 'client_data' where it is not associated with a value
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 78, in dispatch
    codigo_cliente=client_data.get('codigo_cliente') if client_data else settings.SUPERADMIN_CLIENTE_CODIGO
                                                        ^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'client_data' where it is not associated with a value
2025-11-11 10:59:49,912 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-11 10:59:49,913 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs N/A 0.6ms
2025-11-11 10:59:49,913 - app.core.exceptions - ERROR - Error no manejado: cannot access local variable 'client_data' where it is not associated with a value
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 78, in dispatch
    |     codigo_cliente=client_data.get('codigo_cliente') if client_data else settings.SUPERADMIN_CLIENTE_CODIGO
    |                                                         ^^^^^^^^^^^
    | UnboundLocalError: cannot access local variable 'client_data' where it is not associated with a value
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 78, in dispatch
    codigo_cliente=client_data.get('codigo_cliente') if client_data else settings.SUPERADMIN_CLIENTE_CODIGO
                                                        ^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'client_data' where it is not associated with a value
2025-11-11 10:59:49,944 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-11 10:59:49,944 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico N/A 0.6ms
2025-11-11 10:59:49,945 - app.core.exceptions - ERROR - Error no manejado: cannot access local variable 'client_data' where it is not associated with a value
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 78, in dispatch
    |     codigo_cliente=client_data.get('codigo_cliente') if client_data else settings.SUPERADMIN_CLIENTE_CODIGO
    |                                                         ^^^^^^^^^^^
    | UnboundLocalError: cannot access local variable 'client_data' where it is not associated with a value
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 78, in dispatch
    codigo_cliente=client_data.get('codigo_cliente') if client_data else settings.SUPERADMIN_CLIENTE_CODIGO
                                                        ^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'client_data' where it is not associated with a value
2025-11-11 11:01:52,965 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-11 11:01:52,966 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.9ms
2025-11-11 11:01:53,030 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-11 11:01:53,089 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 58.9ms
2025-11-11 11:02:01,040 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /health
2025-11-11 11:02:01,077 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /health 200 37.8ms
2025-11-11 11:03:14,992 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/test
2025-11-11 11:03:14,993 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/test 200 1.5ms
2025-11-11 11:03:52,774 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /debug-env
2025-11-11 11:03:52,775 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /debug-env 200 0.7ms
2025-11-11 11:33:28,716 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-11 11:33:28,717 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.8ms
2025-11-11 11:33:28,799 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-11 11:33:28,855 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 56.4ms
2025-11-11 11:33:34,741 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /health
2025-11-11 11:33:34,769 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /health 200 27.3ms
2025-11-11 11:33:39,939 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/test
2025-11-11 11:33:39,940 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/test 200 1.5ms
2025-11-11 11:33:47,634 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /debug-env
2025-11-11 11:33:47,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /debug-env 200 0.7ms
2025-11-11 15:37:24,813 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-11 15:37:24,814 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.7ms
2025-11-11 15:37:24,897 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-11 15:37:24,957 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 60.0ms
2025-11-11 15:37:31,605 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/test
2025-11-11 15:37:31,676 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/test 200 71.3ms
2025-11-11 15:46:35,797 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 15:46:35,828 - app.api.v1.endpoints.auth - ERROR - Error inesperado en /login/ para usuario superadmin: 'ClienteRead' object is not subscriptable
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 158, in login
    if not cliente or not cliente['es_activo']:
                          ~~~~~~~^^^^^^^^^^^^^
TypeError: 'ClienteRead' object is not subscriptable
2025-11-11 15:46:35,829 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 500 31.9ms
2025-11-11 16:23:39,133 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-11 16:23:39,135 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.3ms
2025-11-11 16:23:39,252 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-11 16:23:39,337 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 84.9ms
2025-11-11 16:24:33,856 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 16:24:33,966 - app.api.v1.endpoints.auth - ERROR - Error inesperado en /login/ para usuario superadmin: 'ClienteRead' object has no attribute 'es_activo'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 158, in login
    if not cliente or not cliente.es_activo:
                          ^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 892, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'ClienteRead' object has no attribute 'es_activo'
2025-11-11 16:24:33,999 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 500 143.6ms
2025-11-11 17:08:14,510 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 17:08:14,596 - app.services.base_service - ERROR - ERROR INESPERADO en obtener_cliente_por_id: 1 validation error for ClienteRead
contacto_email
  value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email. [type=value_error, input_value='admin@sistema.local', input_type=str]
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 174, in obtener_cliente_por_id
    return ClienteRead(**resultado[0])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for ClienteRead
contacto_email
  value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email. [type=value_error, input_value='admin@sistema.local', input_type=str]
2025-11-11 17:08:14,598 - app.api.v1.endpoints.auth - ERROR - Error inesperado en /login/ para usuario superadmin: Error interno del servidor en obtener_cliente_por_id
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 174, in obtener_cliente_por_id
    return ClienteRead(**resultado[0])
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for ClienteRead
contacto_email
  value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email. [type=value_error, input_value='admin@sistema.local', input_type=str]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 157, in login
    cliente = await ClienteService.obtener_cliente_por_id(cliente_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 53, in wrapper
    raise ServiceError(
    ...<3 lines>...
    )
app.core.exceptions.ServiceError: Error interno del servidor en obtener_cliente_por_id
2025-11-11 17:08:14,600 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 500 90.2ms
2025-11-11 17:51:18,483 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 17:51:18,544 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 17:51:18,820 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 337.9ms
2025-11-11 18:40:30,036 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 18:40:30,099 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 18:40:30,349 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 312.7ms
2025-11-11 18:57:13,364 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 18:57:13,391 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 18:57:13,617 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 253.1ms
2025-11-11 18:57:36,695 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /.well-known/appspecific/com.chrome.devtools.json
2025-11-11 18:57:36,696 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /.well-known/appspecific/com.chrome.devtools.json 404 0.9ms
2025-11-11 18:58:41,042 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 18:58:41,066 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 18:58:41,299 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 256.7ms
2025-11-11 20:12:13,978 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 20:12:14,002 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 20:12:14,223 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 245.4ms
2025-11-11 20:57:08,158 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 20:57:08,252 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 20:57:08,253 - app.core.auth - INFO - Iniciando autenticación: cliente_id=1, username=superadmin
2025-11-11 20:57:08,485 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 327.3ms
2025-11-11 20:57:36,421 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 20:57:36,453 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 20:57:36,453 - app.core.auth - INFO - Iniciando autenticación: cliente_id=1, username=superadmin
2025-11-11 20:57:36,848 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 427.2ms
2025-11-11 20:58:17,557 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 20:58:17,605 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 20:58:17,606 - app.core.auth - INFO - Iniciando autenticación: cliente_id=1, username=superadmin
2025-11-11 20:58:17,856 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 298.9ms
2025-11-11 20:58:32,995 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 20:58:33,032 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 20:58:33,032 - app.core.auth - INFO - Iniciando autenticación: cliente_id=1, username=superadmin
2025-11-11 20:58:33,292 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 297.2ms
2025-11-11 20:59:31,398 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 20:59:31,446 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 20:59:31,446 - app.core.auth - INFO - Iniciando autenticación: cliente_id=1, username=superadmin
2025-11-11 20:59:31,692 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 293.9ms
2025-11-11 21:05:47,393 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 21:05:47,451 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 21:05:47,451 - app.core.auth - INFO - Iniciando autenticación: cliente_id=1, username=superadmin
2025-11-11 21:05:47,704 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 311.9ms
2025-11-11 21:06:07,490 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 21:06:07,537 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 21:06:07,538 - app.core.auth - INFO - Iniciando autenticación: cliente_id=1, username=superadmin
2025-11-11 21:06:07,540 - app.core.auth - INFO - Usuario encontrado: 1, cliente_id=1
2025-11-11 21:06:07,540 - app.core.auth - INFO - Contraseña en BD: $2b$12$LQv3c1yqBWVHx...
2025-11-11 21:06:07,770 - app.core.auth - WARNING - Contraseña INCORRECTA para usuario superadmin
2025-11-11 21:06:07,771 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 281.0ms
2025-11-11 22:22:55,812 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 22:22:55,916 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 22:22:55,919 - app.core.auth - INFO - [DEBUG AUTH] Usuario encontrado. ID: 1, cliente_id: 1
2025-11-11 22:22:55,919 - app.core.auth - INFO - [DEBUG AUTH] Contraseña en BD (HASH): $2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5koiyUGfAGQYi
2025-11-11 22:22:55,919 - app.core.auth - INFO - [DEBUG AUTH] Contraseña proporcionada (PLANO): Admin@2025
2025-11-11 22:22:56,147 - app.core.auth - WARNING - [DEBUG AUTH] verify_password devolvió FALSE para el usuario superadmin
2025-11-11 22:22:56,147 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 335.6ms
2025-11-11 22:37:44,463 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 22:37:44,509 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 22:37:44,511 - app.core.auth - INFO - [DEBUG AUTH] Usuario encontrado. ID: 1, cliente_id: 1
2025-11-11 22:37:44,511 - app.core.auth - INFO - [DEBUG AUTH] Contraseña en BD (HASH): $2b$12$CJrVD8JhQlIeZZyp64CZCubM1.vBF2V0ZyRJg2C3bcS7A8/mhi5xm
2025-11-11 22:37:44,511 - app.core.auth - INFO - [DEBUG AUTH] Contraseña proporcionada (PLANO): Admin@2025
2025-11-11 22:37:44,769 - app.db.queries - ERROR - Error en execute_insert: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:37:44,769 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:37:44,794 - app.services.base_service - ERROR - DatabaseError en store_refresh_token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 90, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:37:44,827 - app.api.v1.endpoints.auth - ERROR - Error almacenando refresh token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:37:44,827 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-11 22:37:44,848 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ N/A 385.6ms
2025-11-11 22:37:44,849 - app.core.exceptions - ERROR - Error no manejado: 1 validation errors:
  {'type': 'value_error', 'loc': ('response', 'user_data', 'correo'), 'msg': 'value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email.', 'input': 'admin@sistema.local', 'ctx': {'reason': 'The part after the @-sign is a special-use or reserved name that cannot be used with email.'}}
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 90, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |         errors=_normalize_errors(errors), body=response_content
    |     )
    | fastapi.exceptions.ResponseValidationError: 1 validation errors:
    |   {'type': 'value_error', 'loc': ('response', 'user_data', 'correo'), 'msg': 'value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email.', 'input': 'admin@sistema.local', 'ctx': {'reason': 'The part after the @-sign is a special-use or reserved name that cannot be used with email.'}}
    | 
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 90, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'value_error', 'loc': ('response', 'user_data', 'correo'), 'msg': 'value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email.', 'input': 'admin@sistema.local', 'ctx': {'reason': 'The part after the @-sign is a special-use or reserved name that cannot be used with email.'}}

2025-11-11 22:38:35,369 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-11 22:38:35,370 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.8ms
2025-11-11 22:38:35,487 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-11 22:38:35,557 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 69.8ms
2025-11-11 22:38:44,191 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 22:38:44,254 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 22:38:44,257 - app.core.auth - INFO - [DEBUG AUTH] Usuario encontrado. ID: 1, cliente_id: 1
2025-11-11 22:38:44,257 - app.core.auth - INFO - [DEBUG AUTH] Contraseña en BD (HASH): $2b$12$CJrVD8JhQlIeZZyp64CZCubM1.vBF2V0ZyRJg2C3bcS7A8/mhi5xm
2025-11-11 22:38:44,257 - app.core.auth - INFO - [DEBUG AUTH] Contraseña proporcionada (PLANO): Admin@2025
2025-11-11 22:38:44,500 - app.db.queries - ERROR - Error en execute_insert: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:38:44,500 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:38:44,502 - app.services.base_service - ERROR - DatabaseError en store_refresh_token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 90, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:38:44,503 - app.api.v1.endpoints.auth - ERROR - Error almacenando refresh token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:38:44,503 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-11 22:38:44,507 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ N/A 316.8ms
2025-11-11 22:38:44,508 - app.core.exceptions - ERROR - Error no manejado: 1 validation errors:
  {'type': 'value_error', 'loc': ('response', 'user_data', 'correo'), 'msg': 'value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email.', 'input': 'admin@sistema.local', 'ctx': {'reason': 'The part after the @-sign is a special-use or reserved name that cannot be used with email.'}}
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 90, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |         errors=_normalize_errors(errors), body=response_content
    |     )
    | fastapi.exceptions.ResponseValidationError: 1 validation errors:
    |   {'type': 'value_error', 'loc': ('response', 'user_data', 'correo'), 'msg': 'value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email.', 'input': 'admin@sistema.local', 'ctx': {'reason': 'The part after the @-sign is a special-use or reserved name that cannot be used with email.'}}
    | 
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 90, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'value_error', 'loc': ('response', 'user_data', 'correo'), 'msg': 'value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email.', 'input': 'admin@sistema.local', 'ctx': {'reason': 'The part after the @-sign is a special-use or reserved name that cannot be used with email.'}}

2025-11-11 22:55:26,708 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 22:55:26,757 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 22:55:26,759 - app.core.auth - INFO - [DEBUG AUTH] Usuario encontrado. ID: 1, cliente_id: 1
2025-11-11 22:55:26,759 - app.core.auth - INFO - [DEBUG AUTH] Contraseña en BD (HASH): $2b$12$CJrVD8JhQlIeZZyp64CZCubM1.vBF2V0ZyRJg2C3bcS7A8/mhi5xm
2025-11-11 22:55:26,759 - app.core.auth - INFO - [DEBUG AUTH] Contraseña proporcionada (PLANO): Admin@2025
2025-11-11 22:55:26,998 - app.db.queries - ERROR - Error en execute_insert: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:55:26,999 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:55:27,000 - app.services.base_service - ERROR - DatabaseError en store_refresh_token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 90, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:55:27,002 - app.api.v1.endpoints.auth - ERROR - Error almacenando refresh token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:55:27,002 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-11 22:55:27,006 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ N/A 298.6ms
2025-11-11 22:55:27,007 - app.core.exceptions - ERROR - Error no manejado: 1 validation errors:
  {'type': 'value_error', 'loc': ('response', 'user_data', 'correo'), 'msg': 'value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email.', 'input': 'admin@sistema.local', 'ctx': {'reason': 'The part after the @-sign is a special-use or reserved name that cannot be used with email.'}}
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 90, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |         errors=_normalize_errors(errors), body=response_content
    |     )
    | fastapi.exceptions.ResponseValidationError: 1 validation errors:
    |   {'type': 'value_error', 'loc': ('response', 'user_data', 'correo'), 'msg': 'value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email.', 'input': 'admin@sistema.local', 'ctx': {'reason': 'The part after the @-sign is a special-use or reserved name that cannot be used with email.'}}
    | 
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 90, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'value_error', 'loc': ('response', 'user_data', 'correo'), 'msg': 'value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email.', 'input': 'admin@sistema.local', 'ctx': {'reason': 'The part after the @-sign is a special-use or reserved name that cannot be used with email.'}}

2025-11-11 22:56:42,714 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-11 22:56:42,715 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.9ms
2025-11-11 22:56:42,808 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-11 22:56:42,875 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 66.6ms
2025-11-11 22:57:22,332 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 22:57:22,377 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 22:57:22,379 - app.core.auth - INFO - [DEBUG AUTH] Usuario encontrado. ID: 1, cliente_id: 1
2025-11-11 22:57:22,380 - app.core.auth - INFO - [DEBUG AUTH] Contraseña en BD (HASH): $2b$12$CJrVD8JhQlIeZZyp64CZCubM1.vBF2V0ZyRJg2C3bcS7A8/mhi5xm
2025-11-11 22:57:22,380 - app.core.auth - INFO - [DEBUG AUTH] Contraseña proporcionada (PLANO): Admin@2025
2025-11-11 22:57:22,618 - app.db.queries - ERROR - Error en execute_insert: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:57:22,618 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:57:22,620 - app.services.base_service - ERROR - DatabaseError en store_refresh_token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 90, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:57:22,621 - app.api.v1.endpoints.auth - ERROR - Error almacenando refresh token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 22:57:22,621 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-11 22:57:22,626 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ N/A 294.4ms
2025-11-11 22:57:22,626 - app.core.exceptions - ERROR - Error no manejado: 1 validation errors:
  {'type': 'value_error', 'loc': ('response', 'user_data', 'correo'), 'msg': 'value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email.', 'input': 'admin@sistema.local', 'ctx': {'reason': 'The part after the @-sign is a special-use or reserved name that cannot be used with email.'}}
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 90, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |         errors=_normalize_errors(errors), body=response_content
    |     )
    | fastapi.exceptions.ResponseValidationError: 1 validation errors:
    |   {'type': 'value_error', 'loc': ('response', 'user_data', 'correo'), 'msg': 'value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email.', 'input': 'admin@sistema.local', 'ctx': {'reason': 'The part after the @-sign is a special-use or reserved name that cannot be used with email.'}}
    | 
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 78, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 69, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 90, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'value_error', 'loc': ('response', 'user_data', 'correo'), 'msg': 'value is not a valid email address: The part after the @-sign is a special-use or reserved name that cannot be used with email.', 'input': 'admin@sistema.local', 'ctx': {'reason': 'The part after the @-sign is a special-use or reserved name that cannot be used with email.'}}

2025-11-11 23:06:07,029 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-11 23:06:07,079 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-11 23:06:07,082 - app.core.auth - INFO - [DEBUG AUTH] Usuario encontrado. ID: 1, cliente_id: 1
2025-11-11 23:06:07,082 - app.core.auth - INFO - [DEBUG AUTH] Contraseña en BD (HASH): $2b$12$CJrVD8JhQlIeZZyp64CZCubM1.vBF2V0ZyRJg2C3bcS7A8/mhi5xm
2025-11-11 23:06:07,082 - app.core.auth - INFO - [DEBUG AUTH] Contraseña proporcionada (PLANO): Admin@2025
2025-11-11 23:06:07,323 - app.db.queries - ERROR - Error en execute_insert: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 23:06:07,323 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 23:06:07,325 - app.services.base_service - ERROR - DatabaseError en store_refresh_token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 90, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 23:06:07,326 - app.api.v1.endpoints.auth - ERROR - Error almacenando refresh token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-11 23:06:07,326 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-11 23:06:07,327 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 297.9ms
2025-11-12 01:08:10,487 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 01:08:10,488 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.9ms
2025-11-12 01:08:10,573 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 01:08:10,635 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 61.5ms
2025-11-12 01:08:50,884 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 01:08:50,983 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 01:08:50,987 - app.core.auth - INFO - [DEBUG AUTH] Usuario encontrado. ID: 1, cliente_id: 1
2025-11-12 01:08:50,987 - app.core.auth - INFO - [DEBUG AUTH] Contraseña en BD (HASH): $2b$12$CJrVD8JhQlIeZZyp64CZCubM1.vBF2V0ZyRJg2C3bcS7A8/mhi5xm
2025-11-12 01:08:50,987 - app.core.auth - INFO - [DEBUG AUTH] Contraseña proporcionada (PLANO): Admin@2025
2025-11-12 01:08:51,237 - app.db.queries - ERROR - Error en execute_insert: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-12 01:08:51,237 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-12 01:08:51,238 - app.services.base_service - ERROR - DatabaseError en store_refresh_token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 90, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-12 01:08:51,240 - app.api.v1.endpoints.auth - ERROR - Error almacenando refresh token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-12 01:08:51,240 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 01:08:51,241 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 357.1ms
2025-11-12 01:40:58,748 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 01:40:58,749 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.2ms
2025-11-12 01:40:58,843 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 01:40:58,911 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 68.4ms
2025-11-12 01:41:05,556 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 01:41:05,652 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 01:41:05,657 - app.core.auth - INFO - [DEBUG AUTH] Usuario encontrado. ID: 1, cliente_id: 1
2025-11-12 01:41:05,657 - app.core.auth - INFO - [DEBUG AUTH] Contraseña en BD (HASH): $2b$12$CJrVD8JhQlIeZZyp64CZCubM1.vBF2V0ZyRJg2C3bcS7A8/mhi5xm
2025-11-12 01:41:05,657 - app.core.auth - INFO - [DEBUG AUTH] Contraseña proporcionada (PLANO): Admin@2025
2025-11-12 01:41:05,922 - app.db.queries - ERROR - Error en execute_insert: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 01:41:05,923 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 01:41:05,925 - app.services.base_service - ERROR - DatabaseError en store_refresh_token: Error en la inserción: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 90, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 01:41:05,926 - app.api.v1.endpoints.auth - ERROR - Error almacenando refresh token: Error en la inserción: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 01:41:05,926 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 01:41:05,927 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 370.9ms
2025-11-12 01:45:05,473 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 01:45:05,473 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.7ms
2025-11-12 01:45:05,577 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 01:45:05,648 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 70.3ms
2025-11-12 01:45:11,720 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 01:45:11,773 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 01:45:11,776 - app.core.auth - INFO - [DEBUG AUTH] Usuario encontrado. ID: 1, cliente_id: 1
2025-11-12 01:45:11,776 - app.core.auth - INFO - [DEBUG AUTH] Contraseña en BD (HASH): $2b$12$CJrVD8JhQlIeZZyp64CZCubM1.vBF2V0ZyRJg2C3bcS7A8/mhi5xm
2025-11-12 01:45:11,776 - app.core.auth - INFO - [DEBUG AUTH] Contraseña proporcionada (PLANO): Admin@2025
2025-11-12 01:45:12,032 - app.db.queries - ERROR - Error en execute_insert: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')
2025-11-12 01:45:12,032 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.DataError: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')
2025-11-12 01:45:12,034 - app.services.base_service - ERROR - DatabaseError en store_refresh_token: Error en la inserción: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.DataError: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 90, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')
2025-11-12 01:45:12,036 - app.api.v1.endpoints.auth - ERROR - Error almacenando refresh token: Error en la inserción: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')
2025-11-12 01:45:12,036 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 01:45:12,037 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 317.0ms
2025-11-12 01:45:49,262 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 01:45:49,309 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 01:45:49,312 - app.core.auth - INFO - [DEBUG AUTH] Usuario encontrado. ID: 1, cliente_id: 1
2025-11-12 01:45:49,312 - app.core.auth - INFO - [DEBUG AUTH] Contraseña en BD (HASH): $2b$12$CJrVD8JhQlIeZZyp64CZCubM1.vBF2V0ZyRJg2C3bcS7A8/mhi5xm
2025-11-12 01:45:49,312 - app.core.auth - INFO - [DEBUG AUTH] Contraseña proporcionada (PLANO): Admin@2025
2025-11-12 01:45:49,547 - app.db.queries - ERROR - Error en execute_insert: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-12 01:45:49,547 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-12 01:45:49,560 - app.services.base_service - ERROR - DatabaseError en store_refresh_token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 90, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-12 01:45:49,562 - app.api.v1.endpoints.auth - ERROR - Error almacenando refresh token: Error en la inserción: ('The SQL contains 6 parameter markers, but 7 parameters were supplied', 'HY000')
2025-11-12 01:45:49,562 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 01:45:49,562 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 300.5ms
2025-11-12 01:46:02,569 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 01:46:02,601 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 01:46:02,602 - app.core.auth - INFO - [DEBUG AUTH] Usuario encontrado. ID: 1, cliente_id: 1
2025-11-12 01:46:02,602 - app.core.auth - INFO - [DEBUG AUTH] Contraseña en BD (HASH): $2b$12$CJrVD8JhQlIeZZyp64CZCubM1.vBF2V0ZyRJg2C3bcS7A8/mhi5xm
2025-11-12 01:46:02,602 - app.core.auth - INFO - [DEBUG AUTH] Contraseña proporcionada (PLANO): Admin@2025
2025-11-12 01:46:02,840 - app.db.queries - ERROR - Error en execute_insert: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')
2025-11-12 01:46:02,840 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.DataError: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')
2025-11-12 01:46:02,842 - app.services.base_service - ERROR - DatabaseError en store_refresh_token: Error en la inserción: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.DataError: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 90, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')
2025-11-12 01:46:02,843 - app.api.v1.endpoints.auth - ERROR - Error almacenando refresh token: Error en la inserción: ('22007', '[22007] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Conversion failed when converting date and/or time from character string. (241) (SQLExecDirectW)')
2025-11-12 01:46:02,844 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 01:46:02,844 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 275.8ms
2025-11-12 01:55:49,086 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 01:55:49,134 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 01:55:49,137 - app.core.auth - INFO - [DEBUG AUTH] Usuario encontrado. ID: 1, cliente_id: 1
2025-11-12 01:55:49,137 - app.core.auth - INFO - [DEBUG AUTH] Contraseña en BD (HASH): $2b$12$CJrVD8JhQlIeZZyp64CZCubM1.vBF2V0ZyRJg2C3bcS7A8/mhi5xm
2025-11-12 01:55:49,137 - app.core.auth - INFO - [DEBUG AUTH] Contraseña proporcionada (PLANO): Admin@2025
2025-11-12 01:55:49,377 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 01:55:49,378 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 3
2025-11-12 01:55:49,378 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 3
2025-11-12 01:55:49,378 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 01:55:49,378 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 292.1ms
2025-11-12 07:13:15,630 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 07:13:15,741 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 07:13:16,016 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 07:13:16,016 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 4
2025-11-12 07:13:16,016 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 4
2025-11-12 07:13:16,017 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 07:13:16,017 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 387.6ms
2025-11-12 07:13:56,920 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 07:13:56,922 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 422 2.5ms
2025-11-12 07:14:12,655 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 07:14:12,656 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 422 1.2ms
2025-11-12 07:14:34,517 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 07:14:34,518 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 422 1.2ms
2025-11-12 07:14:47,403 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 07:14:47,404 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 422 1.2ms
2025-11-12 07:43:41,746 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 07:43:41,766 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 07:43:41,993 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 07:43:41,994 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 5
2025-11-12 07:43:41,994 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 5
2025-11-12 07:43:41,994 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 07:43:41,995 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 249.4ms
2025-11-12 07:50:44,587 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 07:50:44,661 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 07:50:44,924 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 07:50:44,925 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 6
2025-11-12 07:50:44,925 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 6
2025-11-12 07:50:44,925 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 07:50:44,926 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 338.8ms
2025-11-12 07:51:20,617 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 07:51:20,617 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 401 0.9ms
2025-11-12 08:01:43,531 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 08:01:43,585 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 08:01:43,836 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 08:01:43,836 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 7
2025-11-12 08:01:43,837 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 7
2025-11-12 08:01:43,837 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 08:01:43,838 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 306.3ms
2025-11-12 08:03:37,691 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 08:03:37,693 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 422 1.5ms
2025-11-12 08:11:31,368 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 08:11:31,369 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.0ms
2025-11-12 08:11:31,463 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 08:11:31,528 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 65.5ms
2025-11-12 08:11:50,351 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 08:11:50,352 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.7ms
2025-11-12 08:11:50,419 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 08:11:50,483 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 64.0ms
2025-11-12 08:14:17,787 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 08:14:17,788 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.2ms
2025-11-12 08:14:17,956 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 08:14:18,027 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 70.9ms
2025-11-12 08:16:18,360 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 08:16:18,361 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 401 1.0ms
2025-11-12 08:18:00,804 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 08:18:00,806 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 422 2.4ms
2025-11-12 08:20:54,874 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 08:20:54,875 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 422 1.2ms
2025-11-12 09:42:59,162 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 09:42:59,163 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.8ms
2025-11-12 09:42:59,326 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 09:42:59,391 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 64.9ms
2025-11-12 09:43:24,899 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 09:43:24,900 - app.api.v1.endpoints.auth - ERROR - Error inesperado en /login/ para usuario superadmin: 'LoginData' object has no attribute 'cliente_id'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 154, in login
    cliente_id = await resolve_cliente_id(login_data.cliente_id, login_data.subdominio)
                                          ^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 892, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'LoginData' object has no attribute 'cliente_id'
2025-11-12 09:43:24,930 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 500 31.5ms
2025-11-12 09:58:59,577 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 09:58:59,578 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.7ms
2025-11-12 09:58:59,671 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 09:58:59,736 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 65.3ms
2025-11-12 09:59:21,658 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 09:59:21,705 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 09:59:21,956 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 09:59:21,956 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 8
2025-11-12 09:59:21,956 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 8
2025-11-12 09:59:21,957 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 09:59:21,957 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 299.0ms
2025-11-12 09:59:55,979 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 09:59:55,981 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 422 1.5ms
2025-11-12 10:01:20,667 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 10:01:20,682 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 10:01:20,910 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 10:01:20,911 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 9
2025-11-12 10:01:20,911 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 9
2025-11-12 10:01:20,911 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 10:01:20,912 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 245.0ms
2025-11-12 10:24:22,052 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 10:24:22,053 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.0ms
2025-11-12 10:24:22,715 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 10:24:22,718 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 2.6ms
2025-11-12 10:24:56,054 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 10:24:56,068 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 10:24:56,289 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 10:24:56,289 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 10
2025-11-12 10:24:56,290 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 10
2025-11-12 10:24:56,290 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 10:24:56,290 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 236.2ms
2025-11-12 10:26:03,739 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 10:26:03,744 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 10:26:03,748 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 8.6ms
2025-11-12 10:41:58,654 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 10:41:58,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.9ms
2025-11-12 10:41:58,832 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 10:41:58,834 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 2.4ms
2025-11-12 10:42:32,182 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 10:42:32,204 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 10:42:32,207 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 25.8ms
2025-11-12 10:42:41,939 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 10:42:41,941 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 10:42:42,175 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 10:42:42,175 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 11
2025-11-12 10:42:42,175 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 11
2025-11-12 10:42:42,176 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 10:42:42,176 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 237.0ms
2025-11-12 10:43:27,819 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 10:43:27,824 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 10:43:27,833 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 13.6ms
2025-11-12 10:50:20,658 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 10:50:20,659 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.1ms
2025-11-12 10:50:20,761 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 10:50:20,829 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 68.2ms
2025-11-12 10:50:39,120 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 10:50:39,161 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 10:50:39,161 - app.api.v1.endpoints.auth - ERROR - Error inesperado en /login/ para usuario superadmin: 'Settings' object has no attribute 'SUPERADMIN_USERNAME'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 135, in login
    user_base_data = await authenticate_user(cliente_id, login_data.username, login_data.password)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 97, in authenticate_user
    if username == settings.SUPERADMIN_USERNAME:
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 892, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'Settings' object has no attribute 'SUPERADMIN_USERNAME'
2025-11-12 10:50:39,163 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 500 43.6ms
2025-11-12 10:53:20,263 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 10:53:20,324 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 10:53:20,324 - app.core.auth - INFO - Login de SUPERADMIN. Forzando cliente_id de búsqueda a: 1 (SYSTEM)
2025-11-12 10:53:20,574 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 10:53:20,574 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 12
2025-11-12 10:53:20,574 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 12
2025-11-12 10:53:20,574 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 10:53:20,575 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 311.8ms
2025-11-12 10:53:29,567 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 10:53:29,570 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 10:53:29,571 - app.core.auth - WARNING - Intento de login fallido. User: admin_acme, Cliente ID de búsqueda: 1
2025-11-12 10:53:29,571 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 4.0ms
2025-11-12 10:53:42,065 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 10:53:42,067 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 10:53:42,067 - app.core.auth - INFO - Login de SUPERADMIN. Forzando cliente_id de búsqueda a: 1 (SYSTEM)
2025-11-12 10:53:42,283 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 10:53:42,284 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 13
2025-11-12 10:53:42,284 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 13
2025-11-12 10:53:42,284 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 10:53:42,284 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 219.5ms
2025-11-12 10:53:59,610 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 10:53:59,612 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 10:53:59,613 - app.core.auth - WARNING - Intento de login fallido. User: admin_acme, Cliente ID de búsqueda: 1
2025-11-12 10:53:59,614 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 3.6ms
2025-11-12 10:54:10,400 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 10:54:10,401 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.0ms
2025-11-12 10:54:10,514 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 10:54:10,577 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 63.1ms
2025-11-12 10:54:27,690 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 10:54:27,730 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 10:54:27,733 - app.core.auth - WARNING - Intento de login fallido. User: admin_acme, Cliente ID de búsqueda: 1
2025-11-12 10:54:27,733 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 43.5ms
2025-11-12 11:11:22,832 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:11:22,833 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.9ms
2025-11-12 11:11:22,920 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 11:11:22,922 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 2.0ms
2025-11-12 11:23:43,615 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:23:43,616 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:23:43,616 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 11:23:43,616 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.8ms
2025-11-12 11:23:43,707 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 11:23:43,708 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:23:43,708 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 11:23:43,782 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 75.2ms
2025-11-12 11:24:15,159 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:24:15,159 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:24:15,159 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 11:24:15,202 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 11:24:15,268 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 11:24:15,516 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 11:24:15,527 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 11:24:15,527 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 14
2025-11-12 11:24:15,527 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 14
2025-11-12 11:24:15,528 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 11:24:15,528 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 369.6ms
2025-11-12 11:25:12,134 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:25:12,135 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:25:12,135 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 11:25:12,179 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 11:25:12,179 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 11:25:12,179 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 11:25:12,414 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 11:25:12,425 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 11:25:12,426 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 15
2025-11-12 11:25:12,426 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 15
2025-11-12 11:25:12,426 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 11:25:12,427 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 292.9ms
2025-11-12 11:25:31,710 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:25:31,710 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: cliente1.midominio.com:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:25:31,710 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 11:25:31,711 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 0.9ms
2025-11-12 11:25:31,810 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 11:25:31,811 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: cliente1.midominio.com:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:25:31,811 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 11:25:31,889 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 78.5ms
2025-11-12 11:25:52,207 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:25:52,207 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: cliente1.midominio.com:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:25:52,207 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 11:25:52,210 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 11:25:52,210 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=1
2025-11-12 11:25:52,210 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=1 (del middleware)
2025-11-12 11:25:52,211 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_acme', cliente_id_buscado=1
2025-11-12 11:25:52,212 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 5.1ms
2025-11-12 11:27:33,235 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:27:33,236 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: cliente1.midominio.com:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:27:33,236 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 11:27:33,250 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 11:27:33,250 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 11:27:33,250 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 11:27:33,479 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 11:27:33,486 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 11:27:33,486 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 16
2025-11-12 11:27:33,487 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 16
2025-11-12 11:27:33,487 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 11:27:33,487 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 252.1ms
2025-11-12 11:28:02,182 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:28:02,183 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: cliente1.midominio.com:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:28:02,183 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 11:28:02,185 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 11:28:02,185 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=1
2025-11-12 11:28:02,185 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=1 (del middleware)
2025-11-12 11:28:02,186 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_acme', cliente_id_buscado=1
2025-11-12 11:28:02,187 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 4.7ms
2025-11-12 11:31:02,525 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:31:02,525 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: cliente1.midominio.com:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:31:02,525 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 11:31:02,526 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.0ms
2025-11-12 11:31:02,631 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 11:31:02,631 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: cliente1.midominio.com:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:31:02,631 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 11:31:02,633 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 2.8ms
2025-11-12 11:31:19,760 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:31:19,760 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: cliente1.midominio.com:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:31:19,761 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 11:31:19,774 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 11:31:19,774 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=1
2025-11-12 11:31:19,774 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=1 (del middleware)
2025-11-12 11:31:19,776 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_acme', cliente_id_buscado=1
2025-11-12 11:31:19,777 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 16.9ms
2025-11-12 11:40:08,464 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:40:08,464 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 11:40:08,465 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:40:08,465 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 11:40:08,465 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 11:40:08,465 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:40:08,465 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 11:40:08,466 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.0ms
2025-11-12 11:40:08,598 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 11:40:08,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 11:40:08,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:40:08,599 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 11:40:08,599 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 11:40:08,600 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:40:08,600 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 11:40:08,674 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 75.2ms
2025-11-12 11:40:22,932 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:40:22,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 11:40:22,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:40:22,933 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 11:40:22,934 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 11:40:22,934 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 11:40:22,934 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 11:40:22,975 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 11:40:22,975 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 11:40:22,975 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 11:40:23,215 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 11:40:23,227 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 11:40:23,227 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 17
2025-11-12 11:40:23,227 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 17
2025-11-12 11:40:23,228 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 11:40:23,228 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 296.0ms
2025-11-12 11:40:28,042 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:40:28,042 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 11:40:28,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:40:28,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 11:40:28,043 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:40:28,044 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:40:28,046 - app.middleware.tenant_middleware - ERROR - [DB] Error al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:40:28,047 - app.middleware.tenant_middleware - ERROR - [TENANT] Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 57, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:40:28,049 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 500 7.1ms
2025-11-12 11:40:28,087 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-12 11:40:28,087 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 11:40:28,088 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:40:28,088 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 11:40:28,088 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:40:28,089 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:40:28,090 - app.middleware.tenant_middleware - ERROR - [DB] Error al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:40:28,092 - app.middleware.tenant_middleware - ERROR - [TENANT] Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 57, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:40:28,093 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico 500 6.3ms
2025-11-12 11:40:45,951 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-12 11:40:45,951 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 11:40:45,952 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:40:45,952 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 11:40:45,952 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:40:45,955 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:40:45,956 - app.middleware.tenant_middleware - ERROR - [DB] Error al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:40:45,958 - app.middleware.tenant_middleware - ERROR - [TENANT] Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 57, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:40:45,959 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico 500 8.3ms
2025-11-12 11:40:51,593 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:40:51,594 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 11:40:51,594 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:40:51,594 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 11:40:51,594 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:40:51,595 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:40:51,596 - app.middleware.tenant_middleware - ERROR - [DB] Error al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:40:51,597 - app.middleware.tenant_middleware - ERROR - [TENANT] Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 57, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:40:51,599 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 500 5.8ms
2025-11-12 11:40:51,628 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-12 11:40:51,629 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 11:40:51,629 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:40:51,629 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 11:40:51,629 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:40:51,630 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:40:51,631 - app.middleware.tenant_middleware - ERROR - [DB] Error al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:40:51,632 - app.middleware.tenant_middleware - ERROR - [TENANT] Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 57, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:40:51,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico 500 6.1ms
2025-11-12 11:41:20,723 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:41:20,723 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 11:41:20,724 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:41:20,724 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 11:41:20,724 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:41:20,758 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:41:20,760 - app.middleware.tenant_middleware - ERROR - [DB] Error al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:41:20,761 - app.middleware.tenant_middleware - ERROR - [TENANT] Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 57, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:41:20,762 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 500 39.3ms
2025-11-12 11:41:20,787 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-12 11:41:20,788 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 11:41:20,788 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:41:20,789 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 11:41:20,789 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:41:20,791 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:41:20,792 - app.middleware.tenant_middleware - ERROR - [DB] Error al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:41:20,793 - app.middleware.tenant_middleware - ERROR - [TENANT] Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 57, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:41:20,795 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico 500 7.3ms
2025-11-12 11:42:12,115 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:42:12,115 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:42:12,165 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 177, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:42:12,168 - app.middleware.tenant_middleware - ERROR - [DB] Error al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 177, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 175, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:42:12,171 - app.middleware.tenant_middleware - ERROR - [TENANT] Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 177, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 57, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 175, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:42:12,173 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 500 58.5ms
2025-11-12 11:42:12,210 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-12 11:42:12,212 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:42:12,214 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 177, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:42:12,215 - app.middleware.tenant_middleware - ERROR - [DB] Error al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 177, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 175, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:42:12,217 - app.middleware.tenant_middleware - ERROR - [TENANT] Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 177, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 57, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 175, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:42:12,219 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico 500 8.7ms
2025-11-12 11:43:44,667 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:43:44,668 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 11:43:44,668 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:43:44,668 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 11:43:44,668 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:43:44,706 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:43:44,708 - app.middleware.tenant_middleware - ERROR - [DB] Error al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:43:44,710 - app.middleware.tenant_middleware - ERROR - [TENANT] Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 57, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:43:44,711 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 500 44.3ms
2025-11-12 11:43:44,736 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-12 11:43:44,736 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 11:43:44,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:43:44,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 11:43:44,737 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:43:44,738 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:43:44,739 - app.middleware.tenant_middleware - ERROR - [DB] Error al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:43:44,741 - app.middleware.tenant_middleware - ERROR - [TENANT] Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 57, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 180, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:43:44,743 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico 500 7.0ms
2025-11-12 11:45:49,312 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:45:49,313 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:45:49,350 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 177, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:45:49,375 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 500 63.7ms
2025-11-12 11:45:49,408 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-12 11:45:49,409 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:45:49,410 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 177, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:45:49,422 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico 500 13.4ms
2025-11-12 11:46:33,262 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:46:33,263 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:46:33,265 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 177, in _get_client_data_by_subdomain
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:46:33,277 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 500 15.2ms
2025-11-12 11:46:33,302 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-12 11:46:33,302 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:46:33,304 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 177, in _get_client_data_by_subdomain
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:46:33,316 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico 500 14.0ms
2025-11-12 11:46:49,843 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:46:49,844 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:46:49,884 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 129, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:46:49,886 - app.middleware.tenant_middleware - ERROR - Error de BD al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 129, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 127, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:46:49,888 - app.middleware.tenant_middleware - ERROR - Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 129, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 53, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 127, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:46:49,889 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 500 46.1ms
2025-11-12 11:46:49,912 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-12 11:46:49,912 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:46:49,914 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 129, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:46:49,915 - app.middleware.tenant_middleware - ERROR - Error de BD al buscar cliente por subdominio 'cliente1': DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 129, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 127, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:46:49,917 - app.middleware.tenant_middleware - ERROR - Error al resolver el tenant: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 129, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 53, in dispatch
    client_data_db = self._get_client_data_by_subdomain(subdomain)
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 127, in _get_client_data_by_subdomain
    with get_db_connection() as conn:
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 68, in get_db_connection
    raise DatabaseError(status_code=500, detail=f"Error de conexión: {str(e)}")
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-11-12 11:46:49,919 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico 500 7.0ms
2025-11-12 11:48:50,517 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:48:50,517 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:48:50,566 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 404 49.4ms
2025-11-12 11:48:50,592 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-12 11:48:50,592 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:48:50,600 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico 404 8.3ms
2025-11-12 11:49:51,230 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:49:51,230 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:49:51,239 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 9.0ms
2025-11-12 11:49:51,331 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 11:49:51,331 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:49:51,417 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 86.1ms
2025-11-12 11:50:23,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:50:23,600 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:50:23,615 - app.api.v1.endpoints.auth - INFO - Cliente 6 resuelto y validado para login.
2025-11-12 11:50:23,615 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=6
2025-11-12 11:50:23,615 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 11:50:23,851 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 11:50:23,862 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 11:50:23,863 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 6, Usuario 1 - Cliente: web - Token ID: 18
2025-11-12 11:50:23,863 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 18
2025-11-12 11:50:23,863 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 6
2025-11-12 11:50:23,864 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 264.5ms
2025-11-12 11:50:34,008 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:50:34,008 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:50:34,026 - app.api.v1.endpoints.auth - INFO - Cliente 6 resuelto y validado para login.
2025-11-12 11:50:34,027 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=6
2025-11-12 11:50:34,027 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=6 (del middleware)
2025-11-12 11:50:34,247 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=6, cliente_id=6
2025-11-12 11:50:34,254 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 11:50:34,254 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 6, Usuario 6 - Cliente: web - Token ID: 19
2025-11-12 11:50:34,254 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 19
2025-11-12 11:50:34,255 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 6
2025-11-12 11:50:34,255 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 247.8ms
2025-11-12 11:52:06,879 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:52:06,890 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:52:06,926 - app.db.connection - ERROR - Error de conexión a la base de datos (default): ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 182, in _get_client_data_by_subdomain
    cursor.execute(query, (subdomain,))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'estado_cliente'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 11:52:06,937 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 500 58.1ms
2025-11-12 11:52:24,237 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:52:24,256 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:52:24,288 - app.api.v1.endpoints.auth - INFO - Cliente 6 resuelto y validado para login.
2025-11-12 11:52:24,288 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=6
2025-11-12 11:52:24,288 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=6 (del middleware)
2025-11-12 11:52:24,523 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=6, cliente_id=6
2025-11-12 11:52:24,534 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 11:52:24,535 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 6, Usuario 6 - Cliente: web - Token ID: 20
2025-11-12 11:52:24,535 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 20
2025-11-12 11:52:24,536 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 6
2025-11-12 11:52:24,537 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 299.9ms
2025-11-12 11:53:37,083 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:53:37,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 11:53:37,084 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:53:37,084 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 11:53:37,084 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:53:37,145 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-12 11:53:37,145 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/api/v1/auth/login/
2025-11-12 11:53:37,150 - app.api.v1.endpoints.auth - INFO - Cliente 6 resuelto y validado para login.
2025-11-12 11:53:37,150 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=6
2025-11-12 11:53:37,150 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=6 (del middleware)
2025-11-12 11:53:37,390 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=6, cliente_id=6
2025-11-12 11:53:37,400 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 11:53:37,400 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 6, Usuario 6 - Cliente: web - Token ID: 21
2025-11-12 11:53:37,400 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 21
2025-11-12 11:53:37,400 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 6
2025-11-12 11:53:37,401 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 318.5ms
2025-11-12 11:54:35,308 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 11:54:35,308 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente2.midominio.com'
2025-11-12 11:54:35,308 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:54:35,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente2'
2025-11-12 11:54:35,309 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:54:35,313 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente2', Código='INNOVA002', ID=7
2025-11-12 11:54:35,313 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=7, verificación_contexto=7, path=/docs
2025-11-12 11:54:35,314 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 6.5ms
2025-11-12 11:54:35,404 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 11:54:35,405 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente2.midominio.com'
2025-11-12 11:54:35,405 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:54:35,405 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente2'
2025-11-12 11:54:35,405 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:54:35,406 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente2', Código='INNOVA002', ID=7
2025-11-12 11:54:35,406 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=7, verificación_contexto=7, path=/openapi.json
2025-11-12 11:54:35,479 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 74.9ms
2025-11-12 11:55:21,800 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:55:21,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente2.midominio.com'
2025-11-12 11:55:21,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:55:21,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente2'
2025-11-12 11:55:21,801 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:55:21,805 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente2', Código='INNOVA002', ID=7
2025-11-12 11:55:21,805 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=7, verificación_contexto=7, path=/api/v1/auth/login/
2025-11-12 11:55:21,813 - app.api.v1.endpoints.auth - INFO - Cliente 7 resuelto y validado para login.
2025-11-12 11:55:21,813 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_innova', cliente_id_recibido=7
2025-11-12 11:55:21,813 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=7 (del middleware)
2025-11-12 11:55:22,040 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_innova', usuario_id=7, cliente_id=7
2025-11-12 11:55:22,048 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 11:55:22,048 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 7, Usuario 7 - Cliente: web - Token ID: 22
2025-11-12 11:55:22,049 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 22
2025-11-12 11:55:22,049 - app.api.v1.endpoints.auth - INFO - Usuario admin_innova autenticado exitosamente (WEB) para cliente 7
2025-11-12 11:55:22,049 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 249.4ms
2025-11-12 11:55:37,570 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:55:37,570 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente2.midominio.com'
2025-11-12 11:55:37,571 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:55:37,571 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente2'
2025-11-12 11:55:37,571 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:55:37,572 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente2', Código='INNOVA002', ID=7
2025-11-12 11:55:37,572 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=7, verificación_contexto=7, path=/api/v1/auth/login/
2025-11-12 11:55:37,573 - app.api.v1.endpoints.auth - INFO - Cliente 7 resuelto y validado para login.
2025-11-12 11:55:37,573 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=7
2025-11-12 11:55:37,574 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=7 (del middleware)
2025-11-12 11:55:37,576 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_acme', cliente_id_buscado=7
2025-11-12 11:55:37,576 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 6.2ms
2025-11-12 11:55:58,786 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 11:55:58,787 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 11:55:58,787 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 11:55:58,787 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 11:55:58,787 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 11:55:58,792 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-12 11:55:58,792 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/api/v1/auth/login/
2025-11-12 11:55:58,796 - app.api.v1.endpoints.auth - INFO - Cliente 6 resuelto y validado para login.
2025-11-12 11:55:58,796 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_innova', cliente_id_recibido=6
2025-11-12 11:55:58,796 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=6 (del middleware)
2025-11-12 11:55:58,800 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_innova', cliente_id_buscado=6
2025-11-12 11:55:58,800 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 14.0ms
2025-11-12 12:05:43,160 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 12:05:43,161 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:05:43,161 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:05:43,161 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:05:43,161 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:05:43,161 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:05:43,162 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 12:05:43,162 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.6ms
2025-11-12 12:05:43,234 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 12:05:43,234 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:05:43,234 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:05:43,235 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:05:43,235 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:05:43,235 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:05:43,235 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 12:05:43,237 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 3.4ms
2025-11-12 12:40:25,071 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 12:40:25,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:40:25,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:40:25,072 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:40:25,072 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:40:25,072 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:40:25,072 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 12:40:25,073 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.5ms
2025-11-12 12:40:25,214 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 12:40:25,215 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:40:25,215 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:40:25,215 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:40:25,215 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:40:25,215 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:40:25,216 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 12:40:25,218 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 3.6ms
2025-11-12 12:40:44,313 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 12:40:44,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:40:44,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:40:44,314 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:40:44,314 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:40:44,314 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:40:44,314 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 12:40:44,315 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 401 2.1ms
2025-11-12 12:53:53,149 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 12:53:53,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:53:53,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:53:53,150 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:53:53,150 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:53:53,151 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:53:53,151 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 12:53:53,151 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.1ms
2025-11-12 12:53:53,320 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 12:53:53,321 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:53:53,321 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:53:53,321 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:53:53,321 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:53:53,321 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:53:53,321 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 12:53:53,391 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 70.8ms
2025-11-12 12:54:12,368 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 12:54:12,368 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:54:12,368 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:54:12,368 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:54:12,369 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:54:12,369 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:54:12,369 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 12:54:12,416 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 12:54:12,416 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 12:54:12,416 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 12:54:12,653 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 12:54:12,663 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 12:54:12,664 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 23
2025-11-12 12:54:12,664 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 23
2025-11-12 12:54:12,665 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ N/A 297.0ms
2025-11-12 12:54:12,665 - app.core.exceptions - ERROR - Error no manejado: name 'login_data' is not defined
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 96, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 87, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 116, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 198, in login
    |     logger.exception(f"Error inesperado en /login/ para usuario {login_data.username}: {str(e)}")
    |                                                                  ^^^^^^^^^^
    | NameError: name 'login_data' is not defined. Did you mean: 'LoginData'?
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 96, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 87, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 116, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 198, in login
    logger.exception(f"Error inesperado en /login/ para usuario {login_data.username}: {str(e)}")
                                                                 ^^^^^^^^^^
NameError: name 'login_data' is not defined. Did you mean: 'LoginData'?
2025-11-12 12:54:58,011 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 12:54:58,012 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:54:58,012 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:54:58,012 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:54:58,012 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:54:58,013 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:54:58,013 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 12:54:58,013 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.8ms
2025-11-12 12:54:58,116 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 12:54:58,117 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:54:58,117 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:54:58,117 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:54:58,117 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:54:58,117 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:54:58,117 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 12:54:58,182 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 65.8ms
2025-11-12 12:55:30,375 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 12:55:30,376 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:55:30,376 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:55:30,376 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:55:30,376 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:55:30,376 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:55:30,377 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 12:55:30,417 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 12:55:30,418 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 12:55:30,418 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 12:55:30,652 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 12:55:30,662 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 12:55:30,663 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 24
2025-11-12 12:55:30,663 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 24
2025-11-12 12:55:30,663 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 12:55:30,664 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 288.7ms
2025-11-12 12:55:48,468 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 12:55:48,468 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:55:48,468 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:55:48,469 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:55:48,469 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:55:48,469 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:55:48,469 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 12:55:48,471 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 12:55:48,472 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 12:55:48,472 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 12:55:48,689 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 12:55:48,691 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 12:55:48,692 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 25
2025-11-12 12:55:48,692 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 25
2025-11-12 12:55:48,692 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 12:55:48,693 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 225.3ms
2025-11-12 12:55:57,634 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 12:55:57,634 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 12:55:57,635 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 12:55:57,635 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 12:55:57,635 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 12:55:57,635 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 12:55:57,635 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 12:55:57,642 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 12:55:57,642 - app.services.base_service - ERROR - ERROR INESPERADO en get_user_role_names: UsuarioService.get_user_role_names() missing 1 required positional argument: 'cliente_id'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: UsuarioService.get_user_role_names() missing 1 required positional argument: 'cliente_id'
2025-11-12 12:55:57,644 - app.api.v1.endpoints.auth - ERROR - Error en /me/: Error interno del servidor en get_user_role_names
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: UsuarioService.get_user_role_names() missing 1 required positional argument: 'cliente_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 243, in get_me
    user_role_names = await usuario_service.get_user_role_names(user_id=user_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 53, in wrapper
    raise ServiceError(
    ...<3 lines>...
    )
app.core.exceptions.ServiceError: Error interno del servidor en get_user_role_names
2025-11-12 12:55:57,646 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 500 12.0ms
2025-11-12 13:09:53,481 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 13:09:53,482 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:09:53,482 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:09:53,483 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:09:53,483 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:09:53,483 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:09:53,483 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 13:09:53,491 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 9.6ms
2025-11-12 13:09:53,589 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 13:09:53,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:09:53,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:09:53,590 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:09:53,590 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:09:53,590 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:09:53,591 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 13:09:53,664 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 74.4ms
2025-11-12 13:10:04,549 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 13:10:04,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:10:04,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:10:04,550 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:10:04,550 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:10:04,550 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:10:04,551 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 13:10:04,655 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 13:10:04,655 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 13:10:04,656 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 13:10:04,890 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 13:10:04,904 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 13:10:04,904 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 1017
2025-11-12 13:10:04,904 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1017
2025-11-12 13:10:04,905 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 13:10:04,905 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 356.0ms
2025-11-12 13:10:11,083 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 13:10:11,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:10:11,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:10:11,084 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:10:11,084 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:10:11,084 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:10:11,084 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 13:10:11,088 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 13:10:11,089 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.7ms
2025-11-12 13:10:52,187 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/
2025-11-12 13:10:52,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:10:52,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:10:52,188 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:10:52,188 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:10:52,188 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:10:52,188 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/
2025-11-12 13:10:52,190 - app.api.v1.endpoints.auth - INFO - Solicitud /sessions/ recibida para usuario: superadmin
2025-11-12 13:10:52,190 - app.services.base_service - ERROR - ERROR INESPERADO en get_active_sessions: RefreshTokenService.get_active_sessions() missing 1 required positional argument: 'cliente_id'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.get_active_sessions() missing 1 required positional argument: 'cliente_id'
2025-11-12 13:10:52,214 - app.api.v1.endpoints.auth - ERROR - Error en /sessions/ para superadmin: Error interno del servidor en get_active_sessions
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.get_active_sessions() missing 1 required positional argument: 'cliente_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 510, in get_active_sessions_endpoint
    sessions = await RefreshTokenService.get_active_sessions(usuario_id=user_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 53, in wrapper
    raise ServiceError(
    ...<3 lines>...
    )
app.core.exceptions.ServiceError: Error interno del servidor en get_active_sessions
2025-11-12 13:10:52,216 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/ 500 29.1ms
2025-11-12 13:18:41,626 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 13:18:41,627 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:18:41,627 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:18:41,628 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:18:41,628 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:18:41,628 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:18:41,628 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 13:18:41,628 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.1ms
2025-11-12 13:18:41,701 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 13:18:41,701 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:18:41,701 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:18:41,701 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:18:41,701 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:18:41,702 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:18:41,702 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 13:18:41,770 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 69.7ms
2025-11-12 13:18:52,786 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 13:18:52,786 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:18:52,786 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:18:52,787 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:18:52,787 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:18:52,787 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:18:52,787 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 13:18:52,949 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 13:18:52,949 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 13:18:52,949 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 13:18:53,194 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 13:18:53,209 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 13:18:53,210 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2017
2025-11-12 13:18:53,210 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2017
2025-11-12 13:18:53,210 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 13:18:53,211 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 425.1ms
2025-11-12 13:19:00,132 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 13:19:00,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:19:00,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:19:00,132 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:19:00,132 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:19:00,132 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:19:00,133 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 13:19:00,136 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 13:19:00,137 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 5.8ms
2025-11-12 13:19:08,032 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/
2025-11-12 13:19:08,032 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:19:08,033 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:19:08,033 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:19:08,033 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:19:08,033 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:19:08,033 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/
2025-11-12 13:19:08,035 - app.api.v1.endpoints.auth - INFO - Solicitud /sessions/ recibida para usuario: superadmin
2025-11-12 13:19:08,035 - app.services.base_service - ERROR - ERROR INESPERADO en get_active_sessions: RefreshTokenService.get_active_sessions() missing 1 required positional argument: 'cliente_id'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.get_active_sessions() missing 1 required positional argument: 'cliente_id'
2025-11-12 13:19:08,051 - app.api.v1.endpoints.auth - ERROR - Error en /sessions/ para superadmin: Error interno del servidor en get_active_sessions
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.get_active_sessions() missing 1 required positional argument: 'cliente_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 510, in get_active_sessions_endpoint
    sessions = await RefreshTokenService.get_active_sessions(usuario_id=user_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 53, in wrapper
    raise ServiceError(
    ...<3 lines>...
    )
app.core.exceptions.ServiceError: Error interno del servidor en get_active_sessions
2025-11-12 13:19:08,068 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/ 500 35.7ms
2025-11-12 13:22:55,013 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/
2025-11-12 13:22:55,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:22:55,015 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:22:55,016 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:22:55,017 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:22:55,017 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:22:55,018 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/
2025-11-12 13:22:55,048 - app.api.v1.endpoints.auth - INFO - Solicitud /sessions/ recibida para usuario: superadmin
2025-11-12 13:22:55,055 - app.services.refresh_token_service - INFO - [SESSIONS] Cliente 1, Usuario 1 tiene 20 sesiones activas
2025-11-12 13:22:55,055 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/ 200 42.5ms
2025-11-12 13:23:28,197 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 13:23:28,197 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:23:28,197 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:23:28,197 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:23:28,198 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:23:28,198 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:23:28,198 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 13:23:28,200 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:23:28,201 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:23:28,232 - app.services.base_service - ERROR - DatabaseError en validate_refresh_token: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 151, in validate_refresh_token
    result = execute_query(GET_REFRESH_TOKEN_BY_HASH, (token_hash,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:23:28,234 - app.core.auth - ERROR - Error validando refresh token: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 313, in get_current_user_from_refresh
    db_token_data = await RefreshTokenService.validate_refresh_token(refresh_token)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 151, in validate_refresh_token
    result = execute_query(GET_REFRESH_TOKEN_BY_HASH, (token_hash,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:23:28,263 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 66.8ms
2025-11-12 13:24:16,206 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 13:24:16,206 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:24:16,206 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:24:16,206 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:24:16,207 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:24:16,207 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:24:16,207 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 13:24:16,217 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 13:24:16,217 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 13:24:16,218 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 13:24:16,466 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 13:24:16,468 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 13:24:16,468 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2018
2025-11-12 13:24:16,469 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2018
2025-11-12 13:24:16,469 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 13:24:16,469 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 263.8ms
2025-11-12 13:24:31,022 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 13:24:31,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:24:31,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:24:31,023 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:24:31,023 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:24:31,023 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:24:31,023 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 13:24:31,025 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:24:31,025 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:24:31,026 - app.services.base_service - ERROR - DatabaseError en validate_refresh_token: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 151, in validate_refresh_token
    result = execute_query(GET_REFRESH_TOKEN_BY_HASH, (token_hash,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:24:31,027 - app.core.auth - ERROR - Error validando refresh token: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 313, in get_current_user_from_refresh
    db_token_data = await RefreshTokenService.validate_refresh_token(refresh_token)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 151, in validate_refresh_token
    result = execute_query(GET_REFRESH_TOKEN_BY_HASH, (token_hash,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:24:31,029 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 6.8ms
2025-11-12 13:27:32,392 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 13:27:32,394 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:27:32,394 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:27:32,394 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:27:32,394 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:27:32,394 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:27:32,394 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 13:27:32,426 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:27:32,427 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:27:32,428 - app.services.base_service - ERROR - DatabaseError en validate_refresh_token: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 151, in validate_refresh_token
    result = execute_query(GET_REFRESH_TOKEN_BY_HASH, (token_hash,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:27:32,430 - app.core.auth - ERROR - Error validando refresh token: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 313, in get_current_user_from_refresh
    db_token_data = await RefreshTokenService.validate_refresh_token(refresh_token)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 151, in validate_refresh_token
    result = execute_query(GET_REFRESH_TOKEN_BY_HASH, (token_hash,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:27:32,431 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 39.1ms
2025-11-12 13:46:19,271 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 13:46:19,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:46:19,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:46:19,272 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:46:19,272 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:46:19,272 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:46:19,273 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 13:46:19,303 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 13:46:19,303 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 13:46:19,303 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 13:46:19,534 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 13:46:19,538 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 13:46:19,539 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2019
2025-11-12 13:46:19,539 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2019
2025-11-12 13:46:19,539 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 13:46:19,540 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 268.9ms
2025-11-12 13:46:27,140 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 13:46:27,140 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:46:27,141 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:46:27,141 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:46:27,141 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:46:27,141 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:46:27,141 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 13:46:27,144 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:46:27,144 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:46:27,149 - app.services.base_service - ERROR - DatabaseError en validate_refresh_token: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 151, in validate_refresh_token
    result = execute_query(GET_REFRESH_TOKEN_BY_HASH, (token_hash,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:46:27,153 - app.core.auth - ERROR - Error validando refresh token: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 313, in get_current_user_from_refresh
    db_token_data = await RefreshTokenService.validate_refresh_token(refresh_token)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 151, in validate_refresh_token
    result = execute_query(GET_REFRESH_TOKEN_BY_HASH, (token_hash,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-12 13:46:27,155 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 15.2ms
2025-11-12 13:50:37,109 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 13:50:37,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:50:37,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:50:37,111 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:50:37,112 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:50:37,112 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:50:37,112 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 13:50:37,150 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-12 13:50:37,154 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-12 13:50:37,154 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_token: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'
2025-11-12 13:50:37,155 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error al revocar token antiguo: Error interno del servidor en revoke_token
2025-11-12 13:50:37,156 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: RefreshTokenService.store_refresh_token() missing 1 required positional argument: 'cliente_id'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.store_refresh_token() missing 1 required positional argument: 'cliente_id'
2025-11-12 13:50:37,156 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-11-12 13:50:37,156 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-12 13:50:37,157 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 47.8ms
2025-11-12 13:55:42,780 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 13:55:42,781 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:55:42,782 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:55:42,782 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:55:42,782 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:55:42,782 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:55:42,782 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 13:55:42,814 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-12 13:55:42,814 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-12 13:55:42,815 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 34.5ms
2025-11-12 13:56:14,034 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 13:56:14,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:56:14,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:56:14,035 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:56:14,035 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:56:14,035 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:56:14,036 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 13:56:14,036 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.9ms
2025-11-12 13:56:14,155 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 13:56:14,155 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:56:14,155 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:56:14,156 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:56:14,156 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:56:14,156 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:56:14,156 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 13:56:14,228 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 72.9ms
2025-11-12 13:56:21,226 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 13:56:21,227 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:56:21,227 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:56:21,227 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:56:21,228 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:56:21,228 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:56:21,228 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 13:56:21,230 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-12 13:56:21,230 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-12 13:56:21,231 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.5ms
2025-11-12 13:56:47,726 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 13:56:47,727 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 13:56:47,727 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 13:56:47,727 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 13:56:47,727 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 13:56:47,727 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 13:56:47,728 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 13:56:47,730 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-12 13:56:47,730 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-12 13:56:47,730 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.0ms
2025-11-12 14:59:40,037 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 14:59:40,037 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 14:59:40,037 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 14:59:40,038 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 14:59:40,038 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 14:59:40,038 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 14:59:40,038 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 14:59:40,039 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_token: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'
2025-11-12 14:59:40,040 - app.api.v1.endpoints.auth - ERROR - Error en logout: Error interno del servidor en revoke_token
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 464, in logout
    revoked = await RefreshTokenService.revoke_token(refresh_token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 53, in wrapper
    raise ServiceError(
    ...<3 lines>...
    )
app.core.exceptions.ServiceError: Error interno del servidor en revoke_token
2025-11-12 14:59:40,043 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 500 6.1ms
2025-11-12 15:02:18,326 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 15:02:18,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:02:18,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:02:18,327 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:02:18,327 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:02:18,327 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:02:18,328 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 15:02:18,328 - app.api.v1.endpoints.auth - ERROR - Error en logout: name 'current_user' is not defined
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 465, in logout
    cliente_id=current_user.get("cliente_id"),
               ^^^^^^^^^^^^
NameError: name 'current_user' is not defined. Did you mean: 'get_current_user'?
2025-11-12 15:02:18,330 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 500 3.9ms
2025-11-12 15:03:56,710 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 15:03:56,711 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:03:56,711 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:03:56,712 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:03:56,712 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:03:56,714 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:03:56,714 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 15:03:56,715 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_token: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'
2025-11-12 15:03:56,716 - app.api.v1.endpoints.auth - ERROR - Error en logout: Error interno del servidor en revoke_token
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 464, in logout
    revoked = await RefreshTokenService.revoke_token(refresh_token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 53, in wrapper
    raise ServiceError(
    ...<3 lines>...
    )
app.core.exceptions.ServiceError: Error interno del servidor en revoke_token
2025-11-12 15:03:56,720 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 500 9.4ms
2025-11-12 15:10:21,976 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 15:10:21,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:10:21,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:10:21,977 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:10:21,978 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:10:21,978 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:10:21,978 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 15:10:21,979 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_token: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'
2025-11-12 15:10:21,980 - app.api.v1.endpoints.auth - ERROR - Error en logout: Error interno del servidor en revoke_token
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 464, in logout
    revoked = await RefreshTokenService.revoke_token(refresh_token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 53, in wrapper
    raise ServiceError(
    ...<3 lines>...
    )
app.core.exceptions.ServiceError: Error interno del servidor en revoke_token
2025-11-12 15:10:21,982 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 500 6.2ms
2025-11-12 15:17:13,954 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 15:17:13,955 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:17:13,957 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:17:13,957 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:17:13,957 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:17:13,958 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:17:13,958 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 15:17:13,994 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 15:17:13,994 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 15:17:13,995 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 15:17:14,226 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 15:17:14,230 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 15:17:14,231 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2020
2025-11-12 15:17:14,231 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2020
2025-11-12 15:17:14,231 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 15:17:14,232 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 277.8ms
2025-11-12 15:17:22,693 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 15:17:22,693 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:17:22,694 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:17:22,694 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:17:22,694 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:17:22,694 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:17:22,694 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 15:17:22,695 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 401 1.8ms
2025-11-12 15:17:46,516 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 15:17:46,516 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:17:46,516 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:17:46,517 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:17:46,517 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:17:46,517 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:17:46,517 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 15:17:46,519 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 15:17:46,519 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 15:17:46,520 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 15:17:46,732 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 15:17:46,733 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 15:17:46,734 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2021
2025-11-12 15:17:46,734 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2021
2025-11-12 15:17:46,734 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 15:17:46,735 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 219.1ms
2025-11-12 15:17:49,135 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 15:17:49,135 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:17:49,135 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:17:49,135 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:17:49,136 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:17:49,136 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:17:49,136 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 15:17:49,138 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 15:17:49,139 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 4.2ms
2025-11-12 15:17:55,390 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 15:17:55,391 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:17:55,391 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:17:55,391 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:17:55,391 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:17:55,391 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:17:55,391 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 15:17:55,394 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-12 15:17:55,395 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-12 15:17:55,400 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-12 15:17:55,401 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-12 15:17:55,401 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-12 15:17:55,402 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 15:17:55,402 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2022
2025-11-12 15:17:55,402 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2022
2025-11-12 15:17:55,403 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-12 15:17:55,403 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.0ms
2025-11-12 15:18:08,108 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 15:18:08,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:18:08,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:18:08,109 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:18:08,109 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:18:08,109 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:18:08,109 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 15:18:08,111 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-12 15:18:08,115 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-12 15:18:08,117 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-12 15:18:08,117 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-12 15:18:08,118 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-12 15:18:08,122 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 15:18:08,123 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2023
2025-11-12 15:18:08,123 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2023
2025-11-12 15:18:08,123 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-12 15:18:08,124 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.5ms
2025-11-12 15:18:15,609 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 15:18:15,609 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:18:15,609 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:18:15,610 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:18:15,610 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:18:15,610 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:18:15,610 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 15:18:15,612 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-12 15:18:15,620 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-12 15:18:15,623 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-12 15:18:15,623 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-12 15:18:15,623 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-12 15:18:15,624 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 15:18:15,625 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2024
2025-11-12 15:18:15,625 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2024
2025-11-12 15:18:15,625 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-12 15:18:15,626 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.8ms
2025-11-12 15:18:33,046 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 15:18:33,046 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:18:33,047 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:18:33,047 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:18:33,047 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:18:33,047 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:18:33,047 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 15:18:33,048 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_token: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'
2025-11-12 15:18:33,049 - app.api.v1.endpoints.auth - ERROR - Error en logout: Error interno del servidor en revoke_token
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 464, in logout
    revoked = await RefreshTokenService.revoke_token(refresh_token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 53, in wrapper
    raise ServiceError(
    ...<3 lines>...
    )
app.core.exceptions.ServiceError: Error interno del servidor en revoke_token
2025-11-12 15:18:33,051 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 500 4.6ms
2025-11-12 15:27:11,228 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 15:27:11,231 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:27:11,231 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:27:11,231 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:27:11,232 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:27:11,232 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:27:11,232 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 15:27:11,233 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 401 4.7ms
2025-11-12 15:27:38,738 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 15:27:38,738 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:27:38,739 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:27:38,739 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:27:38,739 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:27:38,739 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:27:38,739 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 15:27:38,765 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 15:27:38,765 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 15:27:38,765 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 15:27:39,005 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 15:27:39,013 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 15:27:39,014 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2025
2025-11-12 15:27:39,014 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2025
2025-11-12 15:27:39,014 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 15:27:39,015 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 276.7ms
2025-11-12 15:27:43,623 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 15:27:43,623 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:27:43,623 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:27:43,624 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:27:43,624 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:27:43,624 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:27:43,624 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 15:27:43,625 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 401 1.8ms
2025-11-12 15:28:12,674 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 15:28:12,675 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:28:12,675 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:28:12,675 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:28:12,675 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:28:12,676 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:28:12,676 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 15:28:12,679 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 15:28:12,685 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.3ms
2025-11-12 15:28:33,079 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 15:28:33,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:28:33,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:28:33,081 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:28:33,082 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:28:33,082 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:28:33,082 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 15:28:33,083 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 401 3.4ms
2025-11-12 15:29:10,179 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 15:29:10,180 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:29:10,180 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:29:10,180 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:29:10,180 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:29:10,181 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:29:10,181 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 15:29:10,183 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 15:29:10,183 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 15:29:10,183 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 15:29:10,402 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 15:29:10,404 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 15:29:10,404 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2026
2025-11-12 15:29:10,405 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2026
2025-11-12 15:29:10,405 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 15:29:10,405 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 226.0ms
2025-11-12 15:29:18,115 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 15:29:18,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:29:18,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:29:18,115 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:29:18,116 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:29:18,116 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:29:18,116 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 15:29:18,116 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 401 1.7ms
2025-11-12 15:38:19,216 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 15:38:19,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 15:38:19,219 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 15:38:19,219 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 15:38:19,219 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 15:38:19,219 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 15:38:19,220 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 15:38:19,221 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 401 4.9ms
2025-11-12 16:34:06,509 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 16:34:06,512 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:34:06,513 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:34:06,513 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:34:06,513 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:34:06,513 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:34:06,514 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 16:34:06,515 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_token: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'
2025-11-12 16:34:06,517 - app.api.v1.endpoints.auth - ERROR - Error en logout: Error interno del servidor en revoke_token
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() missing 2 required positional arguments: 'usuario_id' and 'token'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 464, in logout
    revoked = await RefreshTokenService.revoke_token(refresh_token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 53, in wrapper
    raise ServiceError(
    ...<3 lines>...
    )
app.core.exceptions.ServiceError: Error interno del servidor en revoke_token
2025-11-12 16:34:06,519 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 500 10.3ms
2025-11-12 16:37:47,847 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 16:37:47,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:37:47,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:37:47,848 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:37:47,848 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:37:47,848 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:37:47,848 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 16:37:47,849 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 401 2.0ms
2025-11-12 16:38:34,531 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 16:38:34,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:38:34,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:38:34,532 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:38:34,532 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:38:34,532 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:38:34,532 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 16:38:34,533 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.5ms
2025-11-12 16:38:34,615 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 16:38:34,615 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:38:34,616 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:38:34,616 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:38:34,616 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:38:34,616 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:38:34,616 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 16:38:34,680 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 65.1ms
2025-11-12 16:38:39,552 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 16:38:39,553 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:38:39,553 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:38:39,553 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:38:39,553 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:38:39,553 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:38:39,553 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 16:38:39,554 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 401 1.8ms
2025-11-12 16:38:54,660 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 16:38:54,661 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:38:54,661 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:38:54,661 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:38:54,661 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:38:54,661 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:38:54,661 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 16:38:54,688 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 16:38:54,688 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 16:38:54,688 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 16:38:54,928 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 16:38:54,933 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 16:38:54,933 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2027
2025-11-12 16:38:54,933 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2027
2025-11-12 16:38:54,933 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 16:38:54,934 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 273.9ms
2025-11-12 16:38:58,188 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 16:38:58,189 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:38:58,189 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:38:58,189 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:38:58,189 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:38:58,189 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:38:58,189 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 16:38:58,191 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 16:38:58,192 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 4.4ms
2025-11-12 16:39:08,371 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 16:39:08,372 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:39:08,372 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:39:08,372 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:39:08,372 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:39:08,373 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:39:08,373 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 16:39:08,375 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-12 16:39:08,378 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-12 16:39:08,378 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-12 16:39:08,379 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 7.6ms
2025-11-12 16:39:25,358 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 16:39:25,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:39:25,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:39:25,359 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:39:25,359 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:39:25,359 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:39:25,360 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 16:39:25,361 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 16:39:25,366 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.4ms
2025-11-12 16:39:52,666 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 16:39:52,666 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:39:52,666 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:39:52,667 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:39:52,667 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:39:52,667 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:39:52,667 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 16:39:52,669 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 16:39:52,670 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 4.0ms
2025-11-12 16:40:04,480 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 16:40:04,481 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:40:04,481 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:40:04,481 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:40:04,481 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:40:04,481 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:40:04,481 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 16:40:04,483 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-12 16:40:04,483 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.1ms
2025-11-12 16:40:19,404 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 16:40:19,405 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:40:19,405 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:40:19,405 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:40:19,405 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:40:19,405 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:40:19,405 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 16:40:19,407 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 16:40:19,408 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 3.4ms
2025-11-12 16:40:39,650 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 16:40:39,650 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:40:39,650 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:40:39,650 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:40:39,650 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:40:39,651 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:40:39,651 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 16:40:39,652 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] No se proporcionó refresh token - Cliente: 1, Usuario: 1 (superadmin)
2025-11-12 16:40:39,653 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 3.1ms
2025-11-12 16:41:05,205 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 16:41:05,205 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:41:05,206 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:41:05,206 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:41:05,206 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:41:05,206 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:41:05,206 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 16:41:05,207 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-12 16:41:05,208 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 2.4ms
2025-11-12 16:41:20,377 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 16:41:20,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:41:20,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:41:20,378 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:41:20,378 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:41:20,378 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:41:20,378 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 16:41:20,380 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 16:41:20,380 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 16:41:20,380 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 16:41:20,590 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 16:41:20,592 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 16:41:20,593 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2028
2025-11-12 16:41:20,593 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2028
2025-11-12 16:41:20,593 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 16:41:20,594 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 216.8ms
2025-11-12 16:41:26,018 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 16:41:26,018 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:41:26,018 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:41:26,019 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:41:26,019 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:41:26,019 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:41:26,019 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 16:41:26,024 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 16:41:26,027 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.8ms
2025-11-12 16:41:39,501 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 16:41:39,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:41:39,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:41:39,502 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:41:39,502 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:41:39,502 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:41:39,503 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 16:41:39,505 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-12 16:41:39,508 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-12 16:41:39,511 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-12 16:41:39,514 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-12 16:41:39,514 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-12 16:41:39,516 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 16:41:39,517 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2029
2025-11-12 16:41:39,517 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2029
2025-11-12 16:41:39,517 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-12 16:41:39,518 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.5ms
2025-11-12 16:41:44,887 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 16:41:44,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:41:44,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:41:44,888 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:41:44,888 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:41:44,888 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:41:44,888 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 16:41:44,890 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-12 16:41:44,892 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-12 16:41:44,897 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-12 16:41:44,898 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-12 16:41:44,898 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-12 16:41:44,900 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 16:41:44,901 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2030
2025-11-12 16:41:44,901 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2030
2025-11-12 16:41:44,902 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-12 16:41:44,903 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.4ms
2025-11-12 16:41:53,347 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 16:41:53,348 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:41:53,348 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:41:53,348 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:41:53,348 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:41:53,348 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:41:53,349 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 16:41:53,350 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 16:41:53,352 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 4.5ms
2025-11-12 16:42:01,748 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-12 16:42:01,748 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:42:01,749 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:42:01,749 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:42:01,749 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:42:01,749 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:42:01,749 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout/
2025-11-12 16:42:01,751 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-12 16:42:01,752 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-12 16:42:01,752 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-12 16:42:01,752 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 4.2ms
2025-11-12 16:42:23,330 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/
2025-11-12 16:42:23,331 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:42:23,331 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:42:23,331 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:42:23,331 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:42:23,332 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:42:23,332 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/
2025-11-12 16:42:23,333 - app.api.v1.endpoints.auth - INFO - Solicitud /sessions/ recibida para usuario: superadmin
2025-11-12 16:42:23,336 - app.services.refresh_token_service - INFO - [SESSIONS] Cliente 1, Usuario 1 tiene 26 sesiones activas
2025-11-12 16:42:23,337 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/ 200 6.3ms
2025-11-12 16:42:32,561 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout_all/
2025-11-12 16:42:32,561 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:42:32,561 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:42:32,561 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:42:32,561 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:42:32,562 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:42:32,562 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout_all/
2025-11-12 16:42:32,563 - app.api.v1.endpoints.auth - INFO - Solicitud /logout_all/ recibida para usuario: superadmin
2025-11-12 16:42:32,563 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_all_user_tokens: RefreshTokenService.revoke_all_user_tokens() missing 1 required positional argument: 'cliente_id'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_all_user_tokens() missing 1 required positional argument: 'cliente_id'
2025-11-12 16:42:32,564 - app.api.v1.endpoints.auth - ERROR - Error en /logout_all/ para superadmin: Error interno del servidor en revoke_all_user_tokens
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_all_user_tokens() missing 1 required positional argument: 'cliente_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 591, in logout_all_sessions
    rows_affected = await RefreshTokenService.revoke_all_user_tokens(usuario_id=user_id)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 53, in wrapper
    raise ServiceError(
    ...<3 lines>...
    )
app.core.exceptions.ServiceError: Error interno del servidor en revoke_all_user_tokens
2025-11-12 16:42:32,566 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout_all/ 500 4.9ms
2025-11-12 16:47:12,181 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout_all/
2025-11-12 16:47:12,181 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:47:12,182 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:47:12,182 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:47:12,182 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:47:12,182 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:47:12,182 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/logout_all/
2025-11-12 16:47:12,210 - app.api.v1.endpoints.auth - INFO - Solicitud /logout_all/ recibida para usuario: superadmin
2025-11-12 16:47:12,215 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 26
2025-11-12 16:47:12,215 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 26 tokens revocados para cliente 1, usuario 1
2025-11-12 16:47:12,216 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout_all/ 200 35.1ms
2025-11-12 16:47:58,848 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 16:47:58,848 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:47:58,848 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:47:58,848 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:47:58,849 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:47:58,849 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:47:58,849 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 16:47:58,860 - app.api.deps - ERROR - Error creando instancia Pydantic UsuarioReadWithRoles para 'superadmin': 1 validation error for UsuarioReadWithRoles
origen_creacion
  Field required [type=missing, input_value={'usuario_id': 1, 'client...), es_eliminado=False)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 135, in get_current_active_user
    usuario_pydantic = UsuarioReadWithRoles(**user_dict, roles=roles_list)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for UsuarioReadWithRoles
origen_creacion
  Field required [type=missing, input_value={'usuario_id': 1, 'client...), es_eliminado=False)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-12 16:47:58,883 - app.api.deps - ERROR - Datos del usuario (dict): {'usuario_id': 1, 'cliente_id': 1, 'nombre_usuario': 'superadmin', 'correo': 'admin@sistema.local', 'nombre': 'System', 'apellido': 'Administrator', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), 'fecha_ultimo_acceso': None, 'correo_confirmado': True}
2025-11-12 16:47:58,883 - app.api.deps - ERROR - Roles obtenidos y convertidos (list[RolRead]): [RolRead(cliente_id=None, codigo_rol=None, nombre='Super Administrador', descripcion='Acceso completo al sistema y gestión de todos los clientes. Rol reservado para administración de la plataforma.', es_activo=True, rol_id=1, fecha_creacion=datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), es_eliminado=False)]
2025-11-12 16:47:58,883 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 500 35.9ms
2025-11-12 16:55:01,952 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 16:55:01,952 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:55:01,953 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:55:01,954 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:55:01,954 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:55:01,954 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:55:01,954 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 16:55:01,986 - app.api.deps - ERROR - Error creando instancia Pydantic UsuarioReadWithRoles para 'superadmin': 1 validation error for UsuarioReadWithRoles
origen_creacion
  Field required [type=missing, input_value={'usuario_id': 1, 'client...), es_eliminado=False)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 135, in get_current_active_user
    usuario_pydantic = UsuarioReadWithRoles(**user_dict, roles=roles_list)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for UsuarioReadWithRoles
origen_creacion
  Field required [type=missing, input_value={'usuario_id': 1, 'client...), es_eliminado=False)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-12 16:55:01,987 - app.api.deps - ERROR - Datos del usuario (dict): {'usuario_id': 1, 'cliente_id': 1, 'nombre_usuario': 'superadmin', 'correo': 'admin@sistema.local', 'nombre': 'System', 'apellido': 'Administrator', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), 'fecha_ultimo_acceso': None, 'correo_confirmado': True}
2025-11-12 16:55:01,987 - app.api.deps - ERROR - Roles obtenidos y convertidos (list[RolRead]): [RolRead(cliente_id=None, codigo_rol=None, nombre='Super Administrador', descripcion='Acceso completo al sistema y gestión de todos los clientes. Rol reservado para administración de la plataforma.', es_activo=True, rol_id=1, fecha_creacion=datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), es_eliminado=False)]
2025-11-12 16:55:01,988 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 500 36.2ms
2025-11-12 16:56:14,425 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 16:56:14,425 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:56:14,426 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:56:14,426 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:56:14,426 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:56:14,426 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:56:14,426 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 16:56:14,427 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.6ms
2025-11-12 16:56:14,554 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 16:56:14,554 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:56:14,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:56:14,555 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:56:14,555 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:56:14,555 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:56:14,555 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 16:56:14,624 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 69.5ms
2025-11-12 16:56:21,610 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 16:56:21,611 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:56:21,611 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:56:21,611 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:56:21,611 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:56:21,611 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:56:21,612 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 16:56:21,612 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 401 1.8ms
2025-11-12 16:56:32,766 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 16:56:32,767 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:56:32,767 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:56:32,767 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:56:32,767 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:56:32,767 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:56:32,768 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 16:56:32,781 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 16:56:32,781 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 16:56:32,781 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 16:56:33,014 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 16:56:33,016 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 16:56:33,016 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2031
2025-11-12 16:56:33,016 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2031
2025-11-12 16:56:33,016 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 16:56:33,017 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 250.4ms
2025-11-12 16:56:37,556 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 16:56:37,556 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 16:56:37,556 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 16:56:37,557 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 16:56:37,557 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 16:56:37,557 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 16:56:37,557 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 16:56:37,560 - app.api.deps - ERROR - Error creando instancia Pydantic UsuarioReadWithRoles para 'superadmin': 1 validation error for UsuarioReadWithRoles
origen_creacion
  Field required [type=missing, input_value={'usuario_id': 1, 'client...), es_eliminado=False)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 135, in get_current_active_user
    usuario_pydantic = UsuarioReadWithRoles(**user_dict, roles=roles_list)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for UsuarioReadWithRoles
origen_creacion
  Field required [type=missing, input_value={'usuario_id': 1, 'client...), es_eliminado=False)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-12 16:56:37,563 - app.api.deps - ERROR - Datos del usuario (dict): {'usuario_id': 1, 'cliente_id': 1, 'nombre_usuario': 'superadmin', 'correo': 'admin@sistema.local', 'nombre': 'System', 'apellido': 'Administrator', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), 'fecha_ultimo_acceso': None, 'correo_confirmado': True}
2025-11-12 16:56:37,563 - app.api.deps - ERROR - Roles obtenidos y convertidos (list[RolRead]): [RolRead(cliente_id=None, codigo_rol=None, nombre='Super Administrador', descripcion='Acceso completo al sistema y gestión de todos los clientes. Rol reservado para administración de la plataforma.', es_activo=True, rol_id=1, fecha_creacion=datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), es_eliminado=False)]
2025-11-12 16:56:37,564 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 500 8.7ms
2025-11-12 17:00:21,010 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/
2025-11-12 17:00:21,010 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:00:21,010 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:00:21,011 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:00:21,011 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:00:21,011 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:00:21,011 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/
2025-11-12 17:00:21,026 - app.api.v1.endpoints.auth - INFO - Solicitud /sessions/ recibida para usuario: superadmin
2025-11-12 17:00:21,027 - app.services.refresh_token_service - INFO - [SESSIONS] Cliente 1, Usuario 1 tiene 1 sesiones activas
2025-11-12 17:00:21,028 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/ 200 17.7ms
2025-11-12 17:02:49,363 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 17:02:49,364 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:02:49,364 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:02:49,364 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:02:49,364 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:02:49,364 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:02:49,364 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 17:02:49,379 - app.api.deps - ERROR - Error creando instancia Pydantic UsuarioReadWithRoles para 'superadmin': 1 validation error for UsuarioReadWithRoles
origen_creacion
  Field required [type=missing, input_value={'usuario_id': 1, 'client...), es_eliminado=False)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 135, in get_current_active_user
    usuario_pydantic = UsuarioReadWithRoles(**user_dict, roles=roles_list)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for UsuarioReadWithRoles
origen_creacion
  Field required [type=missing, input_value={'usuario_id': 1, 'client...), es_eliminado=False)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-12 17:02:49,379 - app.api.deps - ERROR - Datos del usuario (dict): {'usuario_id': 1, 'cliente_id': 1, 'nombre_usuario': 'superadmin', 'correo': 'admin@sistema.local', 'nombre': 'System', 'apellido': 'Administrator', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), 'fecha_ultimo_acceso': None, 'correo_confirmado': True}
2025-11-12 17:02:49,379 - app.api.deps - ERROR - Roles obtenidos y convertidos (list[RolRead]): [RolRead(cliente_id=None, codigo_rol=None, nombre='Super Administrador', descripcion='Acceso completo al sistema y gestión de todos los clientes. Rol reservado para administración de la plataforma.', es_activo=True, rol_id=1, fecha_creacion=datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), es_eliminado=False)]
2025-11-12 17:02:49,380 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 500 16.6ms
2025-11-12 17:07:10,198 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 17:07:10,199 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:07:10,199 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:07:10,199 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:07:10,199 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:07:10,200 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:07:10,200 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 17:07:10,228 - app.db.queries - ERROR - Error en execute_auth_query: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 17:07:10,229 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la autenticación: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 40, in execute_auth_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 54, in execute_auth_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la autenticación: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 17:07:10,230 - app.api.deps - ERROR - Error inesperado obteniendo usuario activo 'superadmin': Error en la autenticación: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 40, in execute_auth_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 77, in get_current_active_user
    user_dict = execute_auth_query(user_query, (username,)) # Asume que devuelve dict o None
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 54, in execute_auth_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la autenticación: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 17:07:10,232 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 500 33.8ms
2025-11-12 17:08:01,736 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 17:08:01,738 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:08:01,738 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:08:01,738 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:08:01,738 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:08:01,738 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:08:01,739 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 17:08:01,770 - app.api.deps - ERROR - Error creando instancia Pydantic UsuarioReadWithRoles para 'superadmin': 1 validation error for UsuarioReadWithRoles
origen_creacion
  Field required [type=missing, input_value={'usuario_id': 1, 'client...), es_eliminado=False)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 135, in get_current_active_user
    usuario_pydantic = UsuarioReadWithRoles(**user_dict, roles=roles_list)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for UsuarioReadWithRoles
origen_creacion
  Field required [type=missing, input_value={'usuario_id': 1, 'client...), es_eliminado=False)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-12 17:08:01,771 - app.api.deps - ERROR - Datos del usuario (dict): {'usuario_id': 1, 'cliente_id': 1, 'nombre_usuario': 'superadmin', 'correo': 'admin@sistema.local', 'nombre': 'System', 'apellido': 'Administrator', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), 'fecha_ultimo_acceso': None, 'correo_confirmado': True}
2025-11-12 17:08:01,771 - app.api.deps - ERROR - Roles obtenidos y convertidos (list[RolRead]): [RolRead(cliente_id=None, codigo_rol=None, nombre='Super Administrador', descripcion='Acceso completo al sistema y gestión de todos los clientes. Rol reservado para administración de la plataforma.', es_activo=True, rol_id=1, fecha_creacion=datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), es_eliminado=False)]
2025-11-12 17:08:01,772 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 500 35.9ms
2025-11-12 17:12:44,523 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 17:12:44,524 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:12:44,524 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:12:44,524 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:12:44,525 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:12:44,525 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:12:44,525 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 17:12:44,529 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-12 17:12:44,529 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 401 5.8ms
2025-11-12 17:13:05,721 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 17:13:05,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:13:05,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:13:05,721 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:13:05,722 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:13:05,722 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:13:05,722 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 17:13:05,749 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 17:13:05,749 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 17:13:05,749 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 17:13:05,978 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 17:13:05,980 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 17:13:05,980 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2032
2025-11-12 17:13:05,980 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2032
2025-11-12 17:13:05,981 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 17:13:05,982 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 260.9ms
2025-11-12 17:13:12,095 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 17:13:12,096 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:13:12,096 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:13:12,096 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:13:12,096 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:13:12,097 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:13:12,097 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 17:13:12,099 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 17:13:12,100 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 4.6ms
2025-11-12 17:13:33,748 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 17:13:33,748 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:13:33,748 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:13:33,748 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:13:33,749 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:13:33,749 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:13:33,749 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 17:13:33,752 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-12 17:13:33,753 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-12 17:13:33,754 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-12 17:13:33,755 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-12 17:13:33,755 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-12 17:13:33,756 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 17:13:33,756 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2033
2025-11-12 17:13:33,757 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2033
2025-11-12 17:13:33,757 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-12 17:13:33,757 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.8ms
2025-11-12 17:13:45,917 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/
2025-11-12 17:13:45,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:13:45,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:13:45,918 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:13:45,918 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:13:45,919 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:13:45,919 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/
2025-11-12 17:13:45,920 - app.api.v1.endpoints.auth - INFO - Solicitud /sessions/ recibida para usuario: superadmin
2025-11-12 17:13:45,921 - app.services.refresh_token_service - INFO - [SESSIONS] Cliente 1, Usuario 1 tiene 2 sesiones activas
2025-11-12 17:13:45,922 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/ 200 4.4ms
2025-11-12 17:13:57,062 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 17:13:57,062 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:13:57,062 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:13:57,062 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:13:57,062 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:13:57,063 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:13:57,063 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 17:13:57,064 - app.db.queries - ERROR - Error en execute_auth_query: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_superadmin'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'ultimo_cambio_contrasena'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 17:13:57,065 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la autenticación: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_superadmin'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'ultimo_cambio_contrasena'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 40, in execute_auth_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_superadmin'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'ultimo_cambio_contrasena'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 54, in execute_auth_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la autenticación: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_superadmin'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'ultimo_cambio_contrasena'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 17:13:57,067 - app.api.deps - ERROR - Error inesperado obteniendo usuario activo 'superadmin': Error en la autenticación: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_superadmin'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'ultimo_cambio_contrasena'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 40, in execute_auth_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_superadmin'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'ultimo_cambio_contrasena'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 79, in get_current_active_user
    user_dict = execute_auth_query(user_query, (username,)) # Asume que devuelve dict o None
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 54, in execute_auth_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la autenticación: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'origen_creacion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_superadmin'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'ultimo_cambio_contrasena'. (207); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-12 17:13:57,069 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 500 7.4ms
2025-11-12 17:17:58,486 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 17:17:58,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:17:58,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:17:58,487 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:17:58,487 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:17:58,488 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:17:58,488 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 17:17:58,520 - app.api.deps - ERROR - Error creando instancia Pydantic UsuarioReadWithRoles para 'superadmin': 1 validation error for UsuarioReadWithRoles
origen_creacion
  Field required [type=missing, input_value={'usuario_id': 1, 'client...), es_eliminado=False)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 137, in get_current_active_user
    usuario_pydantic = UsuarioReadWithRoles(**user_dict, roles=roles_list)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for UsuarioReadWithRoles
origen_creacion
  Field required [type=missing, input_value={'usuario_id': 1, 'client...), es_eliminado=False)]}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-12 17:17:58,521 - app.api.deps - ERROR - Datos del usuario (dict): {'usuario_id': 1, 'cliente_id': 1, 'nombre_usuario': 'superadmin', 'correo': 'admin@sistema.local', 'nombre': 'System', 'apellido': 'Administrator', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), 'fecha_ultimo_acceso': None, 'correo_confirmado': True, 'es_eliminado': False, 'proveedor_autenticacion': 'local', 'fecha_ultimo_cambio_contrasena': datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), 'sincronizado_desde': None}
2025-11-12 17:17:58,521 - app.api.deps - ERROR - Roles obtenidos y convertidos (list[RolRead]): [RolRead(cliente_id=None, codigo_rol=None, nombre='Super Administrador', descripcion='Acceso completo al sistema y gestión de todos los clientes. Rol reservado para administración de la plataforma.', es_activo=True, rol_id=1, fecha_creacion=datetime.datetime(2025, 11, 11, 15, 44, 23, 580000), es_eliminado=False)]
2025-11-12 17:17:58,522 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 500 35.6ms
2025-11-12 17:23:34,158 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 17:23:34,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:23:34,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:23:34,160 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:23:34,160 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:23:34,161 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:23:34,161 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 17:23:34,191 - app.api.deps - WARNING - Acceso denegado para usuario 'superadmin'. Roles: ['Super Administrador']. Roles requeridos: ['Administrador']
2025-11-12 17:23:34,192 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 403 33.6ms
2025-11-12 17:23:51,239 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 17:23:51,239 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:23:51,239 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:23:51,239 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:23:51,240 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:23:51,240 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:23:51,240 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 17:23:51,240 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.5ms
2025-11-12 17:23:51,315 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 17:23:51,316 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:23:51,316 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:23:51,316 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:23:51,316 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:23:51,316 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:23:51,317 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 17:23:51,383 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 67.8ms
2025-11-12 17:24:01,567 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 17:24:01,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:24:01,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:24:01,568 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:24:01,568 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:24:01,568 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:24:01,568 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 17:24:01,574 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 17:24:01,574 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 17:24:01,575 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 17:24:01,812 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 17:24:01,814 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 17:24:01,814 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2034
2025-11-12 17:24:01,814 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2034
2025-11-12 17:24:01,814 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 17:24:01,815 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 248.2ms
2025-11-12 17:24:10,160 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/
2025-11-12 17:24:10,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:24:10,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:24:10,161 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:24:10,161 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:24:10,161 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:24:10,161 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/
2025-11-12 17:24:10,163 - app.api.v1.endpoints.auth - INFO - Solicitud /sessions/ recibida para usuario: superadmin
2025-11-12 17:24:10,164 - app.services.refresh_token_service - INFO - [SESSIONS] Cliente 1, Usuario 1 tiene 3 sesiones activas
2025-11-12 17:24:10,164 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/ 200 4.3ms
2025-11-12 17:24:22,754 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 17:24:22,754 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:24:22,754 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:24:22,754 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:24:22,755 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:24:22,755 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:24:22,755 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 17:24:22,757 - app.api.deps - WARNING - Acceso denegado para usuario 'superadmin'. Roles: ['Super Administrador']. Roles requeridos: ['Administrador']
2025-11-12 17:24:22,758 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 403 4.0ms
2025-11-12 17:24:45,638 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 17:24:45,639 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 17:24:45,639 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 17:24:45,639 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 17:24:45,639 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 17:24:45,639 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 17:24:45,639 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 17:24:45,642 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 17:24:45,646 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.6ms
2025-11-12 18:51:04,810 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 18:51:04,810 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 18:51:04,810 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 18:51:04,811 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 18:51:04,811 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 18:51:04,811 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 18:51:04,811 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 18:51:04,812 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-12 18:51:04,812 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 401 2.6ms
2025-11-12 18:51:12,525 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 18:51:12,526 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 18:51:12,526 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 18:51:12,526 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 18:51:12,526 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 18:51:12,526 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 18:51:12,526 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 18:51:12,527 - app.core.auth - ERROR - Error decodificando token: Signature has expired.
2025-11-12 18:51:12,527 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 401 2.2ms
2025-11-12 18:51:39,068 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 18:51:39,068 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 18:51:39,068 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 18:51:39,069 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 18:51:39,069 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 18:51:39,069 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 18:51:39,069 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 18:51:39,112 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 18:51:39,112 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 18:51:39,112 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 18:51:39,357 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 18:51:39,371 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 18:51:39,371 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2035
2025-11-12 18:51:39,371 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2035
2025-11-12 18:51:39,372 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 18:51:39,372 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 304.3ms
2025-11-12 18:55:25,669 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 18:55:25,670 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 18:55:25,670 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 18:55:25,670 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 18:55:25,670 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 18:55:25,670 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 18:55:25,671 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 18:55:25,671 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-12 18:55:25,672 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 401 2.3ms
2025-11-12 18:55:39,023 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 18:55:39,023 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 18:55:39,023 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 18:55:39,023 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 18:55:39,024 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 18:55:39,024 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 18:55:39,024 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 18:55:39,024 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.8ms
2025-11-12 18:55:39,125 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 18:55:39,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 18:55:39,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 18:55:39,126 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 18:55:39,126 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 18:55:39,126 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 18:55:39,126 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 18:55:39,129 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 3.8ms
2025-11-12 18:55:54,884 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 18:55:54,884 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 18:55:54,884 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 18:55:54,885 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 18:55:54,885 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 18:55:54,885 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 18:55:54,885 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 18:55:54,901 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 18:55:54,901 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 18:55:54,902 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 18:55:55,129 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 18:55:55,136 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 18:55:55,137 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2036
2025-11-12 18:55:55,137 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2036
2025-11-12 18:55:55,137 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 18:55:55,138 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 253.9ms
2025-11-12 18:56:04,532 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 18:56:04,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 18:56:04,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 18:56:04,532 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 18:56:04,533 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 18:56:04,533 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 18:56:04,533 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 18:56:04,540 - app.api.deps - WARNING - Acceso denegado para usuario 'superadmin'. Roles: ['Super Administrador']. Roles requeridos: ['Administrador']
2025-11-12 18:56:04,541 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 403 9.1ms
2025-11-12 22:13:23,671 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/sessions/2031/revoke_admin/
2025-11-12 22:13:23,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 22:13:23,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 22:13:23,672 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 22:13:23,672 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 22:13:23,672 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 22:13:23,672 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/2031/revoke_admin/
2025-11-12 22:13:23,677 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-12 22:13:23,678 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/sessions/2031/revoke_admin/ 401 6.6ms
2025-11-12 22:13:40,739 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 22:13:40,739 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 22:13:40,740 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 22:13:40,740 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 22:13:40,740 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 22:13:40,740 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 22:13:40,740 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 22:13:40,818 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 22:13:40,818 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 22:13:40,819 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 22:13:41,053 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 22:13:41,060 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 22:13:41,060 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2037
2025-11-12 22:13:41,060 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2037
2025-11-12 22:13:41,061 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 22:13:41,061 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 322.3ms
2025-11-12 22:13:47,735 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 22:13:47,735 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 22:13:47,735 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 22:13:47,736 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 22:13:47,736 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 22:13:47,736 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 22:13:47,736 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 22:13:47,740 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 22:13:47,741 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.5ms
2025-11-12 22:14:11,190 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/sessions/2031/revoke_admin/
2025-11-12 22:14:11,190 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 22:14:11,191 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 22:14:11,191 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 22:14:11,191 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 22:14:11,191 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 22:14:11,191 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/2031/revoke_admin/
2025-11-12 22:14:11,203 - app.api.deps - WARNING - Acceso denegado para usuario 'superadmin'. Roles: ['Super Administrador']. Roles requeridos: ['Administrador']
2025-11-12 22:14:11,203 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/sessions/2031/revoke_admin/ 403 13.3ms
2025-11-12 23:07:52,395 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 23:07:52,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 23:07:52,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:07:52,396 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 23:07:52,396 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 23:07:52,397 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 23:07:52,397 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-12 23:07:52,397 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.8ms
2025-11-12 23:07:52,475 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 23:07:52,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 23:07:52,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:07:52,476 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 23:07:52,476 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 23:07:52,476 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 23:07:52,477 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-12 23:07:52,560 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 85.0ms
2025-11-12 23:08:11,712 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 23:08:11,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 23:08:11,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:08:11,713 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 23:08:11,713 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 23:08:11,713 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 23:08:11,714 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 23:08:11,769 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 23:08:11,769 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 23:08:11,769 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 23:08:12,007 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 23:08:12,018 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 23:08:12,019 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2038
2025-11-12 23:08:12,019 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2038
2025-11-12 23:08:12,019 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 23:08:12,020 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 307.8ms
2025-11-12 23:09:07,158 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 23:09:07,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 23:09:07,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:09:07,158 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 23:09:07,158 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 23:09:07,159 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 23:09:07,159 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 23:09:07,159 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 401 1.6ms
2025-11-12 23:09:19,705 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 23:09:19,706 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 23:09:19,706 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:09:19,706 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 23:09:19,706 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 23:09:19,707 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 23:09:19,707 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-12 23:09:19,712 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-12 23:09:19,712 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-12 23:09:19,712 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-12 23:09:19,928 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-12 23:09:19,935 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 23:09:19,935 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2039
2025-11-12 23:09:19,936 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2039
2025-11-12 23:09:19,936 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-12 23:09:19,937 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 231.3ms
2025-11-12 23:09:22,466 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 23:09:22,466 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 23:09:22,466 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:09:22,467 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 23:09:22,467 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 23:09:22,467 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 23:09:22,467 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-12 23:09:22,473 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-12 23:09:22,479 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 12.8ms
2025-11-12 23:09:48,258 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-12 23:09:48,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 23:09:48,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:09:48,259 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 23:09:48,259 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 23:09:48,259 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 23:09:48,260 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/refresh/
2025-11-12 23:09:48,267 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-12 23:09:48,272 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-12 23:09:48,278 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-12 23:09:48,278 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-12 23:09:48,278 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-12 23:09:48,280 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 23:09:48,280 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2040
2025-11-12 23:09:48,280 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2040
2025-11-12 23:09:48,280 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-12 23:09:48,281 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 22.7ms
2025-11-12 23:10:02,101 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/
2025-11-12 23:10:02,102 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 23:10:02,102 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:10:02,102 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 23:10:02,102 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 23:10:02,103 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 23:10:02,103 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/
2025-11-12 23:10:02,104 - app.api.v1.endpoints.auth - INFO - Solicitud /sessions/ recibida para usuario: superadmin
2025-11-12 23:10:02,108 - app.services.refresh_token_service - INFO - [SESSIONS] Cliente 1, Usuario 1 tiene 8 sesiones activas
2025-11-12 23:10:02,109 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/ 200 7.1ms
2025-11-12 23:10:16,540 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 23:10:16,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-12 23:10:16,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:10:16,541 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-12 23:10:16,541 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-12 23:10:16,541 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-12 23:10:16,541 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-12 23:10:16,569 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: superadmin
2025-11-12 23:10:16,573 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] Se recuperaron 8 sesiones activas totales.
2025-11-12 23:10:16,573 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 8 sesiones activas totales.
2025-11-12 23:10:16,574 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 33.3ms
2025-11-12 23:10:39,258 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-12 23:10:39,258 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 23:10:39,258 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:10:39,258 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 23:10:39,258 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 23:10:39,261 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-12 23:10:39,262 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/docs
2025-11-12 23:10:39,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 4.3ms
2025-11-12 23:10:39,369 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-12 23:10:39,369 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 23:10:39,369 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:10:39,369 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 23:10:39,370 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 23:10:39,371 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-12 23:10:39,371 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/openapi.json
2025-11-12 23:10:39,373 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 4.4ms
2025-11-12 23:11:00,389 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-12 23:11:00,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 23:11:00,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:11:00,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 23:11:00,390 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 23:11:00,390 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-12 23:11:00,390 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/api/v1/auth/login/
2025-11-12 23:11:00,393 - app.api.v1.endpoints.auth - INFO - Cliente 6 resuelto y validado para login.
2025-11-12 23:11:00,393 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=6
2025-11-12 23:11:00,393 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=6 (del middleware)
2025-11-12 23:11:00,606 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=6, cliente_id=6
2025-11-12 23:11:00,613 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-12 23:11:00,613 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 6, Usuario 6 - Cliente: web - Token ID: 2041
2025-11-12 23:11:00,613 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2041
2025-11-12 23:11:00,614 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 6
2025-11-12 23:11:00,614 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 225.3ms
2025-11-12 23:11:07,942 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-12 23:11:07,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 23:11:07,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:11:07,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 23:11:07,942 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 23:11:07,943 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-12 23:11:07,943 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/api/v1/auth/me/
2025-11-12 23:11:07,944 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-11-12 23:11:07,945 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 3.8ms
2025-11-12 23:11:19,256 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/
2025-11-12 23:11:19,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 23:11:19,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:11:19,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 23:11:19,256 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 23:11:19,260 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-12 23:11:19,260 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/api/v1/auth/sessions/
2025-11-12 23:11:19,263 - app.api.v1.endpoints.auth - INFO - Solicitud /sessions/ recibida para usuario: admin_acme
2025-11-12 23:11:19,266 - app.services.refresh_token_service - INFO - [SESSIONS] Cliente 6, Usuario 6 tiene 4 sesiones activas
2025-11-12 23:11:19,267 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/ 200 11.0ms
2025-11-12 23:11:29,419 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-12 23:11:29,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-12 23:11:29,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-12 23:11:29,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-12 23:11:29,419 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-12 23:11:29,420 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-12 23:11:29,420 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/api/v1/auth/sessions/admin/
2025-11-12 23:11:29,433 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-12 23:11:29,436 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] Se recuperaron 5 sesiones activas totales.
2025-11-12 23:11:29,436 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 5 sesiones activas totales.
2025-11-12 23:11:29,437 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 18.1ms
2025-11-13 15:58:55,455 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-13 15:58:55,456 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-13 15:58:55,456 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-13 15:58:55,456 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-13 15:58:55,456 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-13 15:58:55,457 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-13 15:58:55,457 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-13 15:58:55,459 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 3.9ms
2025-11-13 15:58:55,555 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-13 15:58:55,556 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-13 15:58:55,556 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-13 15:58:55,556 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-13 15:58:55,556 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-13 15:58:55,557 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-13 15:58:55,557 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-13 15:58:55,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 79.2ms
2025-11-13 15:59:12,735 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-13 15:59:12,736 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-13 15:59:12,736 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-13 15:59:12,736 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-13 15:59:12,736 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-13 15:59:12,736 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-13 15:59:12,737 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-13 15:59:12,786 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-13 15:59:12,786 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-13 15:59:12,786 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-13 15:59:13,020 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-13 15:59:13,030 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-13 15:59:13,031 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2042
2025-11-13 15:59:13,031 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2042
2025-11-13 15:59:13,031 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-13 15:59:13,032 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 296.7ms
2025-11-13 15:59:17,564 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-13 15:59:17,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-13 15:59:17,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-13 15:59:17,565 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-13 15:59:17,565 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-13 15:59:17,565 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-13 15:59:17,566 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/sessions/admin/
2025-11-13 15:59:17,579 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: superadmin
2025-11-13 15:59:17,583 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] Se recuperaron 9 sesiones activas totales.
2025-11-13 15:59:17,583 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 9 sesiones activas totales.
2025-11-13 15:59:17,584 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 19.5ms
2025-11-13 15:59:32,137 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-13 15:59:32,137 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-13 15:59:32,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-13 15:59:32,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-13 15:59:32,138 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-13 15:59:32,142 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-13 15:59:32,142 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/api/v1/auth/login/
2025-11-13 15:59:32,146 - app.api.v1.endpoints.auth - INFO - Cliente 6 resuelto y validado para login.
2025-11-13 15:59:32,146 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=6
2025-11-13 15:59:32,146 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=6 (del middleware)
2025-11-13 15:59:32,372 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=6, cliente_id=6
2025-11-13 15:59:32,379 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-13 15:59:32,380 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 6, Usuario 6 - Cliente: web - Token ID: 2043
2025-11-13 15:59:32,380 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2043
2025-11-13 15:59:32,380 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 6
2025-11-13 15:59:32,381 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 244.1ms
2025-11-13 15:59:36,617 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-13 15:59:36,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-13 15:59:36,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-13 15:59:36,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-13 15:59:36,617 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-13 15:59:36,619 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-13 15:59:36,619 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/api/v1/auth/sessions/admin/
2025-11-13 15:59:36,634 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-13 15:59:36,635 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 403 18.4ms
2025-11-14 11:07:25,777 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-14 11:07:25,778 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-14 11:07:25,778 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 11:07:25,778 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-14 11:07:25,779 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-14 11:07:25,779 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-14 11:07:25,779 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-14 11:07:25,785 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 8.5ms
2025-11-14 11:07:26,437 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-14 11:07:26,438 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-14 11:07:26,438 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 11:07:26,438 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-14 11:07:26,438 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-14 11:07:26,438 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-14 11:07:26,439 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-14 11:07:26,530 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 93.3ms
2025-11-14 11:07:45,336 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-14 11:07:45,336 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-14 11:07:45,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 11:07:45,337 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-14 11:07:45,337 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-14 11:07:45,337 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-14 11:07:45,337 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/login/
2025-11-14 11:07:45,457 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-14 11:07:45,458 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-14 11:07:45,458 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-14 11:07:45,700 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-14 11:07:45,710 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-14 11:07:45,711 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 3042
2025-11-14 11:07:45,711 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 3042
2025-11-14 11:07:45,711 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-14 11:07:45,712 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 375.9ms
2025-11-14 11:07:53,517 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-14 11:07:53,517 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-14 11:07:53,517 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 11:07:53,517 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-14 11:07:53,517 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-14 11:07:53,518 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-14 11:07:53,518 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/api/v1/auth/me/
2025-11-14 11:07:53,521 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-14 11:07:53,523 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.2ms
2025-11-14 11:07:58,240 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-14 11:07:58,240 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-14 11:07:58,240 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 11:07:58,240 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-14 11:07:58,240 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-14 11:07:58,244 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-14 11:07:58,244 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/docs
2025-11-14 11:07:58,245 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 5.1ms
2025-11-14 11:07:58,985 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-14 11:07:58,986 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-14 11:07:58,986 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 11:07:58,986 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-14 11:07:58,986 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-14 11:07:58,988 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-14 11:07:58,988 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/openapi.json
2025-11-14 11:07:58,991 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 5.6ms
2025-11-14 11:08:12,966 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-14 11:08:12,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-14 11:08:12,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 11:08:12,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-14 11:08:12,967 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-14 11:08:12,968 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-14 11:08:12,969 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/api/v1/auth/login/
2025-11-14 11:08:12,971 - app.api.v1.endpoints.auth - INFO - Cliente 6 resuelto y validado para login.
2025-11-14 11:08:12,971 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=6
2025-11-14 11:08:12,971 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=6 (del middleware)
2025-11-14 11:08:13,186 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=6, cliente_id=6
2025-11-14 11:08:13,188 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-14 11:08:13,189 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 6, Usuario 6 - Cliente: web - Token ID: 3043
2025-11-14 11:08:13,189 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 3043
2025-11-14 11:08:13,189 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 6
2025-11-14 11:08:13,190 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 223.2ms
2025-11-14 11:08:17,502 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-14 11:08:17,503 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-14 11:08:17,503 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 11:08:17,503 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-14 11:08:17,503 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-14 11:08:17,505 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-14 11:08:17,505 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/api/v1/auth/me/
2025-11-14 11:08:17,506 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-11-14 11:08:17,507 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 4.9ms
2025-11-14 11:08:27,229 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-14 11:08:27,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-14 11:08:27,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 11:08:27,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-14 11:08:27,230 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-14 11:08:27,231 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-14 11:08:27,232 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/api/v1/auth/sessions/admin/
2025-11-14 11:08:27,245 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_acme'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-14 11:08:27,246 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 403 16.5ms
2025-11-14 11:08:32,537 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/
2025-11-14 11:08:32,537 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-14 11:08:32,537 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 11:08:32,538 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-14 11:08:32,538 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-14 11:08:32,539 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-14 11:08:32,539 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/api/v1/auth/sessions/
2025-11-14 11:08:32,541 - app.api.v1.endpoints.auth - INFO - Solicitud /sessions/ recibida para usuario: admin_acme
2025-11-14 11:08:32,546 - app.services.refresh_token_service - INFO - [SESSIONS] Cliente 6, Usuario 6 tiene 6 sesiones activas
2025-11-14 11:08:32,547 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/ 200 10.2ms
2025-11-14 15:33:48,135 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-14 15:33:48,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-14 15:33:48,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 15:33:48,136 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-14 15:33:48,136 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-14 15:33:48,137 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-14 15:33:48,137 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/docs
2025-11-14 15:33:48,138 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 3.2ms
2025-11-14 15:33:48,291 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-14 15:33:48,291 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: '127.0.0.1'
2025-11-14 15:33:48,292 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 15:33:48,292 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'
2025-11-14 15:33:48,292 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] Verifica que BASE_DOMAIN='midominio.com' sea correcto
2025-11-14 15:33:48,292 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio detectado en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-14 15:33:48,292 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, verificación_contexto=1, path=/openapi.json
2025-11-14 15:33:48,395 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 104.3ms
2025-11-14 16:08:32,878 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-14 16:08:32,879 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-14 16:08:32,879 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 16:08:32,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-14 16:08:32,880 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-14 16:08:33,023 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-14 16:08:33,023 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/docs
2025-11-14 16:08:33,023 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 145.4ms
2025-11-14 16:08:33,269 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-14 16:08:33,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host limpio: 'cliente1.midominio.com'
2025-11-14 16:08:33,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN configurado: 'midominio.com'
2025-11-14 16:08:33,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado en dominio personalizado: 'cliente1'
2025-11-14 16:08:33,270 - app.core.multi_db - WARNING - Llamada a get_db_connection_for_current_tenant fuera de un contexto de request. Usando ID de SYSTEM.
2025-11-14 16:08:33,272 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto exitosamente: Subdominio='cliente1', Código='ACME001', ID=6
2025-11-14 16:08:33,272 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=6, verificación_contexto=6, path=/openapi.json
2025-11-14 16:08:33,275 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 6.1ms
2025-11-14 23:58:29,571 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-14 23:59:42,827 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 00:01:13,538 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 00:14:26,172 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 00:14:32,939 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 00:14:32,940 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-15 00:14:32,940 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:14:32,941 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 00:14:32,941 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 00:14:32,941 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 00:14:32,941 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-15 00:14:32,942 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.4ms
2025-11-15 00:14:44,074 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-15 00:14:44,075 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-15 00:14:44,075 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:14:44,075 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 00:14:44,075 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 00:14:44,075 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 00:14:44,076 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-15 00:14:44,153 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 79.3ms
2025-11-15 00:14:49,386 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 00:14:49,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-15 00:14:49,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:14:49,387 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 00:14:49,387 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 00:14:49,387 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 00:14:49,387 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-15 00:14:49,388 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.5ms
2025-11-15 00:14:49,448 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-15 00:14:49,449 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-15 00:14:49,449 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:14:49,449 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 00:14:49,449 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 00:14:49,449 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 00:14:49,450 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-15 00:14:49,452 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 3.2ms
2025-11-15 00:15:39,508 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 00:15:39,509 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-15 00:15:39,509 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:15:39,509 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 00:15:39,509 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 00:15:39,509 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 00:15:39,509 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 00:15:39,542 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 00:15:39,542 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-15 00:15:39,542 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-15 00:15:39,789 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-15 00:15:39,808 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 00:15:39,809 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 1
2025-11-15 00:15:39,809 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1
2025-11-15 00:15:39,809 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-15 00:15:39,810 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 301.9ms
2025-11-15 00:15:49,234 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 00:15:49,234 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'cliente1.midominio.com'
2025-11-15 00:15:49,235 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:15:49,235 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'cliente1'
2025-11-15 00:15:49,238 - app.middleware.tenant_middleware - ERROR - [TENANT] Subdominio 'cliente1' no encontrado
2025-11-15 00:15:49,238 - app.middleware.tenant_middleware - WARNING - [TENANT] Error: Subdominio 'cliente1' no está asociado a ningún cliente activo.
2025-11-15 00:15:49,238 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 404 4.3ms
2025-11-15 00:15:49,296 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /favicon.ico
2025-11-15 00:15:49,297 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'cliente1.midominio.com'
2025-11-15 00:15:49,297 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:15:49,297 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'cliente1'
2025-11-15 00:15:49,298 - app.middleware.tenant_middleware - ERROR - [TENANT] Subdominio 'cliente1' no encontrado
2025-11-15 00:15:49,298 - app.middleware.tenant_middleware - WARNING - [TENANT] Error: Subdominio 'cliente1' no está asociado a ningún cliente activo.
2025-11-15 00:15:49,299 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /favicon.ico 404 2.5ms
2025-11-15 00:17:51,318 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 00:17:51,318 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'cliente1.midominio.com'
2025-11-15 00:17:51,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:17:51,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'cliente1'
2025-11-15 00:17:51,328 - app.middleware.tenant_middleware - ERROR - [TENANT] Subdominio 'cliente1' no encontrado
2025-11-15 00:17:51,328 - app.middleware.tenant_middleware - WARNING - [TENANT] Error: Subdominio 'cliente1' no está asociado a ningún cliente activo.
2025-11-15 00:17:51,329 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 404 10.8ms
2025-11-15 00:18:47,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 00:18:47,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:18:47,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:18:47,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:18:47,654 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:18:47,657 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-15 00:18:47,657 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:18:47,657 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/docs
2025-11-15 00:18:47,658 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 6.2ms
2025-11-15 00:18:48,411 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-15 00:18:48,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:18:48,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:18:48,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:18:48,413 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:18:48,413 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:18:48,413 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/openapi.json
2025-11-15 00:18:48,415 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 3.8ms
2025-11-15 00:19:23,000 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 00:19:23,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:19:23,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:19:23,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:19:23,002 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:19:23,002 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:19:23,003 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 00:19:23,201 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:19:23,201 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:19:23,202 - app.services.base_service - ERROR - DatabaseError en obtener_cliente_por_id: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 171, in obtener_cliente_por_id
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:19:23,204 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ N/A 203.5ms
2025-11-15 00:19:23,204 - app.core.exceptions - ERROR - Error no manejado: name 'login_data' is not defined
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 96, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 87, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 214, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 198, in login
    |     logger.exception(f"Error inesperado en /login/ para usuario {login_data.username}: {str(e)}")
    |                                                                  ^^^^^^^^^^
    | NameError: name 'login_data' is not defined. Did you mean: 'LoginData'?
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 96, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 87, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 214, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 198, in login
    logger.exception(f"Error inesperado en /login/ para usuario {login_data.username}: {str(e)}")
                                                                 ^^^^^^^^^^
NameError: name 'login_data' is not defined. Did you mean: 'LoginData'?
2025-11-15 00:20:41,959 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 00:20:46,700 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 00:20:46,700 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:20:46,700 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:20:46,701 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:20:46,727 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:20:46,730 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-15 00:20:46,730 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:20:46,730 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/docs
2025-11-15 00:20:46,731 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 31.0ms
2025-11-15 00:20:46,934 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-15 00:20:46,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:20:46,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:20:46,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:20:46,936 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:20:46,936 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:20:46,936 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/openapi.json
2025-11-15 00:20:47,030 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 96.5ms
2025-11-15 00:22:26,618 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 00:22:26,618 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:22:26,618 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:22:26,619 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:22:26,634 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:22:26,635 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:22:26,635 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 00:22:26,666 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:22:26,666 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:22:26,667 - app.services.base_service - ERROR - DatabaseError en obtener_cliente_por_id: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 171, in obtener_cliente_por_id
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:22:26,669 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ N/A 50.9ms
2025-11-15 00:22:26,669 - app.core.exceptions - ERROR - Error no manejado: name 'login_data' is not defined
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 96, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 87, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 214, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 198, in login
    |     logger.exception(f"Error inesperado en /login/ para usuario {login_data.username}: {str(e)}")
    |                                                                  ^^^^^^^^^^
    | NameError: name 'login_data' is not defined. Did you mean: 'LoginData'?
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 96, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 87, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 214, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 198, in login
    logger.exception(f"Error inesperado en /login/ para usuario {login_data.username}: {str(e)}")
                                                                 ^^^^^^^^^^
NameError: name 'login_data' is not defined. Did you mean: 'LoginData'?
2025-11-15 00:24:45,975 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 00:24:45,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-15 00:24:45,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:24:45,976 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 00:24:45,976 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 00:24:45,976 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 00:24:45,976 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-15 00:24:45,976 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.9ms
2025-11-15 00:24:46,078 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-15 00:24:46,079 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-15 00:24:46,079 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:24:46,079 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 00:24:46,079 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 00:24:46,079 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 00:24:46,080 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-15 00:24:46,082 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 3.7ms
2025-11-15 00:25:02,349 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 00:25:02,350 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-15 00:25:02,350 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:25:02,350 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 00:25:02,350 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 00:25:02,350 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 00:25:02,351 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 00:25:02,362 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 00:25:02,362 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=1
2025-11-15 00:25:02,363 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=1 (del middleware)
2025-11-15 00:25:02,363 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_acme', cliente_id_buscado=1
2025-11-15 00:25:02,364 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 14.6ms
2025-11-15 00:30:24,425 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 00:33:42,380 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 00:33:49,088 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 00:33:49,090 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:33:49,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:33:49,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:33:49,120 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:33:49,123 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-15 00:33:49,123 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:33:49,124 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 00:33:49,147 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:33:49,147 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:33:49,148 - app.services.base_service - ERROR - DatabaseError en obtener_cliente_por_id: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 171, in obtener_cliente_por_id
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:33:49,150 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ N/A 62.0ms
2025-11-15 00:33:49,150 - app.core.exceptions - ERROR - Error no manejado: name 'login_data' is not defined
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 96, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 87, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 214, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 198, in login
    |     logger.exception(f"Error inesperado en /login/ para usuario {login_data.username}: {str(e)}")
    |                                                                  ^^^^^^^^^^
    | NameError: name 'login_data' is not defined. Did you mean: 'LoginData'?
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 96, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 87, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 214, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 198, in login
    logger.exception(f"Error inesperado en /login/ para usuario {login_data.username}: {str(e)}")
                                                                 ^^^^^^^^^^
NameError: name 'login_data' is not defined. Did you mean: 'LoginData'?
2025-11-15 00:43:30,414 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 00:44:25,320 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 00:44:25,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:44:25,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:44:25,321 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:44:25,344 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:44:25,347 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-15 00:44:25,347 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:44:25,347 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/docs
2025-11-15 00:44:25,348 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 28.3ms
2025-11-15 00:44:25,437 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-15 00:44:25,438 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:44:25,438 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:44:25,438 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:44:25,439 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:44:25,440 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:44:25,440 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/openapi.json
2025-11-15 00:44:25,517 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 80.3ms
2025-11-15 00:44:41,496 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 00:44:41,496 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:44:41,496 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:44:41,497 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:44:41,498 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:44:41,498 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:44:41,498 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 00:44:41,500 - app.services.base_service - ERROR - ERROR INESPERADO en obtener_cliente_por_id: name 'DatabaseConnection' is not defined
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 171, in obtener_cliente_por_id
    resultado = execute_query(query, (cliente_id,),connection_type=DatabaseConnection.ADMIN)
                                                                   ^^^^^^^^^^^^^^^^^^
NameError: name 'DatabaseConnection' is not defined
2025-11-15 00:44:41,502 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ N/A 5.9ms
2025-11-15 00:44:41,502 - app.core.exceptions - ERROR - Error no manejado: name 'login_data' is not defined
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 96, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 87, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 214, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 198, in login
    |     logger.exception(f"Error inesperado en /login/ para usuario {login_data.username}: {str(e)}")
    |                                                                  ^^^^^^^^^^
    | NameError: name 'login_data' is not defined. Did you mean: 'LoginData'?
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 96, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 87, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 214, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\auth.py", line 198, in login
    logger.exception(f"Error inesperado en /login/ para usuario {login_data.username}: {str(e)}")
                                                                 ^^^^^^^^^^
NameError: name 'login_data' is not defined. Did you mean: 'LoginData'?
2025-11-15 00:47:27,400 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 00:47:31,902 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 00:47:31,903 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:47:31,903 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:47:31,904 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:47:31,930 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:47:31,933 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-15 00:47:31,933 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:47:31,934 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 00:47:31,942 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-15 00:47:31,942 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=2
2025-11-15 00:47:31,943 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=2 (del middleware)
2025-11-15 00:47:32,223 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_id=2
2025-11-15 00:47:32,269 - app.db.queries - ERROR - Error en execute_insert: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:47:32,269 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:47:32,270 - app.services.base_service - ERROR - DatabaseError en store_refresh_token: Error en la inserción: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 91, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:47:32,271 - app.api.v1.endpoints.auth - ERROR - Error almacenando refresh token: Error en la inserción: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'refresh_tokens'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-15 00:47:32,272 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-15 00:47:32,272 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 370.1ms
2025-11-15 00:50:02,227 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 00:50:02,228 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:50:02,228 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:50:02,228 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:50:02,238 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:50:02,239 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:50:02,239 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 00:50:02,242 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-15 00:50:02,242 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=2
2025-11-15 00:50:02,242 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=2 (del middleware)
2025-11-15 00:50:02,472 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_id=2
2025-11-15 00:50:02,485 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 00:50:02,485 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 2, Usuario 1 - Cliente: web - Token ID: 1
2025-11-15 00:50:02,486 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1
2025-11-15 00:50:02,486 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-15 00:50:02,486 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 259.3ms
2025-11-15 00:50:18,837 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 00:50:22,651 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 00:50:22,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:50:22,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:50:22,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:50:22,679 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:50:22,684 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-15 00:50:22,685 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:50:22,686 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 00:50:22,695 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-15 00:50:22,695 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=2
2025-11-15 00:50:22,695 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=2 (del middleware)
2025-11-15 00:50:22,965 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_id=2
2025-11-15 00:50:22,980 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 00:50:22,980 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 2, Usuario 1 - Cliente: web - Token ID: 2
2025-11-15 00:50:22,980 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2
2025-11-15 00:50:22,981 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-15 00:50:22,981 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 330.6ms
2025-11-15 00:54:19,464 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 00:54:23,964 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 00:54:23,964 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:54:23,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:54:23,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:54:23,992 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:54:23,995 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-15 00:54:23,995 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:54:23,996 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 00:54:24,005 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-15 00:54:24,005 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=2
2025-11-15 00:54:24,005 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=2 (del middleware)
2025-11-15 00:54:24,005 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 00:54:24,252 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 00:54:24,254 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_id=2
2025-11-15 00:54:24,254 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 00:54:24,257 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 00:54:24,258 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 00:54:24,258 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 2, Usuario 1 - Cliente: web - Token ID: 3
2025-11-15 00:54:24,258 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 3
2025-11-15 00:54:24,259 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-15 00:54:24,259 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 295.6ms
2025-11-15 00:59:07,900 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 00:59:07,900 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 00:59:07,900 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 00:59:07,901 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 00:59:07,911 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 00:59:07,911 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 00:59:07,912 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 00:59:07,914 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-15 00:59:07,914 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=2
2025-11-15 00:59:07,915 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-15 00:59:07,915 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 00:59:07,921 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='superadmin', cliente_id_buscado=1
2025-11-15 00:59:07,922 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 21.7ms
2025-11-15 01:48:27,890 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 01:49:18,165 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 01:58:26,353 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 08:45:32,676 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 08:51:29,674 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 09:00:55,981 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 09:01:08,523 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 09:01:56,810 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 09:01:56,811 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-15 09:01:56,811 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:01:56,811 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:01:56,811 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:01:56,811 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:01:56,812 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-15 09:01:56,818 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 7.7ms
2025-11-15 09:01:56,913 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-15 09:01:56,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-15 09:01:56,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:01:56,913 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:01:56,914 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:01:56,914 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:01:56,914 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-15 09:01:56,990 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 77.1ms
2025-11-15 09:02:12,977 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:02:12,977 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-15 09:02:12,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:02:12,978 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:02:12,978 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:02:12,978 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:02:12,978 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 09:02:13,080 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 09:02:13,080 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=1
2025-11-15 09:02:13,080 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-15 09:02:13,318 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_id=1
2025-11-15 09:02:13,336 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:02:13,336 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2
2025-11-15 09:02:13,336 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2
2025-11-15 09:02:13,336 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-15 09:02:13,337 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 360.3ms
2025-11-15 09:02:26,999 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:02:26,999 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-15 09:02:26,999 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:02:26,999 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:02:27,000 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:02:27,000 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:02:27,000 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 09:02:27,002 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 09:02:27,002 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=1
2025-11-15 09:02:27,003 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=1 (del middleware)
2025-11-15 09:02:27,004 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_acme', cliente_id_buscado=1
2025-11-15 09:02:27,004 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 5.3ms
2025-11-15 09:02:31,120 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 09:02:31,121 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 09:02:31,121 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:02:31,121 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 09:02:31,124 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 09:02:31,129 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-15 09:02:31,129 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 09:02:31,130 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/docs
2025-11-15 09:02:31,130 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 10.1ms
2025-11-15 09:02:31,303 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-15 09:02:31,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 09:02:31,304 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:02:31,304 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 09:02:31,305 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 09:02:31,305 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 09:02:31,306 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/openapi.json
2025-11-15 09:02:31,308 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 4.6ms
2025-11-15 09:02:47,765 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:02:47,766 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 09:02:47,766 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:02:47,766 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 09:02:47,767 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 09:02:47,767 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 09:02:47,767 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 09:02:47,769 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-15 09:02:47,769 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_recibido=2
2025-11-15 09:02:47,770 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en cliente_id=2 (del middleware)
2025-11-15 09:02:47,770 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:02:48,055 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:02:48,060 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_id=2
2025-11-15 09:02:48,060 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:02:48,065 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:02:48,069 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:02:48,069 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 2, Usuario 1 - Cliente: web - Token ID: 1002
2025-11-15 09:02:48,069 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1002
2025-11-15 09:02:48,069 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-15 09:02:48,070 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 305.0ms
2025-11-15 09:02:54,751 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:02:54,752 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 09:02:54,752 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:02:54,752 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 09:02:54,753 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 09:02:54,754 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 09:02:54,754 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 09:02:54,757 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-15 09:02:54,757 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_recibido=2
2025-11-15 09:02:54,757 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Forzando búsqueda en cliente_id=1 (SYSTEM)
2025-11-15 09:02:54,758 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:02:54,759 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='superadmin', cliente_id_buscado=1
2025-11-15 09:02:54,759 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 7.8ms
2025-11-15 09:04:44,397 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 09:05:32,480 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 09:06:17,783 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 09:07:32,319 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 09:08:42,667 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 09:08:51,405 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:08:51,405 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 09:08:51,405 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:08:51,406 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 09:08:51,430 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 09:08:51,432 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-15 09:08:51,432 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 09:08:51,433 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 09:08:51,440 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-15 09:08:51,440 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=2
2025-11-15 09:08:51,441 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=2
2025-11-15 09:08:51,668 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:08:51,738 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=2
2025-11-15 09:08:51,738 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=2
2025-11-15 09:08:51,741 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:08:51,744 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:08:51,744 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 2, Usuario 1 - Cliente: web - Token ID: 1003
2025-11-15 09:08:51,744 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1003
2025-11-15 09:08:51,745 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 2
2025-11-15 09:08:51,745 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 340.7ms
2025-11-15 09:10:25,607 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:10:25,608 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 09:10:25,608 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:10:25,608 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 09:10:25,618 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 09:10:25,618 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 09:10:25,618 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 09:10:25,621 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-15 09:10:25,621 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=2
2025-11-15 09:10:25,621 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=2
2025-11-15 09:10:25,841 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:10:25,848 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=2
2025-11-15 09:10:25,849 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=2
2025-11-15 09:10:25,849 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:10:25,850 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:10:25,851 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 2, Usuario 1 - Cliente: web - Token ID: 1004
2025-11-15 09:10:25,851 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1004
2025-11-15 09:10:25,851 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 2
2025-11-15 09:10:25,852 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 244.5ms
2025-11-15 09:10:46,676 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:10:46,676 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 09:10:46,676 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:10:46,677 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 09:10:46,678 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 09:10:46,678 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 09:10:46,678 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 09:10:46,682 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-15 09:10:46,682 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-15 09:10:46,682 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-15 09:10:46,683 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:10:46,902 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:10:46,903 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A
2025-11-15 09:10:46,904 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:10:46,908 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:10:46,909 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:10:46,909 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 2, Usuario 1 - Cliente: web - Token ID: 1005
2025-11-15 09:10:46,910 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1005
2025-11-15 09:10:46,910 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-15 09:10:46,910 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 234.5ms
2025-11-15 09:11:15,922 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:11:15,923 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 09:11:15,923 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:11:15,923 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 09:11:15,925 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 09:11:15,925 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 09:11:15,925 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 09:11:15,927 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-15 09:11:15,927 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=2
2025-11-15 09:11:15,927 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=2
2025-11-15 09:11:16,145 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:11:16,146 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=2
2025-11-15 09:11:16,146 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=2
2025-11-15 09:11:16,147 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:11:16,147 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:11:16,148 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 2, Usuario 1 - Cliente: web - Token ID: 1006
2025-11-15 09:11:16,148 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1006
2025-11-15 09:11:16,148 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 2
2025-11-15 09:11:16,149 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 226.2ms
2025-11-15 09:11:58,832 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 09:11:58,833 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.midominio.com'
2025-11-15 09:11:58,833 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:11:58,833 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-15 09:11:58,835 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-15 09:11:58,837 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 3: multi - bd_cliente_innova
2025-11-15 09:11:58,837 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-15 09:11:58,837 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/docs
2025-11-15 09:11:58,838 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 5.4ms
2025-11-15 09:11:58,913 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-15 09:11:58,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.midominio.com'
2025-11-15 09:11:58,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:11:58,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-15 09:11:58,915 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-15 09:11:58,915 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-15 09:11:58,915 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/openapi.json
2025-11-15 09:11:59,000 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 86.7ms
2025-11-15 09:12:25,617 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:12:25,618 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.midominio.com'
2025-11-15 09:12:25,618 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:12:25,618 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-15 09:12:25,621 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-15 09:12:25,623 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-15 09:12:25,623 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/login/
2025-11-15 09:12:25,628 - app.api.v1.endpoints.auth - INFO - Cliente 3 resuelto y validado para login.
2025-11-15 09:12:25,628 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=3
2025-11-15 09:12:25,628 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=3
2025-11-15 09:12:25,628 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-15 09:12:25,696 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_acme', cliente_id_buscado=3
2025-11-15 09:12:25,697 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 79.5ms
2025-11-15 09:12:34,917 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:12:34,917 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.midominio.com'
2025-11-15 09:12:34,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:12:34,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-15 09:12:34,919 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-15 09:12:34,919 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-15 09:12:34,919 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/login/
2025-11-15 09:12:34,922 - app.api.v1.endpoints.auth - INFO - Cliente 3 resuelto y validado para login.
2025-11-15 09:12:34,922 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_innova', cliente_id_destino=3
2025-11-15 09:12:34,922 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=3
2025-11-15 09:12:34,922 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-15 09:12:35,144 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-15 09:12:35,149 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_innova', usuario_id=1, cliente_origen=3, cliente_destino=N/A
2025-11-15 09:12:35,149 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-15 09:12:35,163 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-15 09:12:35,167 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:12:35,168 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 3, Usuario 1 - Cliente: web - Token ID: 1
2025-11-15 09:12:35,168 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1
2025-11-15 09:12:35,168 - app.api.v1.endpoints.auth - INFO - Usuario admin_innova autenticado exitosamente (WEB) para cliente 3
2025-11-15 09:12:35,169 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 251.6ms
2025-11-15 09:12:50,502 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:12:50,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.midominio.com'
2025-11-15 09:12:50,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:12:50,503 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-15 09:12:50,504 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-15 09:12:50,504 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-15 09:12:50,504 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/login/
2025-11-15 09:12:50,507 - app.api.v1.endpoints.auth - INFO - Cliente 3 resuelto y validado para login.
2025-11-15 09:12:50,507 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=3
2025-11-15 09:12:50,507 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=3
2025-11-15 09:12:50,722 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-15 09:12:50,723 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=3
2025-11-15 09:12:50,723 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=3
2025-11-15 09:12:50,723 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-15 09:12:50,724 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:12:50,724 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 3, Usuario 1 - Cliente: web - Token ID: 2
2025-11-15 09:12:50,724 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2
2025-11-15 09:12:50,725 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 3
2025-11-15 09:12:50,725 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 223.2ms
2025-11-15 09:13:13,754 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:13:13,754 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.midominio.com'
2025-11-15 09:13:13,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:13:13,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-15 09:13:13,756 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-15 09:13:13,756 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-15 09:13:13,756 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/login/
2025-11-15 09:13:13,759 - app.api.v1.endpoints.auth - INFO - Cliente 3 resuelto y validado para login.
2025-11-15 09:13:13,760 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=3
2025-11-15 09:13:13,760 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=3
2025-11-15 09:13:13,760 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-15 09:13:13,762 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_acme', cliente_id_buscado=3
2025-11-15 09:13:13,763 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 8.6ms
2025-11-15 09:13:36,060 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 09:13:36,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.midominio.com'
2025-11-15 09:13:36,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:13:36,061 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-15 09:13:36,062 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-15 09:13:36,062 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-15 09:13:36,062 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/docs
2025-11-15 09:13:36,063 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 3.0ms
2025-11-15 09:13:36,150 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-15 09:13:36,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.midominio.com'
2025-11-15 09:13:36,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:13:36,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-15 09:13:36,151 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-15 09:13:36,152 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-15 09:13:36,152 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/openapi.json
2025-11-15 09:13:36,154 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 4.2ms
2025-11-15 09:14:03,077 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 09:14:03,077 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-15 09:14:03,078 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:14:03,078 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-15 09:14:03,080 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-15 09:14:03,082 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_hybrid_sistema_central
2025-11-15 09:14:03,082 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=localhost
2025-11-15 09:14:03,082 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-15 09:14:03,083 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 5.7ms
2025-11-15 09:14:03,145 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-15 09:14:03,145 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-15 09:14:03,145 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:14:03,146 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-15 09:14:03,147 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-15 09:14:03,147 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=localhost
2025-11-15 09:14:03,147 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-15 09:14:03,150 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 5.5ms
2025-11-15 09:14:46,873 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:14:46,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-15 09:14:46,874 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:14:46,874 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-15 09:14:46,875 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-15 09:14:46,875 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=localhost
2025-11-15 09:14:46,875 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 09:14:46,877 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-15 09:14:46,877 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-15 09:14:46,881 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-15 09:14:47,103 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A
2025-11-15 09:14:47,105 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:14:47,106 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 4, Usuario 2 - Cliente: web - Token ID: 3
2025-11-15 09:14:47,106 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 3
2025-11-15 09:14:47,106 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-15 09:14:47,107 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 233.8ms
2025-11-15 09:14:56,124 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:14:56,124 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-15 09:14:56,124 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:14:56,124 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-15 09:14:56,125 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-15 09:14:56,126 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=localhost
2025-11-15 09:14:56,126 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 09:14:56,128 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-15 09:14:56,131 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=4
2025-11-15 09:14:56,132 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-15 09:14:56,135 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_acme', cliente_id_buscado=4
2025-11-15 09:14:56,135 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 11.6ms
2025-11-15 09:15:01,064 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:15:01,064 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-15 09:15:01,064 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:15:01,065 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-15 09:15:01,066 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-15 09:15:01,066 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=localhost
2025-11-15 09:15:01,066 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 09:15:01,068 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-15 09:15:01,072 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_innova', cliente_id_destino=4
2025-11-15 09:15:01,073 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-15 09:15:01,077 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_innova', cliente_id_buscado=4
2025-11-15 09:15:01,078 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 14.1ms
2025-11-15 09:15:07,940 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:15:07,940 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-15 09:15:07,940 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:15:07,941 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-15 09:15:07,942 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-15 09:15:07,942 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=localhost
2025-11-15 09:15:07,942 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 09:15:07,944 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-15 09:15:07,945 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=4
2025-11-15 09:15:07,945 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=4
2025-11-15 09:15:08,158 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=4
2025-11-15 09:15:08,159 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=4
2025-11-15 09:15:08,160 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:15:08,160 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 4, Usuario 1 - Cliente: web - Token ID: 4
2025-11-15 09:15:08,160 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 4
2025-11-15 09:15:08,161 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 4
2025-11-15 09:15:08,161 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 221.5ms
2025-11-15 09:15:32,891 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:15:32,892 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-15 09:15:32,892 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:15:32,892 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-15 09:15:32,893 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-15 09:15:32,893 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=localhost
2025-11-15 09:15:32,894 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 09:15:32,896 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-15 09:15:32,896 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=4
2025-11-15 09:15:32,903 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=4
2025-11-15 09:15:33,129 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=4
2025-11-15 09:15:33,129 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=4
2025-11-15 09:15:33,130 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:15:33,131 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 4, Usuario 1 - Cliente: web - Token ID: 5
2025-11-15 09:15:33,131 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 5
2025-11-15 09:15:33,131 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 4
2025-11-15 09:15:33,131 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 240.1ms
2025-11-15 09:16:34,061 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:16:34,061 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-15 09:16:34,061 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:16:34,061 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-15 09:16:34,063 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-15 09:16:34,063 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=localhost
2025-11-15 09:16:34,063 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 09:16:34,066 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-15 09:16:34,066 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-15 09:16:34,066 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-15 09:16:34,290 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A
2025-11-15 09:16:34,292 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:16:34,292 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 4, Usuario 2 - Cliente: web - Token ID: 6
2025-11-15 09:16:34,292 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 6
2025-11-15 09:16:34,293 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-15 09:16:34,293 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 232.6ms
2025-11-15 09:17:34,567 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:17:34,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-15 09:17:34,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:17:34,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-15 09:17:34,569 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-15 09:17:34,570 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-15 09:17:34,570 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-15 09:17:34,570 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-15 09:17:34,572 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-15 09:17:34,572 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-15 09:17:34,573 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-15 09:17:34,573 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:17:34,838 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:17:34,842 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A
2025-11-15 09:17:34,842 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:17:34,849 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-15 09:17:34,853 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:17:34,853 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 2, Usuario 1 - Cliente: web - Token ID: 1007
2025-11-15 09:17:34,853 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1007
2025-11-15 09:17:34,854 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-15 09:17:34,854 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 287.3ms
2025-11-15 09:22:22,791 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 09:39:38,790 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 09:39:38,790 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-15 09:39:39,101 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 09:39:39,102 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:39:39,102 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:39:39,102 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:39:39,103 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:39:39,103 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:39:39,103 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 09:39:39,107 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 09:39:39,107 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.4ms
2025-11-15 09:45:12,534 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-15 09:45:12,535 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.7ms
2025-11-15 09:45:12,851 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:45:12,852 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:45:12,852 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:45:12,852 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:45:12,852 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:45:12,852 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:45:12,852 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 09:45:12,878 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 09:45:12,878 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-15 09:45:12,878 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-15 09:45:13,113 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1
2025-11-15 09:45:13,113 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-15 09:45:13,124 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:45:13,125 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 7
2025-11-15 09:45:13,125 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 7
2025-11-15 09:45:13,125 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-15 09:45:13,126 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 274.9ms
2025-11-15 09:45:13,157 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-15 09:45:13,158 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-15 09:45:13,158 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.7ms
2025-11-15 09:45:13,158 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.8ms
2025-11-15 09:45:13,162 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:45:13,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:45:13,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:45:13,163 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:45:13,163 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:45:13,163 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:45:13,164 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:45:13,177 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:45:13,178 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:45:13,183 - app.db.queries - ERROR - Error en execute_procedure_params: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-15 09:45:13,184 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 175, in execute_procedure_params
    cursor.execute(query, tuple(params.values()))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 187, in execute_procedure_params
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-15 09:45:13,186 - app.services.menu_service - ERROR - Error de BD al obtener menú para usuario 1: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-15 09:45:13,186 - app.api.v1.endpoints.menus - ERROR - Error de servicio en GET /getmenu/ para usuario 1: Error de base de datos al obtener menú del usuario
2025-11-15 09:45:13,187 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 25.6ms
2025-11-15 09:45:13,189 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:45:13,190 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:45:13,190 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:45:13,190 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:45:13,190 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:45:13,191 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:45:13,191 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:45:13,194 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:45:13,194 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:45:13,195 - app.db.queries - ERROR - Error en execute_procedure_params: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-15 09:45:13,196 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 175, in execute_procedure_params
    cursor.execute(query, tuple(params.values()))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 187, in execute_procedure_params
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-15 09:45:13,197 - app.services.menu_service - ERROR - Error de BD al obtener menú para usuario 1: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-15 09:45:13,197 - app.api.v1.endpoints.menus - ERROR - Error de servicio en GET /getmenu/ para usuario 1: Error de base de datos al obtener menú del usuario
2025-11-15 09:45:13,198 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 8.7ms
2025-11-15 09:46:42,569 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-15 09:46:42,569 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-15 09:46:42,872 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-15 09:46:42,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:46:42,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:46:42,873 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:46:42,873 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:46:42,873 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:46:42,873 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-15 09:46:42,898 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-15 09:46:42,899 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-15 09:46:42,899 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-15 09:46:42,899 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 27.0ms
2025-11-15 09:46:55,472 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:46:55,473 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:46:55,473 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:46:55,473 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:46:55,473 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:46:55,474 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:46:55,474 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 09:46:55,476 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 09:46:55,476 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-15 09:46:55,476 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-15 09:46:55,686 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1
2025-11-15 09:46:55,687 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-15 09:46:55,688 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:46:55,688 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 8
2025-11-15 09:46:55,689 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 8
2025-11-15 09:46:55,689 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-15 09:46:55,689 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 216.8ms
2025-11-15 09:46:55,702 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:46:55,703 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:46:55,703 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:46:55,704 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:46:55,704 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:46:55,704 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:46:55,704 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:46:55,707 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:46:55,707 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:46:55,765 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:46:55,766 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 63.4ms
2025-11-15 09:46:55,767 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:46:55,768 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:46:55,768 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:46:55,768 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:46:55,768 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:46:55,768 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:46:55,769 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:46:55,770 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:46:55,771 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:46:55,772 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:46:55,772 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 4.5ms
2025-11-15 09:49:07,089 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 09:49:07,090 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:49:07,090 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:49:07,090 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:49:07,090 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:49:07,091 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:49:07,091 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 09:49:07,107 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-15 09:49:07,109 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-15 09:49:07,110 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-15 09:49:07,111 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-15 09:49:07,111 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-15 09:49:07,112 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:49:07,112 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 9
2025-11-15 09:49:07,112 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 9
2025-11-15 09:49:07,112 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-15 09:49:07,113 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 24.5ms
2025-11-15 09:49:08,406 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 09:49:08,458 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-15 09:49:08,459 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.8ms
2025-11-15 09:49:08,461 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-15 09:49:08,461 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:49:08,461 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:49:08,461 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:49:08,461 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:49:08,462 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:49:08,462 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-15 09:49:08,490 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-15 09:49:08,492 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 31.0ms
2025-11-15 09:49:08,504 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:49:08,504 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:49:08,504 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:49:08,504 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:49:08,504 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:49:08,504 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:49:08,505 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:49:08,507 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:49:08,508 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:49:08,509 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:49:08,509 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.7ms
2025-11-15 09:49:08,512 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:49:08,512 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:49:08,513 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:49:08,513 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:49:08,513 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:49:08,513 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:49:08,513 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:49:08,516 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:49:08,517 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:49:08,518 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:49:08,518 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.1ms
2025-11-15 09:49:46,828 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-15 09:49:46,829 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:49:46,829 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:49:46,829 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:49:46,829 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:49:46,829 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:49:46,829 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-15 09:49:46,833 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-15 09:49:46,834 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-15 09:49:46,834 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-15 09:49:46,834 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 6.3ms
2025-11-15 09:49:59,055 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 09:49:59,055 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:49:59,055 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:49:59,056 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:49:59,056 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:49:59,056 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:49:59,056 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 09:49:59,062 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 09:49:59,062 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-15 09:49:59,062 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-15 09:49:59,293 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1
2025-11-15 09:49:59,293 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-15 09:49:59,294 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:49:59,295 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 10
2025-11-15 09:49:59,295 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 10
2025-11-15 09:49:59,295 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-15 09:49:59,295 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 240.8ms
2025-11-15 09:49:59,310 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:49:59,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:49:59,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:49:59,311 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:49:59,311 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:49:59,311 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:49:59,312 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:49:59,314 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:49:59,315 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:49:59,316 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:49:59,317 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.1ms
2025-11-15 09:49:59,319 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:49:59,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:49:59,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:49:59,320 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:49:59,320 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:49:59,320 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:49:59,320 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:49:59,323 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:49:59,324 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:49:59,325 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:49:59,326 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.7ms
2025-11-15 09:52:38,239 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 09:52:38,240 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.3ms
2025-11-15 09:52:39,546 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 09:52:39,584 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 09:52:39,585 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:52:39,585 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:52:39,585 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:52:39,585 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:52:39,585 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:52:39,586 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 09:52:39,617 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-15 09:52:39,618 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-15 09:52:39,618 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-15 09:52:39,619 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-15 09:52:39,619 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-15 09:52:39,620 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:52:39,620 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 11
2025-11-15 09:52:39,621 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 11
2025-11-15 09:52:39,621 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-15 09:52:39,621 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 36.9ms
2025-11-15 09:52:39,626 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-15 09:52:39,626 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:52:39,626 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:52:39,627 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:52:39,627 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:52:39,627 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:52:39,627 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-15 09:52:39,629 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-15 09:52:39,630 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 3.8ms
2025-11-15 09:52:39,640 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:52:39,641 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:52:39,641 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:52:39,641 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:52:39,641 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:52:39,642 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:52:39,642 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:52:39,645 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:52:39,645 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:52:39,646 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:52:39,647 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.5ms
2025-11-15 09:52:39,649 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:52:39,649 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:52:39,649 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:52:39,650 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:52:39,650 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:52:39,650 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:52:39,650 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:52:39,652 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:52:39,652 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:52:39,653 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:52:39,654 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.2ms
2025-11-15 09:54:52,766 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 09:54:52,766 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:54:52,767 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:54:52,767 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:54:52,767 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:54:52,767 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:54:52,767 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 09:54:52,777 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-15 09:54:52,778 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-15 09:54:52,779 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-15 09:54:52,780 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-15 09:54:52,780 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-15 09:54:52,781 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 09:54:52,781 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 12
2025-11-15 09:54:52,782 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 12
2025-11-15 09:54:52,782 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-15 09:54:52,782 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.2ms
2025-11-15 09:54:52,787 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-15 09:54:52,788 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:54:52,788 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:54:52,788 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:54:52,788 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:54:52,788 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:54:52,789 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-15 09:54:52,790 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-15 09:54:52,791 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 4.3ms
2025-11-15 09:54:52,800 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:54:52,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:54:52,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:54:52,801 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:54:52,801 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:54:52,802 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:54:52,802 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:54:52,805 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:54:52,805 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:54:52,806 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:54:52,807 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.2ms
2025-11-15 09:54:52,809 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:54:52,809 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:54:52,809 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:54:52,809 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:54:52,809 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:54:52,810 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:54:52,810 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:54:52,812 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:54:52,812 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:54:52,813 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:54:52,813 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 4.8ms
2025-11-15 09:55:51,022 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-15 09:55:51,023 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-15 09:55:51,024 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-11-15 09:55:51,024 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.6ms
2025-11-15 09:55:51,026 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:55:51,026 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:55:51,026 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:55:51,026 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:55:51,026 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:55:51,026 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:55:51,027 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:55:51,027 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 401 1.3ms
2025-11-15 09:55:51,028 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:55:51,029 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:55:51,029 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:55:51,029 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:55:51,029 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:55:51,029 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:55:51,030 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:55:51,032 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:55:51,032 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:55:51,033 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:55:51,034 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.5ms
2025-11-15 09:56:08,063 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-15 09:56:08,064 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.6ms
2025-11-15 09:56:08,066 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-15 09:56:08,067 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 0.5ms
2025-11-15 09:56:08,070 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-15 09:56:08,070 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.7ms
2025-11-15 09:56:08,073 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-15 09:56:08,073 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 0.5ms
2025-11-15 09:56:08,372 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:56:08,373 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:08,373 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:08,373 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:08,374 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:08,374 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:08,374 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:56:08,374 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 09:56:08,374 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 09:56:08,377 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:56:08,377 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:56:08,378 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:56:08,378 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:08,378 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:08,378 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:08,378 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:08,379 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:08,379 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 09:56:08,379 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:08,380 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:08,380 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:08,380 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:08,380 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:08,380 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 09:56:08,391 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 09:56:08,392 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 09:56:08,402 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 09:56:08,402 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 09:56:08,407 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 09:56:08,409 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 09:56:08,410 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 09:56:08,410 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 37.7ms
2025-11-15 09:56:08,411 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 36.4ms
2025-11-15 09:56:08,411 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 36.3ms
2025-11-15 09:56:08,413 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 09:56:08,414 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:08,414 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:08,414 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:08,414 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:08,414 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:08,415 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 09:56:08,417 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 09:56:08,417 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 09:56:08,418 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 09:56:08,419 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 09:56:08,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:08,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:08,419 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:08,420 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:08,420 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:08,420 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 09:56:08,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 09:56:08,424 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 09:56:08,425 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 09:56:08,425 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 09:56:08,426 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:08,426 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:08,426 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:08,426 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:08,426 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:08,427 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 09:56:08,430 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 09:56:08,430 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 09:56:08,434 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 09:56:08,434 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 09:56:08,435 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 21.6ms
2025-11-15 09:56:08,435 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 16.6ms
2025-11-15 09:56:08,436 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 15.6ms
2025-11-15 09:56:11,077 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-15 09:56:11,078 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.8ms
2025-11-15 09:56:11,078 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-15 09:56:11,079 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.8ms
2025-11-15 09:56:11,080 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-15 09:56:11,080 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:11,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:11,081 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:11,081 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:11,081 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:11,081 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-15 09:56:11,087 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 09:56:11,087 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 09:56:11,095 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-15 09:56:11,096 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 16.1ms
2025-11-15 09:56:11,098 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-15 09:56:11,099 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:11,099 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:11,099 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:11,099 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:11,099 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:11,099 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-15 09:56:11,102 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 09:56:11,102 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 09:56:11,105 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-15 09:56:11,106 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 7.4ms
2025-11-15 09:56:15,895 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-15 09:56:15,896 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-15 09:56:15,896 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.2ms
2025-11-15 09:56:15,897 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.9ms
2025-11-15 09:56:15,899 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-15 09:56:15,900 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:15,900 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:15,900 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:15,900 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:15,900 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:15,900 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-15 09:56:15,905 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-15 09:56:15,906 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-15 09:56:15,913 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:15,913 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:15,913 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:15,914 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:15,914 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:15,914 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 5 totales
2025-11-15 09:56:15,914 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 5, Página: 1
2025-11-15 09:56:15,915 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.5ms
2025-11-15 09:56:15,916 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-15 09:56:15,916 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:15,917 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:15,917 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:15,917 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:15,917 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:15,917 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-15 09:56:15,921 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-15 09:56:15,921 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-15 09:56:15,924 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:15,924 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:15,924 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:15,924 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:15,925 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:15,925 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 5 totales
2025-11-15 09:56:15,925 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 5, Página: 1
2025-11-15 09:56:15,925 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 9.3ms
2025-11-15 09:56:17,157 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-15 09:56:17,157 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.7ms
2025-11-15 09:56:17,157 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-15 09:56:17,158 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.1ms
2025-11-15 09:56:17,160 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-15 09:56:17,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:17,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:17,160 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:17,160 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:17,161 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:17,161 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/list/
2025-11-15 09:56:17,166 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 09:56:17,166 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 1
2025-11-15 09:56:17,171 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:17,171 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:17,171 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:17,171 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:17,171 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:17,172 - app.services.area_service - INFO - Lista simple obtenida para cliente 1: 0 áreas activas
2025-11-15 09:56:17,172 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 1 - Total: 0 áreas activas
2025-11-15 09:56:17,172 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 12.7ms
2025-11-15 09:56:17,174 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-15 09:56:17,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:17,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:17,175 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:17,175 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:17,175 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:17,175 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/list/
2025-11-15 09:56:17,179 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 09:56:17,179 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 1
2025-11-15 09:56:17,180 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:17,180 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:17,180 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:17,181 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:17,181 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:17,181 - app.services.area_service - INFO - Lista simple obtenida para cliente 1: 0 áreas activas
2025-11-15 09:56:17,181 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 1 - Total: 0 áreas activas
2025-11-15 09:56:17,182 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 7.6ms
2025-11-15 09:56:25,547 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-15 09:56:25,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:25,548 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:25,548 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:25,548 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:25,548 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:25,548 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-15 09:56:25,553 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-15 09:56:25,553 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-15 09:56:25,558 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:25,558 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:25,559 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:25,559 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:25,559 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:25,559 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 5 totales
2025-11-15 09:56:25,560 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 5, Página: 1
2025-11-15 09:56:25,560 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.3ms
2025-11-15 09:56:25,562 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-15 09:56:25,562 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:25,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:25,563 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:25,563 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:25,563 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:25,563 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-15 09:56:25,567 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-15 09:56:25,568 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-15 09:56:25,571 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:25,572 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:25,572 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:25,572 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:25,572 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:25,573 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 5 totales
2025-11-15 09:56:25,573 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 5, Página: 1
2025-11-15 09:56:25,573 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 11.0ms
2025-11-15 09:56:26,489 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-15 09:56:26,490 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 0.9ms
2025-11-15 09:56:26,490 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-15 09:56:26,491 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 1.1ms
2025-11-15 09:56:26,493 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-15 09:56:26,493 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:26,493 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:26,493 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:26,494 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:26,494 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:26,494 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/sessions/admin/
2025-11-15 09:56:26,500 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: superadmin
2025-11-15 09:56:26,506 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] Se recuperaron 3 sesiones activas totales.
2025-11-15 09:56:26,506 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 3 sesiones activas totales.
2025-11-15 09:56:26,507 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 14.1ms
2025-11-15 09:56:26,509 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-15 09:56:26,509 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:26,510 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:26,510 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:26,510 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:26,510 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:26,510 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/sessions/admin/
2025-11-15 09:56:26,515 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: superadmin
2025-11-15 09:56:26,516 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] Se recuperaron 3 sesiones activas totales.
2025-11-15 09:56:26,516 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 3 sesiones activas totales.
2025-11-15 09:56:26,517 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 7.8ms
2025-11-15 09:56:34,656 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 09:56:34,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:34,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:34,657 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:34,657 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:34,657 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:34,657 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 09:56:34,663 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 09:56:34,663 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 09:56:34,669 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 09:56:34,670 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 09:56:34,671 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 09:56:34,671 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 15.3ms
2025-11-15 09:56:34,671 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:34,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:34,672 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:34,672 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:34,672 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:34,672 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 09:56:34,676 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 09:56:34,677 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 09:56:34,677 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 09:56:34,678 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 7.5ms
2025-11-15 09:56:34,680 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 09:56:34,680 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:34,681 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:34,681 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:34,681 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:34,681 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:34,681 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 09:56:34,686 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 09:56:34,686 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 09:56:34,690 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 09:56:34,690 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 09:56:34,691 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 09:56:34,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:34,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:34,691 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:34,691 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:34,691 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:34,692 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 09:56:34,695 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 09:56:34,695 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 09:56:34,696 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 09:56:34,696 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.1ms
2025-11-15 09:56:34,697 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 6.0ms
2025-11-15 09:56:35,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-15 09:56:35,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:35,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:35,579 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:35,579 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:35,580 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:35,580 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-15 09:56:35,584 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 09:56:35,584 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 09:56:35,588 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-15 09:56:35,589 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 10.9ms
2025-11-15 09:56:35,591 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-15 09:56:35,592 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:35,592 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:35,592 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:35,592 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:35,593 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:35,593 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-15 09:56:35,597 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 09:56:35,597 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 09:56:35,600 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-15 09:56:35,601 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 9.6ms
2025-11-15 09:56:36,733 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-15 09:56:36,734 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:36,734 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:36,734 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:36,734 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:36,735 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:36,735 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-15 09:56:36,739 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-15 09:56:36,740 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-15 09:56:36,744 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:36,744 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:36,744 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:36,745 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:36,745 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:36,745 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 5 totales
2025-11-15 09:56:36,745 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 5, Página: 1
2025-11-15 09:56:36,746 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.3ms
2025-11-15 09:56:36,748 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-15 09:56:36,748 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:36,748 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:36,748 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:36,749 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:36,749 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:36,749 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-15 09:56:36,754 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-15 09:56:36,754 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-15 09:56:36,758 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:36,758 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:36,758 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:36,758 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:36,759 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:36,759 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 5 totales
2025-11-15 09:56:36,759 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 5, Página: 1
2025-11-15 09:56:36,760 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 11.8ms
2025-11-15 09:56:37,762 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-15 09:56:37,762 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:37,762 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:37,763 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:37,763 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:37,763 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:37,763 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/list/
2025-11-15 09:56:37,767 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 09:56:37,767 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 1
2025-11-15 09:56:37,769 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:37,769 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:37,769 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:37,770 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:37,770 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:37,770 - app.services.area_service - INFO - Lista simple obtenida para cliente 1: 0 áreas activas
2025-11-15 09:56:37,770 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 1 - Total: 0 áreas activas
2025-11-15 09:56:37,771 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 9.3ms
2025-11-15 09:56:37,773 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-15 09:56:37,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:37,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:37,774 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:37,774 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:37,774 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:37,775 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/list/
2025-11-15 09:56:37,779 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 09:56:37,779 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 1
2025-11-15 09:56:37,780 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:37,780 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:37,780 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:37,781 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:37,781 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 09:56:37,781 - app.services.area_service - INFO - Lista simple obtenida para cliente 1: 0 áreas activas
2025-11-15 09:56:37,781 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 1 - Total: 0 áreas activas
2025-11-15 09:56:37,782 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 8.3ms
2025-11-15 09:56:38,635 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 09:56:38,636 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:38,636 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:38,636 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:38,636 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:38,636 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:38,636 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 09:56:38,641 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 09:56:38,641 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 09:56:38,646 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 09:56:38,646 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 09:56:38,647 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 09:56:38,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:38,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:38,648 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:38,648 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:38,648 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:38,648 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 09:56:38,653 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 09:56:38,654 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 09:56:38,654 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 09:56:38,654 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 19.1ms
2025-11-15 09:56:38,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 8.0ms
2025-11-15 09:56:38,657 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 09:56:38,657 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:38,658 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:38,658 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:38,658 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:38,658 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:38,658 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 09:56:38,662 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 09:56:38,662 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 09:56:38,665 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 09:56:38,665 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 09:56:38,666 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 09:56:38,666 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:56:38,666 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:56:38,666 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:56:38,666 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:56:38,667 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:56:38,667 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 09:56:38,670 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 09:56:38,671 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 09:56:38,672 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 09:56:38,672 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 15.2ms
2025-11-15 09:56:38,673 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 7.2ms
2025-11-15 09:57:49,684 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-15 09:57:49,684 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:57:49,685 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:57:49,685 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:57:49,685 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:57:49,685 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:57:49,685 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-15 09:57:49,696 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 09:57:49,696 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 09:57:49,699 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-15 09:57:49,700 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.8ms
2025-11-15 09:57:49,702 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-15 09:57:49,702 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:57:49,702 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:57:49,703 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:57:49,703 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:57:49,703 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:57:49,703 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-15 09:57:49,707 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 09:57:49,707 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 09:57:49,710 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-15 09:57:49,710 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 8.6ms
2025-11-15 09:57:51,579 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/all-structured/
2025-11-15 09:57:51,580 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/1/permisos/
2025-11-15 09:57:51,580 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/1/permisos/
2025-11-15 09:57:51,580 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/all-structured/
2025-11-15 09:57:51,580 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/all-structured/ 200 1.3ms
2025-11-15 09:57:51,580 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/1/permisos/ 200 0.9ms
2025-11-15 09:57:51,581 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/1/permisos/ 200 0.9ms
2025-11-15 09:57:51,581 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/all-structured/ 200 0.8ms
2025-11-15 09:57:51,583 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/all-structured/
2025-11-15 09:57:51,583 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:57:51,583 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:57:51,583 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:57:51,583 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:57:51,584 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:57:51,584 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/all-structured/
2025-11-15 09:57:51,588 - app.api.v1.endpoints.menus - INFO - Solicitud recibida en GET /menus/all-structured/ por usuario 1 del cliente 1 (Admin)
2025-11-15 09:57:51,588 - app.services.menu_service - INFO - Obteniendo estructura completa de menús para cliente 1
2025-11-15 09:57:51,589 - app.db.queries - ERROR - Error en execute_procedure_params: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
2025-11-15 09:57:51,589 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en el procedimiento: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 175, in execute_procedure_params
    cursor.execute(query, tuple(params.values()))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 187, in execute_procedure_params
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en el procedimiento: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
2025-11-15 09:57:51,591 - app.services.menu_service - ERROR - Error de BD al obtener estructura admin para cliente 1: Error en el procedimiento: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
2025-11-15 09:57:51,591 - app.api.v1.endpoints.menus - ERROR - Error de servicio en GET /menus/all-structured/: Error de base de datos al obtener estructura de menús
2025-11-15 09:57:51,592 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/1/permisos/
2025-11-15 09:57:51,592 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:57:51,592 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:57:51,592 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:57:51,592 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:57:51,593 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:57:51,593 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/1/permisos/
2025-11-15 09:57:51,596 - app.api.v1.endpoints.roles - INFO - Solicitud recibida en GET /roles/1/permisos/ por usuario 1
2025-11-15 09:57:51,597 - app.api.v1.endpoints.roles - ERROR - Error inesperado al obtener permisos para rol 1
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\roles.py", line 574, in get_permisos_por_rol
    raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="No tiene permisos para acceder a roles del sistema.")
fastapi.exceptions.HTTPException: 403: No tiene permisos para acceder a roles del sistema.
2025-11-15 09:57:51,599 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/all-structured/ 500 15.8ms
2025-11-15 09:57:51,599 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/1/permisos/ 500 7.7ms
2025-11-15 09:57:51,601 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/all-structured/
2025-11-15 09:57:51,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:57:51,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:57:51,601 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:57:51,602 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:57:51,602 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:57:51,602 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/all-structured/
2025-11-15 09:57:51,606 - app.api.v1.endpoints.menus - INFO - Solicitud recibida en GET /menus/all-structured/ por usuario 1 del cliente 1 (Admin)
2025-11-15 09:57:51,606 - app.services.menu_service - INFO - Obteniendo estructura completa de menús para cliente 1
2025-11-15 09:57:51,607 - app.db.queries - ERROR - Error en execute_procedure_params: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
2025-11-15 09:57:51,607 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en el procedimiento: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 175, in execute_procedure_params
    cursor.execute(query, tuple(params.values()))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 187, in execute_procedure_params
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en el procedimiento: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
2025-11-15 09:57:51,608 - app.services.menu_service - ERROR - Error de BD al obtener estructura admin para cliente 1: Error en el procedimiento: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
2025-11-15 09:57:51,609 - app.api.v1.endpoints.menus - ERROR - Error de servicio en GET /menus/all-structured/: Error de base de datos al obtener estructura de menús
2025-11-15 09:57:51,609 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/1/permisos/
2025-11-15 09:57:51,609 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 09:57:51,609 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 09:57:51,609 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 09:57:51,610 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 09:57:51,610 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 09:57:51,610 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/1/permisos/
2025-11-15 09:57:51,613 - app.api.v1.endpoints.roles - INFO - Solicitud recibida en GET /roles/1/permisos/ por usuario 1
2025-11-15 09:57:51,614 - app.api.v1.endpoints.roles - ERROR - Error inesperado al obtener permisos para rol 1
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\roles.py", line 574, in get_permisos_por_rol
    raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="No tiene permisos para acceder a roles del sistema.")
fastapi.exceptions.HTTPException: 403: No tiene permisos para acceder a roles del sistema.
2025-11-15 09:57:51,614 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/all-structured/ 500 13.7ms
2025-11-15 09:57:51,615 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/1/permisos/ 500 6.0ms
2025-11-15 10:00:31,538 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/1/permisos/
2025-11-15 10:00:31,539 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/all-structured/
2025-11-15 10:00:31,539 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:00:31,539 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:00:31,539 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:00:31,539 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:00:31,540 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:00:31,540 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/1/permisos/
2025-11-15 10:00:31,540 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:00:31,540 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:00:31,540 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:00:31,540 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:00:31,541 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:00:31,541 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/all-structured/
2025-11-15 10:00:31,552 - app.api.v1.endpoints.roles - INFO - Solicitud recibida en GET /roles/1/permisos/ por usuario 1
2025-11-15 10:00:31,553 - app.api.v1.endpoints.roles - ERROR - Error inesperado al obtener permisos para rol 1
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\roles.py", line 574, in get_permisos_por_rol
    raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="No tiene permisos para acceder a roles del sistema.")
fastapi.exceptions.HTTPException: 403: No tiene permisos para acceder a roles del sistema.
2025-11-15 10:00:31,558 - app.api.v1.endpoints.menus - INFO - Solicitud recibida en GET /menus/all-structured/ por usuario 1 del cliente 1 (Admin)
2025-11-15 10:00:31,558 - app.services.menu_service - INFO - Obteniendo estructura completa de menús para cliente 1
2025-11-15 10:00:31,559 - app.db.queries - ERROR - Error en execute_procedure_params: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
2025-11-15 10:00:31,559 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en el procedimiento: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 175, in execute_procedure_params
    cursor.execute(query, tuple(params.values()))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 187, in execute_procedure_params
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en el procedimiento: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
2025-11-15 10:00:31,561 - app.services.menu_service - ERROR - Error de BD al obtener estructura admin para cliente 1: Error en el procedimiento: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
2025-11-15 10:00:31,561 - app.api.v1.endpoints.menus - ERROR - Error de servicio en GET /menus/all-structured/: Error de base de datos al obtener estructura de menús
2025-11-15 10:00:31,561 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/1/permisos/ 500 23.1ms
2025-11-15 10:00:31,561 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/all-structured/ 500 22.7ms
2025-11-15 10:00:31,564 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/1/permisos/
2025-11-15 10:00:31,564 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:00:31,564 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:00:31,564 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:00:31,565 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:00:31,565 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:00:31,565 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/1/permisos/
2025-11-15 10:00:31,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/all-structured/
2025-11-15 10:00:31,569 - app.api.v1.endpoints.roles - INFO - Solicitud recibida en GET /roles/1/permisos/ por usuario 1
2025-11-15 10:00:31,570 - app.api.v1.endpoints.roles - ERROR - Error inesperado al obtener permisos para rol 1
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\roles.py", line 574, in get_permisos_por_rol
    raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="No tiene permisos para acceder a roles del sistema.")
fastapi.exceptions.HTTPException: 403: No tiene permisos para acceder a roles del sistema.
2025-11-15 10:00:31,571 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:00:31,571 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:00:31,571 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:00:31,571 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:00:31,572 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:00:31,572 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/all-structured/
2025-11-15 10:00:31,576 - app.api.v1.endpoints.menus - INFO - Solicitud recibida en GET /menus/all-structured/ por usuario 1 del cliente 1 (Admin)
2025-11-15 10:00:31,576 - app.services.menu_service - INFO - Obteniendo estructura completa de menús para cliente 1
2025-11-15 10:00:31,578 - app.db.queries - ERROR - Error en execute_procedure_params: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
2025-11-15 10:00:31,578 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en el procedimiento: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 175, in execute_procedure_params
    cursor.execute(query, tuple(params.values()))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 187, in execute_procedure_params
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en el procedimiento: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
2025-11-15 10:00:31,579 - app.services.menu_service - ERROR - Error de BD al obtener estructura admin para cliente 1: Error en el procedimiento: ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Procedure sp_GetAllMenuItemsAdmin has no parameters and arguments were supplied. (8146) (SQLExecDirectW)')
2025-11-15 10:00:31,579 - app.api.v1.endpoints.menus - ERROR - Error de servicio en GET /menus/all-structured/: Error de base de datos al obtener estructura de menús
2025-11-15 10:00:31,580 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/1/permisos/ 500 15.9ms
2025-11-15 10:00:31,580 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/all-structured/ 500 14.6ms
2025-11-15 10:00:39,587 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-15 10:00:39,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:00:39,588 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:00:39,588 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:00:39,588 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:00:39,588 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:00:39,588 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-15 10:00:39,594 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-15 10:00:39,594 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-15 10:00:39,598 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:39,599 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:39,599 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:39,599 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:39,599 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:39,600 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 5 totales
2025-11-15 10:00:39,600 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 5, Página: 1
2025-11-15 10:00:39,600 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.5ms
2025-11-15 10:00:39,602 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-15 10:00:39,603 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:00:39,603 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:00:39,603 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:00:39,603 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:00:39,603 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:00:39,604 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-15 10:00:39,607 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-15 10:00:39,608 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-15 10:00:39,611 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:39,611 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:39,611 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:39,611 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:39,611 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:39,611 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 5 totales
2025-11-15 10:00:39,612 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 5, Página: 1
2025-11-15 10:00:39,612 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 9.9ms
2025-11-15 10:00:42,682 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-15 10:00:42,682 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:00:42,683 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:00:42,683 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:00:42,683 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:00:42,683 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:00:42,683 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/list/
2025-11-15 10:00:42,688 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:00:42,688 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 1
2025-11-15 10:00:42,690 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:42,690 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:42,690 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:42,691 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:42,691 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:42,691 - app.services.area_service - INFO - Lista simple obtenida para cliente 1: 0 áreas activas
2025-11-15 10:00:42,691 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 1 - Total: 0 áreas activas
2025-11-15 10:00:42,692 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 10.1ms
2025-11-15 10:00:42,694 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-15 10:00:42,695 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:00:42,695 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:00:42,695 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:00:42,695 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:00:42,695 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:00:42,696 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/list/
2025-11-15 10:00:42,700 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:00:42,701 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 1
2025-11-15 10:00:42,702 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:42,702 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:42,703 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:42,703 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:42,703 - app.services.area_service - ERROR - Error mapeando área simple para cliente 1: 1 validation error for AreaSimpleList
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:42,703 - app.services.area_service - INFO - Lista simple obtenida para cliente 1: 0 áreas activas
2025-11-15 10:00:42,704 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 1 - Total: 0 áreas activas
2025-11-15 10:00:42,704 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 9.8ms
2025-11-15 10:00:43,737 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-15 10:00:43,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:00:43,738 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:00:43,738 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:00:43,738 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:00:43,738 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:00:43,738 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-15 10:00:43,742 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-15 10:00:43,743 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-15 10:00:43,747 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:43,747 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:43,748 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:43,748 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:43,748 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:43,748 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 5 totales
2025-11-15 10:00:43,748 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 5, Página: 1
2025-11-15 10:00:43,749 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.3ms
2025-11-15 10:00:43,751 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-15 10:00:43,752 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:00:43,752 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:00:43,752 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:00:43,752 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:00:43,753 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:00:43,753 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-15 10:00:43,757 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-15 10:00:43,757 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-15 10:00:43,760 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:43,760 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:43,761 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:43,761 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:43,761 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:00:43,761 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 5 totales
2025-11-15 10:00:43,761 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 5, Página: 1
2025-11-15 10:00:43,762 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 10.2ms
2025-11-15 10:01:11,712 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 10:01:11,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:01:11,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:01:11,713 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:01:11,713 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:01:11,713 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:01:11,714 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 10:01:11,717 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:01:11,718 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:01:11,723 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 10:01:11,724 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 10:01:11,724 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 12.3ms
2025-11-15 10:01:11,727 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:01:11,728 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:01:11,728 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:01:11,728 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:01:11,728 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:01:11,728 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:01:11,728 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:01:11,732 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:01:11,733 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 10:01:11,733 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 10:01:11,734 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 7.0ms
2025-11-15 10:01:11,736 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 10:01:11,736 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:01:11,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:01:11,737 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:01:11,737 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:01:11,737 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:01:11,737 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 10:01:11,740 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:01:11,741 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:01:11,745 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 10:01:11,745 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 10:01:11,745 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 9.4ms
2025-11-15 10:01:11,747 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:01:11,747 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:01:11,748 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:01:11,748 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:01:11,748 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:01:11,748 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:01:11,748 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:01:11,751 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:01:11,752 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 10:01:11,752 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 10:01:11,753 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 5.6ms
2025-11-15 10:01:16,241 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-15 10:01:16,242 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:01:16,242 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:01:16,242 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:01:16,242 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:01:16,242 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:01:16,243 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-15 10:01:16,248 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:01:16,248 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:01:16,252 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-15 10:01:16,253 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 11.7ms
2025-11-15 10:01:16,255 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-15 10:01:16,255 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:01:16,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:01:16,256 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:01:16,256 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:01:16,256 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:01:16,256 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-15 10:01:16,260 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:01:16,260 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:01:16,264 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-15 10:01:16,265 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 9.5ms
2025-11-15 10:10:18,260 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-15 10:10:18,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-15 10:10:18,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-15 10:10:18,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-15 10:10:18,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.9ms
2025-11-15 10:10:18,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.4ms
2025-11-15 10:10:18,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.3ms
2025-11-15 10:10:18,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.3ms
2025-11-15 10:10:18,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:10:18,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 10:10:18,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:18,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:18,579 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:18,579 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:18,579 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:18,579 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:10:18,580 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:18,580 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:18,580 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:18,580 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:18,580 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:18,580 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 10:10:18,581 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-15 10:10:18,581 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-15 10:10:18,582 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 401 3.8ms
2025-11-15 10:10:18,582 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 401 3.6ms
2025-11-15 10:10:18,584 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:10:18,585 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:18,585 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:18,585 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:18,585 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:18,585 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:18,586 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:10:18,586 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 10:10:18,587 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-15 10:10:18,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:18,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:18,587 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:18,587 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:18,588 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:18,588 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 10:10:18,588 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-15 10:10:18,589 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 10:10:18,589 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 401 4.9ms
2025-11-15 10:10:18,589 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 401 3.5ms
2025-11-15 10:10:18,590 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-15 10:10:18,592 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 10:10:18,592 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:18,593 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:18,593 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:18,593 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:18,593 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:18,593 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 10:10:18,604 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-15 10:10:18,605 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-15 10:10:18,606 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-15 10:10:18,606 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-15 10:10:18,606 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-15 10:10:18,607 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 10:10:18,608 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 13
2025-11-15 10:10:18,608 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 13
2025-11-15 10:10:18,608 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-15 10:10:18,608 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.3ms
2025-11-15 10:10:18,613 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:10:18,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:18,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:18,613 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:18,614 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:18,614 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:18,614 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:10:18,617 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:10:18,618 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 10:10:18,618 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 10:10:18,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 6.0ms
2025-11-15 10:10:38,907 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-15 10:10:38,908 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.6ms
2025-11-15 10:10:38,909 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-15 10:10:38,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:38,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:38,910 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:38,910 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:38,910 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:38,911 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-15 10:10:38,916 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:10:38,916 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:10:38,920 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-15 10:10:38,921 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 11.6ms
2025-11-15 10:10:38,923 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-15 10:10:38,923 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:38,923 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:38,923 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:38,924 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:38,924 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:38,924 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-15 10:10:38,928 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:10:38,929 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:10:38,933 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-15 10:10:38,933 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 10.6ms
2025-11-15 10:10:39,634 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-15 10:10:39,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.5ms
2025-11-15 10:10:39,636 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-15 10:10:39,636 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-15 10:10:39,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:39,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:39,637 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:39,637 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:39,637 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:39,637 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-15 10:10:39,638 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.9ms
2025-11-15 10:10:39,643 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-15 10:10:39,643 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-15 10:10:39,647 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:10:39,647 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:10:39,648 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:10:39,648 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:10:39,649 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:10:39,649 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 5 totales
2025-11-15 10:10:39,649 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 5, Página: 1
2025-11-15 10:10:39,650 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 14.1ms
2025-11-15 10:10:39,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-15 10:10:39,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:39,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:39,653 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:39,653 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:39,653 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:39,653 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-15 10:10:39,657 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 1 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-15 10:10:39,657 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 1: skip=0, limit=10, search='None'
2025-11-15 10:10:39,660 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:10:39,660 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:10:39,660 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:10:39,660 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:10:39,660 - app.services.area_service - ERROR - Error mapeando área: 1 validation error for AreaRead
cliente_id
  Input should be a valid integer [type=int_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.10/v/int_type
2025-11-15 10:10:39,661 - app.services.area_service - INFO - Paginación completada para cliente 1: 0 áreas de 5 totales
2025-11-15 10:10:39,661 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 1 - Total: 5, Página: 1
2025-11-15 10:10:39,661 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 9.1ms
2025-11-15 10:10:40,634 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 10:10:40,635 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:40,635 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:40,635 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:40,635 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:40,635 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:40,636 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 10:10:40,640 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:10:40,640 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:10:40,646 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 10:10:40,646 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 10:10:40,647 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:10:40,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:40,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:40,648 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:40,648 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:40,648 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:40,649 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:10:40,649 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 14.9ms
2025-11-15 10:10:40,653 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:10:40,654 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 10:10:40,654 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 10:10:40,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 8.0ms
2025-11-15 10:10:40,657 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 10:10:40,657 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:40,657 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:40,658 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:40,658 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:40,658 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:40,658 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 10:10:40,662 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:10:40,662 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:10:40,666 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 10:10:40,666 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 10:10:40,666 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:10:40,667 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:40,667 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:40,667 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:40,667 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:40,667 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:40,668 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:10:40,671 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:10:40,672 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 10:10:40,672 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 10:10:40,672 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 15.5ms
2025-11-15 10:10:40,673 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 6.4ms
2025-11-15 10:10:43,107 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 10:10:43,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:43,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:43,108 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:43,108 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:43,109 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:43,109 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 10:10:43,111 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-15 10:10:43,112 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1)
2025-11-15 10:10:43,113 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-15 10:10:43,114 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-15 10:10:43,114 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-15 10:10:43,116 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 10:10:43,116 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 14
2025-11-15 10:10:43,116 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 14
2025-11-15 10:10:43,117 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-15 10:10:43,117 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.9ms
2025-11-15 10:10:43,124 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-15 10:10:43,125 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.6ms
2025-11-15 10:10:43,127 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-15 10:10:43,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:43,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:43,128 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:43,128 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:43,128 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:43,128 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-15 10:10:43,130 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-15 10:10:43,131 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 3.9ms
2025-11-15 10:10:43,156 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-15 10:10:43,157 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-11-15 10:10:43,157 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-15 10:10:43,158 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:10:43,158 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 10:10:43,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:43,159 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:43,159 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:43,159 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:43,159 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:43,159 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:10:43,159 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:43,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:43,160 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:43,160 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:43,160 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:43,160 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 10:10:43,160 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 3.7ms
2025-11-15 10:10:43,164 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:10:43,165 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 10:10:43,165 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 10:10:43,169 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:10:43,169 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:10:43,173 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 10:10:43,173 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 10:10:43,175 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 10:10:43,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:43,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:43,175 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:43,175 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:43,176 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:43,176 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 10:10:43,176 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 18.7ms
2025-11-15 10:10:43,176 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 18.2ms
2025-11-15 10:10:43,178 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 10:10:43,178 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 10:10:43,179 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 10:10:43,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.9ms
2025-11-15 10:10:43,182 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:10:43,183 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 10:10:43,183 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:43,183 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:43,183 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:43,184 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:43,184 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:43,184 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:10:43,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:43,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:43,185 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:43,185 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:43,186 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:43,186 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 10:10:43,186 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 10:10:43,190 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:10:43,190 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 10:10:43,191 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 10:10:43,194 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:10:43,194 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:10:43,197 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 10:10:43,198 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 10:10:43,198 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:43,198 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:43,198 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:43,199 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:43,199 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:43,199 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 10:10:43,202 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 10:10:43,202 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 10:10:43,203 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 10:10:43,204 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 21.4ms
2025-11-15 10:10:43,204 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 21.4ms
2025-11-15 10:10:43,204 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.1ms
2025-11-15 10:10:58,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-15 10:10:58,565 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-15 10:10:58,567 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-15 10:10:58,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:10:58,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:10:58,567 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:10:58,568 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:10:58,568 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:10:58,568 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-15 10:10:58,570 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-15 10:10:58,571 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-15 10:10:58,571 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-15 10:10:58,571 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 4.4ms
2025-11-15 10:11:14,864 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-15 10:11:14,864 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.4ms
2025-11-15 10:11:15,167 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 10:11:15,168 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:15,168 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:15,168 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:15,168 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:15,168 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:15,169 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 10:11:15,172 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 10:11:15,172 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-15 10:11:15,172 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-15 10:11:15,415 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1
2025-11-15 10:11:15,415 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-15 10:11:15,417 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-15 10:11:15,417 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 15
2025-11-15 10:11:15,417 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 15
2025-11-15 10:11:15,417 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-15 10:11:15,418 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 250.5ms
2025-11-15 10:11:15,435 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 10:11:15,435 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:15,436 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:15,437 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:15,437 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:15,437 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:15,437 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 10:11:15,441 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 10:11:15,442 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 10:11:15,443 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 10:11:15,444 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 10:11:15,445 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:15,445 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:15,445 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:15,445 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:15,445 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:15,445 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 10:11:15,451 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:11:15,451 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:11:15,456 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 10:11:15,456 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 10:11:15,457 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 21.8ms
2025-11-15 10:11:15,458 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 13.9ms
2025-11-15 10:11:15,460 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:11:15,460 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:15,461 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:15,461 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:15,461 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:15,461 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:15,461 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:11:15,467 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:11:15,468 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 10:11:15,468 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 10:11:15,469 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-15 10:11:15,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:15,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:15,470 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:15,470 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:15,471 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:15,471 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-15 10:11:15,474 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-15 10:11:15,474 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-15 10:11:15,475 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-15 10:11:15,476 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 16.0ms
2025-11-15 10:11:15,477 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-15 10:11:15,478 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 10:11:15,479 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:15,479 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:15,479 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:15,479 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:15,479 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:15,480 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 10:11:15,485 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:11:15,485 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:11:15,489 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 10:11:15,489 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 10:11:15,489 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:11:15,490 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:15,490 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:15,490 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:15,490 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:15,491 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:15,491 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:11:15,494 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:11:15,495 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 10:11:15,495 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 10:11:15,496 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 17.4ms
2025-11-15 10:11:15,496 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 6.8ms
2025-11-15 10:11:27,263 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-15 10:11:27,263 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:27,263 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:27,263 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:27,264 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:27,264 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:27,264 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-15 10:11:27,267 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:11:27,268 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:11:27,272 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-15 10:11:27,273 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 10.5ms
2025-11-15 10:11:27,276 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-15 10:11:27,276 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:27,276 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:27,276 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:27,277 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:27,277 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:27,277 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-15 10:11:27,281 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:11:27,281 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:11:27,285 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-15 10:11:27,286 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 10.3ms
2025-11-15 10:11:27,970 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 10:11:27,970 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:27,971 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:27,971 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:27,971 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:27,971 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:27,972 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 10:11:27,976 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:11:27,977 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:11:27,982 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 10:11:27,982 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 10:11:27,982 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:11:27,983 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:27,983 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:27,983 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:27,983 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:27,983 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:27,983 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:11:27,987 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:11:27,988 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 10:11:27,988 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 10:11:27,988 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 18.3ms
2025-11-15 10:11:27,989 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 6.8ms
2025-11-15 10:11:27,991 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-15 10:11:27,991 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:27,991 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:27,992 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:27,992 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:27,992 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:27,992 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-15 10:11:27,997 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-15 10:11:27,997 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-15 10:11:28,000 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-15 10:11:28,000 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-15 10:11:28,001 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-15 10:11:28,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:11:28,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:11:28,001 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:11:28,002 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:11:28,002 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:11:28,002 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-15 10:11:28,004 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-15 10:11:28,005 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-15 10:11:28,005 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-15 10:11:28,006 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 15.1ms
2025-11-15 10:11:28,006 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 5.5ms
2025-11-15 10:12:25,831 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-15 10:12:25,832 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:12:25,832 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:12:25,832 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:12:25,832 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:12:25,833 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:12:25,833 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-15 10:12:25,835 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-15 10:12:25,835 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-15 10:12:25,836 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-15 10:12:25,836 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 4.5ms
2025-11-15 10:12:38,942 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 10:12:38,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:12:38,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:12:38,943 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:12:38,943 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:12:38,943 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:12:38,943 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 10:12:38,946 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 10:12:38,946 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=1
2025-11-15 10:12:38,946 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=1
2025-11-15 10:12:38,947 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_tech', cliente_id_buscado=1
2025-11-15 10:12:38,947 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 5.3ms
2025-11-15 10:18:19,227 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 10:18:19,228 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:18:19,228 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:18:19,228 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:18:19,228 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:18:19,228 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:18:19,228 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 10:18:19,229 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 10:18:19,230 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 2.6ms
2025-11-15 10:26:20,854 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 10:26:20,855 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 400 0.5ms
2025-11-15 10:27:09,032 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 10:27:09,032 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 400 0.5ms
2025-11-15 10:27:20,594 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-15 10:27:20,595 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 400 0.7ms
2025-11-15 10:27:55,148 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 10:27:55,149 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 400 0.6ms
2025-11-15 10:27:58,639 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 10:27:58,639 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 400 0.6ms
2025-11-15 10:28:13,761 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 10:28:13,761 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-15 10:28:14,064 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 10:28:14,065 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:28:14,065 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:28:14,065 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:28:14,065 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:28:14,066 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:28:14,066 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 10:28:14,068 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 10:28:14,068 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.8ms
2025-11-15 10:28:14,592 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 10:28:14,592 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:28:14,592 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:28:14,592 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:28:14,593 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:28:14,593 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:28:14,593 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 10:28:14,594 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 10:28:14,594 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 2.9ms
2025-11-15 10:28:27,311 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 10:28:27,311 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:28:27,311 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:28:27,311 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:28:27,312 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:28:27,312 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:28:27,312 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 10:28:27,313 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 10:28:27,314 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.0ms
2025-11-15 10:28:47,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 10:28:47,152 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 400 0.6ms
2025-11-15 10:29:09,736 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-15 10:29:09,736 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 400 0.5ms
2025-11-15 10:29:19,471 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 10:29:19,471 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 400 0.4ms
2025-11-15 10:29:36,528 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-15 10:29:36,529 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 400 0.7ms
2025-11-15 10:38:25,650 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-15 10:38:25,651 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 400 0.7ms
2025-11-15 10:49:28,548 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 10:50:54,952 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 10:50:54,953 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 400 0.9ms
2025-11-15 10:51:07,786 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 10:51:12,013 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 10:51:12,014 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 400 0.6ms
2025-11-15 10:51:23,007 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-15 10:51:23,007 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 400 0.6ms
2025-11-15 10:54:04,533 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 10:54:11,966 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-15 10:54:11,967 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 400 0.9ms
2025-11-15 10:54:17,321 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 10:54:17,321 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 400 0.9ms
2025-11-15 10:58:39,917 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 10:58:46,340 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 10:58:46,341 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-15 10:58:46,648 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 10:58:46,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:58:46,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:58:46,648 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:58:46,648 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:58:46,649 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:58:46,649 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 10:58:46,652 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 10:58:46,652 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.7ms
2025-11-15 10:59:05,781 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-15 10:59:05,782 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.7ms
2025-11-15 10:59:05,783 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 10:59:05,783 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:59:05,783 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:59:05,784 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:59:05,784 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:59:05,784 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:59:05,784 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 10:59:05,809 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 10:59:05,810 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=1
2025-11-15 10:59:05,810 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=1
2025-11-15 10:59:05,811 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_tech', cliente_id_buscado=1
2025-11-15 10:59:05,811 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 27.9ms
2025-11-15 10:59:49,609 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 10:59:53,091 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 10:59:53,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 10:59:53,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 10:59:53,092 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 10:59:53,092 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 10:59:53,092 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 10:59:53,092 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 10:59:53,119 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 10:59:53,119 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=1
2025-11-15 10:59:53,119 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=1
2025-11-15 10:59:53,120 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_tech', cliente_id_buscado=1
2025-11-15 10:59:53,121 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 29.7ms
2025-11-15 11:00:24,694 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 11:00:27,105 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 11:00:27,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:00:27,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:00:27,105 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:00:27,105 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:00:27,106 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:00:27,106 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 11:00:27,132 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 11:00:27,132 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=1
2025-11-15 11:00:27,132 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=1
2025-11-15 11:00:27,133 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_tech', cliente_id_buscado=1
2025-11-15 11:00:27,134 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 29.3ms
2025-11-15 11:02:54,757 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 11:06:23,837 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 11:06:23,838 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:06:23,838 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:06:23,838 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:06:23,838 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:06:23,838 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:06:23,839 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:06:23,839 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:06:23,841 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 4.1ms
2025-11-15 11:06:23,843 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:06:23,844 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 6.0ms
2025-11-15 11:06:24,153 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:06:24,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:06:24,154 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:06:24,154 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:06:24,154 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:06:24,154 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:06:24,154 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:06:24,155 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:06:24,155 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 2.6ms
2025-11-15 11:06:39,969 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:06:39,969 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:06:39,969 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:06:39,970 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:06:39,970 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:06:39,970 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:06:39,970 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:06:39,971 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:06:39,972 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.3ms
2025-11-15 11:06:55,635 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 11:06:55,635 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:06:55,636 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:06:55,636 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:06:55,636 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:06:55,636 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:06:55,636 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 11:06:55,662 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 11:06:55,662 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=1
2025-11-15 11:06:55,663 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=1
2025-11-15 11:06:55,664 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_tech', cliente_id_buscado=1
2025-11-15 11:06:55,664 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 29.3ms
2025-11-15 11:07:14,300 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:07:14,300 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:07:14,301 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:07:14,301 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:07:14,301 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:07:14,301 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:07:14,301 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:07:14,303 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:07:14,303 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.5ms
2025-11-15 11:07:32,977 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:07:32,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:07:32,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:07:32,978 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:07:32,978 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:07:32,978 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:07:32,979 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:07:32,979 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:07:32,980 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 2.5ms
2025-11-15 11:07:33,016 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:07:33,016 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:07:33,016 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:07:33,016 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:07:33,016 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:07:33,017 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:07:33,017 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:07:33,018 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:07:33,018 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 2.2ms
2025-11-15 11:09:42,009 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 11:09:42,010 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-15 11:09:42,059 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:09:42,059 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:09:42,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:09:42,060 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:09:42,060 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:09:42,060 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:09:42,060 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:09:42,061 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:09:42,061 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 2.3ms
2025-11-15 11:09:42,325 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:09:42,326 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:09:42,326 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:09:42,326 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:09:42,326 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:09:42,326 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:09:42,327 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:09:42,328 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:09:42,328 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 2.6ms
2025-11-15 11:11:24,077 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 11:11:28,628 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:11:28,628 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:11:28,629 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:11:28,629 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:11:28,629 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:11:28,629 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:11:28,629 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:11:28,633 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:11:28,633 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.1ms
2025-11-15 11:11:53,818 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-15 11:11:53,819 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-15 11:11:53,821 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 11:11:53,821 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:11:53,821 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:11:53,821 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:11:53,821 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:11:53,822 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:11:53,822 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 11:11:53,847 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 11:11:53,847 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=1
2025-11-15 11:11:53,847 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=1
2025-11-15 11:11:53,848 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_tech', cliente_id_buscado=1
2025-11-15 11:11:53,849 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 28.1ms
2025-11-15 11:13:53,717 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 11:13:57,381 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:13:57,381 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:13:57,381 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:13:57,381 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:13:57,382 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:13:57,382 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:13:57,382 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:13:57,383 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:13:57,384 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.8ms
2025-11-15 11:14:16,913 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-15 11:14:16,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-15 11:14:16,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:14:16,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-15 11:14:16,936 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-15 11:14:16,939 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_hybrid_sistema_central
2025-11-15 11:14:16,940 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=localhost
2025-11-15 11:14:16,940 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-15 11:14:16,941 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 27.7ms
2025-11-15 11:14:17,033 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-15 11:14:17,033 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-15 11:14:17,033 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:14:17,034 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-15 11:14:17,035 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-15 11:14:17,035 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=localhost
2025-11-15 11:14:17,035 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-15 11:14:17,114 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 81.6ms
2025-11-15 11:14:29,643 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:14:29,643 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:14:29,643 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:14:29,643 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:14:29,644 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:14:29,644 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:14:29,644 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:14:29,645 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:14:29,646 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.3ms
2025-11-15 11:27:09,748 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 11:28:39,373 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 11:28:39,373 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-15 11:28:39,384 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-15 11:28:39,384 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-15 11:28:39,688 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:28:39,690 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:28:39,690 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:28:39,690 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:28:39,690 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:28:39,690 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:28:39,690 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:28:39,690 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:28:39,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:28:39,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:28:39,691 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:28:39,691 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:28:39,691 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:28:39,691 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:28:39,693 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:28:39,694 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:28:39,694 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 6.6ms
2025-11-15 11:28:39,694 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.9ms
2025-11-15 11:28:49,137 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:28:49,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:28:49,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:28:49,138 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:28:49,138 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:28:49,138 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:28:49,139 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:28:49,140 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:28:49,140 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.2ms
2025-11-15 11:28:57,980 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 11:29:01,494 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:29:01,495 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:29:01,495 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:29:01,495 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:29:01,495 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:29:01,495 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:29:01,496 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:29:01,497 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:29:01,498 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.5ms
2025-11-15 11:29:17,489 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-15 11:29:17,489 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-15 11:29:17,491 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-15 11:29:17,491 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:29:17,491 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:29:17,492 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:29:17,492 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:29:17,492 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:29:17,492 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-15 11:29:17,518 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-15 11:29:17,518 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=1
2025-11-15 11:29:17,518 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=1
2025-11-15 11:29:17,519 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_tech', cliente_id_buscado=1
2025-11-15 11:29:17,519 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 28.7ms
2025-11-15 11:29:54,833 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 11:30:01,132 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:30:01,133 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:30:01,133 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:30:01,133 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:30:01,133 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:30:01,133 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:30:01,133 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:30:01,137 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:30:01,137 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.9ms
2025-11-15 11:33:58,127 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 11:34:14,744 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 11:34:19,363 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:34:19,363 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:34:19,363 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:34:19,364 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:34:19,364 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:34:19,364 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:34:19,364 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:34:19,366 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:34:19,366 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.6ms
2025-11-15 11:34:39,646 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 11:34:40,823 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:34:40,824 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:34:40,824 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:34:40,824 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:34:40,824 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:34:40,825 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:34:40,825 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:34:40,826 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:34:40,827 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.5ms
2025-11-15 11:35:51,335 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-15 11:36:20,011 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:36:20,012 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:36:20,012 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:36:20,012 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:36:20,012 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:36:20,012 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:36:20,012 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:36:20,014 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:36:20,015 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.4ms
2025-11-15 11:36:36,457 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:36:36,458 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:36:36,458 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:36:36,458 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:36:36,458 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:36:36,458 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:36:36,459 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:36:36,460 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:36:36,461 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.6ms
2025-11-15 11:36:36,871 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:36:36,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:36:36,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:36:36,871 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:36:36,871 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:36:36,871 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:36:36,872 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:36:36,872 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:36:36,873 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 1.9ms
2025-11-15 11:36:40,658 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:36:40,659 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:36:40,659 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:36:40,659 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:36:40,659 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:36:40,660 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:36:40,660 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:36:40,661 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:36:40,661 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 2.9ms
2025-11-15 11:36:40,683 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:36:40,684 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:36:40,684 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:36:40,684 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:36:40,684 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:36:40,684 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-15 11:36:40,684 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-15 11:36:40,685 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-15 11:36:40,686 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 2.4ms
2025-11-15 11:36:48,758 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-15 11:36:48,759 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-15 11:36:48,759 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-15 11:36:48,759 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-15 11:36:48,759 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-15 11:36:48,759 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A

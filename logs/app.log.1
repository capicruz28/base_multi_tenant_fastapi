2025-10-26 23:38:25,181 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (f4b8ad8347573b47be35c23a2ab125eeab577cdeba55e19d9c309af32b6059df). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 119, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 133, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:38:25,188 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-26 23:38:25,188 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:38:25,190 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 34.4ms
2025-10-26 23:38:25,195 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-26 23:38:25,197 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-26 23:38:25,198 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.0ms
2025-10-26 23:38:25,227 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:38:25,230 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:38:25,230 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:38:25,232 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:38:25,232 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:38:25,232 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:38:25,232 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:38:25,235 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:38:25,237 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:38:25,237 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:38:25,240 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:38:25,240 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:38:25,243 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:38:25,244 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:38:25,244 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 17.1ms
2025-10-26 23:38:25,244 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 12.3ms
2025-10-26 23:38:25,244 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.1ms
2025-10-26 23:38:25,247 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:38:25,250 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:38:25,251 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:38:25,251 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:38:25,252 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:38:25,254 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:38:25,255 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:38:25,256 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:38:25,256 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:38:25,257 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:38:25,257 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.1ms
2025-10-26 23:38:25,259 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:38:25,259 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:38:25,263 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:38:25,263 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:38:25,264 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 12.0ms
2025-10-26 23:38:25,265 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.9ms
2025-10-26 23:41:11,275 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:41:11,276 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:41:11,319 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-26 23:41:11,319 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error al revocar token antiguo: name 'refresh_token' is not defined
2025-10-26 23:41:11,319 - app.services.refresh_token_service - INFO - [DEBUG-STORE] Almacenando refresh token para usuario_id=1, client_type=web
2025-10-26 23:41:11,327 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-26 23:41:11,327 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 82
2025-10-26 23:41:11,327 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:41:11,329 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-26 23:41:11,329 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error al revocar token antiguo: name 'refresh_token' is not defined
2025-10-26 23:41:11,329 - app.services.refresh_token_service - INFO - [DEBUG-STORE] Almacenando refresh token para usuario_id=1, client_type=web
2025-10-26 23:41:11,330 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (8cbc670ca481ce9a45090c1866b86e1758f51aff0e60ae555400ec4321f30af6). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-26 23:41:11,330 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (8cbc670ca481ce9a45090c1866b86e1758f51aff0e60ae555400ec4321f30af6). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 119, in store_refresh_token
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:41:11,345 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (8cbc670ca481ce9a45090c1866b86e1758f51aff0e60ae555400ec4321f30af6). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 119, in store_refresh_token
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 133, in store_refresh_token
        status_code=500,
          ^^^^^^^^^^^^^^
    ...<2 lines>...
    
    
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:41:11,346 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-26 23:41:11,346 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:41:11,347 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 72.0ms
2025-10-26 23:41:11,347 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 70.8ms
2025-10-26 23:41:11,352 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-26 23:41:11,355 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-26 23:41:11,364 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 11.4ms
2025-10-26 23:41:12,466 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:41:12,467 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:41:12,467 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:41:12,560 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:41:12,560 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:41:12,609 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:41:12,609 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:41:12,612 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:41:12,612 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:41:12,621 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:41:12,622 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:41:12,624 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:41:12,628 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:41:12,629 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:41:12,630 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 163.2ms
2025-10-26 23:41:12,630 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 163.1ms
2025-10-26 23:41:12,630 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 163.2ms
2025-10-26 23:41:12,633 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:41:12,636 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:41:12,637 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:41:12,638 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:41:12,638 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:41:12,639 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.7ms
2025-10-26 23:41:12,639 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:41:12,640 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:41:12,643 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:41:12,644 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:41:12,644 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:41:12,645 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:41:12,645 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:41:12,649 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:41:12,649 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:41:12,650 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.1ms
2025-10-26 23:41:12,650 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.0ms
2025-10-26 23:41:19,570 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:41:19,571 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:41:19,573 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-26 23:41:19,576 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-26 23:41:19,576 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-26 23:41:19,576 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-26 23:41:19,577 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-26 23:41:19,577 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 84
2025-10-26 23:41:19,578 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:41:19,579 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-26 23:41:19,580 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-26 23:41:19,580 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-26 23:41:19,581 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-26 23:41:19,582 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (3da91d50c8c5622316aaa768259eea27a958b8a45a2ecb960a51c46980bc6c1f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-26 23:41:19,582 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (3da91d50c8c5622316aaa768259eea27a958b8a45a2ecb960a51c46980bc6c1f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:41:19,584 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (3da91d50c8c5622316aaa768259eea27a958b8a45a2ecb960a51c46980bc6c1f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:41:19,586 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-26 23:41:19,586 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:41:19,587 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 16.6ms
2025-10-26 23:41:19,587 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 16.3ms
2025-10-26 23:41:19,592 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-26 23:41:19,594 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-26 23:41:19,602 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 9.7ms
2025-10-26 23:41:19,630 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:41:19,632 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:41:19,633 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:41:19,634 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:41:19,634 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:41:19,635 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:41:19,637 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:41:19,637 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:41:19,641 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:41:19,641 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:41:19,641 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 11.4ms
2025-10-26 23:41:19,641 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.5ms
2025-10-26 23:41:19,643 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:41:19,646 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:41:19,647 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:41:19,647 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:41:19,647 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.1ms
2025-10-26 23:41:19,648 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:41:19,650 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:41:19,650 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:41:19,652 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:41:19,652 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:41:19,653 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.2ms
2025-10-26 23:41:19,654 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:41:19,657 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:41:19,657 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:41:19,660 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:41:19,660 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:41:19,661 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:41:19,661 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.1ms
2025-10-26 23:41:19,664 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:41:19,665 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:41:19,666 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:41:19,667 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.9ms
2025-10-26 23:41:39,787 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:41:39,789 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:41:39,791 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-26 23:41:39,792 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-26 23:41:39,792 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-26 23:41:39,793 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-26 23:41:39,794 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-26 23:41:39,795 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 86
2025-10-26 23:41:39,795 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:41:39,796 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 9.0ms
2025-10-26 23:41:39,798 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-26 23:41:39,800 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-26 23:41:39,800 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-26 23:41:39,800 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-26 23:41:39,802 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (5bd44895c9025eaf048797973cf163de2666e7cb294fa15dea534512cb1a82c1). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-26 23:41:39,803 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (5bd44895c9025eaf048797973cf163de2666e7cb294fa15dea534512cb1a82c1). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:41:39,804 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (5bd44895c9025eaf048797973cf163de2666e7cb294fa15dea534512cb1a82c1). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:41:39,806 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-26 23:41:39,806 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:41:39,807 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.6ms
2025-10-26 23:41:39,812 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-26 23:41:39,814 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-26 23:41:39,815 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.2ms
2025-10-26 23:41:39,841 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:41:39,844 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:41:39,844 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:41:39,846 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:41:39,846 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:41:39,846 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:41:39,847 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:41:39,849 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:41:39,850 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:41:39,850 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:41:39,853 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:41:39,854 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:41:39,858 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:41:39,858 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:41:39,859 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 18.1ms
2025-10-26 23:41:39,860 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 13.1ms
2025-10-26 23:41:39,860 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.9ms
2025-10-26 23:41:39,862 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:41:39,864 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:41:39,865 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:41:39,866 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:41:39,866 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:41:39,867 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.1ms
2025-10-26 23:41:39,868 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:41:39,868 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:41:39,871 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:41:39,872 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:41:39,876 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:41:39,876 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:41:39,878 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:41:39,879 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:41:39,880 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:41:39,880 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.5ms
2025-10-26 23:41:39,880 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 12.5ms
2025-10-26 23:41:43,590 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:41:43,591 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:41:43,594 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-26 23:41:43,595 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-26 23:41:43,596 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-26 23:41:43,596 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-26 23:41:43,598 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-26 23:41:43,599 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 88
2025-10-26 23:41:43,599 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:41:43,601 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-26 23:41:43,603 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-26 23:41:43,603 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-26 23:41:43,603 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-26 23:41:43,605 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (e50f0740b021ecddd66d884176eaa228e86bddbc835ffd730d33eac431af364d). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-26 23:41:43,606 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (e50f0740b021ecddd66d884176eaa228e86bddbc835ffd730d33eac431af364d). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:41:43,607 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (e50f0740b021ecddd66d884176eaa228e86bddbc835ffd730d33eac431af364d). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:41:43,609 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-26 23:41:43,609 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:41:43,610 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 19.4ms
2025-10-26 23:41:43,610 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.8ms
2025-10-26 23:41:43,617 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-26 23:41:43,618 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-26 23:41:43,619 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.7ms
2025-10-26 23:41:43,644 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:41:43,646 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:41:43,647 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:41:43,648 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:41:43,648 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:41:43,648 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:41:43,649 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:41:43,651 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:41:43,651 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:41:43,656 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:41:43,656 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:41:43,660 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:41:43,660 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:41:43,661 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:41:43,661 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 17.5ms
2025-10-26 23:41:43,661 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.9ms
2025-10-26 23:41:43,661 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 12.7ms
2025-10-26 23:41:43,665 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:41:43,666 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:41:43,668 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:41:43,669 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:41:43,670 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:41:43,670 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:41:43,673 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:41:43,673 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:41:43,678 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:41:43,679 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:41:43,679 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:41:43,682 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:41:43,683 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:41:43,683 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:41:43,684 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 18.4ms
2025-10-26 23:41:43,684 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 18.1ms
2025-10-26 23:41:43,684 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.4ms
2025-10-26 23:55:17,517 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-26 23:55:17,517 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-26 23:55:17,517 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.9ms
2025-10-26 23:55:17,518 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-26 23:55:17,822 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:55:17,823 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:55:17,956 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-26 23:55:17,956 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_token: RefreshTokenService.revoke_token() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() takes 1 positional argument but 2 were given
2025-10-26 23:55:17,957 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error al revocar token antiguo: Error interno del servidor en revoke_token
2025-10-26 23:55:17,961 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-26 23:55:17,962 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 90
2025-10-26 23:55:17,962 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:55:17,963 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-26 23:55:17,964 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_token: RefreshTokenService.revoke_token() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() takes 1 positional argument but 2 were given
2025-10-26 23:55:17,964 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error al revocar token antiguo: Error interno del servidor en revoke_token
2025-10-26 23:55:17,965 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (acfa5d3995531e0a261df260713a11c1a8cc9983b11cb1daf516d350fc1b89d2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-26 23:55:17,965 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (acfa5d3995531e0a261df260713a11c1a8cc9983b11cb1daf516d350fc1b89d2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:55:17,967 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (acfa5d3995531e0a261df260713a11c1a8cc9983b11cb1daf516d350fc1b89d2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:55:17,968 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-26 23:55:17,969 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:55:17,969 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 146.7ms
2025-10-26 23:55:17,969 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 146.2ms
2025-10-26 23:55:17,974 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-26 23:55:17,975 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.5ms
2025-10-26 23:55:17,976 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-26 23:55:17,979 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-26 23:55:17,996 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 19.9ms
2025-10-26 23:55:18,020 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-26 23:55:18,020 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-26 23:55:18,021 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-26 23:55:18,021 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.6ms
2025-10-26 23:55:18,022 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.5ms
2025-10-26 23:55:18,023 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 2.0ms
2025-10-26 23:55:18,028 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:55:18,035 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:55:18,035 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:55:18,089 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:55:18,090 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:55:18,090 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-26 23:55:18,091 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:55:18,091 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 63.5ms
2025-10-26 23:55:18,094 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:55:18,094 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:55:18,111 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:55:18,112 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:55:18,112 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-26 23:55:18,113 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-26 23:55:18,113 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 23.0ms
2025-10-26 23:55:18,114 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 22.9ms
2025-10-26 23:55:18,114 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 2.1ms
2025-10-26 23:55:18,115 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 2.0ms
2025-10-26 23:55:18,115 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:55:18,119 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:55:18,120 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:55:18,120 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:55:18,122 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 6.2ms
2025-10-26 23:55:18,122 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:55:18,124 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:55:18,124 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:55:18,125 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:55:18,125 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:55:18,127 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.2ms
2025-10-26 23:55:18,127 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:55:18,130 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:55:18,130 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:55:18,134 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:55:18,135 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:55:18,136 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.9ms
2025-10-26 23:55:18,137 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:55:18,140 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:55:18,141 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:55:18,141 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:55:18,142 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.1ms
2025-10-26 23:55:58,260 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-26 23:55:58,261 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.7ms
2025-10-26 23:55:58,262 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-26 23:55:58,263 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] No se pudo revocar token: name 'decode_refresh_token' is not defined
2025-10-26 23:55:58,263 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 0.7ms
2025-10-26 23:56:17,459 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:56:17,459 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:56:17,461 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-26 23:56:17,461 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-26 23:56:17,461 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.8ms
2025-10-26 23:56:17,462 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.5ms
2025-10-26 23:56:25,017 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-26 23:56:25,018 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-26 23:56:25,019 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-26 23:56:25,394 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-26 23:56:25,395 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 92
2025-10-26 23:56:25,395 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-26 23:56:25,401 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 381.7ms
2025-10-26 23:56:25,425 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:56:25,439 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:56:25,439 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:56:25,500 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:56:25,500 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:56:25,501 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 75.5ms
2025-10-26 23:56:25,502 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:56:25,504 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:56:25,505 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:56:25,519 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:56:25,519 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:56:25,520 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 17.1ms
2025-10-26 23:56:25,522 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:56:25,524 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:56:25,526 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:56:25,527 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:56:25,528 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.8ms
2025-10-26 23:56:25,530 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:56:25,532 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:56:25,533 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:56:25,534 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:56:25,535 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:56:25,535 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.2ms
2025-10-26 23:56:25,537 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:56:25,540 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:56:25,540 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:56:25,545 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:56:25,545 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:56:25,546 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.5ms
2025-10-26 23:56:25,547 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:56:25,549 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:56:25,550 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:56:25,551 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:56:25,551 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.7ms
2025-10-26 23:56:34,331 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:56:34,332 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-26 23:56:34,335 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-26 23:56:34,336 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_token: RefreshTokenService.revoke_token() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() takes 1 positional argument but 2 were given
2025-10-26 23:56:34,337 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error al revocar token antiguo: Error interno del servidor en revoke_token
2025-10-26 23:56:34,339 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-26 23:56:34,339 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 93
2025-10-26 23:56:34,340 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:56:34,342 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-26 23:56:34,342 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_token: RefreshTokenService.revoke_token() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
                 ~~~~^^^^^^^^^^^^^^^^^
TypeError: RefreshTokenService.revoke_token() takes 1 positional argument but 2 were given
2025-10-26 23:56:34,343 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error al revocar token antiguo: Error interno del servidor en revoke_token
2025-10-26 23:56:34,344 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (ebff8587868041ec44d132c90bedfdcb555820c4a381219b45052adcacd96fd3). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-26 23:56:34,345 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (ebff8587868041ec44d132c90bedfdcb555820c4a381219b45052adcacd96fd3). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:56:34,347 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (ebff8587868041ec44d132c90bedfdcb555820c4a381219b45052adcacd96fd3). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-26 23:56:34,349 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-26 23:56:34,349 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-26 23:56:34,349 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.7ms
2025-10-26 23:56:34,350 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.9ms
2025-10-26 23:56:34,354 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-26 23:56:34,356 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-26 23:56:34,358 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.6ms
2025-10-26 23:56:34,374 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:56:34,377 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:56:34,378 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:56:34,382 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:56:34,384 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:56:34,386 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:56:34,386 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:56:34,389 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:56:34,389 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:56:34,394 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:56:34,394 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:56:34,397 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:56:34,399 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:56:34,400 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:56:34,401 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 26.5ms
2025-10-26 23:56:34,401 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 15.6ms
2025-10-26 23:56:34,402 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 15.5ms
2025-10-26 23:56:34,404 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-26 23:56:34,407 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-26 23:56:34,407 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-26 23:56:34,409 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-26 23:56:34,410 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-26 23:56:34,411 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.0ms
2025-10-26 23:56:34,411 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-26 23:56:34,411 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-26 23:56:34,414 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-26 23:56:34,415 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-26 23:56:34,420 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-26 23:56:34,420 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-26 23:56:34,423 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-26 23:56:34,424 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-26 23:56:34,424 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-26 23:56:34,425 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 13.8ms
2025-10-26 23:56:34,425 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 14.0ms
2025-10-27 00:00:32,165 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 00:00:32,165 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] No se pudo revocar token: name 'decode_refresh_token' is not defined
2025-10-27 00:00:32,166 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 1.0ms
2025-10-27 00:00:49,530 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:00:49,530 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:00:49,532 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 00:00:49,532 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 00:00:49,532 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.6ms
2025-10-27 00:00:49,533 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.2ms
2025-10-27 00:01:02,889 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 00:01:03,269 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:01:03,270 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 95
2025-10-27 00:01:03,270 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 00:01:03,276 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 386.7ms
2025-10-27 00:01:03,303 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:01:03,310 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:01:03,310 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:01:03,356 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:01:03,357 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:01:03,357 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 54.1ms
2025-10-27 00:01:03,360 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:01:03,362 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:01:03,362 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:01:03,380 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:01:03,380 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:01:03,381 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 21.1ms
2025-10-27 00:01:03,383 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:01:03,385 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:01:03,388 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:01:03,388 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:01:03,388 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.1ms
2025-10-27 00:01:03,391 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:01:03,393 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:01:03,393 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:01:03,394 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:01:03,395 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:01:03,395 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.3ms
2025-10-27 00:01:03,396 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:01:03,399 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:01:03,399 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:01:03,403 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:01:03,404 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:01:03,404 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.7ms
2025-10-27 00:01:03,406 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:01:03,409 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:01:03,410 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:01:03,410 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:01:03,410 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.9ms
2025-10-27 00:01:10,458 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:01:10,459 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:01:10,466 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:01:10,466 - app.services.refresh_token_service - ERROR - Error inesperado revocando token: name 'REVOKE_REFRESH_TOKEN_BY_USER' is not defined
Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 224, in revoke_token
    result = execute_update(REVOKE_REFRESH_TOKEN_BY_USER, (token_hash, usuario_id))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'REVOKE_REFRESH_TOKEN_BY_USER' is not defined. Did you mean: 'REVOKE_REFRESH_TOKEN'?
2025-10-27 00:01:10,467 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 224, in revoke_token
    result = execute_update(REVOKE_REFRESH_TOKEN_BY_USER, (token_hash, usuario_id))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'REVOKE_REFRESH_TOKEN_BY_USER' is not defined. Did you mean: 'REVOKE_REFRESH_TOKEN'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 240, in revoke_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al revocar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:01:10,470 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error al revocar token antiguo: Error interno del servidor en revoke_token
2025-10-27 00:01:10,476 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:01:10,477 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 96
2025-10-27 00:01:10,478 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:01:10,479 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 21.5ms
2025-10-27 00:01:10,481 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:01:10,482 - app.services.refresh_token_service - ERROR - Error inesperado revocando token: name 'REVOKE_REFRESH_TOKEN_BY_USER' is not defined
Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 224, in revoke_token
    result = execute_update(REVOKE_REFRESH_TOKEN_BY_USER, (token_hash, usuario_id))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'REVOKE_REFRESH_TOKEN_BY_USER' is not defined. Did you mean: 'REVOKE_REFRESH_TOKEN'?
2025-10-27 00:01:10,483 - app.services.base_service - ERROR - ERROR INESPERADO en revoke_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 224, in revoke_token
    result = execute_update(REVOKE_REFRESH_TOKEN_BY_USER, (token_hash, usuario_id))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'REVOKE_REFRESH_TOKEN_BY_USER' is not defined. Did you mean: 'REVOKE_REFRESH_TOKEN'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 240, in revoke_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al revocar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:01:10,484 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error al revocar token antiguo: Error interno del servidor en revoke_token
2025-10-27 00:01:10,486 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (6f14420577d1ccac364867b76ff610c04f33d4d227b96b129401d0a1455e5274). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:01:10,486 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (6f14420577d1ccac364867b76ff610c04f33d4d227b96b129401d0a1455e5274). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:01:10,488 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (6f14420577d1ccac364867b76ff610c04f33d4d227b96b129401d0a1455e5274). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:01:10,490 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:01:10,490 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:01:10,492 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 32.9ms
2025-10-27 00:01:10,501 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:01:10,503 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:01:10,505 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 4.3ms
2025-10-27 00:01:10,524 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:01:10,527 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:01:10,527 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:01:10,529 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:01:10,529 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:01:10,530 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:01:10,530 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:01:10,533 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:01:10,533 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:01:10,538 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:01:10,538 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:01:10,540 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:01:10,541 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:01:10,541 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:01:10,542 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 17.9ms
2025-10-27 00:01:10,542 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.0ms
2025-10-27 00:01:10,542 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 11.8ms
2025-10-27 00:01:10,546 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:01:10,549 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:01:10,549 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:01:10,551 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:01:10,551 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:01:10,552 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:01:10,555 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:01:10,555 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:01:10,559 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:01:10,559 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:01:10,560 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:01:10,561 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 14.7ms
2025-10-27 00:01:10,564 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:01:10,565 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:01:10,565 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:01:10,566 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 14.3ms
2025-10-27 00:01:10,567 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 6.8ms
2025-10-27 00:07:48,145 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 00:07:48,145 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 00:07:48,146 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.9ms
2025-10-27 00:07:48,146 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 00:07:48,449 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:07:48,450 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:07:48,562 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:07:48,566 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:07:48,566 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o no pertenece al usuario 1
2025-10-27 00:07:48,566 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:07:48,570 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:07:48,570 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 98
2025-10-27 00:07:48,570 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:07:48,572 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:07:48,572 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:07:48,573 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o no pertenece al usuario 1
2025-10-27 00:07:48,573 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:07:48,574 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (4b0c9956ba9225c9ad1131950eb116a6640c1e4be56af4482bb6cfa13eaf0df2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:07:48,574 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (4b0c9956ba9225c9ad1131950eb116a6640c1e4be56af4482bb6cfa13eaf0df2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:07:48,576 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (4b0c9956ba9225c9ad1131950eb116a6640c1e4be56af4482bb6cfa13eaf0df2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:07:48,577 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:07:48,578 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:07:48,578 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 128.7ms
2025-10-27 00:07:48,578 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 128.3ms
2025-10-27 00:07:48,583 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 00:07:48,583 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 00:07:48,584 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:07:48,586 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:07:48,598 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 13.5ms
2025-10-27 00:07:48,623 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 00:07:48,624 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.0ms
2025-10-27 00:07:48,624 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 00:07:48,624 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 00:07:48,625 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.9ms
2025-10-27 00:07:48,625 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.8ms
2025-10-27 00:07:48,627 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 00:07:48,627 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:07:48,632 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:07:48,632 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:07:48,680 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:07:48,680 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:07:48,680 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 53.8ms
2025-10-27 00:07:48,681 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 00:07:48,681 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 00:07:48,681 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 54.4ms
2025-10-27 00:07:48,682 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:07:48,684 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:07:48,685 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:07:48,685 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:07:48,686 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 5.5ms
2025-10-27 00:07:48,686 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 5.5ms
2025-10-27 00:07:48,687 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.1ms
2025-10-27 00:07:48,689 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:07:48,691 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:07:48,691 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:07:48,709 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:07:48,710 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:07:48,710 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 21.5ms
2025-10-27 00:07:48,711 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:07:48,713 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:07:48,713 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:07:48,714 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:07:48,715 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:07:48,715 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.5ms
2025-10-27 00:07:48,717 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:07:48,717 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:07:48,719 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:07:48,719 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:07:48,723 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:07:48,723 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:07:48,725 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:07:48,726 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:07:48,726 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:07:48,726 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.3ms
2025-10-27 00:07:48,726 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.2ms
2025-10-27 00:07:55,922 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 00:07:55,923 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.6ms
2025-10-27 00:07:55,924 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 00:07:55,925 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] No se pudo revocar token: name 'decode_refresh_token' is not defined
2025-10-27 00:07:55,925 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 0.7ms
2025-10-27 00:08:13,016 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 00:08:13,017 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.4ms
2025-10-27 00:08:13,018 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 00:08:13,309 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:08:13,309 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 100
2025-10-27 00:08:13,310 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 00:08:13,310 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 291.8ms
2025-10-27 00:08:13,327 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:08:13,333 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:08:13,333 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:08:13,387 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:08:13,387 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:08:13,388 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:08:13,390 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:08:13,390 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:08:13,421 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:08:13,422 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:08:13,422 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 95.2ms
2025-10-27 00:08:13,422 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 34.5ms
2025-10-27 00:08:13,425 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:08:13,427 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:08:13,429 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:08:13,429 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:08:13,430 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:08:13,432 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:08:13,432 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:08:13,433 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:08:13,434 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:08:13,434 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.3ms
2025-10-27 00:08:13,435 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.8ms
2025-10-27 00:08:13,437 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:08:13,440 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:08:13,440 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:08:13,444 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:08:13,444 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:08:13,445 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:08:13,447 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:08:13,448 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:08:13,448 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:08:13,449 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.4ms
2025-10-27 00:08:13,449 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.1ms
2025-10-27 00:08:18,629 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:08:18,630 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:08:18,633 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:08:18,640 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:08:18,640 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o no pertenece al usuario 1
2025-10-27 00:08:18,641 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:08:18,642 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:08:18,643 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 101
2025-10-27 00:08:18,643 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:08:18,644 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:08:18,645 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:08:18,646 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o no pertenece al usuario 1
2025-10-27 00:08:18,646 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:08:18,647 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (129242f230a531642a1bf5ad558e49970261e8da7759dac9ccba194b4b41e0f1). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:08:18,648 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (129242f230a531642a1bf5ad558e49970261e8da7759dac9ccba194b4b41e0f1). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:08:18,649 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (129242f230a531642a1bf5ad558e49970261e8da7759dac9ccba194b4b41e0f1). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:08:18,651 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:08:18,651 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:08:18,652 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 22.8ms
2025-10-27 00:08:18,652 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 22.2ms
2025-10-27 00:08:18,656 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:08:18,659 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:08:18,661 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 4.4ms
2025-10-27 00:08:18,676 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:08:18,679 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:08:18,679 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:08:18,680 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:08:18,680 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:08:18,681 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:08:18,681 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:08:18,684 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:08:18,684 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:08:18,688 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:08:18,688 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:08:18,690 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:08:18,691 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:08:18,691 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:08:18,691 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 15.1ms
2025-10-27 00:08:18,692 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.2ms
2025-10-27 00:08:18,692 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 11.1ms
2025-10-27 00:08:18,694 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:08:18,697 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:08:18,697 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:08:18,698 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:08:18,699 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:08:18,700 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.3ms
2025-10-27 00:08:18,700 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:08:18,700 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:08:18,702 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:08:18,702 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:08:18,707 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:08:18,707 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:08:18,710 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:08:18,711 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:08:18,711 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:08:18,712 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.9ms
2025-10-27 00:08:18,712 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 11.8ms
2025-10-27 00:10:35,765 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 00:10:35,768 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] No se pudo revocar token: name 'execute_auth_query' is not defined
2025-10-27 00:10:35,768 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 3.5ms
2025-10-27 00:10:52,025 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:10:52,026 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:10:52,028 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 00:10:52,028 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 00:10:52,028 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.0ms
2025-10-27 00:10:52,029 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.8ms
2025-10-27 00:11:10,289 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 00:11:10,666 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:11:10,667 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 103
2025-10-27 00:11:10,667 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 00:11:10,672 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 383.7ms
2025-10-27 00:11:10,694 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:11:10,701 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:11:10,702 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:11:10,747 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:11:10,747 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:11:10,748 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 53.9ms
2025-10-27 00:11:10,750 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:11:10,752 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:11:10,752 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:11:10,769 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:11:10,769 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:11:10,770 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 20.2ms
2025-10-27 00:11:10,772 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:11:10,774 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:11:10,776 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:11:10,776 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:11:10,776 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.5ms
2025-10-27 00:11:10,778 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:11:10,781 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:11:10,781 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:11:10,782 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:11:10,782 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:11:10,783 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.8ms
2025-10-27 00:11:10,785 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:11:10,787 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:11:10,787 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:11:10,790 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:11:10,790 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:11:10,791 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.2ms
2025-10-27 00:11:10,793 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:11:10,795 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:11:10,796 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:11:10,796 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:11:10,797 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.2ms
2025-10-27 00:12:03,708 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:12:03,709 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:12:03,721 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:12:03,727 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:12:03,727 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o no pertenece al usuario 1
2025-10-27 00:12:03,727 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:12:03,733 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:12:03,733 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 104
2025-10-27 00:12:03,734 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:12:03,735 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:12:03,736 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:12:03,736 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o no pertenece al usuario 1
2025-10-27 00:12:03,736 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:12:03,737 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (bed436456e9c63b46f4095ade77a44e73401b9c6eb1672ad73871162fbb4d58e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:12:03,737 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (bed436456e9c63b46f4095ade77a44e73401b9c6eb1672ad73871162fbb4d58e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:12:03,739 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (bed436456e9c63b46f4095ade77a44e73401b9c6eb1672ad73871162fbb4d58e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:12:03,741 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:12:03,741 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:12:03,741 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 33.2ms
2025-10-27 00:12:03,742 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 32.6ms
2025-10-27 00:12:03,747 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:12:03,749 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:12:03,760 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 13.3ms
2025-10-27 00:12:03,778 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:12:03,783 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:12:03,784 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:12:03,836 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:12:03,836 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:12:03,837 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:12:03,837 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:12:03,838 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:12:03,840 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:12:03,840 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:12:03,842 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:12:03,842 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:12:03,866 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:12:03,867 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:12:03,867 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 89.7ms
2025-10-27 00:12:03,867 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 30.9ms
2025-10-27 00:12:03,868 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 30.8ms
2025-10-27 00:12:03,870 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:12:03,872 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:12:03,872 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:12:03,874 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:12:03,874 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:12:03,875 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:12:03,875 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.5ms
2025-10-27 00:12:03,877 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:12:03,878 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:12:03,879 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:12:03,879 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:12:03,882 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:12:03,882 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:12:03,887 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:12:03,887 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:12:03,888 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 12.9ms
2025-10-27 00:12:03,888 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.9ms
2025-10-27 00:24:12,514 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 00:24:12,515 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 00:24:12,515 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 1.1ms
2025-10-27 00:24:12,515 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 00:24:12,820 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:24:12,820 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:24:12,825 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 4.9ms
2025-10-27 00:24:12,825 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 4.8ms
2025-10-27 00:24:23,536 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 00:24:23,536 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.4ms
2025-10-27 00:24:23,538 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 00:24:23,883 - app.api.v1.endpoints.auth - ERROR - Error inesperado en /login/ para usuario admin: create_refresh_token() got an unexpected keyword argument 'data'
Traceback (most recent call last):
  File "D:\base_fastapi\app\api\v1\endpoints\auth.py", line 114, in login
    refresh_token = create_refresh_token(data={"sub": form_data.username})
TypeError: create_refresh_token() got an unexpected keyword argument 'data'
2025-10-27 00:24:23,884 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 346.6ms
2025-10-27 00:25:51,140 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:25:51,141 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:25:51,252 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:25:51,254 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 00:25:51,254 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:25:51,254 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:25:51,257 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:25:51,257 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 106
2025-10-27 00:25:51,258 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:25:51,259 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:25:51,260 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 00:25:51,260 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:25:51,260 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:25:51,261 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (723ef573f2886529c384d3d693e444253df13859e2634ef6e2949a96070753c2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:25:51,262 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (723ef573f2886529c384d3d693e444253df13859e2634ef6e2949a96070753c2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:25:51,264 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (723ef573f2886529c384d3d693e444253df13859e2634ef6e2949a96070753c2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:25:51,266 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:25:51,266 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:25:51,266 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 125.8ms
2025-10-27 00:25:51,266 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 125.6ms
2025-10-27 00:25:51,572 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 00:25:51,573 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 00:25:51,575 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:25:51,576 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:25:51,587 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 12.1ms
2025-10-27 00:25:57,704 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 00:25:57,940 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:25:57,941 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 108
2025-10-27 00:25:57,941 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 00:25:57,941 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 237.5ms
2025-10-27 00:25:57,965 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 00:25:57,966 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.9ms
2025-10-27 00:25:57,969 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 00:25:57,970 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.9ms
2025-10-27 00:25:57,970 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:25:57,979 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:25:57,979 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:25:58,033 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:25:58,033 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:25:58,035 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 64.6ms
2025-10-27 00:25:58,036 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 00:25:58,037 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.0ms
2025-10-27 00:25:58,038 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:25:58,041 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:25:58,041 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:25:58,057 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:25:58,057 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:25:58,058 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 20.3ms
2025-10-27 00:25:58,060 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 00:25:58,061 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.0ms
2025-10-27 00:25:58,061 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:25:58,064 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:25:58,066 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:25:58,066 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:25:58,067 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.9ms
2025-10-27 00:25:58,068 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 00:25:58,070 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.5ms
2025-10-27 00:25:58,071 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:25:58,074 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:25:58,074 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:25:58,075 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:25:58,075 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:25:58,076 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.2ms
2025-10-27 00:25:58,077 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 00:25:58,078 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.8ms
2025-10-27 00:25:58,078 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:25:58,080 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:25:58,081 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:25:58,085 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:25:58,085 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:25:58,087 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.4ms
2025-10-27 00:25:58,089 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:25:58,091 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:25:58,092 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:25:58,092 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:25:58,093 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.1ms
2025-10-27 00:26:09,642 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:26:09,643 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:26:09,645 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:26:09,647 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:26:09,647 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:26:09,647 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:26:09,649 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:26:09,649 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 109
2025-10-27 00:26:09,650 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:26:09,652 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:26:09,653 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:26:09,654 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:26:09,654 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:26:09,655 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (020f9a5b47eedc19ce99bcc556fffd44bf0a4f6e520bdc46615e8ceb7e5cd21e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:26:09,656 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (020f9a5b47eedc19ce99bcc556fffd44bf0a4f6e520bdc46615e8ceb7e5cd21e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:26:09,657 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (020f9a5b47eedc19ce99bcc556fffd44bf0a4f6e520bdc46615e8ceb7e5cd21e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:26:09,659 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:26:09,660 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:26:09,660 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.0ms
2025-10-27 00:26:09,661 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.4ms
2025-10-27 00:26:09,668 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:26:09,670 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:26:09,671 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.8ms
2025-10-27 00:26:09,689 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:26:09,691 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:26:09,692 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:26:09,693 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:26:09,693 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:26:09,694 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:26:09,694 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:26:09,696 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:26:09,696 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:26:09,701 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:26:09,701 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:26:09,703 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:26:09,704 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:26:09,704 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:26:09,705 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 16.1ms
2025-10-27 00:26:09,705 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.6ms
2025-10-27 00:26:09,705 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 11.5ms
2025-10-27 00:26:09,708 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:26:09,711 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:26:09,711 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:26:09,712 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:26:09,713 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:26:09,714 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.9ms
2025-10-27 00:26:09,714 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:26:09,717 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:26:09,717 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:26:09,721 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:26:09,721 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:26:09,721 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:26:09,724 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:26:09,725 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:26:09,725 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:26:09,726 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.0ms
2025-10-27 00:26:09,727 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.1ms
2025-10-27 00:26:17,297 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:26:17,299 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:26:17,300 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:26:17,301 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:26:17,301 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:26:17,302 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:26:17,303 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 111
2025-10-27 00:26:17,303 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:26:17,303 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.6ms
2025-10-27 00:26:17,306 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:26:17,309 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:26:17,310 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:26:17,311 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:26:17,311 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:26:17,312 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (fad666497f67f378813d9ac7734319d1d4d8b21f40829ec32e599919c8c53760). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:26:17,313 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (fad666497f67f378813d9ac7734319d1d4d8b21f40829ec32e599919c8c53760). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:26:17,314 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (fad666497f67f378813d9ac7734319d1d4d8b21f40829ec32e599919c8c53760). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:26:17,315 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:26:17,316 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:26:17,316 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 10.0ms
2025-10-27 00:26:17,320 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:26:17,322 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:26:17,323 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.4ms
2025-10-27 00:26:17,341 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:26:17,343 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:26:17,344 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:26:17,345 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:26:17,345 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:26:17,345 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.3ms
2025-10-27 00:26:17,348 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:26:17,350 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:26:17,350 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:26:17,355 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:26:17,355 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:26:17,356 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.3ms
2025-10-27 00:26:17,358 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:26:17,361 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:26:17,362 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:26:17,362 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:26:17,362 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.0ms
2025-10-27 00:26:17,364 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:26:17,367 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:26:17,367 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:26:17,368 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:26:17,369 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:26:17,369 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.5ms
2025-10-27 00:26:17,371 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:26:17,374 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:26:17,375 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:26:17,378 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:26:17,379 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:26:17,379 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.1ms
2025-10-27 00:26:17,381 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:26:17,384 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:26:17,385 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:26:17,385 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:26:17,385 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.1ms
2025-10-27 00:26:25,908 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 00:26:25,908 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.5ms
2025-10-27 00:26:25,910 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 00:26:25,911 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:26:25,912 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:26:25,912 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 00:26:25,912 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.4ms
2025-10-27 00:26:39,011 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:26:39,012 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:26:39,013 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 00:26:39,014 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 00:26:39,014 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.3ms
2025-10-27 00:26:39,014 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.7ms
2025-10-27 00:26:50,103 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 00:26:50,355 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:26:50,355 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 113
2025-10-27 00:26:50,355 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 00:26:50,356 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 252.8ms
2025-10-27 00:26:50,369 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:26:50,380 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:26:50,380 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:26:50,414 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:26:50,414 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:26:50,415 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 45.4ms
2025-10-27 00:26:50,415 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:26:50,418 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:26:50,418 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:26:50,435 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:26:50,435 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:26:50,436 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 20.9ms
2025-10-27 00:26:50,438 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:26:50,440 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:26:50,442 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:26:50,442 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:26:50,443 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.2ms
2025-10-27 00:26:50,443 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:26:50,446 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:26:50,446 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:26:50,447 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:26:50,448 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:26:50,448 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.2ms
2025-10-27 00:26:50,450 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:26:50,453 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:26:50,454 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:26:50,472 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:26:50,472 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:26:50,473 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 22.8ms
2025-10-27 00:26:50,473 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:26:50,478 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:26:50,482 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:26:50,482 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:26:50,483 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.5ms
2025-10-27 00:26:54,776 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:26:54,776 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:26:54,796 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:26:54,801 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:26:54,801 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:26:54,801 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:26:54,806 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:26:54,807 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 114
2025-10-27 00:26:54,807 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:26:54,809 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:26:54,811 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:26:54,811 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:26:54,811 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:26:54,813 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (139a3a0eb5153c258c4b38587cfaa6525b9e144a8a21d277083fc666f5011132). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:26:54,814 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (139a3a0eb5153c258c4b38587cfaa6525b9e144a8a21d277083fc666f5011132). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:26:54,815 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (139a3a0eb5153c258c4b38587cfaa6525b9e144a8a21d277083fc666f5011132). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:26:54,816 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:26:54,817 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:26:54,817 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 41.4ms
2025-10-27 00:26:54,817 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 40.9ms
2025-10-27 00:26:54,822 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:26:54,825 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:26:54,831 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 8.3ms
2025-10-27 00:26:54,849 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:26:54,855 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:26:54,856 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:26:54,900 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:26:54,900 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:26:54,901 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:26:54,902 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:26:54,908 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:26:54,909 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:26:54,932 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:26:54,932 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:26:54,939 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:26:54,942 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:26:54,942 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:26:54,943 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 93.6ms
2025-10-27 00:26:54,943 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 42.3ms
2025-10-27 00:26:54,944 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 41.6ms
2025-10-27 00:26:54,946 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:26:54,953 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:26:54,954 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:26:54,998 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:26:54,998 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:26:54,999 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:26:54,999 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 53.3ms
2025-10-27 00:26:55,005 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:26:55,006 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:26:55,018 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:26:55,018 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:26:55,019 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:26:55,024 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:26:55,026 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:26:55,026 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:26:55,027 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 28.8ms
2025-10-27 00:26:55,028 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.3ms
2025-10-27 00:26:57,792 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:26:57,792 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:26:57,797 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:26:57,802 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:26:57,802 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:26:57,802 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:26:57,806 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:26:57,807 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 116
2025-10-27 00:26:57,807 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:26:57,809 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:26:57,811 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:26:57,811 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:26:57,811 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:26:57,813 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (2afb665a77610e73028aa0208460962ae1e2dbcdda1ce5c9f4c629cf1bb06094). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:26:57,813 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (2afb665a77610e73028aa0208460962ae1e2dbcdda1ce5c9f4c629cf1bb06094). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:26:57,815 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (2afb665a77610e73028aa0208460962ae1e2dbcdda1ce5c9f4c629cf1bb06094). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:26:57,816 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:26:57,816 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:26:57,817 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 25.3ms
2025-10-27 00:26:57,817 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 25.0ms
2025-10-27 00:26:57,822 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:26:57,825 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:26:57,829 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 7.3ms
2025-10-27 00:26:57,848 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:26:57,852 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:26:57,853 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:26:57,885 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:26:57,885 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:26:57,886 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:26:57,886 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:26:57,888 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:26:57,888 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:26:57,896 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:26:57,896 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:26:57,898 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:26:57,899 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:26:57,899 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:26:57,900 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 52.1ms
2025-10-27 00:26:57,900 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 14.3ms
2025-10-27 00:26:57,900 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 14.3ms
2025-10-27 00:26:57,902 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:26:57,904 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:26:57,905 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:26:57,906 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:26:57,906 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:26:57,907 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:26:57,907 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.1ms
2025-10-27 00:26:57,910 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:26:57,910 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:26:57,915 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:26:57,915 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:26:57,916 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:26:57,918 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:26:57,919 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:26:57,919 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:26:57,920 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.9ms
2025-10-27 00:26:57,920 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.5ms
2025-10-27 00:27:00,710 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:27:00,711 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:27:00,713 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:27:00,716 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:27:00,716 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:27:00,716 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:27:00,718 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:27:00,718 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 118
2025-10-27 00:27:00,718 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:27:00,720 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:27:00,721 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:27:00,722 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:27:00,722 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:27:00,724 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (7a51392d6587f97f7c1ebb4aa9fdeac08a58b1065dd8cc88a22588005a50dd6f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:27:00,725 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (7a51392d6587f97f7c1ebb4aa9fdeac08a58b1065dd8cc88a22588005a50dd6f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:27:00,726 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (7a51392d6587f97f7c1ebb4aa9fdeac08a58b1065dd8cc88a22588005a50dd6f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:27:00,728 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:27:00,728 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:27:00,729 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.7ms
2025-10-27 00:27:00,729 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.4ms
2025-10-27 00:27:00,734 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:27:00,736 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:27:00,737 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.7ms
2025-10-27 00:27:00,752 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:27:00,754 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:27:00,755 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:27:00,756 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:27:00,756 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:27:00,756 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:27:00,756 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:27:00,758 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:27:00,758 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:27:00,762 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:27:00,763 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:27:00,765 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:27:00,766 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:27:00,766 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:27:00,766 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 13.8ms
2025-10-27 00:27:00,767 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.4ms
2025-10-27 00:27:00,767 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.2ms
2025-10-27 00:27:00,769 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:27:00,772 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:27:00,772 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:27:00,773 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:27:00,773 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:27:00,774 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:27:00,776 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:27:00,777 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:27:00,781 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:27:00,782 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:27:00,782 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:27:00,782 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 13.2ms
2025-10-27 00:27:00,785 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:27:00,786 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:27:00,786 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:27:00,786 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.7ms
2025-10-27 00:27:00,787 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.3ms
2025-10-27 00:27:03,806 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 00:27:03,807 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:27:03,808 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:27:03,808 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 00:27:03,808 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.4ms
2025-10-27 00:27:11,367 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 00:27:11,588 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:27:11,589 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 120
2025-10-27 00:27:11,589 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 00:27:11,589 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 222.2ms
2025-10-27 00:27:11,603 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:27:11,606 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:27:11,607 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:27:11,608 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:27:11,609 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:27:11,609 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.6ms
2025-10-27 00:27:11,611 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:27:11,614 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:27:11,614 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:27:11,617 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:27:11,618 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:27:11,618 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.0ms
2025-10-27 00:27:11,621 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:27:11,623 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:27:11,625 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:27:11,625 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:27:11,625 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.8ms
2025-10-27 00:27:11,628 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:27:11,630 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:27:11,630 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:27:11,631 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:27:11,631 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:27:11,632 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.3ms
2025-10-27 00:27:11,634 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:27:11,636 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:27:11,636 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:27:11,640 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:27:11,641 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:27:11,641 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.8ms
2025-10-27 00:27:11,643 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:27:11,645 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:27:11,646 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:27:11,646 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:27:11,647 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.6ms
2025-10-27 00:27:17,254 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:27:17,255 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:27:17,258 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:27:17,260 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:27:17,261 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:27:17,261 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:27:17,263 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:27:17,264 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 121
2025-10-27 00:27:17,266 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:27:17,269 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:27:17,270 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:27:17,271 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:27:17,271 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:27:17,273 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (e7e66603e4d8b229bb4923620eb4b2f6f6d3f98fa9038233609aadbc6f77d9d4). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:27:17,273 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (e7e66603e4d8b229bb4923620eb4b2f6f6d3f98fa9038233609aadbc6f77d9d4). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:27:17,274 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (e7e66603e4d8b229bb4923620eb4b2f6f6d3f98fa9038233609aadbc6f77d9d4). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:27:17,276 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:27:17,276 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:27:17,277 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 22.3ms
2025-10-27 00:27:17,277 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 21.7ms
2025-10-27 00:27:17,282 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:27:17,284 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:27:17,285 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.1ms
2025-10-27 00:27:17,301 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:27:17,304 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:27:17,304 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:27:17,305 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:27:17,305 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:27:17,306 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:27:17,306 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:27:17,308 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:27:17,308 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:27:17,313 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:27:17,313 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:27:17,316 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:27:17,317 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:27:17,317 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:27:17,317 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 16.3ms
2025-10-27 00:27:17,318 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.9ms
2025-10-27 00:27:17,318 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 11.7ms
2025-10-27 00:27:17,320 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:27:17,323 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:27:17,323 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:27:17,324 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:27:17,324 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:27:17,325 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:27:17,328 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:27:17,328 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:27:17,332 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:27:17,332 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:27:17,333 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:27:17,333 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 13.4ms
2025-10-27 00:27:17,336 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:27:17,336 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:27:17,337 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:27:17,337 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.3ms
2025-10-27 00:27:17,338 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.8ms
2025-10-27 00:27:21,548 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:27:21,549 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:27:21,552 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:27:21,571 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:27:21,572 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:27:21,572 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:27:21,573 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:27:21,574 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 123
2025-10-27 00:27:21,574 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:27:21,576 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:27:21,577 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:27:21,577 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:27:21,577 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:27:21,578 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (f686c41610bee4cd8a74c23817424a64b61afcfb6e44057ceec8d4946ece04c4). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:27:21,579 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (f686c41610bee4cd8a74c23817424a64b61afcfb6e44057ceec8d4946ece04c4). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:27:21,580 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (f686c41610bee4cd8a74c23817424a64b61afcfb6e44057ceec8d4946ece04c4). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:27:21,583 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:27:21,583 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:27:21,583 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 34.9ms
2025-10-27 00:27:21,584 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 34.3ms
2025-10-27 00:27:21,588 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:27:21,590 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:27:21,591 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.8ms
2025-10-27 00:27:21,607 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:27:21,610 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:27:21,610 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:27:21,611 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:27:21,611 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:27:21,612 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:27:21,612 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:27:21,614 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:27:21,616 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:27:21,616 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:27:21,619 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:27:21,619 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:27:21,623 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:27:21,623 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:27:21,624 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 16.3ms
2025-10-27 00:27:21,624 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 12.2ms
2025-10-27 00:27:21,624 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.1ms
2025-10-27 00:27:21,627 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:27:21,628 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:27:21,630 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:27:21,632 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:27:21,632 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:27:21,634 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:27:21,635 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:27:21,636 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:27:21,636 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:27:21,637 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:27:21,639 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:27:21,639 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:27:21,643 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:27:21,643 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:27:21,644 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 16.5ms
2025-10-27 00:27:21,644 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 16.3ms
2025-10-27 00:27:21,644 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.5ms
2025-10-27 00:30:33,642 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 00:30:33,755 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:30:33,755 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:30:33,755 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 00:30:33,756 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 113.7ms
2025-10-27 00:30:56,664 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:30:56,665 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:30:56,666 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 00:30:56,667 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 00:30:56,667 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.7ms
2025-10-27 00:30:56,667 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.3ms
2025-10-27 00:31:04,767 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 00:31:05,040 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:31:05,041 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 125
2025-10-27 00:31:05,041 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 00:31:05,045 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 278.6ms
2025-10-27 00:31:05,062 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:31:05,070 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:31:05,070 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:31:05,116 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:31:05,117 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:31:05,117 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 55.7ms
2025-10-27 00:31:05,119 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:31:05,121 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:31:05,122 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:31:05,133 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:31:05,133 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:31:05,134 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 14.8ms
2025-10-27 00:31:05,136 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:31:05,138 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:31:05,140 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:31:05,140 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:31:05,140 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.5ms
2025-10-27 00:31:05,142 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:31:05,144 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:31:05,144 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:31:05,146 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:31:05,146 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:31:05,146 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.4ms
2025-10-27 00:31:05,148 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:31:05,150 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:31:05,151 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:31:05,154 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:31:05,154 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:31:05,154 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.2ms
2025-10-27 00:31:05,156 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:31:05,158 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:31:05,159 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:31:05,159 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:31:05,159 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.2ms
2025-10-27 00:31:12,782 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:31:12,783 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:31:12,792 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:31:12,796 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:31:12,797 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:31:12,797 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:31:12,802 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:31:12,802 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 126
2025-10-27 00:31:12,803 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:31:12,804 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:31:12,805 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:31:12,805 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:31:12,805 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:31:12,807 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (20480f22c529654cd41ec10758f28f991f21c4ed33c50fc771bc8ff723ca33e5). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:31:12,807 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (20480f22c529654cd41ec10758f28f991f21c4ed33c50fc771bc8ff723ca33e5). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:31:12,809 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (20480f22c529654cd41ec10758f28f991f21c4ed33c50fc771bc8ff723ca33e5). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:31:12,810 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:31:12,810 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:31:12,810 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 28.5ms
2025-10-27 00:31:12,811 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 28.1ms
2025-10-27 00:31:12,816 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:31:12,818 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:31:12,823 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 7.6ms
2025-10-27 00:31:12,840 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:31:12,858 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:31:12,859 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:31:12,913 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:31:12,914 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:31:12,914 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:31:12,915 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:31:12,928 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:31:12,931 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:31:12,932 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:31:12,936 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:31:12,936 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:31:12,962 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:31:12,962 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:31:12,963 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 122.6ms
2025-10-27 00:31:12,963 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 48.8ms
2025-10-27 00:31:12,964 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 48.8ms
2025-10-27 00:31:12,966 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:31:12,974 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:31:12,974 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:31:12,985 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:31:12,985 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:31:12,986 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:31:12,987 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 20.8ms
2025-10-27 00:31:12,993 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:31:12,995 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:31:12,995 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:31:12,996 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:31:13,001 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:31:13,002 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:31:13,011 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:31:13,011 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:31:13,012 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 25.8ms
2025-10-27 00:31:13,012 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 16.9ms
2025-10-27 00:34:14,338 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 00:34:14,339 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 00:34:14,340 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 1.6ms
2025-10-27 00:34:14,340 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 00:34:15,421 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:34:15,422 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 00:34:15,517 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:34:15,520 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:34:15,521 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:34:15,521 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:34:15,524 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 00:34:15,524 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 128
2025-10-27 00:34:15,524 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:34:15,526 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 00:34:15,527 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 00:34:15,527 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 00:34:15,527 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 00:34:15,528 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (fd8a3f600962042f2ecf14f5ca8a7b8e1460a160db133fb784fc9c132e600dc3). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 00:34:15,528 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (fd8a3f600962042f2ecf14f5ca8a7b8e1460a160db133fb784fc9c132e600dc3). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:34:15,530 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (fd8a3f600962042f2ecf14f5ca8a7b8e1460a160db133fb784fc9c132e600dc3). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 00:34:15,531 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 00:34:15,531 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 00:34:15,532 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 110.4ms
2025-10-27 00:34:15,532 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 110.2ms
2025-10-27 00:34:15,536 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 00:34:15,538 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 00:34:15,547 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 10.9ms
2025-10-27 00:34:15,562 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:34:15,567 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:34:15,567 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:34:15,606 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:34:15,606 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:34:15,607 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:34:15,607 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:34:15,609 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:34:15,609 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:34:15,629 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:34:15,630 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:34:15,631 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:34:15,632 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:34:15,633 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:34:15,633 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 70.5ms
2025-10-27 00:34:15,633 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 26.3ms
2025-10-27 00:34:15,633 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 26.1ms
2025-10-27 00:34:15,636 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 00:34:15,637 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 00:34:15,637 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 00:34:15,639 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 00:34:15,639 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 00:34:15,639 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 00:34:15,639 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 00:34:15,641 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 00:34:15,641 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 00:34:15,644 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 00:34:15,645 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 00:34:15,646 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 00:34:15,647 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 00:34:15,647 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 00:34:15,647 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 11.5ms
2025-10-27 00:34:15,647 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.3ms
2025-10-27 00:34:15,647 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 8.2ms
2025-10-27 08:16:04,755 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 08:16:04,755 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 08:16:04,756 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 1.3ms
2025-10-27 08:16:04,756 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.9ms
2025-10-27 08:16:05,075 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:16:05,075 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:16:05,240 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:16:05,260 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 08:16:05,260 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:16:05,261 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 08:16:05,270 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 08:16:05,270 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 130
2025-10-27 08:16:05,271 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:16:05,272 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:16:05,274 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 08:16:05,274 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:16:05,274 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 08:16:05,275 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (0cf3c0c7a5aa41a0c9d5f571be8f0c736984765326b997d88149132736528bee). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 08:16:05,276 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (0cf3c0c7a5aa41a0c9d5f571be8f0c736984765326b997d88149132736528bee). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:16:05,308 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (0cf3c0c7a5aa41a0c9d5f571be8f0c736984765326b997d88149132736528bee). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:16:05,323 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 08:16:05,324 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:16:05,324 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 249.6ms
2025-10-27 08:16:05,324 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 249.3ms
2025-10-27 08:16:05,331 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 08:16:05,332 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.5ms
2025-10-27 08:16:05,336 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 08:16:05,338 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 08:16:05,361 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 25.0ms
2025-10-27 08:17:27,458 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:17:27,459 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:17:27,469 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:17:27,470 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 08:17:27,470 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:17:27,470 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 08:17:27,471 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 08:17:27,472 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 132
2025-10-27 08:17:27,472 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:17:27,474 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:17:27,474 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 08:17:27,475 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:17:27,475 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 08:17:27,476 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b1f555f4665d2f6cfcee3de55dff51933c2245aa67698f32477d7f3935723b41). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 08:17:27,477 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b1f555f4665d2f6cfcee3de55dff51933c2245aa67698f32477d7f3935723b41). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:17:27,478 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b1f555f4665d2f6cfcee3de55dff51933c2245aa67698f32477d7f3935723b41). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:17:27,480 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 08:17:27,480 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:17:27,480 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 22.0ms
2025-10-27 08:17:27,480 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 21.6ms
2025-10-27 08:17:27,486 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 08:17:27,488 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 08:17:27,489 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.8ms
2025-10-27 08:17:36,772 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:17:36,775 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:17:36,777 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 08:17:36,778 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:17:36,778 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 08:17:36,780 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 08:17:36,780 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 134
2025-10-27 08:17:36,781 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:17:36,781 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 9.2ms
2025-10-27 08:17:36,784 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:17:36,786 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:17:36,787 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 08:17:36,788 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:17:36,788 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 08:17:36,790 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (3562d50cce88b8265047958c4fae7fddbc8865be8f9628c30541e9f2b78cc8a1). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 08:17:36,790 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (3562d50cce88b8265047958c4fae7fddbc8865be8f9628c30541e9f2b78cc8a1). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:17:36,791 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (3562d50cce88b8265047958c4fae7fddbc8865be8f9628c30541e9f2b78cc8a1). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:17:36,793 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 08:17:36,793 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:17:36,793 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 9.3ms
2025-10-27 08:17:36,797 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 08:17:36,799 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 08:17:36,800 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.0ms
2025-10-27 08:18:04,346 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:18:04,350 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:18:04,352 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 08:18:04,353 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:18:04,353 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 08:18:04,357 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 08:18:04,357 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 136
2025-10-27 08:18:04,358 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:18:04,358 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 12.0ms
2025-10-27 08:18:04,361 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:18:04,363 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:18:04,365 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 08:18:04,365 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:18:04,366 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 08:18:04,367 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (05ab835a04bb7f3eacf69313bb6ae2908e663ea73af620d7e0a54aabcf70a4d7). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 08:18:04,368 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (05ab835a04bb7f3eacf69313bb6ae2908e663ea73af620d7e0a54aabcf70a4d7). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:18:04,369 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (05ab835a04bb7f3eacf69313bb6ae2908e663ea73af620d7e0a54aabcf70a4d7). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:18:04,370 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 08:18:04,370 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:18:04,370 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 9.8ms
2025-10-27 08:18:04,374 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 08:18:04,376 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 08:18:04,377 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.9ms
2025-10-27 08:18:19,912 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:18:19,916 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:18:19,917 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 08:18:19,918 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:18:19,918 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 08:18:19,920 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 08:18:19,921 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 138
2025-10-27 08:18:19,921 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:18:19,922 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 9.0ms
2025-10-27 08:18:19,924 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:18:19,927 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:18:19,928 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 08:18:19,929 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:18:19,929 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 08:18:19,930 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (559c9023c72e14cd87eb3bc12242ba692d79e0bc81f6fc66189194934e699f21). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 08:18:19,931 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (559c9023c72e14cd87eb3bc12242ba692d79e0bc81f6fc66189194934e699f21). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:18:19,932 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (559c9023c72e14cd87eb3bc12242ba692d79e0bc81f6fc66189194934e699f21). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:18:19,934 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 08:18:19,934 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:18:19,935 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 11.0ms
2025-10-27 08:18:19,939 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 08:18:19,940 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 08:18:19,942 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.8ms
2025-10-27 08:19:04,066 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:19:04,069 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:19:04,075 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 08:19:04,076 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:19:04,076 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 08:19:04,081 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 08:19:04,081 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 140
2025-10-27 08:19:04,082 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:19:04,082 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 15.5ms
2025-10-27 08:19:04,084 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:19:04,086 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:19:04,087 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 08:19:04,087 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:19:04,087 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 08:19:04,088 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (43ba16bb1aabc7cefda30cfd118c72f97f75242d663aea2c8446642300599ee2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 08:19:04,088 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (43ba16bb1aabc7cefda30cfd118c72f97f75242d663aea2c8446642300599ee2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:19:04,089 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (43ba16bb1aabc7cefda30cfd118c72f97f75242d663aea2c8446642300599ee2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:19:04,091 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 08:19:04,091 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:19:04,091 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.5ms
2025-10-27 08:19:04,095 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 08:19:04,096 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 08:19:04,097 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.9ms
2025-10-27 08:21:04,499 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:21:04,500 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:21:04,523 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:21:04,524 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 08:21:04,525 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:21:04,526 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 08:21:04,527 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 142
2025-10-27 08:21:04,527 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:21:04,528 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:21:04,529 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 08:21:04,529 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:21:04,530 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (3308c40a51edce698c69e2a78aa143507e0c65b7fa76ba291e4e7f5221c6e351). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 08:21:04,530 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (3308c40a51edce698c69e2a78aa143507e0c65b7fa76ba291e4e7f5221c6e351). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:21:04,532 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (3308c40a51edce698c69e2a78aa143507e0c65b7fa76ba291e4e7f5221c6e351). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:21:04,534 - app.api.v1.endpoints.auth - ERROR - Error en rotación de token: Error interno del servidor en store_refresh_token
2025-10-27 08:21:04,534 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:21:04,534 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 35.3ms
2025-10-27 08:21:04,535 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 35.0ms
2025-10-27 08:21:04,539 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 08:21:04,540 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 08:21:04,546 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 6.7ms
2025-10-27 08:21:30,333 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:21:30,333 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:21:30,360 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:21:30,361 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 08:21:30,361 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:21:30,362 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 08:21:30,362 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 144
2025-10-27 08:21:30,363 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:21:30,364 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:21:30,364 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 08:21:30,365 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:21:30,365 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b567838cbea5624129c384ff11526ca0b7b2dbf32cb93f876d67c6b81beafe18). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 08:21:30,366 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b567838cbea5624129c384ff11526ca0b7b2dbf32cb93f876d67c6b81beafe18). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:21:30,367 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b567838cbea5624129c384ff11526ca0b7b2dbf32cb93f876d67c6b81beafe18). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:21:30,369 - app.api.v1.endpoints.auth - ERROR - Error en rotación de token: Error interno del servidor en store_refresh_token
2025-10-27 08:21:30,369 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:21:30,369 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 36.6ms
2025-10-27 08:21:30,369 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 36.2ms
2025-10-27 08:21:30,374 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 08:21:30,376 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 08:21:30,380 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 6.3ms
2025-10-27 08:22:07,682 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:22:07,682 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:22:07,706 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:22:07,707 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 08:22:07,707 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:22:07,708 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 08:22:07,709 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 146
2025-10-27 08:22:07,709 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:22:07,710 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:22:07,710 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 08:22:07,711 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:22:07,711 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (0b02a35ebceffbe707d8ad05c6285f9ff83aad41ca24f9c32050934df64aea1e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 08:22:07,712 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (0b02a35ebceffbe707d8ad05c6285f9ff83aad41ca24f9c32050934df64aea1e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:22:07,713 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (0b02a35ebceffbe707d8ad05c6285f9ff83aad41ca24f9c32050934df64aea1e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:22:07,715 - app.api.v1.endpoints.auth - ERROR - Error en rotación de token: Error interno del servidor en store_refresh_token
2025-10-27 08:22:07,715 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:22:07,716 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 33.8ms
2025-10-27 08:22:07,716 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 33.6ms
2025-10-27 08:22:07,720 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 08:22:07,721 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 08:22:07,726 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 5.8ms
2025-10-27 08:27:06,294 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 08:27:06,294 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 08:27:06,295 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 08:27:06,295 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 08:27:06,606 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:27:06,607 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 08:27:06,616 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:27:06,617 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 08:27:06,617 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:27:06,618 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 08:27:06,619 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 148
2025-10-27 08:27:06,619 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:27:06,620 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 08:27:06,620 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 08:27:06,621 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 08:27:06,621 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (9f02b39b8b39cbd9bdec36789d2f68fe9fc0166e7bacc5215b129b9faffed44a). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 08:27:06,622 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (9f02b39b8b39cbd9bdec36789d2f68fe9fc0166e7bacc5215b129b9faffed44a). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:27:06,622 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (9f02b39b8b39cbd9bdec36789d2f68fe9fc0166e7bacc5215b129b9faffed44a). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 08:27:06,624 - app.api.v1.endpoints.auth - ERROR - Error en rotación de token: Error interno del servidor en store_refresh_token
2025-10-27 08:27:06,624 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 08:27:06,624 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.0ms
2025-10-27 08:27:06,624 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.5ms
2025-10-27 08:27:06,629 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 08:27:06,629 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 08:27:06,631 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 08:27:06,632 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 08:27:06,633 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 1.8ms
2025-10-27 09:02:15,824 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 09:02:15,825 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.7ms
2025-10-27 09:02:16,143 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 09:02:16,399 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:02:16,399 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 150
2025-10-27 09:02:16,399 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 09:02:16,403 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 260.3ms
2025-10-27 09:02:16,429 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 09:02:16,429 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 09:02:16,430 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.4ms
2025-10-27 09:02:16,430 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.9ms
2025-10-27 09:02:16,433 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 09:02:16,434 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 09:02:16,435 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:02:16,436 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:02:16,436 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 2.4ms
2025-10-27 09:02:16,441 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:02:16,441 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:02:16,451 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:02:16,451 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:02:16,453 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:02:16,453 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:02:16,481 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:02:16,482 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:02:16,482 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 47.7ms
2025-10-27 09:02:16,483 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 47.6ms
2025-10-27 09:02:16,483 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 47.4ms
2025-10-27 09:02:16,485 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 09:02:16,485 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 09:02:16,486 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.4ms
2025-10-27 09:02:16,487 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:02:16,487 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:02:16,487 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.9ms
2025-10-27 09:02:16,489 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:02:16,491 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:02:16,491 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:02:16,493 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:02:16,493 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:02:16,494 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:02:16,495 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:02:16,496 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.5ms
2025-10-27 09:02:16,496 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 9.5ms
2025-10-27 09:02:16,499 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:02:16,501 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:02:16,501 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:02:16,506 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:02:16,506 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:02:16,506 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:02:16,509 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:02:16,510 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:02:16,511 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:02:16,512 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 13.2ms
2025-10-27 09:02:16,512 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 6.0ms
2025-10-27 09:28:01,689 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 09:28:01,690 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.7ms
2025-10-27 09:28:01,995 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 09:28:02,256 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:28:02,257 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 151
2025-10-27 09:28:02,257 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 09:28:02,261 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 266.1ms
2025-10-27 09:28:02,284 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 09:28:02,285 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.0ms
2025-10-27 09:28:02,286 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 09:28:02,286 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.0ms
2025-10-27 09:28:02,288 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 09:28:02,289 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:28:02,289 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.5ms
2025-10-27 09:28:02,293 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:28:02,293 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:28:02,295 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:28:02,295 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:28:02,295 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:28:02,296 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 09:28:02,298 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:28:02,299 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:28:02,302 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:28:02,303 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:28:02,304 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 14.8ms
2025-10-27 09:28:02,304 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.7ms
2025-10-27 09:28:02,304 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 8.7ms
2025-10-27 09:28:02,306 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 09:28:02,307 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.7ms
2025-10-27 09:28:02,308 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:28:02,311 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:28:02,312 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:28:02,312 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:28:02,313 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:28:02,313 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 09:28:02,315 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:28:02,315 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:28:02,316 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:28:02,316 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:28:02,317 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.0ms
2025-10-27 09:28:02,317 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.3ms
2025-10-27 09:28:02,317 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 4.2ms
2025-10-27 09:28:02,320 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:28:02,322 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:28:02,322 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:28:02,327 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:28:02,327 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:28:02,328 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:28:02,330 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:28:02,331 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:28:02,331 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:28:02,331 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.4ms
2025-10-27 09:28:02,331 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.9ms
2025-10-27 09:33:54,724 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 09:33:54,942 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:33:54,942 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 152
2025-10-27 09:33:54,942 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 09:33:54,943 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 218.9ms
2025-10-27 09:33:54,958 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:33:54,971 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:33:54,973 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:33:54,979 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:33:54,979 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:33:54,980 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 21.7ms
2025-10-27 09:33:54,982 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:33:54,989 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:33:54,990 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:33:54,996 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:33:54,996 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:33:54,997 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 15.1ms
2025-10-27 09:33:54,997 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:33:55,002 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:33:55,003 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:33:55,003 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:33:55,004 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 6.3ms
2025-10-27 09:33:55,005 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:33:55,008 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:33:55,008 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:33:55,010 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:33:55,011 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:33:55,012 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.6ms
2025-10-27 09:33:55,012 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:33:55,016 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:33:55,016 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:33:55,020 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:33:55,021 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:33:55,021 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.1ms
2025-10-27 09:33:55,023 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:33:55,025 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:33:55,025 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:33:55,025 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:33:55,026 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.3ms
2025-10-27 09:40:51,090 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 09:40:51,091 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-27 09:40:51,402 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 09:40:51,626 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:40:51,626 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 153
2025-10-27 09:40:51,626 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 09:40:51,627 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 224.6ms
2025-10-27 09:40:51,650 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 09:40:51,659 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 09:40:51,663 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 12.2ms
2025-10-27 09:40:51,663 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 3.9ms
2025-10-27 09:40:51,666 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 09:40:51,667 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:40:51,668 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 09:40:51,670 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:40:51,670 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:40:51,674 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:40:51,674 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:40:51,675 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:40:51,676 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 9.6ms
2025-10-27 09:40:51,679 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:40:51,679 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:40:51,683 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:40:51,683 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:40:51,683 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 16.1ms
2025-10-27 09:40:51,684 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 15.9ms
2025-10-27 09:40:51,684 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.3ms
2025-10-27 09:40:51,687 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 09:40:51,688 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.2ms
2025-10-27 09:40:51,688 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:40:51,688 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 09:40:51,691 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:40:51,692 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:40:51,693 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:40:51,693 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:40:51,695 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:40:51,696 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:40:51,697 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:40:51,697 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:40:51,697 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.3ms
2025-10-27 09:40:51,698 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 9.2ms
2025-10-27 09:40:51,698 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.9ms
2025-10-27 09:40:51,701 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:40:51,703 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:40:51,703 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:40:51,708 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:40:51,708 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:40:51,709 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:40:51,711 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:40:51,713 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:40:51,713 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:40:51,713 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.5ms
2025-10-27 09:40:51,713 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.5ms
2025-10-27 09:45:43,391 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:45:43,391 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:45:43,391 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:45:43,392 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 1.3ms
2025-10-27 09:45:43,392 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 0.9ms
2025-10-27 09:45:43,392 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 0.8ms
2025-10-27 09:45:43,395 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:45:43,406 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:45:43,407 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:45:43,408 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:45:43,408 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:45:43,408 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:45:43,409 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:45:43,410 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:45:43,410 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:45:43,415 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:45:43,415 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:45:43,417 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:45:43,417 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:45:43,417 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:45:43,418 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 23.1ms
2025-10-27 09:45:43,418 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.5ms
2025-10-27 09:45:43,418 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.4ms
2025-10-27 09:45:43,420 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 09:45:43,420 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 09:45:43,422 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:45:43,425 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 09:45:43,426 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 09:45:43,426 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:45:43,427 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:45:43,427 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 154
2025-10-27 09:45:43,428 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 09:45:43,428 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.5ms
2025-10-27 09:45:43,434 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 09:45:43,434 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.5ms
2025-10-27 09:45:43,436 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 09:45:43,437 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 09:45:43,439 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.6ms
2025-10-27 09:46:07,656 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:46:07,658 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 09:46:07,659 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 09:46:07,659 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:46:07,661 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:46:07,661 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 155
2025-10-27 09:46:07,662 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 09:46:07,662 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.1ms
2025-10-27 09:46:40,345 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:46:40,369 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 09:46:40,369 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 09:46:40,370 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:46:40,370 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:46:40,370 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 156
2025-10-27 09:46:40,371 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 09:46:40,371 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 25.9ms
2025-10-27 09:46:56,837 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:46:56,839 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 09:46:56,841 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 09:46:56,841 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:46:56,842 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:46:56,842 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 157
2025-10-27 09:46:56,843 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 09:46:56,843 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.1ms
2025-10-27 09:48:20,462 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:48:20,472 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 09:48:20,473 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 09:48:20,473 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:48:20,474 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:48:20,475 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 158
2025-10-27 09:48:20,475 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 09:48:20,475 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.4ms
2025-10-27 09:51:20,370 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:51:20,381 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 09:51:20,383 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 09:51:20,383 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:51:20,384 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:51:20,385 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 159
2025-10-27 09:51:20,385 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 09:51:20,385 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 15.1ms
2025-10-27 09:51:20,391 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 09:51:20,392 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 09:51:20,398 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 7.2ms
2025-10-27 09:51:20,745 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 09:51:20,745 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 09:51:20,746 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.8ms
2025-10-27 09:51:20,746 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.5ms
2025-10-27 09:51:20,748 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:51:20,749 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:51:20,750 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:51:20,751 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:51:20,751 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:51:20,751 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.4ms
2025-10-27 09:51:20,752 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:51:20,755 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:51:20,755 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:51:20,756 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:51:20,756 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:51:20,756 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.0ms
2025-10-27 09:51:27,552 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 09:51:27,553 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.0ms
2025-10-27 09:51:27,553 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:51:27,556 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:51:27,556 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:51:27,557 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:51:27,557 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:51:27,558 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.5ms
2025-10-27 09:51:27,560 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 09:51:27,561 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.0ms
2025-10-27 09:51:27,561 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:51:27,565 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:51:27,565 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:51:27,569 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:51:27,569 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:51:27,570 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.8ms
2025-10-27 09:51:27,571 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 09:51:27,572 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.6ms
2025-10-27 09:51:27,573 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:51:27,576 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:51:27,576 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:51:27,578 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:51:27,578 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:51:27,579 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.1ms
2025-10-27 09:51:27,580 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 09:51:27,581 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.9ms
2025-10-27 09:51:27,582 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:51:27,584 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:51:27,585 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:51:27,585 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:51:27,585 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.8ms
2025-10-27 09:51:27,587 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:51:27,589 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:51:27,590 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:51:27,594 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:51:27,594 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:51:27,595 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.4ms
2025-10-27 09:51:27,596 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:51:27,598 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:51:27,599 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:51:27,600 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:51:27,600 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.5ms
2025-10-27 09:51:33,192 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:51:33,193 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:51:33,193 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:51:33,194 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:51:33,194 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 2.4ms
2025-10-27 09:51:33,195 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 2.4ms
2025-10-27 09:51:33,196 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 2.4ms
2025-10-27 09:51:33,200 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 09:51:33,202 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 09:51:33,202 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:51:33,204 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:51:33,204 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 160
2025-10-27 09:51:33,204 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 09:51:33,205 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:51:33,208 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:51:33,208 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:51:33,210 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:51:33,210 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:51:33,211 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 16.7ms
2025-10-27 09:51:33,211 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.7ms
2025-10-27 09:51:33,212 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:51:33,212 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:51:33,215 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:51:33,216 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:51:33,216 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:51:33,219 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:51:33,219 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:51:33,223 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:51:33,223 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:51:33,224 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 12.5ms
2025-10-27 09:51:33,224 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.5ms
2025-10-27 09:51:33,227 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 09:51:33,228 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 09:51:33,230 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.8ms
2025-10-27 09:51:39,477 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 09:51:39,477 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.4ms
2025-10-27 09:51:39,479 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 09:51:39,480 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 09:51:39,480 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:51:39,480 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 09:51:39,481 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.0ms
2025-10-27 09:51:43,111 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:51:43,111 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 09:51:43,112 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.2ms
2025-10-27 09:52:01,136 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:52:01,137 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 09:52:01,137 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.4ms
2025-10-27 09:52:14,067 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 09:52:14,068 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.5ms
2025-10-27 09:52:14,069 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 09:52:14,299 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:52:14,299 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 161
2025-10-27 09:52:14,299 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 09:52:14,300 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 230.4ms
2025-10-27 09:52:28,293 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:52:28,294 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 09:52:28,295 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 09:52:28,295 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:52:28,296 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:52:28,296 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 162
2025-10-27 09:52:28,296 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 09:52:28,296 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.8ms
2025-10-27 09:52:28,300 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 09:52:28,301 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 09:52:28,302 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.2ms
2025-10-27 09:52:28,318 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:52:28,321 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:52:28,321 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:52:28,322 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:52:28,322 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:52:28,322 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.9ms
2025-10-27 09:52:28,324 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:52:28,326 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:52:28,326 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:52:28,329 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:52:28,329 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:52:28,330 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 5.8ms
2025-10-27 09:52:28,332 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:52:28,334 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:52:28,335 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:52:28,335 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:52:28,336 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.0ms
2025-10-27 09:52:28,337 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 09:52:28,339 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 09:52:28,339 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 09:52:28,340 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 09:52:28,341 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 09:52:28,341 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.5ms
2025-10-27 09:52:28,342 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 09:52:28,344 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 09:52:28,344 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 09:52:28,348 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 09:52:28,348 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 09:52:28,348 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.0ms
2025-10-27 09:52:28,351 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 09:52:28,353 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 09:52:28,353 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 09:52:28,354 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 09:52:28,354 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.4ms
2025-10-27 09:52:32,633 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 09:52:32,634 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 09:52:32,635 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:52:32,635 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 09:52:32,635 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.2ms
2025-10-27 09:52:44,137 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:52:44,138 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 09:52:44,138 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.3ms
2025-10-27 09:52:54,833 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 09:52:55,054 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:52:55,055 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 163
2025-10-27 09:52:55,055 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 09:52:55,055 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 222.4ms
2025-10-27 09:55:12,257 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:55:12,282 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 09:55:12,282 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 09:55:12,283 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:55:12,284 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:55:12,284 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 164
2025-10-27 09:55:12,284 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 09:55:12,285 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 27.7ms
2025-10-27 09:55:36,487 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:55:36,489 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 09:55:36,491 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 09:55:36,492 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:55:36,493 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:55:36,494 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 165
2025-10-27 09:55:36,494 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 09:55:36,495 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.3ms
2025-10-27 09:55:47,698 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 09:55:47,698 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 09:55:48,009 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 09:55:48,011 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 09:55:48,012 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 09:55:48,012 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 09:55:48,013 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 09:55:48,013 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 166
2025-10-27 09:55:48,013 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 09:55:48,014 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 4.8ms
2025-10-27 10:01:51,297 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 10:01:51,297 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 10:01:51,601 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:01:51,617 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:01:51,619 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:01:51,619 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:01:51,620 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:01:51,620 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 167
2025-10-27 10:01:51,620 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:01:51,621 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 20.1ms
2025-10-27 10:03:48,968 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 10:03:48,969 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 10:03:49,280 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:03:49,294 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:03:49,295 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:03:49,295 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:03:49,296 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:03:49,296 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 168
2025-10-27 10:03:49,297 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:03:49,297 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.5ms
2025-10-27 10:05:34,891 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 10:05:34,891 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 10:05:35,201 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:05:35,211 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:05:35,215 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:05:35,215 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:05:35,216 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:05:35,216 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 169
2025-10-27 10:05:35,217 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:05:35,217 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 15.9ms
2025-10-27 10:05:47,488 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 10:05:47,488 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 10:05:47,491 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:05:47,494 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:05:47,497 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:05:47,498 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:05:47,500 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:05:47,500 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 170
2025-10-27 10:05:47,501 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:05:47,501 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 10.2ms
2025-10-27 10:05:57,178 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 10:05:57,179 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 10:05:57,490 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:05:57,492 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:05:57,493 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:05:57,494 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:05:57,494 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:05:57,495 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 171
2025-10-27 10:05:57,495 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:05:57,495 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.5ms
2025-10-27 10:06:59,597 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 10:06:59,598 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 10:06:59,914 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:06:59,916 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:06:59,916 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:06:59,916 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:06:59,917 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:06:59,917 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 172
2025-10-27 10:06:59,917 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:06:59,918 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.6ms
2025-10-27 10:10:51,386 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 10:10:51,388 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 10:10:51,388 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 2.0ms
2025-10-27 10:10:51,388 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 10:10:52,508 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:10:52,508 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:10:52,532 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:10:52,534 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:10:52,534 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:10:52,534 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:10:52,535 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:10:52,535 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 173
2025-10-27 10:10:52,535 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:10:52,536 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:10:52,537 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:10:52,537 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:10:52,537 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:10:52,538 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b286efa178d65e6f67918b310f1adef1b07ab5a405c87a0c75ad35eb791bf3b2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 10:10:52,538 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b286efa178d65e6f67918b310f1adef1b07ab5a405c87a0c75ad35eb791bf3b2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 10:10:52,539 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b286efa178d65e6f67918b310f1adef1b07ab5a405c87a0c75ad35eb791bf3b2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 10:10:52,550 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 10:10:52,550 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:10:52,551 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 42.7ms
2025-10-27 10:10:52,551 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 42.4ms
2025-10-27 10:10:52,556 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 10:10:52,556 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 10:10:52,558 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 10:10:52,559 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 10:10:52,564 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 5.9ms
2025-10-27 10:10:52,607 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 10:10:52,607 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.4ms
2025-10-27 10:10:52,609 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 10:10:52,609 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:10:52,609 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.7ms
2025-10-27 10:10:52,611 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:10:52,612 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:10:52,613 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:10:52,613 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:10:52,614 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.3ms
2025-10-27 10:10:52,615 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 10:10:52,616 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:10:52,618 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:10:52,618 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:10:52,621 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:10:52,622 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:10:52,622 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 7.0ms
2025-10-27 10:10:52,622 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.7ms
2025-10-27 10:10:52,624 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 10:10:52,624 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.5ms
2025-10-27 10:10:52,625 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:10:52,627 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:10:52,627 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:10:52,627 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:10:52,628 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.5ms
2025-10-27 10:10:52,629 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 10:10:52,630 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:10:52,632 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:10:52,632 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:10:52,634 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:10:52,634 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:10:52,634 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 4.8ms
2025-10-27 10:10:52,634 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.6ms
2025-10-27 10:10:52,636 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 10:10:52,637 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:10:52,637 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.8ms
2025-10-27 10:10:52,639 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:10:52,639 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:10:52,642 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:10:52,642 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:10:52,643 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.4ms
2025-10-27 10:10:52,644 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:10:52,646 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:10:52,647 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:10:52,647 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:10:52,648 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.3ms
2025-10-27 10:11:02,689 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 10:11:02,689 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.4ms
2025-10-27 10:11:02,690 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 10:11:02,692 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:11:02,692 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:11:02,692 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 10:11:02,693 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.3ms
2025-10-27 10:11:28,170 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:11:28,170 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:11:28,172 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:11:28,172 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:11:28,172 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.6ms
2025-10-27 10:11:28,172 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.4ms
2025-10-27 10:11:37,836 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:11:37,838 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:11:37,838 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.6ms
2025-10-27 10:11:37,840 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:11:37,841 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:11:37,841 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.6ms
2025-10-27 10:11:44,377 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 10:11:44,378 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.5ms
2025-10-27 10:11:44,379 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 10:11:44,634 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:11:44,635 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 175
2025-10-27 10:11:44,635 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 10:11:44,639 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 260.3ms
2025-10-27 10:11:44,660 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:11:44,664 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:11:44,664 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:11:44,666 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:11:44,667 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:11:44,668 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.9ms
2025-10-27 10:11:44,671 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:11:44,673 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:11:44,673 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:11:44,677 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:11:44,677 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:11:44,678 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.3ms
2025-10-27 10:11:44,681 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:11:44,683 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:11:44,684 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:11:44,684 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:11:44,684 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.7ms
2025-10-27 10:11:44,686 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:11:44,688 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:11:44,688 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:11:44,689 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:11:44,689 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:11:44,690 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.4ms
2025-10-27 10:11:44,691 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:11:44,693 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:11:44,693 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:11:44,697 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:11:44,697 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:11:44,698 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.6ms
2025-10-27 10:11:44,699 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:11:44,701 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:11:44,702 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:11:44,702 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:11:44,703 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.3ms
2025-10-27 10:12:02,884 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:12:02,885 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:12:02,887 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:12:02,888 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:12:02,889 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:12:02,889 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:12:02,890 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:12:02,891 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 176
2025-10-27 10:12:02,891 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:12:02,893 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:12:02,895 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:12:02,896 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:12:02,896 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:12:02,898 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (e778b8d1084f93348c9d1a584a249d424de61a8613f689a0594317b7da4ba4c7). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 10:12:02,898 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (e778b8d1084f93348c9d1a584a249d424de61a8613f689a0594317b7da4ba4c7). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 10:12:02,900 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (e778b8d1084f93348c9d1a584a249d424de61a8613f689a0594317b7da4ba4c7). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 10:12:02,902 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 10:12:02,903 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:12:02,903 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 19.0ms
2025-10-27 10:12:02,903 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.3ms
2025-10-27 10:12:02,908 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 10:12:02,910 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 10:12:02,911 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.0ms
2025-10-27 10:12:02,930 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:12:02,932 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:12:02,933 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:12:02,934 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:12:02,934 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:12:02,935 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.4ms
2025-10-27 10:12:02,935 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:12:02,937 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:12:02,937 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:12:02,941 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:12:02,941 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:12:02,941 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:12:02,944 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:12:02,944 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:12:02,945 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:12:02,945 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.4ms
2025-10-27 10:12:02,946 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.6ms
2025-10-27 10:12:02,947 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:12:02,950 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:12:02,950 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:12:02,951 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:12:02,951 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:12:02,953 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.4ms
2025-10-27 10:12:02,953 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:12:02,953 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:12:02,956 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:12:02,957 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:12:02,960 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:12:02,960 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:12:02,965 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:12:02,966 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:12:02,966 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:12:02,967 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 13.5ms
2025-10-27 10:12:02,967 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 13.5ms
2025-10-27 10:12:29,291 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 10:12:29,295 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:12:29,295 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:12:29,295 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 10:12:29,296 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 4.6ms
2025-10-27 10:12:47,349 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:12:47,351 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:12:47,351 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.6ms
2025-10-27 10:12:47,353 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:12:47,354 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:12:47,354 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.6ms
2025-10-27 10:13:05,852 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:13:05,852 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:13:05,854 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:13:05,854 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:13:05,855 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.7ms
2025-10-27 10:13:05,855 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.5ms
2025-10-27 10:13:25,690 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 10:13:25,943 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:13:25,943 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 178
2025-10-27 10:13:25,944 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 10:13:25,949 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 258.8ms
2025-10-27 10:13:25,966 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:13:25,970 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:13:25,970 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:13:25,971 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:13:25,972 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:13:25,972 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.6ms
2025-10-27 10:13:25,975 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:13:25,978 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:13:25,979 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:13:25,984 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:13:25,985 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:13:25,985 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.8ms
2025-10-27 10:13:25,988 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:13:25,990 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:13:25,991 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:13:25,992 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:13:25,992 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.6ms
2025-10-27 10:13:25,994 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:13:25,997 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:13:25,997 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:13:25,998 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:13:25,998 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:13:25,999 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.5ms
2025-10-27 10:13:26,001 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:13:26,003 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:13:26,003 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:13:26,007 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:13:26,007 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:13:26,008 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.1ms
2025-10-27 10:13:26,010 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:13:26,012 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:13:26,013 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:13:26,013 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:13:26,014 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.9ms
2025-10-27 10:13:50,949 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:13:50,950 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:13:50,953 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:13:50,954 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:13:50,955 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:13:50,955 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:13:50,956 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:13:50,957 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 179
2025-10-27 10:13:50,957 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:13:50,958 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 9.2ms
2025-10-27 10:13:50,960 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:13:50,961 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:13:50,962 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:13:50,962 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:13:50,964 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (7f6bb495c631386e355eb6043cc9b7fd5b8267290c3c1df860a0b2c506e72310). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 10:13:50,964 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (7f6bb495c631386e355eb6043cc9b7fd5b8267290c3c1df860a0b2c506e72310). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 10:13:50,966 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (7f6bb495c631386e355eb6043cc9b7fd5b8267290c3c1df860a0b2c506e72310). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 10:13:50,968 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 10:13:50,968 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:13:50,969 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 19.1ms
2025-10-27 10:13:50,973 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 10:13:50,974 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 10:13:50,975 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.5ms
2025-10-27 10:13:50,991 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:13:50,993 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:13:50,993 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:13:50,994 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:13:50,994 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:13:50,994 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:13:50,995 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:13:50,996 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:13:50,996 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:13:51,000 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:13:51,000 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:13:51,003 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:13:51,004 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:13:51,004 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:13:51,004 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 12.9ms
2025-10-27 10:13:51,004 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.0ms
2025-10-27 10:13:51,005 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.0ms
2025-10-27 10:13:51,006 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:13:51,008 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:13:51,009 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:13:51,010 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:13:51,010 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:13:51,010 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.0ms
2025-10-27 10:13:51,011 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:13:51,012 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:13:51,012 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:13:51,016 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:13:51,017 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:13:51,017 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:13:51,020 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:13:51,021 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:13:51,021 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:13:51,021 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.7ms
2025-10-27 10:13:51,022 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.4ms
2025-10-27 10:20:28,065 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:20:28,065 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:20:28,089 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:20:28,091 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:20:28,091 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:20:28,091 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:20:28,092 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:20:28,093 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 181
2025-10-27 10:20:28,093 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:20:28,094 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:20:28,095 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:20:28,095 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:20:28,095 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:20:28,096 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (a7a9cfac94e60176cd1455a7da6cbbbff64589bb4fa322b663fc293ccee7e52f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 10:20:28,097 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (a7a9cfac94e60176cd1455a7da6cbbbff64589bb4fa322b663fc293ccee7e52f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 10:20:28,098 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (a7a9cfac94e60176cd1455a7da6cbbbff64589bb4fa322b663fc293ccee7e52f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 118, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 132, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 10:20:28,100 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 10:20:28,100 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:20:28,100 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 35.3ms
2025-10-27 10:20:28,100 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 35.1ms
2025-10-27 10:20:28,105 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 10:20:28,106 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 10:20:28,111 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 6.5ms
2025-10-27 10:20:28,135 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:20:28,137 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:20:28,137 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:20:28,138 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:20:28,139 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:20:28,139 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:20:28,140 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:20:28,141 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:20:28,145 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:20:28,145 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:20:28,146 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 10.8ms
2025-10-27 10:20:28,146 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.9ms
2025-10-27 10:20:28,148 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:20:28,150 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:20:28,151 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:20:28,151 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:20:28,151 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.8ms
2025-10-27 10:20:28,152 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:20:28,153 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:20:28,154 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:20:28,155 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:20:28,155 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:20:28,155 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.7ms
2025-10-27 10:20:28,157 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:20:28,160 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:20:28,160 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:20:28,163 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:20:28,163 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:20:28,164 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:20:28,164 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.3ms
2025-10-27 10:20:28,166 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:20:28,167 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:20:28,167 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:20:28,167 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.5ms
2025-10-27 10:25:59,399 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 10:25:59,399 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 10:25:59,400 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 10:25:59,400 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 10:25:59,400 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 10:25:59,400 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 10:25:59,401 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.9ms
2025-10-27 10:25:59,401 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.4ms
2025-10-27 10:25:59,401 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 1.4ms
2025-10-27 10:25:59,401 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.3ms
2025-10-27 10:25:59,402 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.3ms
2025-10-27 10:25:59,402 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.2ms
2025-10-27 10:25:59,404 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 10:25:59,404 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.4ms
2025-10-27 10:25:59,710 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:25:59,711 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:25:59,711 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:25:59,711 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:25:59,712 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 2.0ms
2025-10-27 10:25:59,713 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 1.4ms
2025-10-27 10:25:59,713 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 1.4ms
2025-10-27 10:25:59,725 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:25:59,727 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:25:59,727 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:25:59,727 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:25:59,731 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:25:59,731 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 183
2025-10-27 10:25:59,731 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:25:59,732 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 21.2ms
2025-10-27 10:25:59,733 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:25:59,735 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:25:59,735 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:25:59,736 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:25:59,736 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:25:59,737 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:25:59,737 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:25:59,737 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.8ms
2025-10-27 10:25:59,740 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:25:59,740 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:25:59,744 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:25:59,744 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:25:59,746 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:25:59,747 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:25:59,747 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:25:59,748 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.7ms
2025-10-27 10:25:59,748 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.7ms
2025-10-27 10:25:59,748 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 10:25:59,749 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 1.2ms
2025-10-27 10:25:59,751 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 10:25:59,752 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 10:25:59,753 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.2ms
2025-10-27 10:33:01,482 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:33:01,482 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:33:01,507 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:33:01,508 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 10:33:01,508 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:33:01,508 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:33:01,509 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:33:01,509 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 184
2025-10-27 10:33:01,510 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 184
2025-10-27 10:33:01,510 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:33:01,511 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:33:01,511 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 10:33:01,511 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:33:01,511 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:33:01,512 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (bc2695a7be5cb435e33e932633b622eec8cc5640acc49fe5b386f5dd6fca22f2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 10:33:01,513 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (bc2695a7be5cb435e33e932633b622eec8cc5640acc49fe5b386f5dd6fca22f2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 119, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 10:33:01,514 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (bc2695a7be5cb435e33e932633b622eec8cc5640acc49fe5b386f5dd6fca22f2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 119, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 145, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 10:33:01,515 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 10:33:01,516 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:33:01,516 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 34.2ms
2025-10-27 10:33:01,516 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 33.9ms
2025-10-27 10:33:01,520 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 10:33:01,522 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 10:33:01,527 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 6.7ms
2025-10-27 10:33:01,549 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:33:01,552 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:33:01,552 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:33:01,553 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:33:01,553 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:33:01,553 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:33:01,555 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:33:01,555 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:33:01,559 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:33:01,559 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:33:01,560 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 10.3ms
2025-10-27 10:33:01,560 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.6ms
2025-10-27 10:33:01,562 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:33:01,564 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:33:01,565 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:33:01,565 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:33:01,566 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:33:01,566 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.9ms
2025-10-27 10:33:01,567 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:33:01,567 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:33:01,568 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:33:01,569 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:33:01,569 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.8ms
2025-10-27 10:33:01,571 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:33:01,573 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:33:01,574 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:33:01,577 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:33:01,577 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:33:01,578 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:33:01,578 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.5ms
2025-10-27 10:33:01,580 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:33:01,581 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:33:01,581 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:33:01,582 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.6ms
2025-10-27 10:33:23,360 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 10:33:23,360 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.6ms
2025-10-27 10:33:23,361 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 10:33:23,363 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:33:23,363 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:33:23,363 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 10:33:23,363 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.0ms
2025-10-27 10:33:51,139 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:33:51,140 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:33:51,142 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:33:51,142 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:33:51,142 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.7ms
2025-10-27 10:33:51,142 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.2ms
2025-10-27 10:34:05,958 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 10:34:05,958 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.4ms
2025-10-27 10:34:05,960 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 10:34:06,212 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:34:06,212 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 186
2025-10-27 10:34:06,212 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 186
2025-10-27 10:34:06,213 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 10:34:06,217 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 257.0ms
2025-10-27 10:34:06,232 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:34:06,237 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:34:06,237 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:34:06,239 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:34:06,239 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:34:06,240 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.4ms
2025-10-27 10:34:06,242 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:34:06,244 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:34:06,244 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:34:06,248 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:34:06,248 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:34:06,249 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.3ms
2025-10-27 10:34:06,251 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:34:06,254 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:34:06,255 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:34:06,255 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:34:06,255 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.1ms
2025-10-27 10:34:06,258 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:34:06,260 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:34:06,260 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:34:06,262 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:34:06,262 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:34:06,263 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.8ms
2025-10-27 10:34:06,265 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:34:06,267 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:34:06,267 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:34:06,271 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:34:06,271 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:34:06,272 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.1ms
2025-10-27 10:34:06,274 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:34:06,276 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:34:06,277 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:34:06,277 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:34:06,277 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.4ms
2025-10-27 10:34:26,450 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:34:26,451 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:34:26,453 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:34:26,454 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:34:26,454 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:34:26,454 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:34:26,456 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:34:26,456 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 187
2025-10-27 10:34:26,456 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 187
2025-10-27 10:34:26,457 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:34:26,457 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.8ms
2025-10-27 10:34:26,460 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:34:26,461 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:34:26,461 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:34:26,462 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:34:26,463 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (00e1b9338c8b3c330705edfe8e3817e45b5fcb1941907e0d319b0580bfe062bb). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 10:34:26,463 - app.services.refresh_token_service - ERROR - Error inesperado almacenando refresh token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (00e1b9338c8b3c330705edfe8e3817e45b5fcb1941907e0d319b0580bfe062bb). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 119, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 10:34:26,465 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 59, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (00e1b9338c8b3c330705edfe8e3817e45b5fcb1941907e0d319b0580bfe062bb). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 119, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 80, in execute_insert
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail=f"Error en la inserción: {str(e)}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 145, in store_refresh_token
    raise DatabaseError(
          ~~~~~~~~~~~~~^
        status_code=500,
        ^^^^^^^^^^^^^^^^
        detail="Error al almacenar el refresh token"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: DatabaseError.__init__() got an unexpected keyword argument 'status_code'
2025-10-27 10:34:26,466 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 10:34:26,466 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:34:26,467 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 16.5ms
2025-10-27 10:34:26,471 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 10:34:26,472 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 10:34:26,472 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 1.9ms
2025-10-27 10:34:26,489 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:34:26,491 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:34:26,492 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:34:26,493 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:34:26,493 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:34:26,493 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:34:26,493 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:34:26,495 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:34:26,496 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:34:26,496 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:34:26,497 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:34:26,498 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:34:26,500 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:34:26,500 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:34:26,501 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 11.5ms
2025-10-27 10:34:26,501 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 8.0ms
2025-10-27 10:34:26,501 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.9ms
2025-10-27 10:34:26,503 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:34:26,506 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:34:26,506 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:34:26,508 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:34:26,508 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:34:26,508 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:34:26,510 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:34:26,511 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:34:26,511 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:34:26,512 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:34:26,512 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 8.5ms
2025-10-27 10:34:26,514 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:34:26,514 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:34:26,517 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:34:26,517 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:34:26,518 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.6ms
2025-10-27 10:34:26,518 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.7ms
2025-10-27 10:47:49,108 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 10:47:49,108 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 10:47:49,109 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.8ms
2025-10-27 10:47:49,109 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 10:47:49,416 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:47:49,417 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:47:49,442 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:47:49,443 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 10:47:49,443 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:47:49,443 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:47:49,445 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:47:49,445 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 189
2025-10-27 10:47:49,445 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 189
2025-10-27 10:47:49,445 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:47:49,447 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:47:49,447 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 10:47:49,447 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:47:49,448 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:47:49,448 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (9bce2129e232378ec0c28a5af2bc6ea66b486edcd1889f4eaf43819b0c19b2aa). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 10:47:49,449 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 10:47:49,449 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 10:47:49,449 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:47:49,450 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 33.2ms
2025-10-27 10:47:49,450 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 32.7ms
2025-10-27 10:47:49,455 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 10:47:49,455 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 10:47:49,457 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 10:47:49,458 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 10:47:49,462 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 5.7ms
2025-10-27 10:48:21,523 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:48:21,525 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:48:21,525 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 10:48:21,526 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:48:21,526 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:48:21,527 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:48:21,527 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 191
2025-10-27 10:48:21,528 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 191
2025-10-27 10:48:21,528 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:48:21,528 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.8ms
2025-10-27 10:48:21,530 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:48:21,533 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:48:21,534 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 10:48:21,534 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:48:21,535 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:48:21,536 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b06a9dd5cad5b2474d7017ac7cf60c33b3b48d553a6f766706aafae13f8ff5e0). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 10:48:21,537 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 10:48:21,537 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 10:48:21,537 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:48:21,538 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.2ms
2025-10-27 10:48:21,541 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 10:48:21,543 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 10:48:21,544 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.4ms
2025-10-27 10:48:34,011 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 10:48:34,011 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.4ms
2025-10-27 10:48:34,013 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 10:48:34,243 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:48:34,243 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 193
2025-10-27 10:48:34,243 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 193
2025-10-27 10:48:34,243 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 10:48:34,244 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 230.7ms
2025-10-27 10:48:34,266 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 10:48:34,267 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.6ms
2025-10-27 10:48:34,269 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 10:48:34,270 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:48:34,272 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:48:34,273 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:48:34,274 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:48:34,274 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:48:34,275 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 6.0ms
2025-10-27 10:48:34,276 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.0ms
2025-10-27 10:48:34,278 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 10:48:34,278 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.6ms
2025-10-27 10:48:34,278 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:48:34,281 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:48:34,281 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:48:34,285 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:48:34,285 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:48:34,286 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.0ms
2025-10-27 10:48:34,288 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 10:48:34,288 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.4ms
2025-10-27 10:48:34,289 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:48:34,291 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:48:34,292 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:48:34,292 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:48:34,293 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.4ms
2025-10-27 10:48:34,294 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 10:48:34,294 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.8ms
2025-10-27 10:48:34,295 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:48:34,297 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:48:34,297 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:48:34,299 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:48:34,299 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:48:34,300 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.1ms
2025-10-27 10:48:34,300 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 10:48:34,301 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.9ms
2025-10-27 10:48:34,302 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:48:34,304 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:48:34,304 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:48:34,309 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:48:34,309 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:48:34,310 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.7ms
2025-10-27 10:48:34,311 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:48:34,313 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:48:34,314 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:48:34,314 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:48:34,314 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.0ms
2025-10-27 10:48:42,452 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:48:42,452 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:48:42,455 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:48:42,456 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:48:42,457 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:48:42,457 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:48:42,458 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:48:42,459 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 194
2025-10-27 10:48:42,459 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 194
2025-10-27 10:48:42,459 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:48:42,461 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:48:42,462 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:48:42,463 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:48:42,463 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:48:42,464 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (afe7ad4413a105a38d3fc7836b4513cbc77d9803b558883478ea59ce80b1af3d). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 10:48:42,465 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 10:48:42,465 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 10:48:42,465 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:48:42,466 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.9ms
2025-10-27 10:48:42,466 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.5ms
2025-10-27 10:48:42,470 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 10:48:42,472 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 10:48:42,472 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.0ms
2025-10-27 10:48:42,486 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:48:42,489 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:48:42,489 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:48:42,491 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:48:42,491 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:48:42,491 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:48:42,491 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:48:42,493 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:48:42,493 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:48:42,496 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:48:42,496 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:48:42,497 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:48:42,498 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:48:42,498 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:48:42,498 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 12.2ms
2025-10-27 10:48:42,499 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.5ms
2025-10-27 10:48:42,499 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 7.5ms
2025-10-27 10:48:42,501 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:48:42,503 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:48:42,503 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:48:42,504 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:48:42,504 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:48:42,505 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.7ms
2025-10-27 10:48:42,505 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:48:42,505 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:48:42,507 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:48:42,507 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:48:42,508 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:48:42,509 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:48:42,509 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:48:42,512 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:48:42,512 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:48:42,513 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 7.5ms
2025-10-27 10:48:42,513 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.5ms
2025-10-27 10:49:09,406 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 10:49:09,406 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.5ms
2025-10-27 10:49:09,408 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 10:49:09,410 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:49:09,410 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:49:09,410 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 10:49:09,410 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.3ms
2025-10-27 10:49:36,582 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:49:36,583 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:49:36,584 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:49:36,585 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:49:36,585 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.3ms
2025-10-27 10:49:36,586 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.0ms
2025-10-27 10:49:45,881 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:49:45,882 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:49:45,883 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.0ms
2025-10-27 10:49:45,885 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:49:45,886 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 10:49:45,886 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.6ms
2025-10-27 10:49:56,843 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 10:49:57,101 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:49:57,101 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 196
2025-10-27 10:49:57,101 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 196
2025-10-27 10:49:57,101 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 10:49:57,105 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 263.0ms
2025-10-27 10:49:57,119 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:49:57,123 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:49:57,123 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:49:57,128 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:49:57,128 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:49:57,129 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 10.3ms
2025-10-27 10:49:57,132 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:49:57,134 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:49:57,134 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:49:57,139 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:49:57,140 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:49:57,140 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.5ms
2025-10-27 10:49:57,143 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:49:57,145 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:49:57,146 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:49:57,146 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:49:57,147 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.0ms
2025-10-27 10:49:57,148 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:49:57,150 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:49:57,150 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:49:57,151 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:49:57,151 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:49:57,152 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.5ms
2025-10-27 10:49:57,154 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:49:57,156 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:49:57,156 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:49:57,160 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:49:57,160 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:49:57,161 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.9ms
2025-10-27 10:49:57,162 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:49:57,164 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:49:57,165 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:49:57,165 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:49:57,165 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.0ms
2025-10-27 10:50:18,103 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:50:18,104 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:50:18,106 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:50:18,107 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:50:18,107 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:50:18,107 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:50:18,109 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:50:18,110 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 197
2025-10-27 10:50:18,110 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 197
2025-10-27 10:50:18,110 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:50:18,112 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:50:18,113 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:50:18,114 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:50:18,114 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:50:18,115 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (735618b062b275bed7030b40600bd43feb2d8418b166f3c3463084601d6149b4). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 10:50:18,116 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 10:50:18,116 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 10:50:18,116 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:50:18,117 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.9ms
2025-10-27 10:50:18,117 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.4ms
2025-10-27 10:50:18,122 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 10:50:18,123 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 10:50:18,125 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.4ms
2025-10-27 10:50:18,139 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:50:18,142 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:50:18,142 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:50:18,143 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:50:18,143 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:50:18,144 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:50:18,144 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:50:18,146 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:50:18,146 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:50:18,148 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:50:18,149 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:50:18,150 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:50:18,151 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:50:18,151 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:50:18,151 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 12.5ms
2025-10-27 10:50:18,151 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.7ms
2025-10-27 10:50:18,151 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 7.6ms
2025-10-27 10:50:18,153 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:50:18,156 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:50:18,156 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:50:18,157 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:50:18,158 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:50:18,158 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:50:18,160 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:50:18,160 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:50:18,163 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:50:18,163 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:50:18,163 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:50:18,164 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 10.2ms
2025-10-27 10:50:18,165 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:50:18,166 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:50:18,166 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:50:18,167 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.8ms
2025-10-27 10:50:18,167 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.1ms
2025-10-27 10:53:15,399 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:53:15,400 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 10:53:15,400 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:53:15,400 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:53:15,401 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 2.7ms
2025-10-27 10:53:15,402 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 1.7ms
2025-10-27 10:53:15,402 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 1.6ms
2025-10-27 10:53:15,412 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 10:53:15,413 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 10:53:15,414 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 10:53:15,414 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 10:53:15,415 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 10:53:15,415 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 199
2025-10-27 10:53:15,416 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 199
2025-10-27 10:53:15,416 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 10:53:15,417 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.2ms
2025-10-27 10:53:15,418 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 10:53:15,420 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 10:53:15,421 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 10:53:15,422 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 10:53:15,422 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 10:53:15,422 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 10:53:15,424 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 10:53:15,425 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 10:53:15,425 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 10:53:15,426 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 10:53:15,426 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 8.4ms
2025-10-27 10:53:15,428 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 10:53:15,428 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 10:53:15,431 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 10:53:15,431 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 10:53:15,432 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.6ms
2025-10-27 10:53:15,433 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.0ms
2025-10-27 10:53:15,433 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 10:53:15,435 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 10:53:15,437 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.3ms
2025-10-27 11:00:08,382 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:00:08,382 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 11:00:08,695 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:00:08,705 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:00:08,706 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:00:08,707 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:00:08,707 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:00:08,708 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:00:08,708 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 200
2025-10-27 11:00:08,708 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 200
2025-10-27 11:00:08,708 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:00:08,708 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.1ms
2025-10-27 11:00:25,435 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:00:25,437 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:00:25,438 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:00:25,438 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:00:25,438 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:00:25,439 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:00:25,440 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 201
2025-10-27 11:00:25,440 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 201
2025-10-27 11:00:25,440 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:00:25,440 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.8ms
2025-10-27 11:01:14,812 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:01:14,834 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:01:14,835 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 11:01:14,835 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:01:14,835 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:01:14,836 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:01:14,836 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 202
2025-10-27 11:01:14,836 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 202
2025-10-27 11:01:14,836 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:01:14,837 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 24.8ms
2025-10-27 11:01:49,328 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:01:49,331 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:01:49,332 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:01:49,332 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:01:49,332 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:01:49,334 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:01:49,334 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 203
2025-10-27 11:01:49,334 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 203
2025-10-27 11:01:49,334 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:01:49,335 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.4ms
2025-10-27 11:01:49,336 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:01:49,338 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:01:49,338 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:01:49,339 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:01:49,339 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:01:49,340 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (464a0173524cd8f7c6b739e5f1b8fdc33542d3e558e1b5dde690f81c3845a461). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 11:01:49,340 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 11:01:49,340 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 11:01:49,340 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:01:49,340 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 4.1ms
2025-10-27 11:01:49,652 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 11:01:49,652 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 11:01:49,654 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:01:49,655 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:01:49,659 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 5.3ms
2025-10-27 11:01:49,685 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:01:49,686 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.5ms
2025-10-27 11:01:49,687 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:01:49,688 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:01:49,689 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:01:49,689 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:01:49,690 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:01:49,690 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:01:49,691 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 3.4ms
2025-10-27 11:01:49,691 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.3ms
2025-10-27 11:01:49,692 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:01:49,693 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:01:49,696 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:01:49,696 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:01:49,700 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:01:49,700 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:01:49,701 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 8.3ms
2025-10-27 11:01:49,701 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.2ms
2025-10-27 11:01:49,702 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:01:49,703 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.5ms
2025-10-27 11:01:49,703 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:01:49,705 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:01:49,706 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:01:49,706 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:01:49,707 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.4ms
2025-10-27 11:01:49,708 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:01:49,708 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:01:49,710 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:01:49,710 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:01:49,712 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:01:49,712 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:01:49,713 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 5.0ms
2025-10-27 11:01:49,713 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.9ms
2025-10-27 11:01:49,715 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:01:49,716 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:01:49,716 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.9ms
2025-10-27 11:01:49,718 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:01:49,718 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:01:49,722 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:01:49,723 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:01:49,723 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.7ms
2025-10-27 11:01:49,725 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:01:49,727 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:01:49,729 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:01:49,729 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:01:49,730 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.9ms
2025-10-27 11:01:52,667 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 11:01:52,668 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.4ms
2025-10-27 11:01:52,669 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 11:01:52,670 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:01:52,670 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:01:52,670 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 11:01:52,671 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 1.7ms
2025-10-27 11:02:05,482 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:02:05,483 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 11:02:05,483 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.1ms
2025-10-27 11:02:18,312 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:02:18,313 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 11:02:18,314 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.4ms
2025-10-27 11:02:30,275 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 11:02:30,276 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-27 11:02:30,582 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 11:02:30,815 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:02:30,815 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 205
2025-10-27 11:02:30,816 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 205
2025-10-27 11:02:30,816 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 11:02:30,817 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 234.3ms
2025-10-27 11:08:09,452 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:08:09,462 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:08:09,463 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:08:09,463 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:08:09,463 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:08:09,464 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:08:09,464 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 206
2025-10-27 11:08:09,465 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 206
2025-10-27 11:08:09,465 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:08:09,465 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.1ms
2025-10-27 11:08:20,455 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:08:20,457 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:08:20,459 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:08:20,459 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:08:20,459 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:08:20,461 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:08:20,462 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 207
2025-10-27 11:08:20,462 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 207
2025-10-27 11:08:20,462 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:08:20,463 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.7ms
2025-10-27 11:10:08,765 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:10:08,765 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:10:08,766 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.9ms
2025-10-27 11:10:08,766 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 11:10:09,076 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:10:09,077 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:10:09,086 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:10:09,087 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:10:09,087 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:10:09,087 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:10:09,088 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:10:09,089 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 208
2025-10-27 11:10:09,089 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 208
2025-10-27 11:10:09,089 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:10:09,090 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:10:09,091 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:10:09,091 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:10:09,091 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:10:09,092 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (f93bee1010b7b1f70e0a9f858efe8111aeefb973b8656e69e4b2b319c84089c2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 11:10:09,092 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 11:10:09,093 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 11:10:09,093 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:10:09,093 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.3ms
2025-10-27 11:10:09,093 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 16.6ms
2025-10-27 11:10:09,098 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:10:09,099 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:10:09,100 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.1ms
2025-10-27 11:10:09,128 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:10:09,131 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:10:09,131 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:10:09,133 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:10:09,133 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:10:09,134 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:10:09,138 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:10:09,139 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:10:09,143 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:10:09,143 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:10:09,144 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 15.7ms
2025-10-27 11:10:09,144 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.5ms
2025-10-27 11:10:09,146 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:10:09,148 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:10:09,149 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:10:09,150 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:10:09,151 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.5ms
2025-10-27 11:10:09,151 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:10:09,154 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:10:09,154 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:10:09,157 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:10:09,157 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:10:09,158 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.9ms
2025-10-27 11:10:09,159 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:10:09,162 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:10:09,162 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:10:09,166 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:10:09,166 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:10:09,167 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.1ms
2025-10-27 11:10:09,168 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:10:09,171 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:10:09,172 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:10:09,172 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:10:09,173 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.9ms
2025-10-27 11:11:14,410 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:11:14,411 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:11:14,411 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:11:14,411 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:11:14,412 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 1.7ms
2025-10-27 11:11:14,412 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 1.1ms
2025-10-27 11:11:14,412 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 1.1ms
2025-10-27 11:11:14,417 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:11:14,418 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:11:14,418 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:11:14,419 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:11:14,420 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:11:14,420 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 210
2025-10-27 11:11:14,420 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 210
2025-10-27 11:11:14,421 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:11:14,421 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 10.4ms
2025-10-27 11:11:14,422 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:11:14,424 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:11:14,424 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:11:14,426 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:11:14,426 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:11:14,427 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:11:14,427 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:11:14,427 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.7ms
2025-10-27 11:11:14,429 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:11:14,431 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:11:14,431 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:11:14,433 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:11:14,433 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:11:14,436 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:11:14,437 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:11:14,437 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.7ms
2025-10-27 11:11:14,438 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.6ms
2025-10-27 11:11:14,439 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:11:14,440 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:11:14,441 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.5ms
2025-10-27 11:11:18,744 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:11:18,745 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:11:18,748 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:11:18,750 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:11:18,751 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:11:18,751 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:11:18,753 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:11:18,753 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 211
2025-10-27 11:11:18,754 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 211
2025-10-27 11:11:18,754 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:11:18,755 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:11:18,757 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:11:18,757 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:11:18,757 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:11:18,758 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (c02ddc114b62e643b8c71d830ac7810da526b696ece0e5cb92309ba8abcaeaa7). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 11:11:18,759 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 11:11:18,759 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 11:11:18,759 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:11:18,759 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 15.6ms
2025-10-27 11:11:18,760 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 14.7ms
2025-10-27 11:11:18,764 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:11:18,765 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:11:18,767 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.8ms
2025-10-27 11:11:18,782 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:11:18,785 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:11:18,786 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:11:18,787 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:11:18,787 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:11:18,788 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:11:18,788 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:11:18,790 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:11:18,790 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:11:18,794 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:11:18,794 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:11:18,796 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:11:18,796 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:11:18,796 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:11:18,797 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 14.6ms
2025-10-27 11:11:18,797 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.3ms
2025-10-27 11:11:18,797 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.2ms
2025-10-27 11:11:18,799 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:11:18,802 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:11:18,802 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:11:18,804 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:11:18,804 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:11:18,805 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:11:18,805 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.8ms
2025-10-27 11:11:18,807 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:11:18,807 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:11:18,810 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:11:18,810 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:11:18,811 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:11:18,812 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:11:18,813 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:11:18,813 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:11:18,814 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.9ms
2025-10-27 11:11:18,814 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.3ms
2025-10-27 11:11:36,127 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 11:11:36,128 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:11:36,129 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:11:36,129 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 11:11:36,129 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.1ms
2025-10-27 11:11:56,948 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:11:56,949 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:11:56,951 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 11:11:56,951 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 11:11:56,952 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.3ms
2025-10-27 11:11:56,952 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.1ms
2025-10-27 11:12:07,323 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 11:12:07,573 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:12:07,573 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 213
2025-10-27 11:12:07,574 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 213
2025-10-27 11:12:07,574 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 11:12:07,579 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 256.6ms
2025-10-27 11:12:07,901 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:12:07,902 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:12:07,902 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:12:07,903 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:12:07,903 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:12:07,903 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:12:07,903 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 2.5ms
2025-10-27 11:12:07,904 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.8ms
2025-10-27 11:12:07,904 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.7ms
2025-10-27 11:12:07,904 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.6ms
2025-10-27 11:12:07,904 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.6ms
2025-10-27 11:12:07,905 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.7ms
2025-10-27 11:12:07,908 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:12:07,911 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:12:07,911 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:12:07,912 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:12:07,913 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:12:07,913 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.1ms
2025-10-27 11:12:07,916 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:12:07,918 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:12:07,918 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:12:07,922 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:12:07,922 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:12:07,922 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.5ms
2025-10-27 11:12:07,924 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:12:07,926 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:12:07,927 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:12:07,927 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:12:07,928 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.5ms
2025-10-27 11:12:07,930 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:12:07,932 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:12:07,933 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:12:07,934 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:12:07,934 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:12:07,935 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.0ms
2025-10-27 11:12:07,937 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:12:07,939 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:12:07,940 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:12:07,943 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:12:07,943 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:12:07,944 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.2ms
2025-10-27 11:12:07,946 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:12:07,948 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:12:07,949 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:12:07,949 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:12:07,950 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.2ms
2025-10-27 11:12:27,598 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:12:27,599 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:12:27,601 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:12:27,602 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:12:27,602 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:12:27,602 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:12:27,603 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:12:27,604 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 214
2025-10-27 11:12:27,604 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 214
2025-10-27 11:12:27,604 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:12:27,606 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:12:27,608 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:12:27,609 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:12:27,609 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:12:27,610 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (dc89cd6c77512c29176b94a9fd1c9222f22fd3a37a5b65b276101b295d364feb). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 11:12:27,611 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 11:12:27,611 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 11:12:27,611 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:12:27,612 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.5ms
2025-10-27 11:12:27,612 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.0ms
2025-10-27 11:12:27,933 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 11:12:27,933 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 11:12:27,935 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:12:27,937 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:12:27,938 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.7ms
2025-10-27 11:12:27,954 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:12:27,957 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:12:27,957 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:12:27,958 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:12:27,958 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:12:27,959 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:12:27,959 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:12:27,961 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:12:27,961 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:12:27,964 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:12:27,965 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:12:27,967 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:12:27,968 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:12:27,968 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:12:27,969 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 14.7ms
2025-10-27 11:12:27,969 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.3ms
2025-10-27 11:12:27,969 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.2ms
2025-10-27 11:12:27,971 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:12:27,973 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:12:27,973 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:12:27,975 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:12:27,975 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:12:27,975 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.4ms
2025-10-27 11:12:27,976 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:12:27,977 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:12:27,977 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:12:27,981 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:12:27,981 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:12:27,981 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:12:27,984 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:12:27,986 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:12:27,986 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:12:27,987 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.2ms
2025-10-27 11:12:27,987 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 6.0ms
2025-10-27 11:14:59,378 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:14:59,387 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:14:59,388 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:14:59,389 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:14:59,389 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:14:59,390 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:14:59,390 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 216
2025-10-27 11:14:59,390 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 216
2025-10-27 11:14:59,390 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:14:59,391 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.2ms
2025-10-27 11:17:17,813 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:17:17,824 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:17:17,825 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:17:17,825 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:17:17,826 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:17:17,827 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:17:17,828 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 217
2025-10-27 11:17:17,828 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 217
2025-10-27 11:17:17,828 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:17:17,828 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 15.2ms
2025-10-27 11:17:24,760 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:17:24,762 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:17:24,763 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:17:24,764 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:17:24,764 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:17:24,765 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:17:24,766 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 218
2025-10-27 11:17:24,766 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 218
2025-10-27 11:17:24,766 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:17:24,767 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.2ms
2025-10-27 11:17:37,986 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:17:37,987 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:17:37,988 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:17:37,989 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:17:37,989 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:17:37,990 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:17:37,990 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 219
2025-10-27 11:17:37,990 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 219
2025-10-27 11:17:37,990 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:17:37,991 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.2ms
2025-10-27 11:17:38,501 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:17:38,503 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:17:38,505 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:17:38,505 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:17:38,506 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:17:38,508 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:17:38,509 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 220
2025-10-27 11:17:38,509 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 220
2025-10-27 11:17:38,509 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:17:38,510 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 8.5ms
2025-10-27 11:18:19,468 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:18:19,493 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:18:19,494 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:18:19,495 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:18:19,495 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:18:19,496 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:18:19,496 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 221
2025-10-27 11:18:19,497 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 221
2025-10-27 11:18:19,497 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:18:19,497 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 29.4ms
2025-10-27 11:19:57,009 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:19:57,010 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 11:19:57,321 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:19:57,330 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:19:57,332 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:19:57,332 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:19:57,332 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:19:57,333 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:19:57,334 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 222
2025-10-27 11:19:57,334 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 222
2025-10-27 11:19:57,334 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:19:57,334 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.5ms
2025-10-27 11:23:51,460 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:23:51,461 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 11:23:51,772 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:23:51,785 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:23:51,786 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:23:51,786 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:23:51,786 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:23:51,788 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:23:51,789 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 223
2025-10-27 11:23:51,789 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 223
2025-10-27 11:23:51,789 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:23:51,790 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.6ms
2025-10-27 11:28:30,877 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:28:30,878 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 11:28:31,188 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:28:31,198 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:28:31,199 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:28:31,199 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:28:31,199 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:28:31,200 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:28:31,201 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 224
2025-10-27 11:28:31,201 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 224
2025-10-27 11:28:31,201 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:28:31,201 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 12.8ms
2025-10-27 11:28:31,206 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 11:28:31,206 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.5ms
2025-10-27 11:28:31,208 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:28:31,209 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:28:31,214 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 6.6ms
2025-10-27 11:28:31,238 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:28:31,239 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.9ms
2025-10-27 11:28:31,239 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:28:31,240 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.4ms
2025-10-27 11:28:31,242 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:28:31,243 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:28:31,248 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:28:31,248 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:28:31,250 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:28:31,250 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:28:31,251 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:28:31,251 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 8.9ms
2025-10-27 11:28:31,252 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 8.4ms
2025-10-27 11:28:31,252 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.6ms
2025-10-27 11:28:31,254 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:28:31,255 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.5ms
2025-10-27 11:28:31,256 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:28:31,256 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:28:31,259 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:28:31,260 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:28:31,266 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:28:31,266 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:28:31,267 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 11.4ms
2025-10-27 11:28:31,268 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.7ms
2025-10-27 11:28:31,271 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:28:31,275 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:28:31,277 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:28:31,277 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:28:31,278 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 6.9ms
2025-10-27 11:28:31,280 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:28:31,283 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:28:31,283 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:28:31,284 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:28:31,285 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:28:31,285 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.9ms
2025-10-27 11:28:31,287 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:28:31,289 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:28:31,290 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:28:31,295 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:28:31,295 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:28:31,296 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.1ms
2025-10-27 11:28:31,299 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:28:31,302 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:28:31,303 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:28:31,303 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:28:31,304 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.1ms
2025-10-27 11:28:47,753 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:28:47,753 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:28:47,754 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:28:47,754 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 1.7ms
2025-10-27 11:28:47,755 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 1.1ms
2025-10-27 11:28:47,755 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 1.0ms
2025-10-27 11:28:47,757 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:28:47,759 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:28:47,759 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:28:47,761 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:28:47,761 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:28:47,762 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.2ms
2025-10-27 11:28:47,762 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:28:47,763 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:28:47,764 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:28:47,765 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:28:47,765 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:28:47,767 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:28:47,767 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:28:47,770 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:28:47,770 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:28:47,771 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.0ms
2025-10-27 11:28:47,771 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.9ms
2025-10-27 11:28:50,279 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-10-27 11:28:50,280 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-10-27 11:28:50,280 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/ 1.1ms
2025-10-27 11:28:50,281 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/ 0.6ms
2025-10-27 11:28:50,283 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:28:50,286 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:28:50,286 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:28:50,292 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:28:50,293 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 9.3ms
2025-10-27 11:28:50,294 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:28:50,297 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:28:50,297 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:28:50,301 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:28:50,301 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 7.0ms
2025-10-27 11:28:50,862 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-10-27 11:28:50,863 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/areas/ 0.8ms
2025-10-27 11:28:50,864 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-10-27 11:28:50,865 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/areas/ 1.1ms
2025-10-27 11:28:50,866 - app.main - INFO - 127.0.0.1 -> GET /api/v1/areas/
2025-10-27 11:28:50,868 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-10-27 11:28:50,868 - app.services.area_service - INFO - Obteniendo áreas paginadas: skip=0, limit=10, search='None'
2025-10-27 11:28:50,874 - app.services.area_service - INFO - Paginación completada: 1 áreas de 1 totales
2025-10-27 11:28:50,874 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada - Total: 1, Página: 1
2025-10-27 11:28:50,875 - app.main - INFO - 127.0.0.1 <- GET /api/v1/areas/ 9.0ms
2025-10-27 11:28:50,877 - app.main - INFO - 127.0.0.1 -> GET /api/v1/areas/
2025-10-27 11:28:50,879 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-10-27 11:28:50,879 - app.services.area_service - INFO - Obteniendo áreas paginadas: skip=0, limit=10, search='None'
2025-10-27 11:28:50,882 - app.services.area_service - INFO - Paginación completada: 1 áreas de 1 totales
2025-10-27 11:28:50,883 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada - Total: 1, Página: 1
2025-10-27 11:28:50,883 - app.main - INFO - 127.0.0.1 <- GET /api/v1/areas/ 6.2ms
2025-10-27 11:28:51,293 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:28:51,296 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:28:51,296 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:28:51,299 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:28:51,300 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 7.2ms
2025-10-27 11:28:51,302 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:28:51,304 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:28:51,305 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:28:51,308 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:28:51,308 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 5.8ms
2025-10-27 11:28:51,577 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:28:51,580 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:28:51,580 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:28:51,586 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:28:51,586 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:28:51,587 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:28:51,589 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:28:51,590 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:28:51,590 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:28:51,591 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 14.1ms
2025-10-27 11:28:51,591 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.6ms
2025-10-27 11:28:51,593 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:28:51,595 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:28:51,596 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:28:51,599 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:28:51,599 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:28:51,601 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.9ms
2025-10-27 11:28:51,601 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:28:51,603 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:28:51,604 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:28:51,604 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:28:51,604 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.1ms
2025-10-27 11:28:55,949 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 11:28:55,950 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.6ms
2025-10-27 11:28:55,952 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 11:28:55,953 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:28:55,953 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:28:55,954 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 11:28:55,954 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.4ms
2025-10-27 11:29:31,124 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:29:31,125 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 11:29:31,126 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.1ms
2025-10-27 11:29:47,172 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 11:29:47,173 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-27 11:29:47,174 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 11:29:47,426 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:29:47,426 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 225
2025-10-27 11:29:47,426 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 225
2025-10-27 11:29:47,426 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 11:29:47,430 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 256.1ms
2025-10-27 11:31:01,007 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:31:01,007 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 11:31:01,318 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:31:01,320 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:31:01,321 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:31:01,322 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:31:01,322 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:31:01,322 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:31:01,323 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 226
2025-10-27 11:31:01,323 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 226
2025-10-27 11:31:01,323 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:31:01,323 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.2ms
2025-10-27 11:32:22,071 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:32:22,072 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 11:32:22,381 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:32:22,397 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:32:22,398 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:32:22,399 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:32:22,399 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:32:22,400 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:32:22,400 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 227
2025-10-27 11:32:22,400 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 227
2025-10-27 11:32:22,400 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:32:22,401 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 19.8ms
2025-10-27 11:35:14,737 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:35:14,738 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 11:35:15,050 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:35:15,064 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:35:15,065 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:35:15,065 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:35:15,065 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:35:15,066 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:35:15,067 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 228
2025-10-27 11:35:15,067 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 228
2025-10-27 11:35:15,067 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:35:15,068 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.3ms
2025-10-27 11:39:19,395 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:39:19,395 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:39:19,395 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.8ms
2025-10-27 11:39:19,396 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 11:39:19,707 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:39:19,707 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:39:19,717 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:39:19,718 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:39:19,719 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:39:19,719 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:39:19,720 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:39:19,720 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 229
2025-10-27 11:39:19,720 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 229
2025-10-27 11:39:19,721 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:39:19,722 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:39:19,722 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:39:19,722 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:39:19,723 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:39:19,723 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (61dd1e30af1a5d960142779371b973f76b038257d12fffb3abb327312e066554). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 11:39:19,724 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 11:39:19,724 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 11:39:19,724 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:39:19,724 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.3ms
2025-10-27 11:39:19,724 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.0ms
2025-10-27 11:39:19,730 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 11:39:19,730 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.5ms
2025-10-27 11:39:19,732 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:39:19,733 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:39:19,734 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.2ms
2025-10-27 11:39:19,764 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:39:19,765 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:39:19,765 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.2ms
2025-10-27 11:39:19,766 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:39:19,767 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.6ms
2025-10-27 11:39:19,767 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.1ms
2025-10-27 11:39:19,770 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:39:19,770 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:39:19,774 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:39:19,774 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:39:19,775 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:39:19,775 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:39:19,776 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:39:19,776 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:39:19,777 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 6.7ms
2025-10-27 11:39:19,777 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.6ms
2025-10-27 11:39:19,779 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:39:19,779 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:39:19,782 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:39:19,783 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:39:19,783 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:39:19,785 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 8.8ms
2025-10-27 11:39:19,785 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.9ms
2025-10-27 11:39:19,785 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 2.2ms
2025-10-27 11:39:19,787 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:39:19,790 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:39:19,791 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:39:19,791 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:39:19,792 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.8ms
2025-10-27 11:39:19,793 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:39:19,796 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:39:19,796 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:39:19,797 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:39:19,798 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:39:19,798 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.6ms
2025-10-27 11:39:19,800 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:39:19,802 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:39:19,803 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:39:19,806 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:39:19,807 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:39:19,808 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.0ms
2025-10-27 11:39:19,808 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:39:19,810 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:39:19,811 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:39:19,812 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:39:19,813 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.9ms
2025-10-27 11:39:22,438 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:39:22,438 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:39:22,439 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 1.2ms
2025-10-27 11:39:22,439 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 1.0ms
2025-10-27 11:39:22,442 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:39:22,443 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:39:22,446 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:39:22,447 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:39:22,448 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:39:22,448 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:39:22,451 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:39:22,451 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 231
2025-10-27 11:39:22,452 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 231
2025-10-27 11:39:22,452 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:39:22,453 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 11.1ms
2025-10-27 11:39:22,455 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:39:22,456 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:39:22,457 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:39:22,457 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:39:22,459 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (219c90b1b98c0adf9cf835f303d0cbfb881ee6451af3ba03f8bd85a728f81331). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 11:39:22,459 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 11:39:22,459 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 11:39:22,460 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:39:22,460 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.4ms
2025-10-27 11:39:22,465 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 11:39:22,466 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.6ms
2025-10-27 11:39:22,468 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:39:22,470 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:39:22,471 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.4ms
2025-10-27 11:39:22,498 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:39:22,500 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:39:22,500 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:39:22,501 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 2.9ms
2025-10-27 11:39:22,501 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:39:22,501 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:39:22,502 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:39:22,503 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 3.0ms
2025-10-27 11:39:22,503 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 2.8ms
2025-10-27 11:39:22,503 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 2.1ms
2025-10-27 11:39:22,503 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.9ms
2025-10-27 11:39:22,504 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.8ms
2025-10-27 11:39:22,507 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:39:22,509 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:39:22,509 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:39:22,510 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:39:22,510 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:39:22,512 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:39:22,512 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:39:22,513 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.8ms
2025-10-27 11:39:22,514 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:39:22,515 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:39:22,516 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:39:22,518 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:39:22,518 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:39:22,522 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:39:22,522 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:39:22,523 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:39:22,523 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:39:22,523 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:39:22,525 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:39:22,526 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:39:22,526 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:39:22,528 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:39:22,528 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:39:22,529 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:39:22,529 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:39:22,532 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:39:22,532 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:39:22,535 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:39:22,535 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:39:22,536 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 24.3ms
2025-10-27 11:39:22,536 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 24.3ms
2025-10-27 11:39:22,537 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 14.0ms
2025-10-27 11:39:22,537 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 13.9ms
2025-10-27 11:39:22,537 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 13.8ms
2025-10-27 11:42:53,406 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:42:53,406 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 11:42:53,716 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:42:53,725 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:42:53,726 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:42:53,726 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:42:53,726 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:42:53,727 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:42:53,728 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 233
2025-10-27 11:42:53,728 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 233
2025-10-27 11:42:53,728 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:42:53,728 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 12.5ms
2025-10-27 11:42:53,733 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 11:42:53,733 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 11:42:53,734 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:42:53,735 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:42:53,736 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 1.8ms
2025-10-27 11:42:54,079 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:42:54,080 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.3ms
2025-10-27 11:42:54,081 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:42:54,082 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.2ms
2025-10-27 11:42:54,084 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:42:54,085 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:42:54,085 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.6ms
2025-10-27 11:42:54,088 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:42:54,088 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:42:54,090 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:42:54,090 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:42:54,091 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:42:54,091 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:42:54,094 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:42:54,094 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:42:54,099 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:42:54,099 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:42:54,100 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 15.4ms
2025-10-27 11:42:54,101 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 9.7ms
2025-10-27 11:42:54,101 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.7ms
2025-10-27 11:42:54,103 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:42:54,104 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.5ms
2025-10-27 11:42:54,105 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:42:54,108 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:42:54,109 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:42:54,109 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:42:54,110 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:42:54,110 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:42:54,113 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:42:54,113 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:42:54,114 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:42:54,115 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:42:54,115 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.3ms
2025-10-27 11:42:54,116 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 6.3ms
2025-10-27 11:42:54,116 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.2ms
2025-10-27 11:42:54,120 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:42:54,123 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:42:54,123 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:42:54,128 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:42:54,129 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:42:54,129 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:42:54,130 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.6ms
2025-10-27 11:42:54,134 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:42:54,136 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:42:54,136 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:42:54,137 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 7.9ms
2025-10-27 11:43:17,586 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:43:17,586 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 11:43:17,588 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:43:17,590 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:43:17,593 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:43:17,594 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:43:17,594 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:43:17,595 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:43:17,596 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 234
2025-10-27 11:43:17,596 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 234
2025-10-27 11:43:17,596 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:43:17,597 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 8.8ms
2025-10-27 11:43:38,920 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:43:38,921 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.9ms
2025-10-27 11:43:38,923 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:43:38,927 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:43:38,929 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:43:38,930 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:43:38,930 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:43:38,931 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:43:38,932 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 235
2025-10-27 11:43:38,932 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 235
2025-10-27 11:43:38,932 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:43:38,933 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 10.0ms
2025-10-27 11:43:43,109 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:43:43,109 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:43:43,110 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.9ms
2025-10-27 11:43:43,110 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 11:43:43,112 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:43:43,112 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:43:43,114 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:43:43,115 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:43:43,115 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:43:43,115 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:43:43,116 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:43:43,117 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 236
2025-10-27 11:43:43,117 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 236
2025-10-27 11:43:43,117 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:43:43,118 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.0ms
2025-10-27 11:43:43,119 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:43:43,122 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:43:43,122 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:43:43,123 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:43:43,124 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (582f727af96ff6c745e00cdde5d1bd708d0ae415f52939578faae1787b885df5). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 11:43:43,124 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 11:43:43,124 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 11:43:43,125 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:43:43,125 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.1ms
2025-10-27 11:43:43,130 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 11:43:43,130 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 11:43:43,133 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:43:43,134 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:43:43,135 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.5ms
2025-10-27 11:43:43,158 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:43:43,159 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:43:43,159 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:43:43,160 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 2.2ms
2025-10-27 11:43:43,161 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 2.3ms
2025-10-27 11:43:43,162 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 2.4ms
2025-10-27 11:43:43,164 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:43:43,166 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:43:43,166 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:43:43,167 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:43:43,167 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:43:43,168 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:43:43,169 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:43:43,169 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.3ms
2025-10-27 11:43:43,169 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:43:43,170 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:43:43,170 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:43:43,170 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 2.4ms
2025-10-27 11:43:43,172 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:43:43,172 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:43:43,176 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:43:43,176 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:43:43,178 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:43:43,179 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:43:43,180 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:43:43,181 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 12.0ms
2025-10-27 11:43:43,182 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.4ms
2025-10-27 11:43:43,182 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 12.6ms
2025-10-27 11:43:43,182 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 12.5ms
2025-10-27 11:43:43,185 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:43:43,188 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:43:43,188 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:43:43,189 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:43:43,190 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:43:43,191 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.6ms
2025-10-27 11:43:43,191 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:43:43,192 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:43:43,195 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:43:43,195 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:43:43,199 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:43:43,200 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:43:43,202 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:43:43,203 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:43:43,203 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:43:43,204 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.9ms
2025-10-27 11:43:43,204 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 12.8ms
2025-10-27 11:43:49,510 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 11:43:49,510 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.5ms
2025-10-27 11:43:49,511 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 11:43:49,513 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:43:49,513 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:43:49,513 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 11:43:49,513 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.1ms
2025-10-27 11:43:54,749 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:43:54,750 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 11:43:54,750 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.4ms
2025-10-27 11:44:28,989 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:44:28,990 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 11:44:28,991 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.2ms
2025-10-27 11:44:39,419 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 11:44:39,419 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.5ms
2025-10-27 11:44:39,421 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 11:44:39,687 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:44:39,688 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 238
2025-10-27 11:44:39,688 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 238
2025-10-27 11:44:39,688 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 11:44:39,692 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 271.4ms
2025-10-27 11:45:26,514 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:45:26,516 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:45:26,517 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:45:26,517 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:45:26,517 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:45:26,519 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:45:26,519 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 239
2025-10-27 11:45:26,519 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 239
2025-10-27 11:45:26,519 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:45:26,520 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.9ms
2025-10-27 11:48:25,651 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:48:25,651 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 11:48:25,960 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:48:25,983 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:48:25,983 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:48:25,984 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:48:25,984 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:48:25,985 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:48:25,985 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 240
2025-10-27 11:48:25,985 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 240
2025-10-27 11:48:25,985 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:48:25,986 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 26.0ms
2025-10-27 11:52:09,379 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:52:09,389 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:52:09,389 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:52:09,390 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:52:09,390 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:52:09,392 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:52:09,392 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 241
2025-10-27 11:52:09,392 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 241
2025-10-27 11:52:09,392 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:52:09,393 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.5ms
2025-10-27 11:54:24,832 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:54:24,842 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:54:24,843 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:54:24,843 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:54:24,844 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:54:24,845 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:54:24,845 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 242
2025-10-27 11:54:24,845 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 242
2025-10-27 11:54:24,845 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:54:24,845 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.2ms
2025-10-27 11:54:30,924 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:54:30,927 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:54:30,928 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:54:30,929 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:54:30,929 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:54:30,931 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:54:30,931 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 243
2025-10-27 11:54:30,931 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 243
2025-10-27 11:54:30,931 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:54:30,932 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.6ms
2025-10-27 11:54:30,933 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:54:30,935 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:54:30,936 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:54:30,936 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:54:30,936 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:54:30,937 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (bd172aa05a01b494aec56e71884a6d10881841d415487fd8bbf3c01edf45f5fb). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 11:54:30,938 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 11:54:30,938 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 11:54:30,938 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:54:30,939 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.8ms
2025-10-27 11:54:31,253 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 11:54:31,254 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 11:54:31,256 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:54:31,257 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:54:31,262 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 6.0ms
2025-10-27 11:54:31,292 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:54:31,293 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.5ms
2025-10-27 11:54:31,295 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 11:54:31,295 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:54:31,297 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:54:31,298 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:54:31,299 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:54:31,299 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:54:31,300 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 4.9ms
2025-10-27 11:54:31,300 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.8ms
2025-10-27 11:54:31,303 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:54:31,305 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:54:31,305 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:54:31,307 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:54:31,307 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:54:31,308 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.5ms
2025-10-27 11:54:34,980 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:54:34,981 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:54:34,982 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.9ms
2025-10-27 11:54:34,982 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 11:54:34,982 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:54:34,983 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 2.0ms
2025-10-27 11:54:34,985 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:54:34,985 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:54:34,986 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:54:34,986 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:54:34,988 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 5.6ms
2025-10-27 11:54:34,988 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.5ms
2025-10-27 11:54:34,990 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 11:54:34,990 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:54:34,993 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:54:34,993 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:54:34,998 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:54:34,998 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:54:34,999 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 9.2ms
2025-10-27 11:54:34,999 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.1ms
2025-10-27 11:54:34,999 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:54:35,001 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:54:35,002 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:54:35,002 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:54:35,003 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.1ms
2025-10-27 11:54:35,005 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:54:35,006 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:54:35,007 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:54:35,007 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:54:35,008 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:54:35,008 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.4ms
2025-10-27 11:54:35,008 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:54:35,010 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:54:35,010 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:54:35,014 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:54:35,014 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:54:35,015 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.6ms
2025-10-27 11:54:35,016 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:54:35,018 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:54:35,019 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:54:35,019 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:54:35,019 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.2ms
2025-10-27 11:54:36,796 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-10-27 11:54:36,796 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-10-27 11:54:36,797 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/areas/ 0.9ms
2025-10-27 11:54:36,797 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/areas/ 0.6ms
2025-10-27 11:54:36,799 - app.main - INFO - 127.0.0.1 -> GET /api/v1/areas/
2025-10-27 11:54:36,802 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-10-27 11:54:36,802 - app.services.area_service - INFO - Obteniendo áreas paginadas: skip=0, limit=10, search='None'
2025-10-27 11:54:36,804 - app.services.area_service - INFO - Paginación completada: 1 áreas de 1 totales
2025-10-27 11:54:36,805 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada - Total: 1, Página: 1
2025-10-27 11:54:36,805 - app.main - INFO - 127.0.0.1 <- GET /api/v1/areas/ 5.9ms
2025-10-27 11:54:36,807 - app.main - INFO - 127.0.0.1 -> GET /api/v1/areas/
2025-10-27 11:54:36,809 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-10-27 11:54:36,809 - app.services.area_service - INFO - Obteniendo áreas paginadas: skip=0, limit=10, search='None'
2025-10-27 11:54:36,811 - app.services.area_service - INFO - Paginación completada: 1 áreas de 1 totales
2025-10-27 11:54:36,811 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada - Total: 1, Página: 1
2025-10-27 11:54:36,812 - app.main - INFO - 127.0.0.1 <- GET /api/v1/areas/ 4.7ms
2025-10-27 11:54:51,556 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 11:54:51,557 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.7ms
2025-10-27 11:54:51,559 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 11:54:51,560 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:54:51,560 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:54:51,561 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 11:54:51,561 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.2ms
2025-10-27 11:55:26,335 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:55:26,336 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:55:26,338 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 11:55:26,339 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 11:55:26,339 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.8ms
2025-10-27 11:55:26,339 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.2ms
2025-10-27 11:55:42,281 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 11:55:42,281 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.7ms
2025-10-27 11:55:42,284 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 11:55:42,534 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:55:42,534 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 245
2025-10-27 11:55:42,534 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 245
2025-10-27 11:55:42,535 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 11:55:42,540 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 256.2ms
2025-10-27 11:55:42,560 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:55:42,564 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:55:42,564 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:55:42,567 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:55:42,567 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:55:42,567 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.2ms
2025-10-27 11:55:42,579 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:55:42,582 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:55:42,583 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:55:42,588 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:55:42,588 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:55:42,589 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.8ms
2025-10-27 11:55:42,591 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:55:42,593 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:55:42,594 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:55:42,595 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:55:42,595 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.6ms
2025-10-27 11:55:42,597 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:55:42,599 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:55:42,600 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:55:42,601 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:55:42,601 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:55:42,602 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.3ms
2025-10-27 11:55:42,603 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:55:42,605 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:55:42,605 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:55:42,609 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:55:42,609 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:55:42,610 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.8ms
2025-10-27 11:55:42,612 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:55:42,614 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:55:42,615 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:55:42,615 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:55:42,616 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.9ms
2025-10-27 11:55:52,432 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:55:52,432 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:55:52,436 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:55:52,437 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:55:52,438 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:55:52,438 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:55:52,441 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:55:52,441 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 246
2025-10-27 11:55:52,442 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 246
2025-10-27 11:55:52,442 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:55:52,443 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 11.0ms
2025-10-27 11:55:52,444 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:55:52,445 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:55:52,445 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:55:52,446 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:55:52,447 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (42fbe4e8fc060ba5df88a01eaf671c3baca2907629cd1f98a63578ffae72dced). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 11:55:52,447 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 11:55:52,448 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 11:55:52,448 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:55:52,449 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 16.5ms
2025-10-27 11:55:52,455 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:55:52,457 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:55:52,458 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.1ms
2025-10-27 11:55:52,474 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:55:52,477 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:55:52,478 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:55:52,479 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:55:52,479 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:55:52,480 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:55:52,480 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:55:52,482 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:55:52,482 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:55:52,486 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:55:52,487 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:55:52,489 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:55:52,490 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:55:52,490 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:55:52,491 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 16.3ms
2025-10-27 11:55:52,491 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.5ms
2025-10-27 11:55:52,491 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 11.3ms
2025-10-27 11:55:52,494 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:55:52,496 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:55:52,496 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:55:52,498 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:55:52,498 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:55:52,498 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:55:52,501 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:55:52,501 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:55:52,505 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:55:52,505 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:55:52,506 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:55:52,506 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 12.1ms
2025-10-27 11:55:52,508 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:55:52,509 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:55:52,509 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:55:52,510 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.8ms
2025-10-27 11:55:52,511 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.3ms
2025-10-27 11:58:42,388 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:58:42,389 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 11:58:42,389 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:58:42,389 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:58:42,390 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 1.6ms
2025-10-27 11:58:42,390 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 1.1ms
2025-10-27 11:58:42,390 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 1.0ms
2025-10-27 11:58:42,390 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 1.0ms
2025-10-27 11:58:42,393 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:58:42,404 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:58:42,404 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:58:42,405 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:58:42,405 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:58:42,406 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:58:42,406 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:58:42,407 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:58:42,408 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:58:42,408 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:58:42,408 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 15.4ms
2025-10-27 11:58:42,409 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.1ms
2025-10-27 11:58:42,411 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:58:42,411 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:58:42,412 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:58:42,412 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:58:42,413 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:58:42,413 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 248
2025-10-27 11:58:42,414 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 248
2025-10-27 11:58:42,414 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:58:42,415 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 8.8ms
2025-10-27 11:58:42,415 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:58:42,417 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:42,417 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:58:42,420 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:58:42,420 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:58:42,421 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.0ms
2025-10-27 11:58:42,425 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:58:42,426 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:58:42,427 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.0ms
2025-10-27 11:58:46,658 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-10-27 11:58:46,658 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/ 0.9ms
2025-10-27 11:58:46,659 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-10-27 11:58:46,659 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/ 0.8ms
2025-10-27 11:58:46,661 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:58:46,664 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:46,664 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:58:46,667 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:58:46,668 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 7.0ms
2025-10-27 11:58:46,670 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:58:46,672 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:46,672 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:58:46,675 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:58:46,676 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 5.9ms
2025-10-27 11:58:47,457 - app.main - INFO - 127.0.0.1 -> GET /api/v1/areas/
2025-10-27 11:58:47,460 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-10-27 11:58:47,460 - app.services.area_service - INFO - Obteniendo áreas paginadas: skip=0, limit=10, search='None'
2025-10-27 11:58:47,464 - app.services.area_service - INFO - Paginación completada: 1 áreas de 1 totales
2025-10-27 11:58:47,464 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada - Total: 1, Página: 1
2025-10-27 11:58:47,464 - app.main - INFO - 127.0.0.1 <- GET /api/v1/areas/ 7.1ms
2025-10-27 11:58:47,466 - app.main - INFO - 127.0.0.1 -> GET /api/v1/areas/
2025-10-27 11:58:47,469 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-10-27 11:58:47,469 - app.services.area_service - INFO - Obteniendo áreas paginadas: skip=0, limit=10, search='None'
2025-10-27 11:58:47,472 - app.services.area_service - INFO - Paginación completada: 1 áreas de 1 totales
2025-10-27 11:58:47,472 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada - Total: 1, Página: 1
2025-10-27 11:58:47,473 - app.main - INFO - 127.0.0.1 <- GET /api/v1/areas/ 6.3ms
2025-10-27 11:58:47,997 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:58:47,999 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:48,000 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:58:48,003 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:58:48,004 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 7.3ms
2025-10-27 11:58:48,006 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:58:48,008 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:48,008 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:58:48,010 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:58:48,011 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 5.1ms
2025-10-27 11:58:48,544 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:58:48,547 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:48,547 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:58:48,552 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:58:48,552 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:58:48,553 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.8ms
2025-10-27 11:58:48,553 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:58:48,557 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:58:48,559 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:58:48,559 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:58:48,560 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 6.4ms
2025-10-27 11:58:48,561 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 11:58:48,564 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:48,564 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 11:58:48,568 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 11:58:48,568 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 11:58:48,569 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.4ms
2025-10-27 11:58:48,569 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 11:58:48,571 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 11:58:48,572 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 11:58:48,572 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 11:58:48,572 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.4ms
2025-10-27 11:58:49,193 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:58:49,196 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:49,196 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:58:49,199 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:58:49,200 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 6.6ms
2025-10-27 11:58:49,202 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:58:49,205 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:49,205 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:58:49,209 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:58:49,209 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 7.2ms
2025-10-27 11:58:50,563 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:58:50,564 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:58:50,567 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:58:50,579 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:58:50,582 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:58:50,582 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:58:50,585 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:58:50,585 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 249
2025-10-27 11:58:50,585 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 249
2025-10-27 11:58:50,586 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:58:50,588 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:58:50,590 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:58:50,591 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:58:50,591 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:58:50,593 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (475c5d126a04769a2dfe260e58918285d84e16090082b46cb700ed8c6c1701e6). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 11:58:50,594 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 11:58:50,595 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 11:58:50,595 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:58:50,595 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 32.0ms
2025-10-27 11:58:50,596 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 31.6ms
2025-10-27 11:58:50,601 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:58:50,603 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:58:50,604 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.4ms
2025-10-27 11:58:50,621 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:58:50,624 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:58:50,624 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:58:50,625 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:58:50,625 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:58:50,626 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:58:50,628 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:50,628 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:58:50,631 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:58:50,632 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 10.7ms
2025-10-27 11:58:50,632 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 6.2ms
2025-10-27 11:58:50,634 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:58:50,636 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:58:50,637 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:58:50,638 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:58:50,638 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:58:50,639 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.4ms
2025-10-27 11:58:50,640 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:58:50,642 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:50,642 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:58:50,646 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:58:50,647 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 7.2ms
2025-10-27 11:58:55,448 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:58:55,449 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:58:55,452 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:58:55,453 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:58:55,454 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:58:55,454 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:58:55,456 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:58:55,457 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 251
2025-10-27 11:58:55,457 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 251
2025-10-27 11:58:55,458 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:58:55,461 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:58:55,463 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:58:55,463 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:58:55,464 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:58:55,465 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (845f2e3a94ec50e7c9ac55426ddbf44ea7573387580fd58dc6ff5a9c44e40f0f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 11:58:55,466 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 11:58:55,466 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 11:58:55,466 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:58:55,467 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.3ms
2025-10-27 11:58:55,467 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.8ms
2025-10-27 11:58:55,472 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 11:58:55,474 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 11:58:55,477 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 4.3ms
2025-10-27 11:58:55,497 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:58:55,500 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:58:55,500 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:58:55,501 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:58:55,502 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:58:55,502 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:58:55,504 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:55,505 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:58:55,508 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:58:55,508 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 11.1ms
2025-10-27 11:58:55,509 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 6.6ms
2025-10-27 11:58:55,511 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 11:58:55,514 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 11:58:55,514 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 11:58:55,515 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 11:58:55,516 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 11:58:55,517 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.6ms
2025-10-27 11:58:55,517 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 11:58:55,520 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 11:58:55,520 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 11:58:55,524 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 11:58:55,525 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 8.2ms
2025-10-27 11:59:42,644 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 11:59:42,646 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 11:59:42,647 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 11:59:42,647 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 11:59:42,647 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 11:59:42,648 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 11:59:42,648 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 253
2025-10-27 11:59:42,648 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 253
2025-10-27 11:59:42,649 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 11:59:42,649 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 4.8ms
2025-10-27 12:01:47,466 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:01:47,477 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:01:47,478 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:01:47,478 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:01:47,478 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:01:47,479 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:01:47,480 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 254
2025-10-27 12:01:47,480 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 254
2025-10-27 12:01:47,480 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:01:47,480 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.9ms
2025-10-27 12:01:50,697 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:01:50,700 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:01:50,701 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:01:50,701 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:01:50,701 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:01:50,702 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:01:50,703 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 255
2025-10-27 12:01:50,703 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 255
2025-10-27 12:01:50,703 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:01:50,704 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.9ms
2025-10-27 12:07:07,109 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:07:07,118 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:07:07,119 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:07:07,119 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:07:07,120 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:07:07,120 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:07:07,121 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 256
2025-10-27 12:07:07,121 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 256
2025-10-27 12:07:07,121 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:07:07,121 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 12.1ms
2025-10-27 12:07:47,296 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 12:07:47,296 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 12:07:47,298 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:07:47,300 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:07:47,301 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:07:47,301 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:07:47,301 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:07:47,302 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:07:47,303 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 257
2025-10-27 12:07:47,303 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 257
2025-10-27 12:07:47,303 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:07:47,303 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.6ms
2025-10-27 12:08:30,393 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 12:08:30,394 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.9ms
2025-10-27 12:08:30,701 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:08:30,703 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:08:30,704 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:08:30,704 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:08:30,704 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:08:30,706 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:08:30,706 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 258
2025-10-27 12:08:30,706 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 258
2025-10-27 12:08:30,706 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:08:30,707 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.0ms
2025-10-27 12:09:07,164 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 12:09:07,164 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 12:09:07,165 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:09:07,167 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:09:07,168 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:09:07,168 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:09:07,169 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:09:07,170 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:09:07,170 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 259
2025-10-27 12:09:07,170 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 259
2025-10-27 12:09:07,170 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:09:07,171 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.2ms
2025-10-27 12:14:45,119 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 12:14:45,120 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 12:14:45,432 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:14:45,443 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:14:45,447 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:14:45,448 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:14:45,448 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:14:45,449 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:14:45,450 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 260
2025-10-27 12:14:45,450 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 260
2025-10-27 12:14:45,450 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:14:45,450 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.6ms
2025-10-27 12:17:53,715 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 12:17:53,715 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 12:17:54,025 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:17:54,036 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:17:54,037 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:17:54,037 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:17:54,037 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:17:54,038 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:17:54,038 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 261
2025-10-27 12:17:54,038 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 261
2025-10-27 12:17:54,039 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:17:54,039 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 14.2ms
2025-10-27 12:18:34,073 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 12:18:34,073 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 12:18:34,076 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:18:34,076 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 12:18:34,077 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 12:18:34,078 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:18:34,080 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:18:34,081 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:18:34,081 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:18:34,082 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:18:34,082 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 262
2025-10-27 12:18:34,083 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 262
2025-10-27 12:18:34,083 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:18:34,083 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.8ms
2025-10-27 12:18:34,085 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:18:34,088 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:18:34,089 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:18:34,089 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:18:34,089 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:18:34,091 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (e26e06768877f4e36bac19a788f249cdbf1bc0665b0d104b4f334b7e5d5b90f2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 12:18:34,091 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 12:18:34,091 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 12:18:34,092 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:18:34,093 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.2ms
2025-10-27 12:18:34,099 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 12:18:34,100 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.7ms
2025-10-27 12:18:34,103 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 12:18:34,104 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 12:18:34,106 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.4ms
2025-10-27 12:18:34,153 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 12:18:34,154 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.8ms
2025-10-27 12:18:34,156 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:18:34,158 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:18:34,159 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:18:34,162 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:18:34,163 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:18:34,164 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.7ms
2025-10-27 12:18:34,164 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 12:18:34,166 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.4ms
2025-10-27 12:18:34,168 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:18:34,170 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:18:34,171 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:18:34,172 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:18:34,172 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:18:34,173 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.7ms
2025-10-27 12:18:39,076 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 12:18:39,076 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.5ms
2025-10-27 12:18:39,077 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:18:39,078 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 0.5ms
2025-10-27 12:18:39,079 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 12:18:39,080 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.9ms
2025-10-27 12:18:39,080 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 12:18:39,081 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.9ms
2025-10-27 12:18:39,083 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:18:39,084 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:18:39,086 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:18:39,086 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:18:39,087 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:18:39,087 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:18:39,088 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.2ms
2025-10-27 12:18:39,089 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:18:39,090 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:18:39,090 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:18:39,090 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:18:39,092 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:18:39,092 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 264
2025-10-27 12:18:39,092 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 264
2025-10-27 12:18:39,092 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:18:39,093 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 10.2ms
2025-10-27 12:18:39,098 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 12:18:39,098 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.6ms
2025-10-27 12:18:39,101 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 12:18:39,102 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 12:18:39,103 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.2ms
2025-10-27 12:19:00,374 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 12:19:00,375 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 12:19:00,375 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 12:19:00,376 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 12:19:00,376 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:19:00,378 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:19:00,379 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:19:00,380 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:19:00,380 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:19:00,381 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 6.5ms
2025-10-27 12:19:00,381 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 6.1ms
2025-10-27 12:19:00,381 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 6.1ms
2025-10-27 12:19:00,382 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 6.0ms
2025-10-27 12:19:00,382 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.0ms
2025-10-27 12:19:00,386 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:19:00,389 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:19:00,390 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:19:00,394 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:19:00,394 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:19:00,395 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.3ms
2025-10-27 12:19:00,397 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:19:00,399 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:19:00,400 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:19:00,401 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:19:00,401 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.2ms
2025-10-27 12:19:00,403 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:19:00,406 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:19:00,406 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:19:00,408 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:19:00,408 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:19:00,409 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.8ms
2025-10-27 12:19:00,411 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:19:00,414 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:19:00,414 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:19:00,418 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:19:00,418 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:19:00,419 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.9ms
2025-10-27 12:19:00,421 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:19:00,424 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:19:00,425 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:19:00,425 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:19:00,425 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.1ms
2025-10-27 12:19:02,151 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-10-27 12:19:02,152 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/areas/ 0.7ms
2025-10-27 12:19:02,154 - app.main - INFO - 127.0.0.1 -> GET /api/v1/areas/
2025-10-27 12:19:02,157 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-10-27 12:19:02,157 - app.services.area_service - INFO - Obteniendo áreas paginadas: skip=0, limit=10, search='None'
2025-10-27 12:19:02,161 - app.services.area_service - INFO - Paginación completada: 1 áreas de 1 totales
2025-10-27 12:19:02,161 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada - Total: 1, Página: 1
2025-10-27 12:19:02,161 - app.main - INFO - 127.0.0.1 <- GET /api/v1/areas/ 7.3ms
2025-10-27 12:19:02,163 - app.main - INFO - 127.0.0.1 -> GET /api/v1/areas/
2025-10-27 12:19:02,166 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-10-27 12:19:02,166 - app.services.area_service - INFO - Obteniendo áreas paginadas: skip=0, limit=10, search='None'
2025-10-27 12:19:02,169 - app.services.area_service - INFO - Paginación completada: 1 áreas de 1 totales
2025-10-27 12:19:02,170 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada - Total: 1, Página: 1
2025-10-27 12:19:02,170 - app.main - INFO - 127.0.0.1 <- GET /api/v1/areas/ 6.9ms
2025-10-27 12:19:04,212 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:19:04,216 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:19:04,216 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:19:04,218 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:19:04,218 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:19:04,219 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/autorizacion/pendientes/
2025-10-27 12:19:04,219 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.0ms
2025-10-27 12:19:04,220 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/autorizacion/pendientes/
2025-10-27 12:19:04,221 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/autorizacion/pendientes/ 1.5ms
2025-10-27 12:19:04,221 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/autorizacion/pendientes/ 1.4ms
2025-10-27 12:19:04,223 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:19:04,226 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:19:04,226 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:19:04,227 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:19:04,228 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:19:04,229 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.5ms
2025-10-27 12:19:04,229 - app.main - INFO - 127.0.0.1 -> GET /api/v1/autorizacion/pendientes/
2025-10-27 12:19:04,229 - app.services.autorizacion_service - INFO - Ejecutando SP sp_pendiente_autorizacion para obtener pendientes
2025-10-27 12:19:04,476 - app.services.autorizacion_service - INFO - Se obtuvieron 1634 registros pendientes de autorización
2025-10-27 12:19:04,520 - app.main - INFO - 127.0.0.1 <- GET /api/v1/autorizacion/pendientes/ 290.6ms
2025-10-27 12:19:04,522 - app.main - INFO - 127.0.0.1 -> GET /api/v1/autorizacion/pendientes/
2025-10-27 12:19:04,523 - app.services.autorizacion_service - INFO - Ejecutando SP sp_pendiente_autorizacion para obtener pendientes
2025-10-27 12:19:04,595 - app.services.autorizacion_service - INFO - Se obtuvieron 1634 registros pendientes de autorización
2025-10-27 12:19:04,635 - app.main - INFO - 127.0.0.1 <- GET /api/v1/autorizacion/pendientes/ 113.1ms
2025-10-27 12:19:05,392 - app.main - INFO - 127.0.0.1 -> GET /api/v1/autorizacion/pendientes/
2025-10-27 12:19:05,392 - app.services.autorizacion_service - INFO - Ejecutando SP sp_pendiente_autorizacion para obtener pendientes
2025-10-27 12:19:05,455 - app.services.autorizacion_service - INFO - Se obtuvieron 1634 registros pendientes de autorización
2025-10-27 12:19:05,496 - app.main - INFO - 127.0.0.1 <- GET /api/v1/autorizacion/pendientes/ 104.1ms
2025-10-27 12:19:05,498 - app.main - INFO - 127.0.0.1 -> GET /api/v1/autorizacion/pendientes/
2025-10-27 12:19:05,498 - app.services.autorizacion_service - INFO - Ejecutando SP sp_pendiente_autorizacion para obtener pendientes
2025-10-27 12:19:05,574 - app.services.autorizacion_service - INFO - Se obtuvieron 1634 registros pendientes de autorización
2025-10-27 12:19:05,632 - app.main - INFO - 127.0.0.1 <- GET /api/v1/autorizacion/pendientes/ 133.8ms
2025-10-27 12:19:06,553 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:19:06,555 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:19:06,555 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:19:06,557 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:19:06,557 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:19:06,558 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.9ms
2025-10-27 12:19:06,559 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:19:06,559 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:19:06,562 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:19:06,563 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:19:06,563 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:19:06,566 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:19:06,566 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:19:06,569 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:19:06,570 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:19:06,570 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 11.3ms
2025-10-27 12:19:06,571 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.2ms
2025-10-27 12:19:06,571 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:19:06,574 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:19:06,574 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:19:06,576 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:19:06,576 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:19:06,577 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.9ms
2025-10-27 12:19:06,578 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:19:06,578 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:19:06,581 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:19:06,581 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:19:06,585 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:19:06,585 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:19:06,587 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:19:06,588 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:19:06,588 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:19:06,589 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.7ms
2025-10-27 12:19:06,589 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.6ms
2025-10-27 12:19:07,557 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-10-27 12:19:07,558 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/ 0.9ms
2025-10-27 12:19:07,558 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-10-27 12:19:07,559 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/ 1.1ms
2025-10-27 12:19:07,560 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 12:19:07,562 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:19:07,563 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 12:19:07,566 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 12:19:07,567 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 6.4ms
2025-10-27 12:19:07,569 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/
2025-10-27 12:19:07,571 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:19:07,571 - app.services.rol_service - INFO - Obteniendo roles paginados: page=1, limit=10, search='None'
2025-10-27 12:19:07,574 - app.services.rol_service - INFO - Obtención paginada de roles completada exitosamente
2025-10-27 12:19:07,575 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/ 6.4ms
2025-10-27 12:20:02,969 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 12:20:02,970 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.4ms
2025-10-27 12:20:03,280 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 12:20:03,281 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:20:03,282 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:20:03,282 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 12:20:03,282 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.1ms
2025-10-27 12:20:31,165 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:20:31,165 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:20:31,167 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 12:20:31,168 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 12:20:31,168 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.0ms
2025-10-27 12:20:31,168 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.7ms
2025-10-27 12:20:39,362 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 12:20:39,362 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.4ms
2025-10-27 12:20:39,364 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 12:20:39,622 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:20:39,622 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 265
2025-10-27 12:20:39,622 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 265
2025-10-27 12:20:39,623 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 12:20:39,628 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 265.0ms
2025-10-27 12:20:39,651 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:20:39,654 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:20:39,655 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:20:39,659 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:20:39,659 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:20:39,660 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 9.3ms
2025-10-27 12:20:39,662 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:20:39,665 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:20:39,665 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:20:39,669 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:20:39,670 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:20:39,670 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.9ms
2025-10-27 12:20:39,673 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:20:39,675 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:20:39,676 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:20:39,676 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:20:39,676 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.9ms
2025-10-27 12:20:39,679 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:20:39,682 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:20:39,682 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:20:39,683 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:20:39,684 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:20:39,684 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.3ms
2025-10-27 12:20:39,686 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:20:39,688 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:20:39,688 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:20:39,692 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:20:39,692 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:20:39,692 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.5ms
2025-10-27 12:20:39,694 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:20:39,697 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:20:39,698 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:20:39,698 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:20:39,698 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.4ms
2025-10-27 12:21:01,694 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:21:01,695 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:21:01,697 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:21:01,698 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:21:01,698 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:21:01,699 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:21:01,700 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:21:01,700 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 266
2025-10-27 12:21:01,701 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 266
2025-10-27 12:21:01,701 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:21:01,703 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:21:01,705 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:21:01,705 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:21:01,706 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:21:01,708 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b782e023299fd2d716baf8ed555021ee74b3c6d551868cfa6ae93301d597f2fa). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 12:21:01,708 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 12:21:01,709 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 12:21:01,709 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:21:01,709 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 15.3ms
2025-10-27 12:21:01,710 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 14.9ms
2025-10-27 12:21:01,717 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 12:21:01,719 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 12:21:01,720 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.3ms
2025-10-27 12:21:01,736 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:21:01,739 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:21:01,740 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:21:01,741 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:21:01,741 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:21:01,742 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:21:01,742 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:21:01,745 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:21:01,745 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:21:01,746 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:21:01,747 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:21:01,748 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:21:01,752 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:21:01,753 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:21:01,753 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 17.0ms
2025-10-27 12:21:01,753 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 11.6ms
2025-10-27 12:21:01,754 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.5ms
2025-10-27 12:21:01,756 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:21:01,759 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:21:01,759 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:21:01,760 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:21:01,760 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:21:01,761 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:21:01,763 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:21:01,764 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:21:01,764 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:21:01,765 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:21:01,765 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 8.8ms
2025-10-27 12:21:01,768 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:21:01,768 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:21:01,772 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:21:01,772 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:21:01,773 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 12.1ms
2025-10-27 12:21:01,774 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.2ms
2025-10-27 12:28:56,383 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 12:28:56,383 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 12:28:56,695 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:28:56,705 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:28:56,706 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:28:56,706 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:28:56,706 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:28:56,707 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:28:56,707 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 268
2025-10-27 12:28:56,708 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 268
2025-10-27 12:28:56,708 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:28:56,708 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.0ms
2025-10-27 12:32:12,878 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:32:12,887 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:32:12,888 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:32:12,889 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:32:12,889 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:32:12,890 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:32:12,890 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 269
2025-10-27 12:32:12,890 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 269
2025-10-27 12:32:12,891 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:32:12,891 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 12.9ms
2025-10-27 12:37:44,663 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:37:44,673 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:37:44,674 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:37:44,674 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:37:44,674 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:37:44,675 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:37:44,675 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 270
2025-10-27 12:37:44,675 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 270
2025-10-27 12:37:44,676 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:37:44,676 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 12.9ms
2025-10-27 12:37:44,990 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 12:37:44,990 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 12:37:44,992 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 12:37:44,993 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 12:37:44,994 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.0ms
2025-10-27 12:37:45,014 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 12:37:45,014 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.4ms
2025-10-27 12:37:45,016 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 12:37:45,016 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:37:45,018 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:37:45,018 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:37:45,020 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:37:45,020 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:37:45,020 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 4.8ms
2025-10-27 12:37:45,021 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.8ms
2025-10-27 12:37:45,022 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 12:37:45,023 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:37:45,023 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.7ms
2025-10-27 12:37:45,025 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:37:45,025 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:37:45,028 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:37:45,029 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:37:45,029 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.2ms
2025-10-27 12:37:45,030 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:37:45,032 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:37:45,033 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:37:45,033 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:37:45,034 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.1ms
2025-10-27 12:38:15,375 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:38:15,377 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:38:15,377 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:38:15,378 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:38:15,378 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:38:15,379 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:38:15,379 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 271
2025-10-27 12:38:15,380 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 271
2025-10-27 12:38:15,380 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:38:15,380 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 4.9ms
2025-10-27 12:38:15,383 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 12:38:15,384 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 12:38:15,385 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 1.8ms
2025-10-27 12:38:15,399 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:38:15,401 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:38:15,401 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:38:15,402 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:38:15,402 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:38:15,403 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.2ms
2025-10-27 12:38:15,404 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:38:15,406 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:38:15,406 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:38:15,409 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:38:15,409 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:38:15,409 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 5.3ms
2025-10-27 12:38:15,411 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:38:15,413 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:38:15,414 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:38:15,414 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:38:15,414 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.9ms
2025-10-27 12:38:47,225 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:38:47,228 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:38:47,229 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:38:47,229 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:38:47,229 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:38:47,231 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:38:47,231 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 272
2025-10-27 12:38:47,231 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 272
2025-10-27 12:38:47,232 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:38:47,232 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.7ms
2025-10-27 12:44:24,863 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 12:44:24,864 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 12:44:25,174 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:44:25,184 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:44:25,185 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:44:25,185 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:44:25,185 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:44:25,187 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:44:25,187 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 273
2025-10-27 12:44:25,187 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 273
2025-10-27 12:44:25,187 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:44:25,187 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.3ms
2025-10-27 12:44:55,463 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:44:55,486 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:44:55,487 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 12:44:55,487 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:44:55,487 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:44:55,488 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:44:55,489 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 274
2025-10-27 12:44:55,489 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 274
2025-10-27 12:44:55,489 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:44:55,489 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 26.2ms
2025-10-27 12:45:05,202 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 12:45:05,203 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.5ms
2025-10-27 12:45:05,204 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 12:45:05,435 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:45:05,436 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 275
2025-10-27 12:45:05,436 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 275
2025-10-27 12:45:05,436 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 12:45:05,441 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 237.6ms
2025-10-27 12:45:05,464 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:45:05,468 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:45:05,468 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:45:05,470 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:45:05,471 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:45:05,471 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.3ms
2025-10-27 12:45:05,474 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:45:05,477 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:45:05,477 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:45:05,483 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:45:05,483 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:45:05,484 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.8ms
2025-10-27 12:45:05,486 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:45:05,488 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:45:05,490 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:45:05,490 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:45:05,490 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.7ms
2025-10-27 12:45:05,492 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:45:05,494 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:45:05,495 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:45:05,496 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:45:05,496 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:45:05,497 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.3ms
2025-10-27 12:45:05,498 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:45:05,500 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:45:05,501 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:45:05,505 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:45:05,505 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:45:05,506 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.8ms
2025-10-27 12:45:05,508 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:45:05,510 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:45:05,511 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:45:05,511 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:45:05,512 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.5ms
2025-10-27 12:45:32,385 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 12:45:32,386 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.6ms
2025-10-27 12:45:32,387 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 12:45:32,389 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:45:32,389 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:45:32,389 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 12:45:32,390 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.4ms
2025-10-27 12:46:05,762 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:46:05,764 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 12:46:05,764 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.2ms
2025-10-27 12:46:11,711 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:46:11,712 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 12:46:11,712 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.3ms
2025-10-27 12:46:22,069 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 12:46:22,318 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:46:22,318 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 276
2025-10-27 12:46:22,319 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 276
2025-10-27 12:46:22,319 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 12:46:22,323 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 253.4ms
2025-10-27 12:46:22,337 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:46:22,344 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:46:22,344 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:46:22,346 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:46:22,346 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:46:22,347 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 10.4ms
2025-10-27 12:46:22,347 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:46:22,350 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:46:22,350 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:46:22,354 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:46:22,354 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:46:22,355 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.6ms
2025-10-27 12:46:22,356 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:46:22,359 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:46:22,360 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:46:22,360 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:46:22,361 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.3ms
2025-10-27 12:46:22,361 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 12:46:22,364 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 12:46:22,364 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 12:46:22,365 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 12:46:22,366 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 12:46:22,366 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.0ms
2025-10-27 12:46:22,368 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 12:46:22,369 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 12:46:22,369 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 12:46:22,372 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 12:46:22,372 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 12:46:22,373 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 5.6ms
2025-10-27 12:46:22,373 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 12:46:22,376 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 12:46:22,376 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 12:46:22,377 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 12:46:22,377 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.9ms
2025-10-27 12:46:35,720 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:46:35,722 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:46:35,723 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:46:35,723 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:46:35,724 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:46:35,725 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:46:35,725 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 277
2025-10-27 12:46:35,726 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 277
2025-10-27 12:46:35,726 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:46:35,727 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.1ms
2025-10-27 12:58:37,392 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 12:58:37,393 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 12:58:37,697 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:58:37,708 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:58:37,710 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 12:58:37,710 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:58:37,711 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:58:37,711 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:58:37,712 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 278
2025-10-27 12:58:37,712 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 278
2025-10-27 12:58:37,712 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:58:37,712 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 15.8ms
2025-10-27 12:59:51,823 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 12:59:51,848 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 12:59:51,849 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 12:59:51,849 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 12:59:51,849 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 12:59:51,850 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 12:59:51,851 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 279
2025-10-27 12:59:51,851 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 279
2025-10-27 12:59:51,851 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 12:59:51,851 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 28.4ms
2025-10-27 13:00:07,126 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 13:00:07,127 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-27 13:00:07,128 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:00:07,363 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:00:07,363 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 280
2025-10-27 13:00:07,364 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 280
2025-10-27 13:00:07,364 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:00:07,370 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 241.7ms
2025-10-27 13:00:07,396 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:00:07,397 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.8ms
2025-10-27 13:00:07,397 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:00:07,398 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.9ms
2025-10-27 13:00:07,400 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:00:07,401 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:00:07,401 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:00:07,402 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 2.2ms
2025-10-27 13:00:07,405 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:00:07,405 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:00:07,408 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:00:07,408 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:00:07,409 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 8.2ms
2025-10-27 13:00:07,409 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.9ms
2025-10-27 13:00:07,411 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:00:07,412 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:00:07,413 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.4ms
2025-10-27 13:00:07,413 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:00:07,416 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:00:07,416 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:00:07,421 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:00:07,421 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:00:07,422 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 10.0ms
2025-10-27 13:00:07,423 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.8ms
2025-10-27 13:00:07,426 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:00:07,429 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:00:07,430 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:00:07,430 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:00:07,431 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.3ms
2025-10-27 13:00:07,433 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:00:07,435 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:00:07,435 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:00:07,437 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:00:07,437 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:00:07,437 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.3ms
2025-10-27 13:00:07,439 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:00:07,442 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:00:07,442 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:00:07,447 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:00:07,447 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:00:07,448 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.1ms
2025-10-27 13:00:07,449 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:00:07,452 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:00:07,453 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:00:07,453 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:00:07,453 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.0ms
2025-10-27 13:00:14,927 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:00:14,929 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:00:14,930 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:00:14,931 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:00:14,931 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:00:14,932 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:00:14,933 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 281
2025-10-27 13:00:14,933 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 281
2025-10-27 13:00:14,933 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:00:14,934 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.2ms
2025-10-27 13:00:25,860 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:00:26,080 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:00:26,080 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 282
2025-10-27 13:00:26,081 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 282
2025-10-27 13:00:26,081 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:00:26,081 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 221.2ms
2025-10-27 13:00:26,097 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:00:26,099 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:00:26,100 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:00:26,102 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:00:26,102 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:00:26,103 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.1ms
2025-10-27 13:00:26,104 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:00:26,104 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:00:26,107 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:00:26,109 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:00:26,109 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:00:26,111 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:00:26,111 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:00:26,115 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:00:26,115 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:00:26,116 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 12.9ms
2025-10-27 13:00:26,117 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.8ms
2025-10-27 13:00:26,117 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:00:26,121 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:00:26,121 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:00:26,123 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:00:26,123 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:00:26,124 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.1ms
2025-10-27 13:00:26,126 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:00:26,129 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:00:26,130 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:00:26,130 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:00:26,131 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.6ms
2025-10-27 13:00:26,132 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:00:26,134 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:00:26,134 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:00:26,137 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:00:26,137 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:00:26,138 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.6ms
2025-10-27 13:00:31,581 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 13:00:31,582 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.6ms
2025-10-27 13:00:31,584 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 13:00:31,585 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:00:31,586 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:00:31,586 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 13:00:31,586 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.2ms
2025-10-27 13:00:42,979 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:00:43,196 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:00:43,197 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 283
2025-10-27 13:00:43,197 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 283
2025-10-27 13:00:43,197 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:00:43,198 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 219.2ms
2025-10-27 13:00:43,212 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:00:43,215 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:00:43,216 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:00:43,217 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:00:43,217 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:00:43,218 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.8ms
2025-10-27 13:00:43,220 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:00:43,223 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:00:43,223 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:00:43,228 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:00:43,228 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:00:43,229 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.9ms
2025-10-27 13:00:43,232 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:00:43,234 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:00:43,235 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:00:43,235 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:00:43,236 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.3ms
2025-10-27 13:00:43,238 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:00:43,240 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:00:43,240 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:00:43,242 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:00:43,242 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:00:43,243 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.4ms
2025-10-27 13:00:43,243 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:00:43,245 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:00:43,246 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:00:43,249 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:00:43,249 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:00:43,250 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.5ms
2025-10-27 13:00:43,251 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:00:43,253 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:00:43,254 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:00:43,254 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:00:43,255 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.7ms
2025-10-27 13:00:48,706 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:00:48,708 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:00:48,710 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:00:48,710 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:00:48,710 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:00:48,712 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:00:48,712 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 284
2025-10-27 13:00:48,712 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 284
2025-10-27 13:00:48,713 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:00:48,713 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.1ms
2025-10-27 13:01:39,079 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:01:39,081 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:01:39,105 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:01:39,105 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:01:39,105 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:01:39,107 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:01:39,107 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 285
2025-10-27 13:01:39,107 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 285
2025-10-27 13:01:39,107 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:01:39,108 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 28.6ms
2025-10-27 13:01:58,359 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:01:58,576 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:01:58,577 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 286
2025-10-27 13:01:58,577 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 286
2025-10-27 13:01:58,577 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:01:58,578 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 218.9ms
2025-10-27 13:01:58,597 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:01:58,599 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:01:58,599 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:01:58,601 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:01:58,601 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:01:58,601 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.8ms
2025-10-27 13:01:58,604 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:01:58,606 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:01:58,606 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:01:58,610 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:01:58,611 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:01:58,611 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.6ms
2025-10-27 13:01:58,614 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:01:58,616 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:01:58,617 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:01:58,617 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:01:58,618 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.3ms
2025-10-27 13:01:58,618 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:01:58,620 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:01:58,620 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:01:58,621 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:01:58,621 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:01:58,622 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.7ms
2025-10-27 13:01:58,623 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:01:58,626 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:01:58,626 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:01:58,630 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:01:58,630 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:01:58,631 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:01:58,631 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.2ms
2025-10-27 13:01:58,633 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:01:58,634 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:01:58,634 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:01:58,635 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.9ms
2025-10-27 13:01:59,930 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:01:59,933 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:01:59,934 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:01:59,935 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:01:59,935 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:01:59,937 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:01:59,938 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 287
2025-10-27 13:01:59,938 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 287
2025-10-27 13:01:59,938 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:01:59,939 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 8.7ms
2025-10-27 13:02:20,871 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:02:20,873 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:02:20,875 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:02:20,875 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:02:20,876 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:02:20,877 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:02:20,878 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 288
2025-10-27 13:02:20,878 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 288
2025-10-27 13:02:20,878 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:02:20,879 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.6ms
2025-10-27 13:02:33,676 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:02:33,888 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:02:33,888 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 289
2025-10-27 13:02:33,889 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 289
2025-10-27 13:02:33,889 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:02:33,889 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 213.7ms
2025-10-27 13:02:33,904 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:02:33,907 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:02:33,908 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:02:33,909 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:02:33,909 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:02:33,910 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.4ms
2025-10-27 13:02:33,911 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:02:33,911 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:02:33,915 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:02:33,915 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:02:33,919 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:02:33,920 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:02:33,921 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:02:33,922 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:02:33,923 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:02:33,923 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.3ms
2025-10-27 13:02:33,923 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 12.2ms
2025-10-27 13:02:33,925 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:02:33,928 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:02:33,928 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:02:33,930 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:02:33,930 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:02:33,931 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.2ms
2025-10-27 13:02:33,932 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:02:33,932 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:02:33,935 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:02:33,936 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:02:33,936 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:02:33,938 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:02:33,938 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:02:33,941 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:02:33,941 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:02:33,942 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.4ms
2025-10-27 13:02:33,942 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.3ms
2025-10-27 13:02:42,339 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 13:02:42,340 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:02:42,341 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:02:42,341 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 13:02:42,341 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.2ms
2025-10-27 13:02:55,539 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:02:55,754 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:02:55,755 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 290
2025-10-27 13:02:55,755 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 290
2025-10-27 13:02:55,755 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:02:55,756 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 216.3ms
2025-10-27 13:02:55,769 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:02:55,773 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:02:55,773 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:02:55,775 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:02:55,775 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:02:55,776 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.1ms
2025-10-27 13:02:55,776 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:02:55,779 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:02:55,780 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:02:55,784 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:02:55,785 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:02:55,786 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.2ms
2025-10-27 13:02:55,787 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:02:55,790 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:02:55,791 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:02:55,791 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:02:55,792 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.7ms
2025-10-27 13:02:55,792 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:02:55,795 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:02:55,795 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:02:55,796 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:02:55,797 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:02:55,797 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.0ms
2025-10-27 13:02:55,799 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:02:55,801 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:02:55,801 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:02:55,806 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:02:55,806 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:02:55,807 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.4ms
2025-10-27 13:02:55,807 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:02:55,810 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:02:55,811 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:02:55,811 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:02:55,812 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.3ms
2025-10-27 13:03:08,507 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:03:08,510 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:03:08,511 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:03:08,512 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:03:08,512 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:03:08,514 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:03:08,515 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 291
2025-10-27 13:03:08,516 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 291
2025-10-27 13:03:08,518 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:03:08,519 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 12.0ms
2025-10-27 13:03:30,969 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:03:30,971 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:03:30,979 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:03:30,980 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:03:30,980 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:03:30,992 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:03:30,992 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 292
2025-10-27 13:03:30,993 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 292
2025-10-27 13:03:30,993 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:03:30,994 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 24.3ms
2025-10-27 13:05:51,847 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:05:51,847 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 13:05:52,153 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:05:52,178 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:05:52,179 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:05:52,179 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:05:52,179 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:05:52,180 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:05:52,181 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 293
2025-10-27 13:05:52,181 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 293
2025-10-27 13:05:52,181 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:05:52,181 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 28.2ms
2025-10-27 13:06:45,369 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:06:45,370 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 13:06:45,372 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:06:45,374 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:06:45,375 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 13:06:45,376 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:06:45,376 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:06:45,377 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:06:45,378 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 294
2025-10-27 13:06:45,378 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 294
2025-10-27 13:06:45,378 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:06:45,379 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.6ms
2025-10-27 13:07:03,046 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 13:07:03,046 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.5ms
2025-10-27 13:07:03,351 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:07:03,586 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:07:03,586 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 295
2025-10-27 13:07:03,587 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 295
2025-10-27 13:07:03,587 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:07:03,591 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 240.7ms
2025-10-27 13:07:03,617 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:07:03,618 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.0ms
2025-10-27 13:07:03,619 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:07:03,620 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.5ms
2025-10-27 13:07:03,622 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:07:03,623 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:07:03,626 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:07:03,626 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:07:03,628 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:07:03,628 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:07:03,630 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 7.4ms
2025-10-27 13:07:03,630 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.5ms
2025-10-27 13:07:03,630 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:07:03,632 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:07:03,643 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:07:03,644 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:07:03,649 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:07:03,649 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:07:03,652 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 21.2ms
2025-10-27 13:07:03,652 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 19.7ms
2025-10-27 13:07:03,654 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:07:03,654 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.8ms
2025-10-27 13:07:03,655 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:07:03,658 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:07:03,659 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:07:03,659 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:07:03,659 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:07:03,661 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.9ms
2025-10-27 13:07:03,661 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:07:03,661 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 2.0ms
2025-10-27 13:07:03,664 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:07:03,664 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:07:03,665 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:07:03,666 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:07:03,667 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.5ms
2025-10-27 13:07:03,670 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:07:03,673 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:07:03,673 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:07:03,677 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:07:03,677 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:07:03,678 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:07:03,678 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.6ms
2025-10-27 13:07:03,681 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:07:03,682 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:07:03,682 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:07:03,683 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.8ms
2025-10-27 13:07:08,349 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 13:07:08,350 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:07:08,351 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:07:08,351 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 13:07:08,351 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.5ms
2025-10-27 13:07:25,465 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:07:25,466 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 13:07:25,466 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.6ms
2025-10-27 13:08:31,964 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 13:08:31,964 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-27 13:08:32,270 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:08:32,492 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:08:32,492 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 296
2025-10-27 13:08:32,492 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 296
2025-10-27 13:08:32,493 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:08:32,493 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 223.3ms
2025-10-27 13:08:32,521 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:08:32,522 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.2ms
2025-10-27 13:08:32,523 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:08:32,524 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.5ms
2025-10-27 13:08:32,527 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:08:32,528 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:08:32,531 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:08:32,531 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:08:32,541 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:08:32,541 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:08:32,543 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:08:32,544 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 16.7ms
2025-10-27 13:08:32,545 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 17.0ms
2025-10-27 13:08:32,549 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:08:32,549 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:08:32,554 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:08:32,554 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:08:32,555 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:08:32,556 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 13.6ms
2025-10-27 13:08:32,557 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 2.4ms
2025-10-27 13:08:32,561 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:08:32,561 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:08:32,565 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:08:32,566 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:08:32,566 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:08:32,567 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:08:32,568 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 7.7ms
2025-10-27 13:08:32,569 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 7.4ms
2025-10-27 13:08:32,571 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:08:32,572 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:08:32,574 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:08:32,574 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:08:32,575 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:08:32,576 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 8.7ms
2025-10-27 13:08:32,577 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 2.3ms
2025-10-27 13:08:32,580 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:08:32,583 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:08:32,584 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:08:32,589 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:08:32,589 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:08:32,590 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.0ms
2025-10-27 13:08:32,591 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:08:32,594 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:08:32,595 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:08:32,596 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:08:32,596 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.7ms
2025-10-27 13:09:18,539 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:09:18,540 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 13:09:18,542 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:09:18,545 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:09:18,547 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:09:18,547 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:09:18,547 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:09:18,550 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:09:18,551 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 297
2025-10-27 13:09:18,551 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 297
2025-10-27 13:09:18,551 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:09:18,552 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 9.2ms
2025-10-27 13:14:49,390 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:14:49,390 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 13:14:49,700 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:14:49,710 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:14:49,711 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:14:49,711 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:14:49,712 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:14:49,712 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:14:49,713 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 298
2025-10-27 13:14:49,713 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 298
2025-10-27 13:14:49,713 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:14:49,713 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.0ms
2025-10-27 13:15:47,951 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:15:47,979 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:15:47,980 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 13:15:47,980 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:15:47,981 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:15:47,982 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:15:47,983 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 299
2025-10-27 13:15:47,983 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 299
2025-10-27 13:15:47,983 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:15:47,984 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 32.9ms
2025-10-27 13:24:20,623 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:24:20,625 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 1.6ms
2025-10-27 13:24:20,928 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:24:21,030 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:24:21,033 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-10-27 13:24:21,033 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:24:21,034 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:24:21,037 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:24:21,037 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1130
2025-10-27 13:24:21,038 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1130
2025-10-27 13:24:21,038 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:24:21,038 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 110.3ms
2025-10-27 13:29:23,390 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:29:23,390 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:29:23,391 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 1.1ms
2025-10-27 13:29:23,391 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 13:29:23,707 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:29:23,707 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:29:23,719 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:29:23,721 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:29:23,721 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:29:23,722 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:29:23,723 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:29:23,724 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1131
2025-10-27 13:29:23,724 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1131
2025-10-27 13:29:23,724 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:29:23,726 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:29:23,727 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:29:23,728 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:29:23,728 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:29:23,730 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (c4f1aa8916d44076475a3e25127817f6aa7c85a75a51b444955a3f870a1b7a26). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 13:29:23,730 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 13:29:23,730 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 13:29:23,731 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:29:23,731 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 24.2ms
2025-10-27 13:29:23,731 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 23.8ms
2025-10-27 13:29:23,739 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 13:29:23,740 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.7ms
2025-10-27 13:29:23,742 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:29:23,745 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:29:23,760 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 17.4ms
2025-10-27 13:29:23,810 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:29:23,810 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.7ms
2025-10-27 13:29:23,813 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:29:23,820 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:29:23,820 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:29:23,868 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:29:23,868 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:29:23,869 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 56.0ms
2025-10-27 13:29:23,869 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:29:23,870 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.0ms
2025-10-27 13:29:23,873 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:29:23,876 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:29:23,876 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:29:23,877 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:29:23,877 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:29:23,878 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.7ms
2025-10-27 13:29:29,498 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 13:29:29,499 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.6ms
2025-10-27 13:29:29,500 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 13:29:29,502 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:29:29,502 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:29:29,502 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 13:29:29,502 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.1ms
2025-10-27 13:30:09,379 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:30:09,379 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 13:30:09,683 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:30:09,684 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 13:30:09,685 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.4ms
2025-10-27 13:30:21,069 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:30:21,070 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 13:30:21,071 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:30:21,072 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 13:30:21,072 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 0.9ms
2025-10-27 13:31:15,844 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 13:31:15,845 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.4ms
2025-10-27 13:31:16,162 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:31:16,401 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:31:16,402 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1133
2025-10-27 13:31:16,402 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1133
2025-10-27 13:31:16,402 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:31:16,403 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 240.8ms
2025-10-27 13:31:16,432 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:31:16,433 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.2ms
2025-10-27 13:31:16,433 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:31:16,436 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 2.5ms
2025-10-27 13:31:16,439 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:31:16,440 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:31:16,443 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:31:16,444 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:31:16,446 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:31:16,446 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:31:16,448 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:31:16,448 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:31:16,449 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 10.2ms
2025-10-27 13:31:16,450 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 10.2ms
2025-10-27 13:31:16,453 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:31:16,457 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:31:16,476 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:31:16,476 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:31:16,480 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 31.9ms
2025-10-27 13:31:16,480 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 31.9ms
2025-10-27 13:31:16,483 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:31:16,484 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:31:16,486 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:31:16,489 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:31:16,489 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:31:16,490 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 6.9ms
2025-10-27 13:31:16,491 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 6.8ms
2025-10-27 13:31:16,491 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:31:16,491 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:31:16,494 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:31:16,494 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:31:16,496 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:31:16,496 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:31:16,498 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.9ms
2025-10-27 13:31:16,498 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 7.0ms
2025-10-27 13:31:16,501 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:31:16,503 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:31:16,504 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:31:16,509 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:31:16,509 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:31:16,510 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.3ms
2025-10-27 13:31:16,511 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:31:16,515 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:31:16,521 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:31:16,524 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:31:16,525 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 14.8ms
2025-10-27 13:31:28,635 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:31:28,636 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.8ms
2025-10-27 13:31:28,638 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:31:28,644 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:31:28,646 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:31:28,647 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:31:28,647 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:31:28,648 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:31:28,649 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1134
2025-10-27 13:31:28,649 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1134
2025-10-27 13:31:28,649 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:31:28,650 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 12.5ms
2025-10-27 13:32:29,754 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:32:29,755 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 13:32:30,064 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:32:30,066 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:32:30,067 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:32:30,068 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:32:30,068 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:32:30,069 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:32:30,069 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1135
2025-10-27 13:32:30,069 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1135
2025-10-27 13:32:30,069 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:32:30,070 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.9ms
2025-10-27 13:32:30,075 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 13:32:30,076 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.5ms
2025-10-27 13:32:30,078 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:32:30,079 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:32:30,080 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.0ms
2025-10-27 13:32:54,659 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 13:32:54,660 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.5ms
2025-10-27 13:32:54,662 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:32:54,877 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:32:54,877 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1136
2025-10-27 13:32:54,877 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1136
2025-10-27 13:32:54,878 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:32:54,878 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 216.6ms
2025-10-27 13:32:54,902 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:32:54,903 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.7ms
2025-10-27 13:32:54,907 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:32:54,907 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:32:54,910 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:32:54,910 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:32:54,912 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:32:54,913 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:32:54,913 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 6.5ms
2025-10-27 13:32:54,914 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.2ms
2025-10-27 13:32:54,916 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:32:54,917 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.8ms
2025-10-27 13:32:54,917 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:32:54,920 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:32:54,920 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:32:54,925 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:32:54,925 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:32:54,927 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.1ms
2025-10-27 13:32:54,929 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:32:54,932 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:32:54,933 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:32:54,933 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:32:54,934 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.6ms
2025-10-27 13:32:57,455 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:32:57,456 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 13:32:57,459 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:32:57,464 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:32:57,468 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:32:57,469 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:32:57,469 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:32:57,471 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:32:57,472 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1137
2025-10-27 13:32:57,472 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1137
2025-10-27 13:32:57,472 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:32:57,473 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 14.2ms
2025-10-27 13:32:57,479 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 13:32:57,479 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.5ms
2025-10-27 13:32:57,482 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:32:57,484 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:32:57,485 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.3ms
2025-10-27 13:32:57,510 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:32:57,511 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.8ms
2025-10-27 13:32:57,512 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:32:57,512 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:32:57,513 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.5ms
2025-10-27 13:32:57,513 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.3ms
2025-10-27 13:32:57,515 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:32:57,518 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:32:57,518 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:32:57,519 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:32:57,520 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:32:57,521 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.3ms
2025-10-27 13:32:57,521 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:32:57,522 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:32:57,524 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:32:57,525 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:32:57,530 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:32:57,531 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:32:57,533 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:32:57,534 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:32:57,535 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:32:57,536 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 15.0ms
2025-10-27 13:32:57,536 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 14.5ms
2025-10-27 13:33:11,369 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 13:33:11,371 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:33:11,371 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:33:11,371 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 13:33:11,371 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.4ms
2025-10-27 13:33:36,409 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:33:36,409 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 13:33:36,411 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:33:36,412 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 13:33:36,412 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.3ms
2025-10-27 13:33:47,238 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:33:47,239 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.8ms
2025-10-27 13:33:47,553 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:33:47,554 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 13:33:47,555 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.5ms
2025-10-27 13:33:56,913 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 13:33:56,914 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.4ms
2025-10-27 13:33:56,916 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:33:57,133 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 217.2ms
2025-10-27 13:34:01,011 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 13:34:01,011 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-27 13:34:01,013 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:34:01,236 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:34:01,236 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1138
2025-10-27 13:34:01,237 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1138
2025-10-27 13:34:01,237 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:34:01,237 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 224.2ms
2025-10-27 13:34:01,260 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:34:01,270 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:34:01,271 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 11.1ms
2025-10-27 13:34:01,272 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.9ms
2025-10-27 13:34:01,275 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:34:01,278 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:34:01,279 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:34:01,280 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:34:01,280 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:34:01,281 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:34:01,281 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.5ms
2025-10-27 13:34:01,282 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.9ms
2025-10-27 13:34:01,285 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:34:01,288 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:34:01,288 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:34:01,292 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:34:01,292 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:34:01,293 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.1ms
2025-10-27 13:34:01,294 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:34:01,296 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:34:01,297 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:34:01,298 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:34:01,298 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.9ms
2025-10-27 13:34:17,632 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:34:17,633 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 1.4ms
2025-10-27 13:34:17,637 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:34:17,641 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:34:17,643 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:34:17,643 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:34:17,643 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:34:17,645 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:34:17,646 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1139
2025-10-27 13:34:17,646 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1139
2025-10-27 13:34:17,646 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:34:17,647 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 9.4ms
2025-10-27 13:34:17,656 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 13:34:17,657 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.9ms
2025-10-27 13:34:17,660 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:34:17,662 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:34:17,663 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.1ms
2025-10-27 13:34:17,688 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:34:17,688 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.5ms
2025-10-27 13:34:17,691 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:34:17,691 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:34:17,694 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:34:17,694 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:34:17,696 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:34:17,696 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:34:17,697 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 5.9ms
2025-10-27 13:34:17,697 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.7ms
2025-10-27 13:34:17,699 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:34:17,701 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:34:17,702 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 2.2ms
2025-10-27 13:34:17,705 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:34:17,705 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:34:17,710 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:34:17,710 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:34:17,712 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.4ms
2025-10-27 13:34:17,713 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:34:17,717 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:34:17,719 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:34:17,719 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:34:17,720 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 6.3ms
2025-10-27 13:34:48,433 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:34:48,437 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 3.8ms
2025-10-27 13:34:48,746 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:34:48,749 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:34:48,750 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:34:48,751 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:34:48,751 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:34:48,752 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:34:48,752 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1140
2025-10-27 13:34:48,752 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1140
2025-10-27 13:34:48,753 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:34:48,753 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.2ms
2025-10-27 13:35:02,531 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 13:35:02,532 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.5ms
2025-10-27 13:35:02,533 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:35:02,752 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:35:02,752 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1141
2025-10-27 13:35:02,752 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1141
2025-10-27 13:35:02,753 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:35:02,753 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 219.6ms
2025-10-27 13:35:02,778 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:35:02,779 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.5ms
2025-10-27 13:35:02,781 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:35:02,782 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:35:02,785 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:35:02,785 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:35:02,787 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:35:02,787 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:35:02,787 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 5.9ms
2025-10-27 13:35:02,788 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.5ms
2025-10-27 13:35:02,790 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:35:02,791 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.6ms
2025-10-27 13:35:02,791 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:35:02,795 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:35:02,795 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:35:02,800 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:35:02,800 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:35:02,801 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.5ms
2025-10-27 13:35:02,802 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:35:02,803 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.5ms
2025-10-27 13:35:02,804 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:35:02,807 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:35:02,808 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:35:02,808 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:35:02,809 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.2ms
2025-10-27 13:35:02,809 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:35:02,810 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.9ms
2025-10-27 13:35:02,811 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:35:02,814 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:35:02,814 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:35:02,815 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:35:02,815 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:35:02,816 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.9ms
2025-10-27 13:35:02,816 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:35:02,817 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.9ms
2025-10-27 13:35:02,819 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:35:02,821 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:35:02,821 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:35:02,825 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:35:02,825 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:35:02,825 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.7ms
2025-10-27 13:35:02,827 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:35:02,830 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:35:02,831 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:35:02,832 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:35:02,832 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.3ms
2025-10-27 13:35:04,735 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:35:04,735 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 13:35:04,738 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:35:04,741 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:35:04,744 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:35:04,745 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:35:04,745 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:35:04,747 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:35:04,747 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1142
2025-10-27 13:35:04,748 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1142
2025-10-27 13:35:04,748 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:35:04,749 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 10.6ms
2025-10-27 13:39:47,381 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:39:47,382 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:39:47,382 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 1.0ms
2025-10-27 13:39:47,382 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 13:39:47,689 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:39:47,690 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:39:47,703 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:39:47,705 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:39:47,705 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:39:47,705 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:39:47,707 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:39:47,708 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1143
2025-10-27 13:39:47,708 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1143
2025-10-27 13:39:47,708 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:39:47,710 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:39:47,711 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:39:47,712 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:39:47,713 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:39:47,716 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (73f22760f54680ec57fc2d34c06a49ff2d6a0fb7db6ee353b1cf402fed76968f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 13:39:47,718 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 13:39:47,718 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 13:39:47,719 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:39:47,719 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 29.7ms
2025-10-27 13:39:47,719 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 29.1ms
2025-10-27 13:39:47,725 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 13:39:47,726 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.5ms
2025-10-27 13:39:47,728 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:39:47,731 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:39:47,734 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 5.5ms
2025-10-27 13:39:58,486 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:39:58,486 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 13:39:58,489 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:39:58,492 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:39:58,493 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:39:58,494 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:39:58,494 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:39:58,495 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:39:58,496 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1145
2025-10-27 13:39:58,496 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1145
2025-10-27 13:39:58,496 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:39:58,497 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 8.2ms
2025-10-27 13:39:58,506 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 13:39:58,507 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.6ms
2025-10-27 13:39:58,510 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:39:58,512 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:39:58,514 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.9ms
2025-10-27 13:40:08,591 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 13:40:08,592 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.4ms
2025-10-27 13:40:08,898 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:40:09,116 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:40:09,116 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1146
2025-10-27 13:40:09,116 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1146
2025-10-27 13:40:09,117 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:40:09,117 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 218.8ms
2025-10-27 13:40:09,140 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:40:09,141 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:40:09,141 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.1ms
2025-10-27 13:40:09,142 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.4ms
2025-10-27 13:40:09,145 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:40:09,146 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:40:09,148 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:40:09,149 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:40:09,150 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:40:09,150 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:40:09,151 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 6.0ms
2025-10-27 13:40:09,152 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.6ms
2025-10-27 13:40:09,152 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:40:09,154 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:40:09,155 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:40:09,158 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:40:09,159 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:40:09,159 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.1ms
2025-10-27 13:40:09,161 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:40:09,163 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:40:09,165 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:40:09,165 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:40:09,166 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.8ms
2025-10-27 13:40:17,597 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 13:40:17,598 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.6ms
2025-10-27 13:40:17,599 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 13:40:17,601 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:40:17,601 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:40:17,601 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 13:40:17,602 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.4ms
2025-10-27 13:40:32,272 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:40:32,272 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 13:40:32,273 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.1ms
2025-10-27 13:40:53,130 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:40:53,388 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:40:53,388 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1147
2025-10-27 13:40:53,388 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1147
2025-10-27 13:40:53,389 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:40:53,395 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 264.2ms
2025-10-27 13:40:53,419 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:40:53,422 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:40:53,423 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:40:53,425 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:40:53,425 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:40:53,426 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.8ms
2025-10-27 13:40:53,427 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:40:53,429 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:40:53,430 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:40:53,434 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:40:53,434 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:40:53,435 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.8ms
2025-10-27 13:40:53,437 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:40:53,439 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:40:53,441 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:40:53,441 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:40:53,441 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.5ms
2025-10-27 13:41:03,991 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:41:03,995 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:41:03,996 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:41:03,996 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:41:03,997 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:41:04,001 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:41:04,002 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1148
2025-10-27 13:41:04,002 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1148
2025-10-27 13:41:04,003 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:41:04,003 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 12.1ms
2025-10-27 13:41:04,008 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:41:04,010 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:41:04,011 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.2ms
2025-10-27 13:41:04,026 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:41:04,028 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:41:04,028 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:41:04,029 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:41:04,030 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:41:04,030 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.1ms
2025-10-27 13:41:04,032 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:41:04,034 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:41:04,034 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:41:04,039 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:41:04,039 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:41:04,040 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.3ms
2025-10-27 13:41:04,042 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:41:04,044 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:41:04,045 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:41:04,046 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:41:04,046 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.2ms
2025-10-27 13:44:56,392 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:44:56,393 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:44:56,393 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:44:56,393 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:44:56,394 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 2.3ms
2025-10-27 13:44:56,394 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 1.8ms
2025-10-27 13:44:56,395 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 1.4ms
2025-10-27 13:44:56,409 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:44:56,410 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:44:56,411 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:44:56,411 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:44:56,412 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:44:56,412 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1149
2025-10-27 13:44:56,412 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1149
2025-10-27 13:44:56,413 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:44:56,413 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 20.3ms
2025-10-27 13:44:56,419 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:44:56,421 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:44:56,422 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.0ms
2025-10-27 13:45:46,082 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:45:46,082 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 0.7ms
2025-10-27 13:45:46,084 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:45:46,085 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 0.8ms
2025-10-27 13:45:46,087 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:45:46,087 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 0.6ms
2025-10-27 13:45:46,089 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:45:46,091 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:45:46,092 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:45:46,092 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:45:46,092 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:45:46,099 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:45:46,100 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1150
2025-10-27 13:45:46,100 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1150
2025-10-27 13:45:46,100 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:45:46,100 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 11.4ms
2025-10-27 13:45:46,105 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:45:46,107 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:45:46,108 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.2ms
2025-10-27 13:45:55,066 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:45:55,068 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:45:55,069 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:45:55,069 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:45:55,069 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:45:55,070 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:45:55,070 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1151
2025-10-27 13:45:55,070 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1151
2025-10-27 13:45:55,070 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:45:55,071 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 4.2ms
2025-10-27 13:45:55,074 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:45:55,075 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:45:55,076 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.1ms
2025-10-27 13:45:55,088 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:45:55,090 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:45:55,090 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:45:55,091 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:45:55,091 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:45:55,091 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:45:55,091 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:45:55,092 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:45:55,093 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:45:55,093 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:45:55,096 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:45:55,096 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:45:55,100 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:45:55,100 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:45:55,100 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 12.4ms
2025-10-27 13:45:55,100 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 9.4ms
2025-10-27 13:45:55,101 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.3ms
2025-10-27 13:48:49,688 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:48:49,701 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:48:49,702 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:48:49,703 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:48:49,703 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:48:49,705 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:48:49,706 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1152
2025-10-27 13:48:49,706 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1152
2025-10-27 13:48:49,706 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:48:49,707 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.2ms
2025-10-27 13:50:01,493 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:50:01,728 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:50:01,729 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1153
2025-10-27 13:50:01,729 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1153
2025-10-27 13:50:01,729 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:50:01,730 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 236.4ms
2025-10-27 13:50:01,755 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:50:01,758 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:50:01,759 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:50:01,760 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:50:01,761 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:50:01,761 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.4ms
2025-10-27 13:50:01,762 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:50:01,765 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:50:01,765 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:50:01,770 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:50:01,770 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:50:01,772 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.9ms
2025-10-27 13:50:01,773 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:50:01,776 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:50:01,777 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:50:01,777 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:50:01,778 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.4ms
2025-10-27 13:50:01,779 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:50:01,781 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:50:01,781 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:50:01,783 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:50:01,783 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:50:01,784 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.3ms
2025-10-27 13:50:01,786 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:50:01,789 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:50:01,789 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:50:01,793 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:50:01,793 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:50:01,794 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:50:01,794 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.1ms
2025-10-27 13:50:01,797 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:50:01,798 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:50:01,798 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:50:01,799 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.4ms
2025-10-27 13:50:14,966 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 13:50:14,968 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:50:14,968 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:50:14,968 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 13:50:14,969 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.6ms
2025-10-27 13:50:42,201 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:50:42,202 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 13:50:42,519 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:50:42,520 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 13:50:42,521 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.9ms
2025-10-27 13:50:55,091 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 13:50:55,091 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-27 13:50:55,093 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:50:55,361 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:50:55,361 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1154
2025-10-27 13:50:55,361 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1154
2025-10-27 13:50:55,362 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:50:55,367 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 274.2ms
2025-10-27 13:50:55,393 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:50:55,394 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.1ms
2025-10-27 13:50:55,398 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:50:55,398 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:50:55,402 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:50:55,403 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:50:55,406 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:50:55,406 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:50:55,407 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 9.2ms
2025-10-27 13:50:55,407 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 8.8ms
2025-10-27 13:50:55,413 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:50:55,416 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 2.7ms
2025-10-27 13:50:55,416 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:50:55,419 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:50:55,419 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:50:55,423 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:50:55,423 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:50:55,425 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.1ms
2025-10-27 13:50:55,426 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:50:55,428 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.4ms
2025-10-27 13:50:55,428 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:50:55,431 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:50:55,432 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:50:55,432 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:50:55,434 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.4ms
2025-10-27 13:50:55,435 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:50:55,436 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.8ms
2025-10-27 13:50:55,436 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:50:55,439 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:50:55,439 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:50:55,440 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:50:55,440 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:50:55,441 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.2ms
2025-10-27 13:50:55,443 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:50:55,444 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.6ms
2025-10-27 13:50:55,444 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:50:55,448 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:50:55,448 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:50:55,453 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:50:55,453 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:50:55,454 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.0ms
2025-10-27 13:50:55,456 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:50:55,459 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:50:55,460 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:50:55,460 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:50:55,460 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.0ms
2025-10-27 13:51:01,894 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:51:01,894 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 13:51:01,897 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:51:01,900 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:51:01,902 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:51:01,905 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:51:01,905 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:51:01,907 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:51:01,908 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1155
2025-10-27 13:51:01,908 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1155
2025-10-27 13:51:01,908 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:51:01,909 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 11.7ms
2025-10-27 13:53:41,970 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 13:53:41,970 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-27 13:53:42,286 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:53:42,517 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:53:42,517 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1156
2025-10-27 13:53:42,517 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1156
2025-10-27 13:53:42,518 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:53:42,518 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 232.3ms
2025-10-27 13:53:42,548 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:53:42,550 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 2.3ms
2025-10-27 13:53:42,550 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:53:42,551 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.9ms
2025-10-27 13:53:42,553 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:53:42,554 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.6ms
2025-10-27 13:53:42,555 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:53:42,555 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:53:42,559 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:53:42,559 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:53:42,561 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:53:42,561 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:53:42,562 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:53:42,565 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:53:42,566 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:53:42,572 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:53:42,572 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:53:42,573 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 17.7ms
2025-10-27 13:53:42,573 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 17.7ms
2025-10-27 13:53:42,573 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.4ms
2025-10-27 13:53:42,576 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:53:42,578 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.4ms
2025-10-27 13:53:42,578 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:53:42,579 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:53:42,583 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:53:42,584 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:53:42,585 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:53:42,585 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:53:42,589 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:53:42,589 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:53:42,592 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:53:42,592 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:53:42,593 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 14.3ms
2025-10-27 13:53:42,593 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 14.1ms
2025-10-27 13:53:42,593 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.8ms
2025-10-27 13:53:42,597 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:53:42,600 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:53:42,601 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:53:42,612 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:53:42,616 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:53:42,617 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 20.3ms
2025-10-27 13:53:42,617 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:53:42,622 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:53:42,623 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:53:42,624 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:53:42,625 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 7.3ms
2025-10-27 13:53:44,733 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:53:44,734 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.9ms
2025-10-27 13:53:44,737 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:53:44,740 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:53:44,745 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:53:44,746 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:53:44,746 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:53:44,748 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:53:44,749 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1157
2025-10-27 13:53:44,749 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1157
2025-10-27 13:53:44,750 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:53:44,751 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 14.7ms
2025-10-27 13:54:31,077 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:54:31,078 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:54:31,078 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 1.0ms
2025-10-27 13:54:31,079 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 13:54:31,081 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:54:31,082 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:54:31,085 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:54:31,086 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:54:31,086 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:54:31,087 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:54:31,088 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:54:31,088 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1158
2025-10-27 13:54:31,088 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1158
2025-10-27 13:54:31,088 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:54:31,089 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 8.0ms
2025-10-27 13:54:31,090 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:54:31,091 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:54:31,091 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:54:31,091 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:54:31,092 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (20aef9ec2f819fa38961ca9989e3749693e0ad72aae482c6ed2c968700078391). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 13:54:31,093 - app.services.refresh_token_service - WARNING - [STORE-TOKEN] Token duplicado detectado para usuario 1, posiblemente por doble llamada. Ignorando inserción.
2025-10-27 13:54:31,093 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token duplicado ignorado (doble llamada detectada)
2025-10-27 13:54:31,093 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:54:31,094 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 11.4ms
2025-10-27 13:54:31,099 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 13:54:31,100 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.5ms
2025-10-27 13:54:31,102 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:54:31,104 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:54:31,105 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.2ms
2025-10-27 13:54:34,453 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:54:34,453 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.8ms
2025-10-27 13:54:34,456 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:54:34,458 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:54:34,460 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:54:34,461 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:54:34,461 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:54:34,463 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:54:34,463 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1160
2025-10-27 13:54:34,464 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1160
2025-10-27 13:54:34,464 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:54:34,464 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 8.6ms
2025-10-27 13:54:34,473 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 13:54:34,474 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.5ms
2025-10-27 13:54:34,476 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:54:34,477 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:54:34,478 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.7ms
2025-10-27 13:54:44,051 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 13:54:44,052 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.5ms
2025-10-27 13:54:44,366 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:54:44,588 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:54:44,588 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1161
2025-10-27 13:54:44,588 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1161
2025-10-27 13:54:44,589 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:54:44,589 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 223.3ms
2025-10-27 13:54:44,615 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:54:44,616 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.1ms
2025-10-27 13:54:44,617 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:54:44,618 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.9ms
2025-10-27 13:54:44,620 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:54:44,621 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:54:44,621 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:54:44,633 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:54:44,633 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:54:44,641 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:54:44,641 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:54:44,643 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:54:44,644 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:54:44,645 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:54:44,645 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:54:44,646 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 25.6ms
2025-10-27 13:54:44,646 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 25.3ms
2025-10-27 13:54:44,647 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 25.4ms
2025-10-27 13:54:44,652 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:54:44,655 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:54:44,657 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:54:44,657 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:54:44,658 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.7ms
2025-10-27 13:54:47,140 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 13:54:47,141 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 13:54:47,144 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:54:47,147 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:54:47,151 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:54:47,152 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:54:47,153 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:54:47,155 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:54:47,155 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1162
2025-10-27 13:54:47,156 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1162
2025-10-27 13:54:47,156 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:54:47,157 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 12.5ms
2025-10-27 13:54:47,162 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 13:54:47,162 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.5ms
2025-10-27 13:54:47,165 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:54:47,167 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:54:47,168 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.0ms
2025-10-27 13:54:47,195 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 13:54:47,196 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 13:54:47,196 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 13:54:47,196 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.8ms
2025-10-27 13:54:47,197 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.7ms
2025-10-27 13:54:47,198 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.6ms
2025-10-27 13:54:47,200 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:54:47,203 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:54:47,203 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:54:47,204 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:54:47,205 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:54:47,206 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.1ms
2025-10-27 13:54:47,206 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:54:47,206 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:54:47,208 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:54:47,208 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:54:47,212 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:54:47,213 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:54:47,215 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:54:47,216 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:54:47,216 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:54:47,218 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.0ms
2025-10-27 13:54:47,218 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 12.2ms
2025-10-27 13:54:56,512 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 13:54:56,513 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.4ms
2025-10-27 13:54:56,823 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 13:54:56,824 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:54:56,825 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:54:56,825 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 13:54:56,825 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.0ms
2025-10-27 13:55:18,024 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:55:18,027 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 13:55:18,027 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.9ms
2025-10-27 13:55:28,666 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 13:55:28,929 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:55:28,929 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1163
2025-10-27 13:55:28,930 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1163
2025-10-27 13:55:28,930 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 13:55:28,934 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 267.9ms
2025-10-27 13:55:28,957 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:55:28,960 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:55:28,960 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:55:28,962 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:55:28,963 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:55:28,963 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.5ms
2025-10-27 13:55:28,965 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:55:28,968 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:55:28,968 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:55:28,973 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:55:28,974 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:55:28,974 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.2ms
2025-10-27 13:55:28,977 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:55:28,979 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:55:28,980 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:55:28,980 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:55:28,981 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.4ms
2025-10-27 13:55:46,397 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 13:55:46,399 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 13:55:46,400 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 13:55:46,400 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 13:55:46,400 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 13:55:46,402 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 13:55:46,403 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1164
2025-10-27 13:55:46,403 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1164
2025-10-27 13:55:46,404 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 13:55:46,405 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 7.9ms
2025-10-27 13:55:46,413 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 13:55:46,414 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 13:55:46,416 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.2ms
2025-10-27 13:55:46,434 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 13:55:46,436 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 13:55:46,436 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 13:55:46,438 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 13:55:46,438 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 13:55:46,438 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 13:55:46,441 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 13:55:46,441 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 13:55:46,445 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 13:55:46,445 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 13:55:46,446 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 11.8ms
2025-10-27 13:55:46,446 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.7ms
2025-10-27 13:55:46,448 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 13:55:46,450 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 13:55:46,451 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 13:55:46,451 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 13:55:46,451 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.0ms
2025-10-27 15:18:01,091 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 15:18:01,091 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 15:18:01,406 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 15:18:01,419 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 15:18:01,420 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 15:18:01,420 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 15:18:01,421 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 15:18:01,422 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 15:18:01,422 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1165
2025-10-27 15:18:01,423 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1165
2025-10-27 15:18:01,423 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 15:18:01,423 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.0ms
2025-10-27 15:18:01,428 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 15:18:01,428 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 15:18:01,430 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 15:18:01,431 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 15:18:01,432 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.6ms
2025-10-27 15:18:01,457 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 15:18:01,458 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.8ms
2025-10-27 15:18:01,458 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 15:18:01,459 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.7ms
2025-10-27 15:18:01,460 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 15:18:01,461 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.4ms
2025-10-27 15:18:01,461 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 15:18:01,464 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 15:18:01,464 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 15:18:01,465 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 15:18:01,465 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 15:18:01,466 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.5ms
2025-10-27 15:18:01,468 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 15:18:01,470 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 15:18:01,470 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 15:18:01,475 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 15:18:01,475 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 15:18:01,475 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.0ms
2025-10-27 15:18:01,478 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 15:18:01,480 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 15:18:01,481 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 15:18:01,481 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 15:18:01,482 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.3ms
2025-10-27 15:49:45,894 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 15:49:45,895 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 1.2ms
2025-10-27 15:49:47,016 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 15:49:47,038 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 15:49:47,038 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 15:49:47,038 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 15:49:47,039 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 22.3ms
2025-10-27 15:50:02,894 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 15:50:02,895 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 15:50:02,897 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 15:50:02,899 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 15:50:02,899 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.9ms
2025-10-27 15:50:18,327 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 15:50:18,327 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 15:50:18,328 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 15:50:18,329 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 15:50:18,329 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.9ms
2025-10-27 15:50:18,329 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.6ms
2025-10-27 15:50:22,973 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 15:50:22,974 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 15:50:22,975 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 15:50:22,977 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 15:50:22,979 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.7ms
2025-10-27 15:50:22,979 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 5.6ms
2025-10-27 15:50:35,140 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 15:50:35,140 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-27 15:50:35,142 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 15:50:35,380 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 15:50:35,380 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1166
2025-10-27 15:50:35,380 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1166
2025-10-27 15:50:35,380 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 15:50:35,386 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 244.5ms
2025-10-27 15:50:35,411 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 15:50:35,411 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 15:50:35,411 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.9ms
2025-10-27 15:50:35,412 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.6ms
2025-10-27 15:50:35,414 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 15:50:35,417 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 15:50:35,417 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 15:50:35,418 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 15:50:35,418 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 15:50:35,419 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.9ms
2025-10-27 15:50:35,419 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 15:50:35,419 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 15:50:35,420 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.0ms
2025-10-27 15:50:35,420 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.9ms
2025-10-27 15:50:35,423 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 15:50:35,425 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 15:50:35,426 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 15:50:35,430 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 15:50:35,430 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 15:50:35,431 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.6ms
2025-10-27 15:50:35,431 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 15:50:35,432 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 15:50:35,433 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.2ms
2025-10-27 15:50:35,433 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.1ms
2025-10-27 15:50:35,435 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 15:50:35,437 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 15:50:35,438 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 15:50:35,438 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 15:50:35,438 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.9ms
2025-10-27 15:50:35,441 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 15:50:35,444 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 15:50:35,444 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 15:50:35,445 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 15:50:35,445 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 15:50:35,446 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.2ms
2025-10-27 15:50:35,448 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 15:50:35,450 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 15:50:35,450 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 15:50:35,453 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 15:50:35,453 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 15:50:35,454 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.3ms
2025-10-27 15:50:35,456 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 15:50:35,458 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 15:50:35,459 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 15:50:35,459 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 15:50:35,460 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.1ms
2025-10-27 15:51:10,542 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 15:51:10,543 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 15:51:10,544 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 15:51:10,545 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 15:51:10,546 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 15:51:10,546 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 15:51:10,547 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 15:51:10,547 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1167
2025-10-27 15:51:10,547 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1167
2025-10-27 15:51:10,548 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 15:51:10,549 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 15:51:10,550 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 15:51:10,550 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 15:51:10,550 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 15:51:10,551 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (06a30776d57eba163f2f107df4166ebd733f641e9dc1d608a0cd67d5e263495f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 15:51:10,551 - app.services.refresh_token_service - CRITICAL - [SECURITY ALERT - TOKEN REUSE] Colisión de Refresh Token (hash) detectada para usuario 1. Revocando todas las sesiones del usuario para mitigar el riesgo.
2025-10-27 15:51:10,553 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 1
2025-10-27 15:51:10,554 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 1 tokens revocados para usuario 1
2025-10-27 15:51:10,554 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (06a30776d57eba163f2f107df4166ebd733f641e9dc1d608a0cd67d5e263495f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 87, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (06a30776d57eba163f2f107df4166ebd733f641e9dc1d608a0cd67d5e263495f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 113, in store_refresh_token
    raise AuthenticationError(
    ...<2 lines>...
    )
app.core.exceptions.AuthenticationError: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
2025-10-27 15:51:10,569 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 15:51:10,569 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 15:51:10,569 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 27.3ms
2025-10-27 15:51:10,570 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 27.0ms
2025-10-27 15:51:10,888 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 15:51:10,888 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.4ms
2025-10-27 15:51:10,890 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 15:51:10,891 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 15:51:10,892 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.0ms
2025-10-27 15:51:10,908 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 15:51:10,911 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 15:51:10,911 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 15:51:10,912 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 15:51:10,912 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 15:51:10,912 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 15:51:10,913 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 15:51:10,914 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 15:51:10,914 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 15:51:10,917 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 15:51:10,917 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 15:51:10,918 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 15:51:10,919 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 15:51:10,919 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 15:51:10,920 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 11.9ms
2025-10-27 15:51:10,920 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.5ms
2025-10-27 15:51:10,920 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 7.4ms
2025-10-27 15:51:10,922 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 15:51:10,925 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 15:51:10,925 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 15:51:10,926 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 15:51:10,926 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 15:51:10,927 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.8ms
2025-10-27 15:51:10,927 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 15:51:10,928 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 15:51:10,929 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 15:51:10,930 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 15:51:10,930 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 15:51:10,931 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 15:51:10,931 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 15:51:10,935 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 15:51:10,935 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 15:51:10,936 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 8.7ms
2025-10-27 15:51:10,936 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.6ms
2025-10-27 15:55:09,682 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 15:55:09,692 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 15:55:09,693 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 15:55:09,693 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 15:55:09,693 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 15:55:09,695 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 15:55:09,695 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1169
2025-10-27 15:55:09,695 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1169
2025-10-27 15:55:09,695 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 15:55:09,696 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.9ms
2025-10-27 15:55:09,700 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 15:55:09,702 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 15:55:09,703 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.4ms
2025-10-27 15:55:09,728 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 15:55:09,730 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 15:55:09,730 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 15:55:09,731 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 15:55:09,731 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 15:55:09,732 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.3ms
2025-10-27 15:55:09,734 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 15:55:09,736 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 15:55:09,736 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 15:55:09,740 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 15:55:09,740 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 15:55:09,740 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.8ms
2025-10-27 15:55:09,742 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 15:55:09,744 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 15:55:09,745 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 15:55:09,745 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 15:55:09,745 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.4ms
2025-10-27 15:55:17,994 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 15:55:17,996 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 15:55:17,997 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 15:55:17,998 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 15:55:17,998 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 15:55:17,999 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 15:55:18,000 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1170
2025-10-27 15:55:18,000 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1170
2025-10-27 15:55:18,000 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 15:55:18,001 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.7ms
2025-10-27 15:55:18,006 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 15:55:18,009 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 15:55:18,010 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.9ms
2025-10-27 15:55:18,028 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 15:55:18,031 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 15:55:18,031 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 15:55:18,032 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 15:55:18,032 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 15:55:18,033 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 15:55:18,033 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 15:55:18,036 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 15:55:18,036 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 15:55:18,039 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 15:55:18,039 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 15:55:18,041 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 15:55:18,043 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 15:55:18,043 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 15:55:18,043 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 15.6ms
2025-10-27 15:55:18,044 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.1ms
2025-10-27 15:55:18,044 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 11.0ms
2025-10-27 16:05:45,390 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 16:05:45,390 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.5ms
2025-10-27 16:05:45,702 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:05:45,728 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:05:45,729 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:05:45,729 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:05:45,729 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:05:45,731 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:05:45,731 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1171
2025-10-27 16:05:45,731 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1171
2025-10-27 16:05:45,731 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:05:45,732 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 30.1ms
2025-10-27 16:05:45,736 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-10-27 16:05:45,736 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 0.6ms
2025-10-27 16:05:45,739 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 16:05:45,740 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 16:05:45,745 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 6.2ms
2025-10-27 16:05:45,760 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 16:05:45,761 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 16:05:45,761 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.0ms
2025-10-27 16:05:45,761 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.5ms
2025-10-27 16:05:45,763 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 16:05:45,764 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 0.5ms
2025-10-27 16:05:45,764 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:05:45,766 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:05:45,766 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:05:45,767 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:05:45,767 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:05:45,768 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.8ms
2025-10-27 16:05:45,770 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:05:45,773 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:05:45,773 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:05:45,777 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:05:45,777 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:05:45,778 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.0ms
2025-10-27 16:05:45,779 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:05:45,781 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:05:45,782 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:05:45,783 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:05:45,783 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.5ms
2025-10-27 16:05:53,880 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:05:53,882 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:05:53,883 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:05:53,883 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:05:53,884 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:05:53,885 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:05:53,885 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1172
2025-10-27 16:05:53,885 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1172
2025-10-27 16:05:53,886 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:05:53,886 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.4ms
2025-10-27 16:05:53,891 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 16:05:53,893 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 16:05:53,895 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 3.7ms
2025-10-27 16:05:53,914 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:05:53,917 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:05:53,917 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:05:53,918 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:05:53,918 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:05:53,918 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:05:53,919 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:05:53,921 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:05:53,921 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:05:53,924 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:05:53,924 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:05:53,925 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:05:53,926 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:05:53,926 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:05:53,927 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 12.9ms
2025-10-27 16:05:53,927 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.6ms
2025-10-27 16:05:53,927 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 8.5ms
2025-10-27 16:07:13,570 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:07:13,570 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:07:13,580 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:07:13,581 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:07:13,581 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:07:13,582 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:07:13,583 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:07:13,584 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1173
2025-10-27 16:07:13,584 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1173
2025-10-27 16:07:13,584 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:07:13,585 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:07:13,586 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:07:13,586 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:07:13,586 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:07:13,587 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (3550e04478d704d2eed0f2c968f6928a1fcaaf4ea4cf17cc85d46f3dcbff1493). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 16:07:13,588 - app.services.refresh_token_service - CRITICAL - [SECURITY ALERT - TOKEN REUSE] Colisión de Refresh Token (hash) detectada para usuario 1. Revocando todas las sesiones del usuario para mitigar el riesgo.
2025-10-27 16:07:13,589 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 1
2025-10-27 16:07:13,589 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 1 tokens revocados para usuario 1
2025-10-27 16:07:13,589 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (3550e04478d704d2eed0f2c968f6928a1fcaaf4ea4cf17cc85d46f3dcbff1493). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 87, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (3550e04478d704d2eed0f2c968f6928a1fcaaf4ea4cf17cc85d46f3dcbff1493). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 113, in store_refresh_token
    raise AuthenticationError(
    ...<2 lines>...
    )
app.core.exceptions.AuthenticationError: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
2025-10-27 16:07:13,591 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 16:07:13,591 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:07:13,592 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 22.1ms
2025-10-27 16:07:13,592 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 21.8ms
2025-10-27 16:07:13,595 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 16:07:13,597 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 16:07:13,598 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.0ms
2025-10-27 16:07:13,616 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:07:13,619 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:07:13,619 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:07:13,621 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:07:13,621 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:07:13,621 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:07:13,624 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:07:13,624 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:07:13,628 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:07:13,628 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:07:13,629 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 12.3ms
2025-10-27 16:07:13,629 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.4ms
2025-10-27 16:07:13,632 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:07:13,634 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:07:13,636 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:07:13,636 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:07:13,636 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:07:13,637 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.2ms
2025-10-27 16:07:13,639 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:07:13,639 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:07:13,641 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:07:13,641 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:07:13,642 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.8ms
2025-10-27 16:07:13,644 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:07:13,646 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:07:13,646 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:07:13,650 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:07:13,651 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:07:13,652 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:07:13,652 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.3ms
2025-10-27 16:07:13,654 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:07:13,656 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:07:13,656 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:07:13,657 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.4ms
2025-10-27 16:07:24,218 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:07:24,219 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:07:24,221 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:07:24,223 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:07:24,223 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:07:24,223 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:07:24,225 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:07:24,226 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1175
2025-10-27 16:07:24,226 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1175
2025-10-27 16:07:24,227 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:07:24,229 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:07:24,230 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:07:24,230 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:07:24,230 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:07:24,232 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (8a7d3d9fe757ed81b7e78f4cadca963475db1aca1c9af42693fd4bda9ede02d9). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 16:07:24,233 - app.services.refresh_token_service - CRITICAL - [SECURITY ALERT - TOKEN REUSE] Colisión de Refresh Token (hash) detectada para usuario 1. Revocando todas las sesiones del usuario para mitigar el riesgo.
2025-10-27 16:07:24,234 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 1
2025-10-27 16:07:24,235 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 1 tokens revocados para usuario 1
2025-10-27 16:07:24,235 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (8a7d3d9fe757ed81b7e78f4cadca963475db1aca1c9af42693fd4bda9ede02d9). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 87, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (8a7d3d9fe757ed81b7e78f4cadca963475db1aca1c9af42693fd4bda9ede02d9). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 113, in store_refresh_token
    raise AuthenticationError(
    ...<2 lines>...
    )
app.core.exceptions.AuthenticationError: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
2025-10-27 16:07:24,236 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 16:07:24,236 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:07:24,237 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.6ms
2025-10-27 16:07:24,237 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.2ms
2025-10-27 16:07:24,242 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 16:07:24,243 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 16:07:24,245 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.8ms
2025-10-27 16:07:24,260 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:07:24,263 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:07:24,263 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:07:24,264 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:07:24,265 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:07:24,265 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:07:24,266 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:07:24,268 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:07:24,269 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:07:24,272 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:07:24,272 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:07:24,274 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:07:24,275 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:07:24,275 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:07:24,275 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 15.3ms
2025-10-27 16:07:24,276 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.3ms
2025-10-27 16:07:24,276 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.1ms
2025-10-27 16:07:24,278 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:07:24,280 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:07:24,281 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:07:24,282 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:07:24,282 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:07:24,283 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.7ms
2025-10-27 16:07:24,284 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:07:24,286 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:07:24,286 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:07:24,291 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:07:24,291 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:07:24,292 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:07:24,294 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:07:24,295 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:07:24,295 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:07:24,296 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 12.2ms
2025-10-27 16:07:24,296 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.6ms
2025-10-27 16:07:29,103 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:07:29,104 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:07:29,106 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:07:29,107 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:07:29,107 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:07:29,107 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:07:29,109 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:07:29,110 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1177
2025-10-27 16:07:29,110 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1177
2025-10-27 16:07:29,110 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:07:29,112 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:07:29,114 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:07:29,114 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:07:29,115 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:07:29,117 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (afaf16e489bc18267783fb8a23794e776fb9860773ef29dfa8dc798a0f3f8288). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 16:07:29,117 - app.services.refresh_token_service - CRITICAL - [SECURITY ALERT - TOKEN REUSE] Colisión de Refresh Token (hash) detectada para usuario 1. Revocando todas las sesiones del usuario para mitigar el riesgo.
2025-10-27 16:07:29,118 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 1
2025-10-27 16:07:29,119 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 1 tokens revocados para usuario 1
2025-10-27 16:07:29,119 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (afaf16e489bc18267783fb8a23794e776fb9860773ef29dfa8dc798a0f3f8288). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 87, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (afaf16e489bc18267783fb8a23794e776fb9860773ef29dfa8dc798a0f3f8288). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 113, in store_refresh_token
    raise AuthenticationError(
    ...<2 lines>...
    )
app.core.exceptions.AuthenticationError: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
2025-10-27 16:07:29,121 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 16:07:29,121 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:07:29,121 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 18.4ms
2025-10-27 16:07:29,122 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.8ms
2025-10-27 16:07:29,127 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 16:07:29,128 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 16:07:29,129 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.6ms
2025-10-27 16:07:29,145 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:07:29,147 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:07:29,147 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:07:29,148 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:07:29,149 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:07:29,149 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:07:29,149 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:07:29,152 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:07:29,152 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:07:29,156 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:07:29,157 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:07:29,159 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:07:29,159 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:07:29,159 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:07:29,160 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 15.0ms
2025-10-27 16:07:29,160 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.0ms
2025-10-27 16:07:29,160 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.9ms
2025-10-27 16:07:29,162 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:07:29,165 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:07:29,165 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:07:29,166 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:07:29,166 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:07:29,167 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:07:29,167 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.0ms
2025-10-27 16:07:29,170 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:07:29,170 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:07:29,174 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:07:29,174 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:07:29,175 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:07:29,177 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:07:29,177 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:07:29,178 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:07:29,178 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 11.5ms
2025-10-27 16:07:29,179 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.7ms
2025-10-27 16:07:57,865 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 16:07:57,865 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.4ms
2025-10-27 16:07:58,168 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 16:07:58,169 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:07:58,170 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:07:58,170 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 16:07:58,170 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 1.8ms
2025-10-27 16:08:27,675 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:08:27,676 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:08:27,678 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 16:08:27,678 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 16:08:27,678 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.1ms
2025-10-27 16:08:27,678 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.4ms
2025-10-27 16:08:33,797 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:08:33,798 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 16:08:33,799 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.8ms
2025-10-27 16:08:33,801 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:08:33,802 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 16:08:33,803 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.6ms
2025-10-27 16:08:43,671 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 16:08:43,672 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.5ms
2025-10-27 16:08:43,673 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 16:08:43,932 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:08:43,933 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1179
2025-10-27 16:08:43,933 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1179
2025-10-27 16:08:43,933 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 16:08:43,938 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 264.5ms
2025-10-27 16:08:43,965 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:08:43,968 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:08:43,969 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:08:43,970 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:08:43,971 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:08:43,971 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.5ms
2025-10-27 16:08:43,974 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:08:43,977 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:08:43,977 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:08:43,981 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:08:43,982 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:08:43,982 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.7ms
2025-10-27 16:08:43,984 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:08:43,986 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:08:43,987 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:08:43,987 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:08:43,988 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.8ms
2025-10-27 16:08:43,990 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:08:43,993 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:08:43,993 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:08:43,994 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:08:43,994 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:08:43,995 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.6ms
2025-10-27 16:08:43,996 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:08:43,999 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:08:43,999 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:08:44,002 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:08:44,002 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:08:44,003 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.8ms
2025-10-27 16:08:44,005 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:08:44,008 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:08:44,009 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:08:44,009 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:08:44,009 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.5ms
2025-10-27 16:09:11,767 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:09:11,769 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:09:11,772 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:09:11,773 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:09:11,773 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:09:11,774 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:09:11,777 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:09:11,778 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1180
2025-10-27 16:09:11,778 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1180
2025-10-27 16:09:11,778 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:09:11,779 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 11.5ms
2025-10-27 16:09:11,781 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:09:11,782 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:09:11,783 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:09:11,783 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:09:11,784 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (4fa1296d59c85b70f20a65ceabf868928171643f0c90142534bc9722335434ed). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 16:09:11,785 - app.services.refresh_token_service - CRITICAL - [SECURITY ALERT - TOKEN REUSE] Colisión de Refresh Token (hash) detectada para usuario 1. Revocando todas las sesiones del usuario para mitigar el riesgo.
2025-10-27 16:09:11,787 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 1
2025-10-27 16:09:11,787 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 1 tokens revocados para usuario 1
2025-10-27 16:09:11,787 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (4fa1296d59c85b70f20a65ceabf868928171643f0c90142534bc9722335434ed). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 87, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (4fa1296d59c85b70f20a65ceabf868928171643f0c90142534bc9722335434ed). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 113, in store_refresh_token
    raise AuthenticationError(
    ...<2 lines>...
    )
app.core.exceptions.AuthenticationError: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
2025-10-27 16:09:11,789 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 16:09:11,790 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:09:11,791 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 22.0ms
2025-10-27 16:09:11,794 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 16:09:11,796 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 16:09:11,797 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.3ms
2025-10-27 16:09:11,814 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:09:11,817 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:09:11,817 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:09:11,818 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:09:11,818 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:09:11,819 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:09:11,819 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:09:11,821 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:09:11,821 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:09:11,822 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:09:11,823 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:09:11,823 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:09:11,826 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:09:11,826 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:09:11,827 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 12.9ms
2025-10-27 16:09:11,827 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 7.9ms
2025-10-27 16:09:11,827 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.7ms
2025-10-27 16:09:11,829 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:09:11,832 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:09:11,832 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:09:11,834 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:09:11,834 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:09:11,835 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:09:11,837 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:09:11,837 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:09:11,838 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:09:11,838 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:09:11,838 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 8.9ms
2025-10-27 16:09:11,840 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:09:11,840 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:09:11,844 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:09:11,844 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:09:11,845 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.0ms
2025-10-27 16:09:11,846 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.6ms
2025-10-27 16:12:00,393 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:12:00,393 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:12:00,404 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:12:00,405 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:12:00,405 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:12:00,405 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:12:00,407 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:12:00,407 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1182
2025-10-27 16:12:00,407 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1182
2025-10-27 16:12:00,408 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:12:00,409 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:12:00,411 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:12:00,411 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:12:00,411 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:12:00,412 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (24f506399a6f3681b1fa46b1b49d067696db18a4be0bd59ed88d14d1f2d6c15f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 16:12:00,413 - app.services.refresh_token_service - CRITICAL - [SECURITY ALERT - TOKEN REUSE] Colisión de Refresh Token (hash) detectada para usuario 1. Revocando todas las sesiones del usuario para mitigar el riesgo.
2025-10-27 16:12:00,414 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 1
2025-10-27 16:12:00,415 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 1 tokens revocados para usuario 1
2025-10-27 16:12:00,415 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (24f506399a6f3681b1fa46b1b49d067696db18a4be0bd59ed88d14d1f2d6c15f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 87, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (24f506399a6f3681b1fa46b1b49d067696db18a4be0bd59ed88d14d1f2d6c15f). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 113, in store_refresh_token
    raise AuthenticationError(
    ...<2 lines>...
    )
app.core.exceptions.AuthenticationError: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
2025-10-27 16:12:00,416 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 16:12:00,416 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:12:00,417 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 23.9ms
2025-10-27 16:12:00,417 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 23.6ms
2025-10-27 16:12:00,421 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 16:12:00,423 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 16:12:00,424 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.9ms
2025-10-27 16:12:00,444 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:12:00,446 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:12:00,447 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:12:00,448 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:12:00,448 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:12:00,448 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:12:00,450 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:12:00,450 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:12:00,453 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:12:00,454 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:12:00,454 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 10.0ms
2025-10-27 16:12:00,454 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.0ms
2025-10-27 16:12:00,456 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:12:00,460 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:12:00,461 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:12:00,462 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:12:00,463 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 6.3ms
2025-10-27 16:12:00,463 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:12:00,465 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:12:00,466 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:12:00,467 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:12:00,467 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:12:00,468 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.4ms
2025-10-27 16:12:00,470 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:12:00,472 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:12:00,472 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:12:00,478 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:12:00,478 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:12:00,479 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.1ms
2025-10-27 16:12:00,479 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:12:00,481 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:12:00,482 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:12:00,482 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:12:00,483 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.1ms
2025-10-27 16:12:05,406 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 16:12:05,407 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:12:05,407 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:12:05,408 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 16:12:05,408 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.0ms
2025-10-27 16:12:29,438 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:12:29,439 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:12:29,441 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 16:12:29,441 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 16:12:29,441 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.8ms
2025-10-27 16:12:29,441 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.6ms
2025-10-27 16:12:34,322 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:12:34,323 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:12:34,324 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 16:12:34,325 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 16:12:34,325 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 3.2ms
2025-10-27 16:12:34,325 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.3ms
2025-10-27 16:12:43,198 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 16:12:43,461 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:12:43,461 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1184
2025-10-27 16:12:43,461 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1184
2025-10-27 16:12:43,462 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 16:12:43,467 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 269.3ms
2025-10-27 16:12:43,491 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:12:43,496 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:12:43,500 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:12:43,503 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:12:43,503 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:12:43,504 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 13.2ms
2025-10-27 16:12:43,507 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:12:43,510 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:12:43,510 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:12:43,515 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:12:43,515 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:12:43,516 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.4ms
2025-10-27 16:12:43,519 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:12:43,522 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:12:43,524 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:12:43,524 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:12:43,524 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.5ms
2025-10-27 16:12:43,527 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:12:43,530 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:12:43,530 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:12:43,531 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:12:43,531 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:12:43,532 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.8ms
2025-10-27 16:12:43,534 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:12:43,536 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:12:43,537 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:12:43,540 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:12:43,541 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:12:43,541 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.4ms
2025-10-27 16:12:43,543 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:12:43,545 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:12:43,546 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:12:43,546 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:12:43,546 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.2ms
2025-10-27 16:12:53,760 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:12:53,761 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:12:53,763 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:12:53,764 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:12:53,764 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:12:53,764 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:12:53,765 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:12:53,766 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1185
2025-10-27 16:12:53,766 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1185
2025-10-27 16:12:53,766 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:12:53,768 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:12:53,769 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:12:53,770 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:12:53,770 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:12:53,772 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (2f47557ea3184200766a9921f2d9c9f8adcf16b372ad47776fc4ba4a17b9ee3a). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-10-27 16:12:53,772 - app.services.refresh_token_service - CRITICAL - [SECURITY ALERT - TOKEN REUSE] Colisión de Refresh Token (hash) detectada para usuario 1. Revocando todas las sesiones del usuario para mitigar el riesgo.
2025-10-27 16:12:53,774 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 1
2025-10-27 16:12:53,774 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 1 tokens revocados para usuario 1
2025-10-27 16:12:53,774 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
Traceback (most recent call last):
  File "D:\base_fastapi\app\db\queries.py", line 65, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (2f47557ea3184200766a9921f2d9c9f8adcf16b372ad47776fc4ba4a17b9ee3a). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 87, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_fastapi\app\db\queries.py", line 86, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB133EA7D3EC'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (2f47557ea3184200766a9921f2d9c9f8adcf16b372ad47776fc4ba4a17b9ee3a). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_fastapi\app\services\refresh_token_service.py", line 113, in store_refresh_token
    raise AuthenticationError(
    ...<2 lines>...
    )
app.core.exceptions.AuthenticationError: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
2025-10-27 16:12:53,777 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-10-27 16:12:53,777 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:12:53,777 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.2ms
2025-10-27 16:12:53,778 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 16.9ms
2025-10-27 16:12:53,783 - app.main - INFO - 127.0.0.1 -> GET /api/v1/auth/me/
2025-10-27 16:12:53,784 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin
2025-10-27 16:12:53,785 - app.main - INFO - 127.0.0.1 <- GET /api/v1/auth/me/ 2.3ms
2025-10-27 16:12:53,802 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:12:53,804 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:12:53,804 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:12:53,805 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:12:53,805 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:12:53,805 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:12:53,806 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:12:53,807 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:12:53,807 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:12:53,808 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:12:53,810 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:12:53,811 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:12:53,815 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:12:53,815 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:12:53,815 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 13.0ms
2025-10-27 16:12:53,815 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.0ms
2025-10-27 16:12:53,816 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.9ms
2025-10-27 16:12:53,817 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:12:53,819 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:12:53,819 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:12:53,820 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:12:53,821 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:12:53,821 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 3.9ms
2025-10-27 16:12:53,822 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:12:53,822 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:12:53,824 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:12:53,824 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:12:53,825 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:12:53,827 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:12:53,827 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:12:53,831 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:12:53,831 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:12:53,832 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 10.4ms
2025-10-27 16:12:53,832 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.4ms
2025-10-27 16:21:39,389 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 16:21:39,389 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 16:21:39,692 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:21:39,704 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:21:39,705 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:21:39,705 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:21:39,705 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:21:39,706 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:21:39,707 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1187
2025-10-27 16:21:39,707 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1187
2025-10-27 16:21:39,707 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:21:39,707 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 15.0ms
2025-10-27 16:22:10,376 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:22:10,378 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:22:10,379 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:22:10,380 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:22:10,380 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:22:10,382 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:22:10,382 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1188
2025-10-27 16:22:10,382 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1188
2025-10-27 16:22:10,382 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:22:10,383 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.9ms
2025-10-27 16:22:17,225 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:22:17,227 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:22:17,228 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:22:17,228 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:22:17,228 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:22:17,229 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:22:17,229 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1189
2025-10-27 16:22:17,229 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1189
2025-10-27 16:22:17,230 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:22:17,230 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 4.7ms
2025-10-27 16:22:28,807 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:22:28,812 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:22:28,814 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:22:28,814 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:22:28,815 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:22:28,817 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:22:28,818 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1190
2025-10-27 16:22:28,818 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1190
2025-10-27 16:22:28,818 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:22:28,818 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 11.0ms
2025-10-27 16:27:16,974 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 16:27:16,975 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 16:27:17,292 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:27:17,301 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:27:17,302 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:27:17,302 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:27:17,303 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:27:17,305 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:27:17,305 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1191
2025-10-27 16:27:17,306 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1191
2025-10-27 16:27:17,306 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:27:17,306 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 14.0ms
2025-10-27 16:28:09,455 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 16:28:09,456 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 16:28:09,459 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:28:09,463 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:28:09,467 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:28:09,470 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:28:09,471 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:28:09,472 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:28:09,473 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1192
2025-10-27 16:28:09,473 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1192
2025-10-27 16:28:09,473 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:28:09,474 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 14.8ms
2025-10-27 16:30:29,323 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 16:30:29,324 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.4ms
2025-10-27 16:30:29,638 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:30:29,651 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:30:29,652 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:30:29,653 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:30:29,653 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:30:29,655 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:30:29,655 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1193
2025-10-27 16:30:29,655 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1193
2025-10-27 16:30:29,655 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:30:29,656 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 17.7ms
2025-10-27 16:30:36,522 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 16:30:36,523 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.8ms
2025-10-27 16:30:36,525 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:30:36,529 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:30:36,534 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:30:36,536 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:30:36,536 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:30:36,538 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:30:36,539 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1194
2025-10-27 16:30:36,539 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1194
2025-10-27 16:30:36,539 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:30:36,540 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 14.8ms
2025-10-27 16:30:43,669 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 16:30:43,670 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.5ms
2025-10-27 16:30:43,984 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 16:30:44,209 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:30:44,210 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1195
2025-10-27 16:30:44,210 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1195
2025-10-27 16:30:44,210 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 16:30:44,211 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 226.7ms
2025-10-27 16:30:44,234 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 16:30:44,235 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 0.7ms
2025-10-27 16:30:44,235 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 16:30:44,237 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.3ms
2025-10-27 16:30:44,239 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 16:30:44,240 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:30:44,242 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:30:44,243 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:30:44,244 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:30:44,244 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:30:44,245 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 16:30:44,245 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:30:44,245 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 6.6ms
2025-10-27 16:30:44,247 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:30:44,248 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:30:44,251 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:30:44,252 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:30:44,252 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 12.4ms
2025-10-27 16:30:44,253 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 8.4ms
2025-10-27 16:30:44,253 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.3ms
2025-10-27 16:30:44,256 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 16:30:44,258 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.4ms
2025-10-27 16:30:44,258 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 16:30:44,259 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:30:44,261 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:30:44,262 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:30:44,262 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:30:44,262 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:30:44,265 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:30:44,265 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:30:44,267 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:30:44,267 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:30:44,267 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 9.0ms
2025-10-27 16:30:44,268 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 8.9ms
2025-10-27 16:30:44,268 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.6ms
2025-10-27 16:30:44,271 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:30:44,274 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:30:44,275 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:30:44,279 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:30:44,279 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:30:44,280 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:30:44,280 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.3ms
2025-10-27 16:30:44,283 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:30:44,300 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:30:44,301 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:30:44,302 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 22.3ms
2025-10-27 16:30:57,125 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 16:30:57,125 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.4ms
2025-10-27 16:30:57,126 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 16:30:57,128 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:30:57,129 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:30:57,129 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 16:30:57,129 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.9ms
2025-10-27 16:31:30,068 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:31:30,070 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 16:31:30,070 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.9ms
2025-10-27 16:31:37,693 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:31:37,694 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 16:31:37,695 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 1.5ms
2025-10-27 16:31:47,664 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 16:31:47,918 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:31:47,918 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1196
2025-10-27 16:31:47,918 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1196
2025-10-27 16:31:47,919 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 16:31:47,923 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 258.5ms
2025-10-27 16:31:47,945 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:31:47,948 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:31:47,948 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:31:47,950 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:31:47,950 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:31:47,951 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:31:47,951 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.1ms
2025-10-27 16:31:47,954 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:31:47,954 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:31:47,957 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:31:47,957 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:31:47,958 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.5ms
2025-10-27 16:31:47,960 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:31:47,962 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:31:47,963 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:31:47,963 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:31:47,964 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.8ms
2025-10-27 16:31:47,964 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:31:47,967 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:31:47,967 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:31:47,968 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:31:47,968 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:31:47,969 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.8ms
2025-10-27 16:31:47,970 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:31:47,972 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:31:47,972 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:31:47,975 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:31:47,975 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:31:47,976 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.1ms
2025-10-27 16:31:47,976 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:31:47,977 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:31:47,978 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:31:47,978 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:31:47,979 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.0ms
2025-10-27 16:32:12,877 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:32:12,880 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:32:12,881 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:32:12,882 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:32:12,882 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:32:12,884 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:32:12,885 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1197
2025-10-27 16:32:12,885 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1197
2025-10-27 16:32:12,885 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:32:12,886 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 8.8ms
2025-10-27 16:43:53,919 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 16:43:53,920 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-27 16:43:54,224 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 16:43:54,450 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:43:54,451 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1198
2025-10-27 16:43:54,451 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1198
2025-10-27 16:43:54,451 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 16:43:54,452 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 228.1ms
2025-10-27 16:43:54,475 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 16:43:54,476 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.1ms
2025-10-27 16:43:54,477 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 16:43:54,478 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.2ms
2025-10-27 16:43:54,479 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 16:43:54,481 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:43:54,481 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.8ms
2025-10-27 16:43:54,484 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:43:54,484 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:43:54,486 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:43:54,486 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:43:54,486 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 16:43:54,488 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.0ms
2025-10-27 16:43:54,488 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.9ms
2025-10-27 16:43:54,491 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:43:54,493 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:43:54,493 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:43:54,497 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:43:54,497 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:43:54,499 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.0ms
2025-10-27 16:43:54,499 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 16:43:54,499 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 16:43:54,500 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:43:54,502 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:43:54,503 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:43:54,503 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:43:54,504 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 5.0ms
2025-10-27 16:43:54,504 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 5.0ms
2025-10-27 16:43:54,505 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.1ms
2025-10-27 16:43:54,508 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:43:54,510 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:43:54,510 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:43:54,511 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:43:54,511 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:43:54,512 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.5ms
2025-10-27 16:43:54,513 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:43:54,515 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:43:54,515 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:43:54,518 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:43:54,518 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:43:54,519 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.3ms
2025-10-27 16:43:54,520 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:43:54,523 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:43:54,524 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:43:54,524 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:43:54,525 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.2ms
2025-10-27 16:43:56,014 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 16:43:56,015 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.6ms
2025-10-27 16:43:56,017 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:43:56,019 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:43:56,020 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:43:56,020 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:43:56,020 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:43:56,025 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:43:56,026 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1199
2025-10-27 16:43:56,026 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1199
2025-10-27 16:43:56,027 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:43:56,027 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 10.2ms
2025-10-27 16:44:00,677 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 16:44:00,892 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:44:00,893 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1200
2025-10-27 16:44:00,893 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1200
2025-10-27 16:44:00,893 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 16:44:00,894 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 216.7ms
2025-10-27 16:44:00,912 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:44:00,915 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:44:00,915 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:44:00,917 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:44:00,919 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:44:00,920 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:44:00,921 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:44:00,925 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:44:00,926 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:44:00,932 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:44:00,933 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:44:00,935 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:44:00,936 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:44:00,936 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:44:00,937 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 24.7ms
2025-10-27 16:44:00,937 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 17.4ms
2025-10-27 16:44:00,937 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 16.2ms
2025-10-27 16:44:00,940 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:44:00,943 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:44:00,943 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:44:00,944 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:44:00,945 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:44:00,946 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.8ms
2025-10-27 16:44:00,946 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:44:00,948 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:44:00,948 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:44:00,951 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:44:00,951 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:44:00,952 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:44:00,954 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:44:00,955 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:44:00,955 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:44:00,956 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.8ms
2025-10-27 16:44:00,956 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.4ms
2025-10-27 16:44:05,334 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 16:44:05,335 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.4ms
2025-10-27 16:44:05,336 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 16:44:05,337 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:44:05,338 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:44:05,338 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 16:44:05,338 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.1ms
2025-10-27 16:44:26,221 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:44:26,223 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 16:44:26,223 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.0ms
2025-10-27 16:44:32,909 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 16:44:33,181 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:44:33,181 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1201
2025-10-27 16:44:33,181 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1201
2025-10-27 16:44:33,181 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 16:44:33,187 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 277.5ms
2025-10-27 16:44:33,206 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:44:33,210 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:44:33,210 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:44:33,212 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:44:33,212 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:44:33,212 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.7ms
2025-10-27 16:44:33,214 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:44:33,217 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:44:33,217 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:44:33,221 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:44:33,221 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:44:33,222 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 7.3ms
2025-10-27 16:44:33,224 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:44:33,227 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:44:33,228 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:44:33,228 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:44:33,229 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.9ms
2025-10-27 16:44:33,231 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:44:33,233 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:44:33,234 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:44:33,235 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:44:33,235 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:44:33,235 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 4.1ms
2025-10-27 16:44:33,237 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:44:33,239 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:44:33,239 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:44:33,243 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:44:33,243 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:44:33,244 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.5ms
2025-10-27 16:44:33,246 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:44:33,248 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:44:33,249 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:44:33,249 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:44:33,249 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.6ms
2025-10-27 16:44:38,220 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:44:38,222 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:44:38,223 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:44:38,224 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:44:38,224 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:44:38,225 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:44:38,226 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1202
2025-10-27 16:44:38,226 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1202
2025-10-27 16:44:38,226 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:44:38,227 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.4ms
2025-10-27 16:53:47,099 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 16:53:47,320 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:53:47,321 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1203
2025-10-27 16:53:47,321 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1203
2025-10-27 16:53:47,321 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 16:53:47,322 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 223.3ms
2025-10-27 16:53:47,342 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:53:47,344 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:53:47,344 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:53:47,346 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:53:47,346 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:53:47,347 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.0ms
2025-10-27 16:53:47,350 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:53:47,352 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:53:47,352 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:53:47,356 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:53:47,356 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:53:47,356 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:53:47,358 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:53:47,359 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:53:47,359 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:53:47,360 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.2ms
2025-10-27 16:53:47,360 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.5ms
2025-10-27 16:53:47,362 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:53:47,364 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:53:47,365 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:53:47,366 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:53:47,366 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:53:47,367 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:53:47,367 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 5.6ms
2025-10-27 16:53:47,370 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:53:47,370 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:53:47,373 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:53:47,373 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:53:47,374 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 6.8ms
2025-10-27 16:53:47,375 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:53:47,377 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:53:47,378 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:53:47,378 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:53:47,378 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 3.0ms
2025-10-27 16:53:49,314 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:53:49,317 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:53:49,318 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:53:49,319 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:53:49,319 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:53:49,320 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:53:49,320 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1204
2025-10-27 16:53:49,321 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1204
2025-10-27 16:53:49,321 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:53:49,321 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 6.9ms
2025-10-27 16:55:07,475 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 16:55:07,475 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.5ms
2025-10-27 16:55:07,790 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 16:55:08,013 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:55:08,013 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1205
2025-10-27 16:55:08,013 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1205
2025-10-27 16:55:08,014 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 16:55:08,014 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 223.8ms
2025-10-27 16:55:08,038 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 16:55:08,040 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.4ms
2025-10-27 16:55:08,040 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 16:55:08,042 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.5ms
2025-10-27 16:55:08,044 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 16:55:08,045 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:55:08,047 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:55:08,048 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:55:08,050 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:55:08,050 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:55:08,051 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 6.8ms
2025-10-27 16:55:08,051 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:55:08,051 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 16:55:08,052 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.3ms
2025-10-27 16:55:08,054 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:55:08,054 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:55:08,058 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:55:08,058 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:55:08,060 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.9ms
2025-10-27 16:55:08,060 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 8.9ms
2025-10-27 16:55:08,062 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:55:08,063 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 16:55:08,065 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:55:08,066 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:55:08,066 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:55:08,067 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.9ms
2025-10-27 16:55:08,067 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 4.8ms
2025-10-27 16:55:08,068 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:55:08,068 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 16:55:08,070 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:55:08,070 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:55:08,072 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:55:08,072 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:55:08,074 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.0ms
2025-10-27 16:55:08,074 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 5.9ms
2025-10-27 16:55:08,077 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:55:08,080 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:55:08,080 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:55:08,085 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:55:08,085 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:55:08,086 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.6ms
2025-10-27 16:55:08,087 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:55:08,089 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:55:08,090 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:55:08,090 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:55:08,091 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.4ms
2025-10-27 16:55:13,440 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 16:55:13,441 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 16:55:13,443 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:55:13,446 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:55:13,449 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:55:13,451 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:55:13,452 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:55:13,454 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:55:13,454 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1206
2025-10-27 16:55:13,455 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1206
2025-10-27 16:55:13,455 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:55:13,456 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 12.2ms
2025-10-27 16:56:34,072 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 16:56:34,073 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-27 16:56:34,389 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 16:56:34,608 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:56:34,609 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1207
2025-10-27 16:56:34,609 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1207
2025-10-27 16:56:34,609 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 16:56:34,610 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 221.1ms
2025-10-27 16:56:34,637 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 16:56:34,637 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 16:56:34,638 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.1ms
2025-10-27 16:56:34,638 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.9ms
2025-10-27 16:56:34,642 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:56:34,646 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:56:34,647 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:56:34,649 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:56:34,649 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:56:34,650 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 16:56:34,651 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 8.5ms
2025-10-27 16:56:34,651 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 16:56:34,651 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:56:34,654 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:56:34,655 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:56:34,660 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:56:34,660 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:56:34,661 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 10.9ms
2025-10-27 16:56:34,662 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 10.7ms
2025-10-27 16:56:34,662 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.7ms
2025-10-27 16:56:34,666 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:56:34,669 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:56:34,671 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:56:34,671 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:56:34,672 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 6.7ms
2025-10-27 16:56:34,673 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 16:56:34,673 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:56:34,674 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 16:56:34,677 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:56:34,677 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:56:34,679 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:56:34,680 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:56:34,681 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 7.9ms
2025-10-27 16:56:34,681 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.7ms
2025-10-27 16:56:34,681 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 7.6ms
2025-10-27 16:56:34,685 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:56:34,688 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:56:34,688 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:56:34,694 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:56:34,694 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:56:34,696 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 10.8ms
2025-10-27 16:56:34,696 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:56:34,699 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:56:34,700 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:56:34,700 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:56:34,701 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.9ms
2025-10-27 16:56:39,436 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-10-27 16:56:39,436 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 0.6ms
2025-10-27 16:56:39,438 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/logout/
2025-10-27 16:56:39,439 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:56:39,440 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:56:39,440 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD
2025-10-27 16:56:39,440 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/logout/ 2.1ms
2025-10-27 16:57:11,912 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 16:57:11,912 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.7ms
2025-10-27 16:57:12,224 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:57:12,226 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-10-27 16:57:12,226 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 2.4ms
2025-10-27 16:57:28,757 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 16:57:28,758 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.7ms
2025-10-27 16:57:28,759 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 16:57:29,026 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:57:29,027 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1208
2025-10-27 16:57:29,027 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1208
2025-10-27 16:57:29,027 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 16:57:29,031 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 271.8ms
2025-10-27 16:57:29,059 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 16:57:29,061 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.8ms
2025-10-27 16:57:29,064 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 16:57:29,065 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:57:29,065 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 1.4ms
2025-10-27 16:57:29,068 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:57:29,069 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:57:29,071 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:57:29,071 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:57:29,072 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 7.7ms
2025-10-27 16:57:29,074 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 16:57:29,075 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.1ms
2025-10-27 16:57:29,075 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:57:29,078 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:57:29,078 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:57:29,082 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:57:29,083 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:57:29,084 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 9.0ms
2025-10-27 16:57:29,086 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 16:57:29,087 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.2ms
2025-10-27 16:57:29,088 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:57:29,090 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:57:29,092 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:57:29,092 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:57:29,094 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 5.9ms
2025-10-27 16:57:29,095 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 16:57:29,096 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.8ms
2025-10-27 16:57:29,096 - app.main - INFO - 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-10-27 16:57:29,099 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1
2025-10-27 16:57:29,100 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-10-27 16:57:29,101 - app.utils.menu_helper - INFO - Árbol de menú construido con 1 items raíz.
2025-10-27 16:57:29,102 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 1 items raíz.
2025-10-27 16:57:29,103 - app.main - INFO - 127.0.0.1 <- GET /api/v1/menus/getmenu/ 6.6ms
2025-10-27 16:57:29,105 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-10-27 16:57:29,106 - app.main - INFO - 127.0.0.1 -> GET /api/v1/usuarios/
2025-10-27 16:57:29,106 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 1.2ms
2025-10-27 16:57:29,109 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-10-27 16:57:29,109 - app.services.usuario_service - INFO - Obteniendo usuarios paginados: page=1, limit=10, search='None'
2025-10-27 16:57:29,113 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-10-27 16:57:29,113 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada - Total: 2, Página: 1
2025-10-27 16:57:29,114 - app.main - INFO - 127.0.0.1 <- GET /api/v1/usuarios/ 8.5ms
2025-10-27 16:57:29,117 - app.main - INFO - 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-10-27 16:57:29,120 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida para lista simple
2025-10-27 16:57:29,121 - app.services.rol_service - INFO - Se encontraron 3 roles activos
2025-10-27 16:57:29,121 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada - Total: 3
2025-10-27 16:57:29,122 - app.main - INFO - 127.0.0.1 <- GET /api/v1/roles/all-active/ 4.5ms
2025-10-27 16:58:06,400 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-10-27 16:58:06,401 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 0.9ms
2025-10-27 16:58:06,403 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-10-27 16:58:06,408 - app.core.auth - INFO - [REFRESH] Token validado exitosamente para usuario: admin (Cliente: web)
2025-10-27 16:58:06,412 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-10-27 16:58:06,413 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado
2025-10-27 16:58:06,413 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para admin
2025-10-27 16:58:06,415 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:58:06,415 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1209
2025-10-27 16:58:06,416 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 1209
2025-10-27 16:58:06,416 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: admin
2025-10-27 16:58:06,416 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/refresh/ 13.4ms
2025-10-27 16:59:42,746 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-10-27 16:59:42,747 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 0.6ms
2025-10-27 16:59:43,063 - app.main - INFO - 127.0.0.1 -> POST /api/v1/auth/login/
2025-10-27 16:59:43,289 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-10-27 16:59:43,290 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Usuario 1 - Cliente: web - Token ID: 1210
2025-10-27 16:59:43,290 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 1210
2025-10-27 16:59:43,290 - app.api.v1.endpoints.auth - INFO - Usuario admin autenticado exitosamente (WEB) - Refresh en cookie
2025-10-27 16:59:43,291 - app.main - INFO - 127.0.0.1 <- POST /api/v1/auth/login/ 227.9ms
2025-10-27 16:59:43,322 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-10-27 16:59:43,322 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-10-27 16:59:43,323 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 1.2ms
2025-10-27 16:59:43,323 - app.main - INFO - 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 0.8ms
2025-10-27 16:59:43,327 - app.main - INFO - 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/

2025-11-24 13:34:47,618 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:34:47,620 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 13:34:47,621 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,622 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,623 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,624 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,625 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,626 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,627 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 13:34:47,627 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,629 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 13:34:47,629 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 13:34:47,629 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 61.4ms
2025-11-24 13:34:47,630 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 14.9ms
2025-11-24 13:34:47,632 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:34:47,633 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:34:47,633 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:34:47,634 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:34:47,634 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:34:47,634 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:34:47,635 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:34:47,635 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:34:47,635 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 13:34:47,636 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,637 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,638 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,639 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,639 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,640 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,641 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:34:47,641 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 13:34:47,641 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,643 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,645 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 13:34:47,645 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 13:34:47,646 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:34:47,646 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:34:47,646 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:34:47,646 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:34:47,647 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:34:47,647 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:34:47,648 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:34:47,648 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:34:47,648 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 13:34:47,649 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,650 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,651 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,652 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,653 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,653 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,654 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 13:34:47,654 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:47,655 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 13:34:47,655 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 13:34:47,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 23.1ms
2025-11-24 13:34:47,656 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.8ms
2025-11-24 13:34:49,142 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'cdn', 'backend', 'assets', 'admin', 'static', 'api', 'www'}
2025-11-24 13:34:49,184 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:34:49,185 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:34:49,185 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:34:49,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:34:49,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:34:49,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:34:49,218 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:34:49,221 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 13:34:49,221 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:34:49,221 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 13:34:49,224 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:49,244 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:49,245 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:49,246 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:49,247 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:49,247 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:49,247 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:49,249 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:49,251 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:34:49,251 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 500 67.2ms
2025-11-24 13:34:49,253 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:34:49,253 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:34:49,254 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:34:49,254 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:34:49,254 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:34:49,254 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:34:49,255 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:34:49,255 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:34:49,255 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 13:34:49,256 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:49,257 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:49,258 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:49,259 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:49,260 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:49,260 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:49,260 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:49,261 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:49,262 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:34:49,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 500 9.1ms
2025-11-24 13:34:50,711 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 13:34:50,712 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:34:50,712 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:34:50,712 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:34:50,712 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:34:50,712 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:34:50,714 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:34:50,714 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:34:50,714 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 13:34:50,715 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:50,716 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:50,717 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:50,719 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:50,720 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:50,721 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:50,721 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:50,722 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:50,723 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:34:50,724 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 500 13.2ms
2025-11-24 13:34:50,726 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 13:34:50,726 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:34:50,726 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:34:50,727 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:34:50,727 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:34:50,727 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:34:50,728 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:34:50,728 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:34:50,728 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 13:34:50,729 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:50,731 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:50,732 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:50,733 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:50,734 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:50,735 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:50,735 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:50,736 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:50,737 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:34:50,738 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 500 11.8ms
2025-11-24 13:34:56,279 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:34:56,279 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:34:56,279 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:34:56,280 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:34:56,280 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:34:56,280 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:34:56,281 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:34:56,281 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:34:56,282 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 13:34:56,282 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,284 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,285 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,286 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,288 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,288 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:56,288 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:56,290 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:56,291 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:34:56,292 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 500 13.3ms
2025-11-24 13:34:56,292 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:34:56,293 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:34:56,293 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:34:56,294 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:34:56,294 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:34:56,294 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:34:56,295 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:34:56,295 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:34:56,296 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 13:34:56,297 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,298 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,299 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,300 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,301 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,302 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:56,302 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:56,303 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:56,304 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:34:56,306 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:34:56,306 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 500 13.8ms
2025-11-24 13:34:56,307 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:34:56,307 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:34:56,307 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:34:56,307 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:34:56,308 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:34:56,309 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:34:56,309 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:34:56,309 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 13:34:56,310 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,311 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,312 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,313 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,313 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,314 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:56,314 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:56,315 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:56,315 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:34:56,316 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:34:56,317 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:34:56,317 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:34:56,317 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:34:56,317 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:34:56,318 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:34:56,318 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:34:56,319 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:34:56,319 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 13:34:56,319 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 500 13.6ms
2025-11-24 13:34:56,320 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,320 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,321 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,322 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,324 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:34:56,324 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:56,324 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:56,325 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:34:56,326 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:34:56,327 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 500 10.5ms
2025-11-24 13:35:01,012 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:35:01,013 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:35:01,014 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:35:01,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:35:01,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:35:01,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:35:01,016 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:35:01,016 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:35:01,016 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 13:35:01,017 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:01,018 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:01,020 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:01,021 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:01,023 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:01,023 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:01,023 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:01,024 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:01,025 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:35:01,026 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 500 13.4ms
2025-11-24 13:35:01,028 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:35:01,029 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:35:01,029 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:35:01,029 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:35:01,029 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:35:01,030 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:35:01,031 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:35:01,031 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:35:01,032 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 13:35:01,033 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:01,034 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:01,035 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:01,036 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:01,037 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:01,037 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:01,038 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:01,039 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:01,039 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:35:01,040 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 500 11.7ms
2025-11-24 13:35:02,672 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:35:02,672 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:35:02,673 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:35:02,673 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:35:02,673 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:35:02,673 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:35:02,674 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:35:02,674 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:35:02,675 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 13:35:02,675 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,677 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,679 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,680 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,682 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,683 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:02,683 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:02,684 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:02,685 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:35:02,686 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:35:02,686 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 500 14.6ms
2025-11-24 13:35:02,687 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:35:02,687 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:35:02,687 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:35:02,687 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:35:02,687 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:35:02,688 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:35:02,689 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:35:02,689 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 13:35:02,690 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,691 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,692 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,693 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,694 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,695 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:02,695 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:02,697 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:02,698 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:35:02,699 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 500 13.4ms
2025-11-24 13:35:02,700 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:35:02,700 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:35:02,701 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:35:02,701 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:35:02,701 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:35:02,701 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:35:02,702 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:35:02,702 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:35:02,702 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 13:35:02,705 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,706 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,707 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,708 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,709 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,709 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:02,709 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:02,710 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:02,711 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:35:02,712 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:35:02,713 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:35:02,713 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:35:02,714 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:35:02,714 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:35:02,714 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:35:02,715 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:35:02,715 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:35:02,715 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 13:35:02,716 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,717 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,718 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,719 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,720 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:02,720 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:02,720 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:02,721 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:02,722 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:35:02,723 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 500 23.1ms
2025-11-24 13:35:02,724 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 500 11.5ms
2025-11-24 13:35:22,931 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:35:22,932 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:35:22,932 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:35:22,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:35:22,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:35:22,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:35:22,934 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:35:22,934 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:35:22,934 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 13:35:22,935 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:22,936 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:22,937 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:22,938 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:22,940 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:22,940 - app.db.queries - ERROR - Error en execute_query: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:22,940 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:22,942 - app.services.rol_service - ERROR - Error de BD en get_min_required_access_level: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\rol_service.py", line 75, in get_min_required_access_level
    result = execute_query(QUERY, tuple(role_names))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('The SQL contains 2 parameter markers, but 1 parameters were supplied', 'HY000')
2025-11-24 13:35:22,944 - app.api.deps - ERROR - Error al obtener nivel requerido para roles ['Administrador']: Error de base de datos al obtener nivel de rol requerido.
2025-11-24 13:35:22,945 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 500 13.9ms
2025-11-24 13:35:24,522 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'assets', 'api', 'static', 'backend', 'admin', 'www', 'cdn'}
2025-11-24 13:35:24,561 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:35:24,561 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:35:24,562 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:35:24,562 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:35:24,562 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:35:24,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:35:24,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:35:24,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:35:24,607 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:35:24,610 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 13:35:24,610 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:35:24,611 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 13:35:24,611 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:35:24,611 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:35:24,611 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:35:24,612 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:35:24,612 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:35:24,614 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:35:24,615 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:35:24,615 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 13:35:24,615 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:35:24,615 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:35:24,616 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:35:24,616 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:35:24,616 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:35:24,619 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:35:24,620 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:35:24,620 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 13:35:24,623 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,650 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,652 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,654 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,655 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,656 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,657 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:35:24,658 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 13:35:24,658 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,663 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,672 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 13:35:24,672 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 13:35:24,673 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,674 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,675 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,676 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,676 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,677 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,678 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:35:24,678 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 13:35:24,679 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,683 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,690 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 2 completada exitosamente
2025-11-24 13:35:24,691 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,692 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,693 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,694 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,696 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,697 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,699 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 13:35:24,699 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,702 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 13:35:24,702 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 13:35:24,704 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 142.7ms
2025-11-24 13:35:24,704 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 142.6ms
2025-11-24 13:35:24,704 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 142.4ms
2025-11-24 13:35:24,706 - app.core.exceptions - ERROR - Error no manejado: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |         errors=_normalize_errors(errors), body=response_content
    |     )
    | fastapi.exceptions.ResponseValidationError: 3 validation errors:
    |   {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    | 
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}

2025-11-24 13:35:24,741 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:35:24,741 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:35:24,742 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:35:24,742 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:35:24,742 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:35:24,742 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:35:24,742 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:35:24,746 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:35:24,746 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:35:24,746 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 13:35:24,747 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,748 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,749 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,750 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,751 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,752 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,753 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 13:35:24,753 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,754 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 13:35:24,754 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 13:35:24,754 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:35:24,754 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 13:35:24,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 13:35:24,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:35:24,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 13:35:24,756 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 13:35:24,756 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 13:35:24,756 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 13:35:24,757 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,758 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,759 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,760 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,761 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,762 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,763 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:35:24,764 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 13:35:24,764 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,770 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 13:35:24,777 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 13:35:24,777 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 13:35:24,778 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 36.8ms
2025-11-24 13:35:24,778 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 36.6ms
2025-11-24 13:43:00,622 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-24 13:43:00,623 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:43:00,623 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 13:43:00,623 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 13:43:00,624 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:43:00,624 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 13:43:00,624 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 13:43:00,624 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 13:43:00,624 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-24 13:43:00,625 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.1ms
2025-11-24 13:43:00,705 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-24 13:43:00,706 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:43:00,706 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 13:43:00,706 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 13:43:00,706 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:43:00,706 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 13:43:00,707 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 13:43:00,707 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 13:43:00,707 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-24 13:43:00,884 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 179.1ms
2025-11-24 13:43:21,969 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:43:21,970 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:43:21,970 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 13:43:21,970 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 13:43:21,970 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:43:21,970 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 13:43:21,971 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 13:43:21,971 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 13:43:21,971 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-24 13:43:21,972 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 401 2.2ms
2025-11-24 13:43:36,122 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 13:43:36,123 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:43:36,123 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 13:43:36,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 13:43:36,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:43:36,124 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 13:43:36,124 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 13:43:36,124 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 13:43:36,124 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 13:43:36,138 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 13:43:36,139 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 13:43:36,139 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 13:43:36,383 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 13:43:36,383 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-24 13:43:36,384 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-24 13:43:36,385 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 13:43:36,388 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 13:43:36,389 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11341, Rotación: False
2025-11-24 13:43:36,389 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11341
2025-11-24 13:43:36,389 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-24 13:43:36,390 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 267.9ms
2025-11-24 13:43:40,863 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:43:40,864 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:43:40,864 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 13:43:40,864 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 13:43:40,864 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:43:40,865 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 13:43:40,865 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 13:43:40,865 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 13:43:40,865 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-24 13:43:40,889 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:43:40,889 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 1: page=1, limit=10, search='None'
2025-11-24 13:43:40,896 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 1 completada exitosamente
2025-11-24 13:43:40,897 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 33.3ms
2025-11-24 13:44:01,168 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 13:44:01,169 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:44:01,169 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 13:44:01,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 13:44:01,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:44:01,169 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 13:44:01,169 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 13:44:01,170 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 13:44:01,170 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 13:44:01,173 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 13:44:01,173 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=1
2025-11-24 13:44:01,173 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=1
2025-11-24 13:44:01,174 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_acme', cliente_id_buscado=1
2025-11-24 13:44:01,174 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 6.1ms
2025-11-24 13:44:20,019 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 13:44:20,020 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:44:20,020 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 13:44:20,020 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 13:44:20,020 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:44:20,020 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 13:44:20,020 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 13:44:20,021 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 13:44:20,021 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 13:44:20,025 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 13:44:20,025 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=1
2025-11-24 13:44:20,025 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=1
2025-11-24 13:44:20,032 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_tech', cliente_id_buscado=1
2025-11-24 13:44:20,033 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 13.9ms
2025-11-24 13:44:29,316 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 13:44:29,316 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:44:29,317 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 13:44:29,317 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 13:44:29,317 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:44:29,317 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 13:44:29,317 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 13:44:29,317 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 13:44:29,317 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 13:44:29,320 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 13:44:29,320 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=1
2025-11-24 13:44:29,320 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=1
2025-11-24 13:44:29,325 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_tech', cliente_id_buscado=1
2025-11-24 13:44:29,326 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 10.5ms
2025-11-24 13:44:52,800 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 13:44:52,801 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 13:44:52,801 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 13:44:52,802 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 13:44:52,802 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.9ms
2025-11-24 13:44:52,803 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.6ms
2025-11-24 13:44:52,803 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.6ms
2025-11-24 13:44:52,803 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.5ms
2025-11-24 13:44:52,808 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:44:52,809 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:44:52,809 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:44:52,809 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:44:52,809 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:44:52,809 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:44:52,811 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:44:52,813 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_sistema
2025-11-24 13:44:52,813 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:44:52,813 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 13:44:52,814 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 13:44:52,815 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:44:52,816 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:44:52,816 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:44:52,816 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:44:52,816 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:44:52,816 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:44:52,817 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:44:52,817 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:44:52,817 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 13:44:52,818 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 13:44:52,818 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 401 10.2ms
2025-11-24 13:44:52,819 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 401 4.6ms
2025-11-24 13:44:52,821 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:44:52,822 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:44:52,822 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:44:52,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:44:52,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:44:52,823 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:44:52,824 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:44:52,824 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:44:52,824 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 13:44:52,825 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 13:44:52,826 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:44:52,826 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 13:44:52,827 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:44:52,827 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:44:52,827 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:44:52,827 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:44:52,827 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:44:52,828 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:44:52,828 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:44:52,828 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 13:44:52,829 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 13:44:52,830 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 3.1ms
2025-11-24 13:44:52,830 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 401 8.7ms
2025-11-24 13:44:52,831 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 401 5.1ms
2025-11-24 13:44:52,832 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 13:44:52,833 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:44:52,833 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:44:52,833 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:44:52,833 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:44:52,833 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:44:52,834 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:44:52,834 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:44:52,835 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 13:44:52,840 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-24 13:44:52,840 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: admin_acme
2025-11-24 13:44:52,840 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 8.5ms
2025-11-24 13:45:06,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 13:45:06,261 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-24 13:45:06,263 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 13:45:06,264 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:06,264 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:06,264 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:06,264 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:06,264 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:06,265 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:06,266 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:06,266 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/login/
2025-11-24 13:45:06,268 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-24 13:45:06,268 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-24 13:45:06,269 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-24 13:45:06,494 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-24 13:45:06,495 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 13:45:06,499 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-24 13:45:06,502 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 13:45:06,503 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 11342, Rotación: False
2025-11-24 13:45:06,503 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11342
2025-11-24 13:45:06,503 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-24 13:45:06,504 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 240.4ms
2025-11-24 13:45:06,517 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 13:45:06,518 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-11-24 13:45:06,519 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:45:06,520 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:06,520 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:06,521 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:06,521 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:06,521 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:06,522 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:06,523 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:06,523 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 13:45:06,523 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:45:06,524 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 13:45:06,544 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:45:06,544 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:45:06,554 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 13:45:06,554 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 13:45:06,555 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:06,555 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:06,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:06,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:06,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:06,556 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:06,556 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:06,557 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 13:45:06,561 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 13:45:06,563 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 13:45:06,563 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 13:45:06,564 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 39.8ms
2025-11-24 13:45:06,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 13:45:06,565 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 46.5ms
2025-11-24 13:45:06,566 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:06,566 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:06,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:06,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:06,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:06,567 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:06,567 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:06,568 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/menus/getmenu/
2025-11-24 13:45:06,568 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 44.8ms
2025-11-24 13:45:06,571 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-24 13:45:06,571 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-24 13:45:06,615 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-24 13:45:06,617 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 52.7ms
2025-11-24 13:45:06,618 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:45:06,619 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:06,619 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:06,619 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:06,620 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:06,620 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:06,621 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:06,621 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:06,621 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 13:45:06,626 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:45:06,626 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:45:06,629 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 13:45:06,630 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 13:45:06,630 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:45:06,631 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 13:45:06,631 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:06,631 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:06,632 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:06,632 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:06,632 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:06,633 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:06,633 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:06,633 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 13:45:06,638 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 13:45:06,639 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 13:45:06,639 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 13:45:06,640 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:06,640 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:06,641 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:06,641 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:06,641 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:06,642 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:06,642 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:06,642 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/menus/getmenu/
2025-11-24 13:45:06,645 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-24 13:45:06,646 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-24 13:45:06,646 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-24 13:45:06,647 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 29.1ms
2025-11-24 13:45:06,648 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 17.5ms
2025-11-24 13:45:06,648 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 17.3ms
2025-11-24 13:45:08,176 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 13:45:08,177 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.7ms
2025-11-24 13:45:08,177 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 13:45:08,178 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.8ms
2025-11-24 13:45:08,179 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:45:08,179 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:08,179 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:08,180 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:08,180 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:08,180 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:08,181 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:08,181 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:08,182 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 13:45:08,188 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:45:08,188 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:45:08,195 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 4 completada exitosamente
2025-11-24 13:45:08,196 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.1ms
2025-11-24 13:45:08,198 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:45:08,198 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:08,199 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:08,199 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:08,199 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:08,199 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:08,200 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:08,200 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:08,200 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 13:45:08,205 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:45:08,205 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:45:08,209 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 4 completada exitosamente
2025-11-24 13:45:08,210 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 12.6ms
2025-11-24 13:45:11,000 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:45:11,000 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:11,001 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:11,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:11,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:11,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:11,002 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:11,002 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:11,003 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 13:45:11,009 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:45:11,009 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:45:11,013 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 13:45:11,014 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 13:45:11,015 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:45:11,015 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:11,015 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:11,015 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:11,016 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:11,016 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:11,017 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:11,017 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:11,017 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 13:45:11,017 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 17.2ms
2025-11-24 13:45:11,021 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 13:45:11,022 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 13:45:11,022 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 13:45:11,024 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.3ms
2025-11-24 13:45:11,025 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:45:11,026 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:11,026 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:11,026 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:11,027 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:11,027 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:11,028 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:11,028 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:11,028 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 13:45:11,028 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:45:11,032 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:45:11,032 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:45:11,035 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 13:45:11,036 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 13:45:11,036 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:11,036 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:11,036 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:11,037 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:11,037 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:11,037 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:11,038 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:11,038 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 13:45:11,042 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 13:45:11,043 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 13:45:11,043 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 13:45:11,044 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 18.7ms
2025-11-24 13:45:11,045 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 16.5ms
2025-11-24 13:45:11,776 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:45:11,776 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:11,776 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:11,777 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:11,777 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:11,777 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:11,778 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:11,778 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:11,778 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 13:45:11,784 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:45:11,785 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:45:11,789 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 4 completada exitosamente
2025-11-24 13:45:11,790 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.2ms
2025-11-24 13:45:11,792 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:45:11,792 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:45:11,792 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:45:11,793 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:45:11,793 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:45:11,793 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:45:11,794 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:45:11,794 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:45:11,794 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 13:45:11,801 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:45:11,801 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:45:11,805 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 4 completada exitosamente
2025-11-24 13:45:11,806 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.8ms
2025-11-24 13:46:12,629 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 13:46:12,629 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.7ms
2025-11-24 13:46:12,631 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 13:46:12,632 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.5ms
2025-11-24 13:46:12,633 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 13:46:12,634 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:46:12,634 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:46:12,634 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:46:12,634 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:46:12,634 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:46:12,642 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:46:12,642 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:46:12,642 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 13:46:12,668 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 13:46:12,668 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 13:46:12,674 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 13:46:12,674 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 13:46:12,675 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 42.2ms
2025-11-24 13:46:12,677 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 13:46:12,677 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:46:12,677 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:46:12,678 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:46:12,678 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:46:12,678 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:46:12,679 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:46:12,680 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:46:12,680 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 13:46:12,686 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 13:46:12,687 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 13:46:12,688 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 13:46:12,689 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 13:46:12,689 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.3ms
2025-11-24 13:47:06,877 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 13:47:06,877 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.7ms
2025-11-24 13:47:06,880 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 13:47:06,881 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.5ms
2025-11-24 13:47:06,883 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 13:47:06,884 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:06,884 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:06,884 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:06,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:06,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:06,892 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:06,892 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:06,892 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/list/
2025-11-24 13:47:06,917 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 13:47:06,917 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 4
2025-11-24 13:47:06,919 - app.services.area_service - INFO - No se encontraron áreas activas para el cliente 4 en la lista simple
2025-11-24 13:47:06,920 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 4 - Total: 0 áreas activas
2025-11-24 13:47:06,920 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 37.3ms
2025-11-24 13:47:06,922 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 13:47:06,923 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:06,923 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:06,923 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:06,923 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:06,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:06,925 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:06,925 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:06,925 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/list/
2025-11-24 13:47:06,932 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 13:47:06,932 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 4
2025-11-24 13:47:06,933 - app.services.area_service - INFO - No se encontraron áreas activas para el cliente 4 en la lista simple
2025-11-24 13:47:06,934 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 4 - Total: 0 áreas activas
2025-11-24 13:47:06,934 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 12.0ms
2025-11-24 13:47:10,631 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 13:47:10,632 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:10,632 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:10,632 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:10,632 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:10,632 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:10,634 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:10,634 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:10,635 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 13:47:10,641 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 13:47:10,641 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 13:47:10,652 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 13:47:10,652 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 13:47:10,653 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 22.0ms
2025-11-24 13:47:10,655 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 13:47:10,656 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:10,656 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:10,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:10,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:10,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:10,666 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:10,666 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:10,666 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 13:47:10,673 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 13:47:10,673 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 13:47:10,675 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 13:47:10,675 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 13:47:10,676 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 20.6ms
2025-11-24 13:47:11,515 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:47:11,516 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:11,516 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:11,516 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:11,517 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:11,517 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:11,518 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:11,518 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:11,518 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 13:47:11,524 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:47:11,525 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:47:11,532 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 4 completada exitosamente
2025-11-24 13:47:11,533 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.7ms
2025-11-24 13:47:11,535 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:47:11,536 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:11,536 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:11,536 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:11,536 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:11,537 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:11,538 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:11,538 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:11,538 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 13:47:11,543 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:47:11,543 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:47:11,546 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 4 completada exitosamente
2025-11-24 13:47:11,547 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 11.5ms
2025-11-24 13:47:15,126 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:47:15,127 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:15,127 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:15,127 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:15,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:15,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:15,129 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:15,129 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:15,130 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 13:47:15,135 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:47:15,135 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:47:15,146 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 13:47:15,146 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 13:47:15,148 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:47:15,148 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 21.7ms
2025-11-24 13:47:15,148 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:15,148 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:15,149 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:15,149 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:15,149 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:15,150 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:15,150 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:15,150 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 13:47:15,155 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 13:47:15,157 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 13:47:15,158 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 13:47:15,159 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.1ms
2025-11-24 13:47:15,159 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 13:47:15,160 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:15,160 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:15,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:15,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:15,160 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:15,161 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:15,162 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:15,162 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 13:47:15,166 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:47:15,166 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:47:15,169 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 13:47:15,169 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 13:47:15,170 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 13:47:15,172 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:15,172 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:15,172 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:15,172 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:15,172 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:15,173 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:15,174 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:15,174 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 13:47:15,178 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 13:47:15,179 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 13:47:15,179 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 13:47:15,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 20.5ms
2025-11-24 13:47:15,181 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.3ms
2025-11-24 13:47:16,411 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:47:16,411 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:16,411 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:16,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:16,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:16,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:16,413 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:16,414 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:16,414 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 13:47:16,420 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:47:16,421 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:47:16,425 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 4 completada exitosamente
2025-11-24 13:47:16,426 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.0ms
2025-11-24 13:47:16,428 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 13:47:16,428 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:16,429 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:16,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:16,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:16,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:16,430 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:16,430 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:16,431 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 13:47:16,436 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 13:47:16,436 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 13:47:16,439 - app.services.rol_service - INFO - Obtención paginada de roles para cliente 4 completada exitosamente
2025-11-24 13:47:16,440 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 12.4ms
2025-11-24 13:47:18,289 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 13:47:18,290 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:18,290 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:18,290 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:18,291 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:18,291 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:18,292 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:18,292 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:18,293 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 13:47:18,298 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 13:47:18,298 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 13:47:18,300 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 13:47:18,300 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 13:47:18,301 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 11.8ms
2025-11-24 13:47:18,303 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 13:47:18,303 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:18,303 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:18,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:18,304 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:18,304 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:18,305 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:18,305 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:18,305 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 13:47:18,312 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 13:47:18,313 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 13:47:18,315 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 13:47:18,315 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 13:47:18,315 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.7ms
2025-11-24 13:47:19,339 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 13:47:19,339 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:19,340 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:19,340 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:19,340 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:19,340 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:19,341 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:19,341 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:19,341 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/list/
2025-11-24 13:47:19,348 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 13:47:19,348 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 4
2025-11-24 13:47:19,349 - app.services.area_service - INFO - No se encontraron áreas activas para el cliente 4 en la lista simple
2025-11-24 13:47:19,349 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 4 - Total: 0 áreas activas
2025-11-24 13:47:19,350 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 11.3ms
2025-11-24 13:47:19,352 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 13:47:19,352 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 13:47:19,353 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 13:47:19,353 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 13:47:19,353 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 13:47:19,353 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 13:47:19,354 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 13:47:19,355 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 13:47:19,355 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/list/
2025-11-24 13:47:19,360 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 13:47:19,360 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 4
2025-11-24 13:47:19,362 - app.services.area_service - INFO - No se encontraron áreas activas para el cliente 4 en la lista simple
2025-11-24 13:47:19,362 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 4 - Total: 0 áreas activas
2025-11-24 13:47:19,363 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 10.6ms
2025-11-24 13:51:54,574 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'static', 'assets', 'admin', 'www', 'api', 'cdn', 'backend'}
2025-11-24 14:21:08,828 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'static', 'admin', 'www', 'cdn', 'assets', 'backend', 'api'}
2025-11-24 14:21:19,999 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 14:21:20,000 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 14:21:20,005 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 5.4ms
2025-11-24 14:21:20,005 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 4.9ms
2025-11-24 14:21:20,005 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 14:21:20,006 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 14:21:20,008 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.2ms
2025-11-24 14:21:20,008 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.1ms
2025-11-24 14:21:20,011 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:21:20,011 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:21:20,012 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:20,012 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:20,013 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:20,013 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:20,013 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:20,057 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:20,060 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_sistema
2025-11-24 14:21:20,061 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:20,062 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 14:21:20,062 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:20,062 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:20,062 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:20,063 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:20,063 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:20,064 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:20,064 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:20,064 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 14:21:20,067 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 14:21:20,067 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 14:21:20,068 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 401 57.0ms
2025-11-24 14:21:20,068 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 401 56.8ms
2025-11-24 14:21:20,071 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:21:20,071 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:21:20,072 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:20,072 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:20,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:20,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:20,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:20,073 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:20,073 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:20,074 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 14:21:20,074 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 14:21:20,074 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:20,075 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:20,075 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:20,075 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:20,075 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:20,076 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:20,076 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:20,076 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 14:21:20,077 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 14:21:20,078 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 14:21:20,078 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-24 14:21:20,079 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 401 8.1ms
2025-11-24 14:21:20,079 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 401 7.9ms
2025-11-24 14:21:20,081 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 14:21:20,082 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:20,082 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:20,082 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:20,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:20,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:20,084 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:20,084 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:20,084 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 14:21:20,090 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 4, Usuario 2, Tipo: web
2025-11-24 14:21:20,093 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_tech (Cliente: 4, Level: 4, Type: tenant_admin)
2025-11-24 14:21:20,099 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-24 14:21:20,102 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 14:21:20,103 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 11343, Rotación: True
2025-11-24 14:21:20,108 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 14:21:20,108 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 4, Usuario 2
2025-11-24 14:21:20,109 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 14:21:20,109 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11343
2025-11-24 14:21:20,109 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_tech
2025-11-24 14:21:20,109 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 28.0ms
2025-11-24 14:21:20,114 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:21:20,115 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:21:20,115 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:20,116 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:20,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:20,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:20,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:20,117 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:20,117 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:20,117 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 14:21:20,138 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 14:21:20,140 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 14:21:20,140 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 14:21:20,140 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:20,141 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:20,141 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:20,141 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:20,141 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:20,142 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:20,142 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:20,142 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 14:21:20,148 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:21:20,148 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 14:21:20,157 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:21:20,157 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 14:21:20,158 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 43.5ms
2025-11-24 14:21:20,158 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 43.4ms
2025-11-24 14:21:20,160 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:21:20,161 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:20,161 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:20,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:20,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:20,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:20,163 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:20,163 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:20,163 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 14:21:20,168 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 14:21:20,168 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 14:21:20,169 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 14:21:20,169 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:21:20,169 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:20,170 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:20,170 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:20,170 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:20,170 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:20,171 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:20,171 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:20,171 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 14:21:20,175 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:21:20,175 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 14:21:20,179 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:21:20,180 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 14:21:20,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 20.1ms
2025-11-24 14:21:20,181 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 12.2ms
2025-11-24 14:21:22,282 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 14:21:22,282 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.7ms
2025-11-24 14:21:22,283 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 14:21:22,283 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.7ms
2025-11-24 14:21:22,284 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:21:22,285 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:22,285 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:22,285 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:22,285 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:22,285 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:22,286 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:22,287 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:22,287 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 14:21:22,293 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:21:22,293 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 14:21:22,293 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 14:21:22,298 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 14:21:22,302 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 14:21:22,302 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 14:21:22,302 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 14:21:22,303 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.5ms
2025-11-24 14:21:22,304 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:21:22,305 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:22,305 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:22,305 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:22,305 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:22,305 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:22,306 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:22,306 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:22,306 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 14:21:22,310 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:21:22,310 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 14:21:22,310 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 14:21:22,312 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 14:21:22,314 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 14:21:22,314 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 14:21:22,314 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 14:21:22,315 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 10.4ms
2025-11-24 14:21:25,619 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 14:21:25,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.5ms
2025-11-24 14:21:25,621 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:21:25,622 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:25,623 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:25,623 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:25,624 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:25,624 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:25,627 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:25,627 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:25,627 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 14:21:25,636 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:21:25,636 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 14:21:25,640 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 14:21:25,641 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 14:21:25,641 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 19.9ms
2025-11-24 14:21:25,643 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:21:25,644 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:25,644 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:25,644 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:25,644 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:25,644 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:25,645 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:25,646 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:25,646 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 14:21:25,652 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:21:25,652 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 14:21:25,653 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 14:21:25,654 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 14:21:25,654 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 11.2ms
2025-11-24 14:21:26,978 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 14:21:26,979 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.8ms
2025-11-24 14:21:26,979 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 14:21:26,980 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.1ms
2025-11-24 14:21:26,981 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:21:26,982 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:26,982 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:26,982 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:26,982 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:26,982 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:26,984 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:26,984 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:26,984 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/list/
2025-11-24 14:21:26,991 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 14:21:26,991 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 4
2025-11-24 14:21:26,993 - app.services.area_service - INFO - No se encontraron áreas activas para el cliente 4 en la lista simple
2025-11-24 14:21:26,993 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 4 - Total: 0 áreas activas
2025-11-24 14:21:26,994 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 12.3ms
2025-11-24 14:21:26,995 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:21:26,996 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:26,996 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:26,996 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:26,996 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:26,996 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:26,997 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:26,997 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:26,997 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/list/
2025-11-24 14:21:27,002 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 14:21:27,002 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 4
2025-11-24 14:21:27,003 - app.services.area_service - INFO - No se encontraron áreas activas para el cliente 4 en la lista simple
2025-11-24 14:21:27,003 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 4 - Total: 0 áreas activas
2025-11-24 14:21:27,004 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 8.3ms
2025-11-24 14:21:27,945 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 14:21:27,946 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 14:21:27,947 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 1.2ms
2025-11-24 14:21:27,947 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 0.9ms
2025-11-24 14:21:27,949 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 14:21:27,949 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:27,949 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:27,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:27,950 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:27,950 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:27,951 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:27,951 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:27,951 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/sessions/admin/
2025-11-24 14:21:27,959 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_tech
2025-11-24 14:21:27,963 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 29 sesiones activas recuperadas - Cliente 4
2025-11-24 14:21:27,964 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 29 sesiones activas totales.
2025-11-24 14:21:27,965 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 15.9ms
2025-11-24 14:21:27,966 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 14:21:27,967 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:27,967 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:27,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:27,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:27,968 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:27,969 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:27,969 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:27,969 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/sessions/admin/
2025-11-24 14:21:27,975 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_tech
2025-11-24 14:21:27,976 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 29 sesiones activas recuperadas - Cliente 4
2025-11-24 14:21:27,976 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 29 sesiones activas totales.
2025-11-24 14:21:27,977 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 10.4ms
2025-11-24 14:21:29,091 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:21:29,091 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:29,091 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:29,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:29,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:29,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:29,093 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:29,093 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:29,093 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 14:21:29,099 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:21:29,099 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 14:21:29,105 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:21:29,105 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 14:21:29,106 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:21:29,106 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:29,107 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:29,107 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:29,107 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:29,107 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:29,108 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:29,108 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:29,109 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 14:21:29,114 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 14:21:29,115 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 14:21:29,115 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 14:21:29,115 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.6ms
2025-11-24 14:21:29,116 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.2ms
2025-11-24 14:21:29,118 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:21:29,119 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:29,119 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:29,119 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:29,119 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:29,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:29,121 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:29,121 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:29,121 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 14:21:29,126 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:21:29,126 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 14:21:29,130 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:21:29,130 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 14:21:29,131 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:21:29,132 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:29,132 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 14:21:29,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 14:21:29,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:29,133 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 14:21:29,133 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 14:21:29,133 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 14:21:29,134 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 14:21:29,139 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 14:21:29,140 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 14:21:29,140 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 14:21:29,141 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 22.8ms
2025-11-24 14:21:29,141 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.6ms
2025-11-24 14:21:33,362 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 14:21:33,363 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.8ms
2025-11-24 14:21:33,364 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 14:21:33,365 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.5ms
2025-11-24 14:21:33,366 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:21:33,366 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:33,367 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:33,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:33,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:33,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:33,370 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:33,372 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 14:21:33,372 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:33,372 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:21:33,373 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 14:21:33,374 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 401 8.2ms
2025-11-24 14:21:33,376 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:21:33,377 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:33,377 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:33,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:33,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:33,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:33,379 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:33,379 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:33,379 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:21:33,380 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 14:21:33,380 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 14:21:33,381 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.4ms
2025-11-24 14:21:33,381 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 401 4.8ms
2025-11-24 14:21:33,383 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 14:21:33,384 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:33,384 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:33,384 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:33,384 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:33,385 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:33,386 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:33,386 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:33,386 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 14:21:33,388 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:33,413 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 2
2025-11-24 14:21:33,413 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: admin_tech
2025-11-24 14:21:33,414 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 30.7ms
2025-11-24 14:21:43,432 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 14:21:43,432 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.7ms
2025-11-24 14:21:43,434 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 14:21:43,435 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:43,435 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:43,436 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:43,436 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:43,436 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:43,439 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:43,439 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:43,439 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 14:21:43,447 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 14:21:43,447 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 14:21:43,447 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 14:21:43,447 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,693 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,697 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,703 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 14:21:43,703 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 14:21:43,703 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,707 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,708 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 14:21:43,708 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,711 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 14:21:43,711 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 4, Rotación: False
2025-11-24 14:21:43,711 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 4
2025-11-24 14:21:43,712 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 14:21:43,712 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 277.7ms
2025-11-24 14:21:43,725 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 14:21:43,725 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.6ms
2025-11-24 14:21:43,727 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:21:43,728 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:43,728 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:43,728 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:43,728 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:43,728 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:43,730 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:43,730 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:43,730 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:21:43,731 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 14:21:43,731 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,733 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,735 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,736 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,737 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,740 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,741 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:21:43,741 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:21:43,741 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,744 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:21:43,744 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:21:43,745 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 13.9ms
2025-11-24 14:21:43,745 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 14:21:43,746 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:43,746 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:43,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:43,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:43,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:43,747 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:43,748 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:43,752 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 14:21:43,753 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 26.0ms
2025-11-24 14:21:43,754 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,756 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,756 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,757 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,758 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 14:21:43,758 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 14:21:43,758 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,759 - app.db.queries - ERROR - Error en execute_procedure_params: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:21:43,760 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 175, in execute_procedure_params
    cursor.execute(query, tuple(params.values()))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 187, in execute_procedure_params
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:21:43,763 - app.services.menu_service - ERROR - Error de BD al obtener menú para usuario 1: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:21:43,763 - app.api.v1.endpoints.menus - ERROR - Error de servicio en GET /getmenu/ para usuario 1: Error de base de datos al obtener menú del usuario
2025-11-24 14:21:43,765 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 19.7ms
2025-11-24 14:21:43,767 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:21:43,768 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:43,769 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:43,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:43,770 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:43,770 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:43,771 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:43,772 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:43,772 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:21:43,773 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,774 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,775 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,776 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,777 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,778 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,778 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:21:43,779 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:21:43,779 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,780 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:21:43,780 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:21:43,781 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 14:21:43,782 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:43,782 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:43,782 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:43,782 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:43,783 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:43,784 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:43,784 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:43,784 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 14:21:43,785 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,786 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,787 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,788 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,789 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 14:21:43,789 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 14:21:43,789 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:43,790 - app.db.queries - ERROR - Error en execute_procedure_params: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:21:43,790 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 175, in execute_procedure_params
    cursor.execute(query, tuple(params.values()))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 187, in execute_procedure_params
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:21:43,791 - app.services.menu_service - ERROR - Error de BD al obtener menú para usuario 1: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:21:43,792 - app.api.v1.endpoints.menus - ERROR - Error de servicio en GET /getmenu/ para usuario 1: Error de base de datos al obtener menú del usuario
2025-11-24 14:21:43,792 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 25.1ms
2025-11-24 14:21:43,793 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 12.0ms
2025-11-24 14:21:46,014 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 14:21:46,014 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.8ms
2025-11-24 14:21:46,015 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 14:21:46,016 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.3ms
2025-11-24 14:21:46,016 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 14:21:46,017 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 14:21:46,018 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:21:46,018 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.0ms
2025-11-24 14:21:46,019 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.0ms
2025-11-24 14:21:46,019 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:46,020 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:46,020 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:46,020 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:46,021 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:46,022 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:46,023 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:46,023 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:21:46,025 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,026 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,027 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,028 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,029 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,030 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,031 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:21:46,031 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:21:46,031 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,037 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,044 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:21:46,044 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:21:46,045 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:21:46,045 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:46,045 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:46,045 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:46,046 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:46,046 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:46,046 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:46,047 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:46,047 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:21:46,047 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,048 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,049 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,049 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,050 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,051 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,052 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:21:46,052 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,055 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:21:46,055 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:21:46,056 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 37.8ms
2025-11-24 14:21:46,057 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.2ms
2025-11-24 14:21:46,058 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:21:46,059 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:46,059 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:46,059 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:46,059 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:46,059 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:46,060 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:46,060 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:46,061 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:21:46,062 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,062 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,063 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,064 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,064 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,065 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,066 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:21:46,066 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:21:46,066 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,068 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,070 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:21:46,071 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:21:46,072 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:21:46,072 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:46,072 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:46,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:46,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:46,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:46,073 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:46,074 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:46,074 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:21:46,074 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.0ms
2025-11-24 14:21:46,074 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,075 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,076 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,077 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,077 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,078 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,079 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:21:46,079 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:46,079 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:21:46,080 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:21:46,081 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.0ms
2025-11-24 14:21:47,245 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 14:21:47,245 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 14:21:47,245 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.9ms
2025-11-24 14:21:47,246 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.8ms
2025-11-24 14:21:47,248 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:21:47,248 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:47,248 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:47,249 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:47,249 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:47,249 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:47,251 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:47,251 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:47,251 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:21:47,252 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,254 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,255 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,256 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,257 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,258 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,260 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:21:47,260 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:21:47,260 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:21:47,260 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,264 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:21:47,264 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,268 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:21:47,268 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:21:47,268 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:21:47,269 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 21.5ms
2025-11-24 14:21:47,270 - app.core.exceptions - ERROR - Error no manejado: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |         errors=_normalize_errors(errors), body=response_content
    |     )
    | fastapi.exceptions.ResponseValidationError: 3 validation errors:
    |   {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    | 
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}

2025-11-24 14:21:47,303 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:21:47,304 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:47,304 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:47,304 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:47,304 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:47,304 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:47,306 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:47,306 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:47,306 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:21:47,307 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,308 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,309 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,310 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,311 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,312 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,313 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:21:47,313 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:21:47,314 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:21:47,314 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,315 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:21:47,316 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:47,317 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:21:47,318 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:21:47,318 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:21:47,318 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 15.2ms
2025-11-24 14:21:47,319 - app.core.exceptions - ERROR - Error no manejado: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |         errors=_normalize_errors(errors), body=response_content
    |     )
    | fastapi.exceptions.ResponseValidationError: 3 validation errors:
    |   {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    | 
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}

2025-11-24 14:21:51,285 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 14:21:51,286 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 14:21:51,286 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.0ms
2025-11-24 14:21:51,287 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.8ms
2025-11-24 14:21:51,288 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:21:51,289 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:51,289 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:51,289 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:51,289 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:51,289 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:51,291 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:51,291 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:51,291 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:21:51,293 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,294 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,295 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,297 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,298 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,299 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,300 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:21:51,300 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:21:51,300 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,304 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,309 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:21:51,309 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:21:51,310 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 21.7ms
2025-11-24 14:21:51,312 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:21:51,312 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:51,312 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:51,313 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:51,313 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:51,313 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:51,314 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:51,314 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:51,314 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:21:51,315 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,316 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,317 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,318 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,318 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,319 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,320 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:21:51,320 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:21:51,320 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,322 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:51,323 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:21:51,323 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:21:51,324 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.1ms
2025-11-24 14:21:53,372 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:21:53,372 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:53,373 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:53,373 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:53,373 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:53,373 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:53,374 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:53,375 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:53,375 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:21:53,377 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,378 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,380 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,381 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,382 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,383 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,384 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:21:53,384 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:21:53,384 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,385 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:21:53,386 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:21:53,386 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 14.3ms
2025-11-24 14:21:53,388 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:21:53,389 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:53,389 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:53,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:53,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:53,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:53,391 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:53,391 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:53,391 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:21:53,392 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,393 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,395 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,396 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,397 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,398 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,398 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:21:53,399 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:21:53,399 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:53,400 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:21:53,400 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:21:53,400 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 11.9ms
2025-11-24 14:21:54,113 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:21:54,114 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:54,114 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:54,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:54,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:54,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:54,116 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:54,116 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:54,116 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:21:54,117 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,118 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,119 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,121 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,122 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,123 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,125 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:21:54,125 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:21:54,125 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,128 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,131 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:21:54,131 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:21:54,132 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 18.1ms
2025-11-24 14:21:54,134 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:21:54,134 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:54,134 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:54,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:54,135 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:54,135 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:54,136 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:54,136 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:54,136 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:21:54,137 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,138 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,139 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,140 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,140 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,141 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,142 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:21:54,142 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:21:54,143 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,145 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,147 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:21:54,148 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:21:54,148 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 14.7ms
2025-11-24 14:21:54,711 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:21:54,712 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:54,712 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:54,712 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:54,712 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:54,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:54,714 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:54,714 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:54,714 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:21:54,715 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,716 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,717 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,718 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,720 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,721 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,722 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:21:54,722 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:21:54,723 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:21:54,723 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,725 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:21:54,725 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,728 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:21:54,728 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:21:54,728 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:21:54,729 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 18.1ms
2025-11-24 14:21:54,730 - app.core.exceptions - ERROR - Error no manejado: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |         errors=_normalize_errors(errors), body=response_content
    |     )
    | fastapi.exceptions.ResponseValidationError: 3 validation errors:
    |   {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    | 
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}

2025-11-24 14:21:54,754 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:21:54,754 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:21:54,754 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:21:54,754 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:21:54,754 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:21:54,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:21:54,755 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:21:54,756 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:21:54,756 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:21:54,757 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,757 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,759 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,759 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,761 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,762 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,763 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:21:54,763 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:21:54,763 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:21:54,763 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,765 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:21:54,765 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:21:54,767 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:21:54,767 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:21:54,767 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:21:54,768 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 14.4ms
2025-11-24 14:21:54,769 - app.core.exceptions - ERROR - Error no manejado: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |         errors=_normalize_errors(errors), body=response_content
    |     )
    | fastapi.exceptions.ResponseValidationError: 3 validation errors:
    |   {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    | 
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}

2025-11-24 14:22:59,948 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:22:59,948 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:22:59,949 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:22:59,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:22:59,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:22:59,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:22:59,963 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:22:59,963 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:22:59,963 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:22:59,964 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,971 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,974 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,975 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,976 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,978 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,979 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:22:59,979 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:22:59,979 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,983 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,987 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:22:59,988 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:22:59,989 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 40.8ms
2025-11-24 14:22:59,991 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:22:59,991 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:22:59,992 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:22:59,992 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:22:59,992 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:22:59,992 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:22:59,993 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:22:59,993 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:22:59,993 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:22:59,994 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,995 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,996 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,996 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,997 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,998 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:22:59,998 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:22:59,999 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:22:59,999 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:00,000 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:00,001 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:23:00,002 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:23:00,002 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 11.1ms
2025-11-24 14:23:01,969 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:23:01,969 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:23:01,969 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:23:01,970 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:23:01,970 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:23:01,970 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:23:01,971 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:23:01,971 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:23:01,971 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:23:01,972 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,973 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,975 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,977 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,978 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,979 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,980 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:23:01,980 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:23:01,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,983 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:23:01,983 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:23:01,984 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 15.0ms
2025-11-24 14:23:01,985 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:23:01,986 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:23:01,986 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:23:01,986 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:23:01,986 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:23:01,986 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:23:01,987 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:23:01,988 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:23:01,988 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:23:01,988 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,989 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,990 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,991 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,993 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,993 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,994 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:23:01,994 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:23:01,994 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:01,995 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:23:01,995 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:23:01,996 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 10.4ms
2025-11-24 14:23:03,684 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 14:23:03,685 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 1.1ms
2025-11-24 14:23:03,686 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 14:23:03,687 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 0.5ms
2025-11-24 14:23:03,688 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 14:23:03,688 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:23:03,689 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:23:03,689 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:23:03,689 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:23:03,689 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:23:03,691 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:23:03,691 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:23:03,691 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/sessions/admin/
2025-11-24 14:23:03,692 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,694 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,695 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,696 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,698 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,698 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,700 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,702 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-24 14:23:03,702 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,707 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 2 sesiones activas recuperadas - Cliente 2
2025-11-24 14:23:03,707 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 2 sesiones activas totales.
2025-11-24 14:23:03,708 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 19.9ms
2025-11-24 14:23:03,711 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 14:23:03,711 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:23:03,711 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:23:03,711 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:23:03,711 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:23:03,712 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:23:03,713 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:23:03,713 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:23:03,713 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/sessions/admin/
2025-11-24 14:23:03,714 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,714 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,715 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,716 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,716 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,717 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,718 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,719 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-24 14:23:03,719 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:03,720 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 2 sesiones activas recuperadas - Cliente 2
2025-11-24 14:23:03,720 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 2 sesiones activas totales.
2025-11-24 14:23:03,720 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 9.6ms
2025-11-24 14:23:05,917 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:23:05,918 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:23:05,918 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:23:05,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:23:05,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:23:05,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:23:05,920 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:23:05,920 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:23:05,920 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:23:05,921 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,922 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,924 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,925 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,927 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,928 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,930 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:23:05,930 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:23:05,930 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,935 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,942 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:23:05,942 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:23:05,943 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:23:05,944 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 26.5ms
2025-11-24 14:23:05,944 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:23:05,944 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:23:05,944 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:23:05,944 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:23:05,945 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:23:05,946 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:23:05,946 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:23:05,947 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:23:05,949 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,950 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,951 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,952 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,953 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,954 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,955 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:23:05,955 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,958 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:23:05,958 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:23:05,959 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 16.7ms
2025-11-24 14:23:05,961 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:23:05,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:23:05,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:23:05,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:23:05,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:23:05,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:23:05,964 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:23:05,964 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:23:05,964 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:23:05,966 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,967 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,968 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,968 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,969 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,970 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,971 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:23:05,971 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:23:05,971 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,973 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,976 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:23:05,976 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:23:05,977 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:23:05,977 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:23:05,978 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:23:05,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:23:05,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:23:05,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:23:05,979 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:23:05,980 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:23:05,980 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:23:05,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,981 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,982 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,983 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,984 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,985 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,985 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:23:05,986 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:23:05,987 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:23:05,987 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:23:05,987 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 26.1ms
2025-11-24 14:23:05,988 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.1ms
2025-11-24 14:24:09,135 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:24:09,136 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:24:09,136 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:24:09,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:24:09,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:24:09,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:24:09,145 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:24:09,145 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:24:09,145 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:24:09,146 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,151 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,153 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,154 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,156 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,159 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,161 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:24:09,161 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:24:09,161 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:24:09,161 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,166 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:24:09,166 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,170 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:24:09,170 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:24:09,171 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:24:09,172 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 36.5ms
2025-11-24 14:24:09,172 - app.core.exceptions - ERROR - Error no manejado: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |         errors=_normalize_errors(errors), body=response_content
    |     )
    | fastapi.exceptions.ResponseValidationError: 3 validation errors:
    |   {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    | 
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}

2025-11-24 14:24:09,199 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:24:09,199 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:24:09,200 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:24:09,200 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:24:09,200 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:24:09,200 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:24:09,201 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:24:09,201 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:24:09,201 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:24:09,202 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,203 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,204 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,205 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,206 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,207 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,208 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:24:09,209 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:24:09,209 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:24:09,209 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,211 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:24:09,211 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:24:09,213 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:24:09,213 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:24:09,213 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:24:09,213 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ N/A 14.4ms
2025-11-24 14:24:09,214 - app.core.exceptions - ERROR - Error no manejado: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    |     content = await serialize_response(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<9 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    |     raise ResponseValidationError(
    |         errors=_normalize_errors(errors), body=response_content
    |     )
    | fastapi.exceptions.ResponseValidationError: 3 validation errors:
    |   {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    |   {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
    | 
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 190, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 181, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 158, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\middleware\tenant_middleware.py", line 293, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'value_error', 'loc': ('response', 'roles', 0), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 1, 'nombre': 'Administrador', 'descripcion': 'Administrador con acceso completo', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'ADMIN'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 1), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 2, 'nombre': 'Supervisor', 'descripcion': 'Supervisor de departamento', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'SUPERVISOR'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}
  {'type': 'value_error', 'loc': ('response', 'roles', 2), 'msg': 'Value error, Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).', 'input': {'rol_id': 3, 'nombre': 'Usuario', 'descripcion': 'Usuario estándar', 'es_activo': True, 'fecha_creacion': datetime.datetime(2025, 11, 16, 10, 28, 49, 500000), 'cliente_id': 2, 'codigo_rol': 'USER'}, 'ctx': {'error': ValueError('Un rol con codigo_rol (rol de sistema) solo puede pertenecer al cliente SUPER ADMIN (cliente_id=1). Para otros clientes, cree un rol de cliente (codigo_rol=NULL).')}}

2025-11-24 14:29:24,276 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:29:24,277 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:24,277 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:24,278 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:24,278 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:24,278 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:24,294 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:24,296 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 14:29:24,296 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:24,296 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:29:24,297 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:24,306 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:24,308 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:24,308 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:24,309 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:24,312 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:24,313 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:29:24,313 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:29:24,314 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:24,317 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:24,322 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:29:24,322 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:29:24,323 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 46.8ms
2025-11-24 14:29:25,762 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'www', 'api', 'static', 'assets', 'backend', 'admin', 'cdn'}
2025-11-24 14:29:25,804 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:29:25,804 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:29:25,804 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:25,805 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:25,805 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:25,805 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:25,805 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:25,837 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:25,840 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 14:29:25,840 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:25,840 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:29:25,841 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:25,841 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:25,841 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:25,841 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:25,841 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:25,842 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:25,842 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:25,842 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:29:25,844 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,862 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,863 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,864 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,865 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,866 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,867 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:29:25,867 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:29:25,867 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,868 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,870 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:29:25,870 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:29:25,871 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,872 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,873 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,874 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,874 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,875 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,876 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:29:25,876 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:29:25,876 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:29:25,876 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,879 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:29:25,880 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,882 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:29:25,883 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:25,883 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:25,883 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:25,883 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:29:25,883 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:29:25,884 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 80.8ms
2025-11-24 14:29:25,885 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 80.7ms
2025-11-24 14:29:25,887 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:29:25,887 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:25,887 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:25,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:25,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:25,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:25,889 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:25,889 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:25,889 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:29:25,890 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,891 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,892 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,893 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,894 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,894 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,895 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:29:25,896 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:29:25,896 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:29:25,896 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,897 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:29:25,897 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:25,899 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:29:25,899 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:25,899 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:25,899 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:25,899 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:29:25,900 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:29:25,900 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.4ms
2025-11-24 14:29:29,224 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:29:29,224 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:29,224 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:29,225 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:29,225 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:29,225 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:29,226 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:29,227 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:29,227 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:29:29,228 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,229 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,231 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,232 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,233 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,234 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,235 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:29:29,235 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:29:29,236 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,241 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,249 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:29:29,249 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:29:29,250 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:29:29,251 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:29,251 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:29,251 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:29,251 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:29,251 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:29,252 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:29,252 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:29,252 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:29:29,253 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 28.8ms
2025-11-24 14:29:29,253 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,254 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,255 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,255 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,256 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,257 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,258 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:29:29,258 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,260 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:29:29,260 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:29:29,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.6ms
2025-11-24 14:29:29,263 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:29:29,264 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:29,264 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:29,264 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:29,265 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:29,265 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:29,266 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:29,266 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:29,266 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:29:29,267 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,268 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,269 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,270 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,271 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,271 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,272 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:29:29,272 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:29:29,273 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,274 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,277 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:29:29,277 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:29:29,278 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:29:29,279 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:29,279 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:29,279 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:29,279 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:29,279 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:29,280 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:29,280 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:29,281 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:29:29,281 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 17.5ms
2025-11-24 14:29:29,281 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,282 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,283 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,284 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,284 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,285 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,286 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:29:29,286 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:29,287 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:29:29,287 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:29:29,288 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.1ms
2025-11-24 14:29:30,740 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:29:30,741 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:30,741 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:30,741 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:30,741 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:30,741 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:30,743 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:30,743 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:30,743 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:29:30,744 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,747 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,748 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,750 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,753 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,754 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,755 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:29:30,755 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:29:30,756 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:29:30,756 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,757 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:29:30,758 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,760 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:29:30,761 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:30,761 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:30,761 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:30,761 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:29:30,761 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:29:30,762 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 21.9ms
2025-11-24 14:29:30,764 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:29:30,764 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:30,764 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:30,765 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:30,765 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:30,765 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:30,766 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:30,766 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:30,766 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:29:30,767 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,768 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,769 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,769 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,770 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,771 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,772 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:29:30,772 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:29:30,772 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:29:30,772 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,774 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:29:30,774 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:30,776 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:29:30,776 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:30,776 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:30,776 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:30,776 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:29:30,776 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:29:30,777 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.3ms
2025-11-24 14:29:43,557 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:29:43,557 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:43,558 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:43,558 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:43,558 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:43,558 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:43,559 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:43,559 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:43,560 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:29:43,560 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,562 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,563 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,564 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,565 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,566 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,568 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:29:43,568 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:29:43,568 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,570 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,572 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:29:43,572 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:29:43,573 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.0ms
2025-11-24 14:29:43,575 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:29:43,576 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:43,576 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:43,576 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:43,576 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:43,577 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:43,578 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:43,578 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:43,578 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:29:43,579 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,580 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,582 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,583 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,584 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:29:43,584 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:29:43,584 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:43,587 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:29:43,587 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:29:43,588 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.9ms
2025-11-24 14:29:44,568 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:29:44,568 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:44,569 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:44,569 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:44,569 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:44,569 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:44,570 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:44,570 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:44,570 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:29:44,571 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,572 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,574 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,575 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,577 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,578 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,579 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:29:44,579 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:29:44,579 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,582 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:29:44,582 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:29:44,582 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 14.6ms
2025-11-24 14:29:44,584 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:29:44,585 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:44,585 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:44,585 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:44,585 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:44,585 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:44,586 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:44,587 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:44,587 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:29:44,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,588 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,589 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,592 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,592 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,593 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:29:44,593 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:29:44,593 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:44,594 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:29:44,594 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:29:44,595 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 10.6ms
2025-11-24 14:29:47,097 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/area/2/tree/
2025-11-24 14:29:47,098 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/area/2/tree/ 200 0.7ms
2025-11-24 14:29:47,099 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 14:29:47,100 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:47,100 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:47,100 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:47,100 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:47,100 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:47,101 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:47,102 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:47,102 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 14:29:47,102 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:47,103 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:47,104 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:47,105 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:47,105 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:47,106 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:47,107 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:29:47,108 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 14:29:47,108 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:47,112 - app.utils.menu_helper - ERROR - Error procesando item de menú 4: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:29:47,114 - app.utils.menu_helper - ERROR - Error procesando item de menú 5: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:29:47,115 - app.utils.menu_helper - INFO - Árbol de menú construido con 0 items raíz.
2025-11-24 14:29:47,115 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 0 items raíz.
2025-11-24 14:29:47,115 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 16.0ms
2025-11-24 14:29:48,716 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/area/1/tree/
2025-11-24 14:29:48,717 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/area/1/tree/ 200 0.5ms
2025-11-24 14:29:48,718 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 14:29:48,719 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:48,719 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:48,719 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:48,719 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:48,720 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:48,720 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:48,721 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:48,721 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 14:29:48,722 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:48,722 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:48,723 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:48,724 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:48,725 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:48,726 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:48,727 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:29:48,727 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 14:29:48,728 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:48,729 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 14:29:48,729 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 11.0ms
2025-11-24 14:29:49,651 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 14:29:49,651 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:49,651 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:49,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:49,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:49,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:49,653 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:49,653 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:49,653 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/sessions/admin/
2025-11-24 14:29:49,654 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,655 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,656 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,657 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,658 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,659 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,660 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,663 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-24 14:29:49,663 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,667 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 2 sesiones activas recuperadas - Cliente 2
2025-11-24 14:29:49,667 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 2 sesiones activas totales.
2025-11-24 14:29:49,668 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 17.5ms
2025-11-24 14:29:49,670 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 14:29:49,670 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:49,671 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:49,671 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:49,671 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:49,671 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:49,672 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:49,672 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:49,673 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/sessions/admin/
2025-11-24 14:29:49,673 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,674 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,676 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,676 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,677 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,678 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,679 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,680 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-24 14:29:49,680 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:49,681 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 2 sesiones activas recuperadas - Cliente 2
2025-11-24 14:29:49,681 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 2 sesiones activas totales.
2025-11-24 14:29:49,682 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 12.1ms
2025-11-24 14:29:50,679 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:29:50,680 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:50,680 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:50,680 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:50,680 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:50,681 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:50,682 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:50,682 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:50,682 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:29:50,683 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,684 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,685 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,686 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,687 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,688 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,689 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:29:50,690 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:29:50,690 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:29:50,690 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,692 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:29:50,692 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,694 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:29:50,694 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:50,694 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:50,695 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:50,695 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:29:50,695 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:29:50,696 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 16.3ms
2025-11-24 14:29:50,697 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:29:50,698 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:50,698 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:50,698 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:50,699 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:50,699 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:50,700 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:50,700 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:50,700 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:29:50,701 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,702 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,703 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,704 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,704 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,705 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,706 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:29:50,706 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:29:50,707 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:29:50,707 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,708 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:29:50,708 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:50,710 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:29:50,710 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:50,710 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:50,710 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:50,710 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:29:50,711 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:29:50,711 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.9ms
2025-11-24 14:29:51,317 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:29:51,317 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:51,317 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:51,318 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:51,318 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:51,318 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:51,319 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:51,319 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:51,319 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:29:51,320 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,321 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,323 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,324 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,325 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,326 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,327 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:29:51,327 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:29:51,328 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,330 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,333 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:29:51,333 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:29:51,334 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 17.1ms
2025-11-24 14:29:51,334 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:29:51,335 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:51,335 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:51,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:51,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:51,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:51,336 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:51,336 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:51,336 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:29:51,337 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,339 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,341 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,342 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:29:51,342 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,343 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:29:51,343 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:29:51,344 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:29:51,345 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.8ms
2025-11-24 14:29:51,345 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:51,345 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:51,346 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:51,346 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:51,346 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:51,347 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:51,347 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:51,347 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:29:51,348 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,349 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,350 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,351 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,351 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,352 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,353 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:29:51,353 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:29:51,353 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,355 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,357 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:29:51,357 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:29:51,358 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:29:51,358 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:51,359 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:51,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:51,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:51,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:51,360 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:51,360 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:51,360 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:29:51,360 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.1ms
2025-11-24 14:29:51,361 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,362 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,363 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,364 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,365 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,365 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,366 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:29:51,366 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:51,367 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:29:51,367 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:29:51,368 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.6ms
2025-11-24 14:29:53,486 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:29:53,486 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:53,486 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:53,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:53,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:53,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:53,488 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:53,488 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:53,488 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:29:53,489 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,490 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,492 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,493 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,494 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,495 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,496 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:29:53,497 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:29:53,497 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:29:53,497 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,499 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:29:53,499 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,501 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:29:53,502 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:53,502 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:53,502 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:53,502 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:29:53,502 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:29:53,503 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.5ms
2025-11-24 14:29:53,505 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:29:53,505 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:53,506 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:53,506 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:53,506 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:53,506 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:53,507 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:53,507 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:53,508 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:29:53,508 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,509 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,510 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,511 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,512 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,512 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,513 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:29:53,513 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:29:53,514 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:29:53,514 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,515 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:29:53,515 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:53,517 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:29:53,517 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:53,517 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:53,517 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:29:53,518 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:29:53,518 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:29:53,518 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.6ms
2025-11-24 14:29:55,581 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:29:55,582 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:55,582 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:55,582 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:55,582 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:55,582 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:55,584 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:55,584 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:55,585 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:29:55,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,589 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,592 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,593 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:29:55,593 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:29:55,593 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,595 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,597 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:29:55,597 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:29:55,597 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.4ms
2025-11-24 14:29:55,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:29:55,600 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:29:55,600 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:29:55,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:29:55,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:29:55,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:29:55,602 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:29:55,602 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:29:55,602 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:29:55,603 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,604 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,605 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,606 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,607 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,607 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,608 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:29:55,608 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:29:55,608 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,610 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:29:55,612 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:29:55,612 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:29:55,612 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.7ms
2025-11-24 14:30:11,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:30:11,152 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:11,152 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:11,152 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:11,152 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:11,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:11,153 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:11,154 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:11,154 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:30:11,155 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,156 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,157 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,158 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,159 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,160 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,161 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:30:11,162 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:30:11,162 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,164 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,167 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:30:11,167 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:30:11,168 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:30:11,169 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:11,169 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:11,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:11,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:11,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:11,170 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:11,171 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:11,171 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:30:11,171 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 19.8ms
2025-11-24 14:30:11,172 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,172 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,173 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,174 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,175 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,176 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,176 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:30:11,176 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,177 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:30:11,177 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:30:11,178 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.2ms
2025-11-24 14:30:11,180 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:30:11,181 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:11,181 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:11,181 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:11,181 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:11,181 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:11,182 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:11,183 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:11,183 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:30:11,184 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,185 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,186 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,186 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,187 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,188 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,189 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:30:11,189 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:30:11,189 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,190 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,192 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:30:11,192 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:30:11,193 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:30:11,194 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:11,194 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:11,194 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:11,194 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:11,195 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:11,195 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:11,195 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:11,196 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:30:11,196 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.1ms
2025-11-24 14:30:11,197 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,198 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,199 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,200 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,201 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,201 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,202 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:30:11,202 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:11,203 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:30:11,203 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:30:11,204 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.0ms
2025-11-24 14:30:12,955 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:30:12,956 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:12,956 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:12,956 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:12,957 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:12,957 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:12,958 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:12,958 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:12,958 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:30:12,959 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,961 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,962 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,963 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,964 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,965 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,966 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:30:12,967 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:30:12,967 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:30:12,967 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,969 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:30:12,970 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,971 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:30:12,972 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:30:12,972 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:30:12,972 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:30:12,972 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:30:12,972 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:30:12,973 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.5ms
2025-11-24 14:30:12,975 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:30:12,975 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:12,975 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:12,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:12,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:12,976 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:12,977 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:12,977 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:12,977 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:30:12,978 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,979 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,981 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,982 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,983 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:30:12,984 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:30:12,984 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:30:12,984 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,986 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:30:12,986 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:12,988 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:30:12,988 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:30:12,988 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:30:12,988 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:30:12,988 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:30:12,988 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:30:12,989 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.4ms
2025-11-24 14:30:45,268 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:30:45,268 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:45,269 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:45,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:45,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:45,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:45,272 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:45,273 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:45,273 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:30:45,274 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,276 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,278 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,280 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,282 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,283 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,284 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:30:45,284 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:30:45,284 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,291 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,299 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:30:45,299 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:30:45,300 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:30:45,303 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:45,303 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:45,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:45,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:45,304 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:45,305 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:45,305 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:45,305 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:30:45,306 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,307 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,308 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,309 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,309 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,310 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,311 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:30:45,311 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,314 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:30:45,314 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:30:45,315 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 46.9ms
2025-11-24 14:30:45,316 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 15.7ms
2025-11-24 14:30:45,318 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:30:45,319 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:45,319 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:45,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:45,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:45,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:45,321 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:45,321 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:45,321 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:30:45,322 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,323 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,324 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,325 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,326 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,326 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,327 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:30:45,327 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:30:45,328 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,329 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,332 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:30:45,332 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:30:45,333 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:30:45,334 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:45,334 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:45,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:45,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:45,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:45,335 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:45,335 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:45,336 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:30:45,336 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 18.2ms
2025-11-24 14:30:45,336 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,337 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,339 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,341 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:30:45,341 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:45,342 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:30:45,342 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:30:45,343 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.0ms
2025-11-24 14:30:48,256 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:30:48,257 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:48,257 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:48,257 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:48,257 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:48,257 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:48,259 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:48,259 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:48,259 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:30:48,260 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,261 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,263 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,264 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,265 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,266 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,268 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:30:48,268 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:30:48,268 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:30:48,269 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,272 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:30:48,272 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,276 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:30:48,276 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:30:48,277 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:30:48,277 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:30:48,277 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:30:48,277 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:30:48,278 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 21.8ms
2025-11-24 14:30:48,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:30:48,280 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:48,280 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:48,280 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:48,281 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:48,281 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:48,282 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:48,282 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:48,282 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:30:48,283 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,284 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,285 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,286 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,287 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,287 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,288 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:30:48,288 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:30:48,288 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:30:48,289 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,290 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:30:48,290 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:48,292 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:30:48,292 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:30:48,292 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:30:48,292 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:30:48,292 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:30:48,292 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:30:48,293 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.4ms
2025-11-24 14:30:54,580 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:30:54,581 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:54,581 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:54,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:54,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:54,582 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:54,583 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:54,583 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:54,583 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:30:54,584 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,588 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,589 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,591 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,592 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:30:54,592 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:30:54,592 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,594 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,596 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:30:54,596 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:30:54,597 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:30:54,598 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:54,598 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:54,598 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:54,598 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:54,598 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:54,599 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:54,600 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:54,600 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:30:54,600 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,601 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,602 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,603 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,604 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,605 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,607 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:30:54,607 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,608 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:30:54,608 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:30:54,608 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 28.2ms
2025-11-24 14:30:54,609 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.4ms
2025-11-24 14:30:54,611 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:30:54,612 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:54,612 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:54,612 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:54,612 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:54,612 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:54,613 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:54,613 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:54,613 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:30:54,614 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,615 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,616 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,616 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,617 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,618 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,619 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:30:54,619 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:30:54,619 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,620 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,623 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:30:54,624 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:30:54,624 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:30:54,625 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:30:54,625 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:30:54,625 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:30:54,625 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:30:54,625 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:30:54,626 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:30:54,626 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:30:54,626 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:30:54,627 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,628 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,629 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,629 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,630 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,631 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,632 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:30:54,632 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:30:54,632 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:30:54,633 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:30:54,633 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 22.0ms
2025-11-24 14:30:54,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.5ms
2025-11-24 14:35:37,300 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 14:35:37,300 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 14:35:37,301 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.8ms
2025-11-24 14:35:37,301 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.7ms
2025-11-24 14:35:37,304 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:35:37,304 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:37,305 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:37,305 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:37,305 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:37,305 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:37,320 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:37,323 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 14:35:37,323 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:37,324 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:35:37,325 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,333 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,336 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,337 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,341 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:35:37,342 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:35:37,342 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:35:37,342 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,345 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:35:37,345 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,349 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:35:37,349 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:37,349 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:37,349 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:37,350 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:35:37,350 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:35:37,351 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 47.1ms
2025-11-24 14:35:37,353 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:35:37,354 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:37,354 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:37,354 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:37,354 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:37,355 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:37,356 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:37,356 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:37,357 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:35:37,358 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,359 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,360 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,361 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,362 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,363 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,364 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:35:37,364 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:35:37,364 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:35:37,365 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,366 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:35:37,367 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:37,368 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:35:37,369 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:37,369 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:37,369 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:37,369 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:35:37,369 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:35:37,370 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 16.6ms
2025-11-24 14:35:39,811 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 14:35:39,812 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.9ms
2025-11-24 14:35:39,812 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 14:35:39,813 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.8ms
2025-11-24 14:35:39,814 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:35:39,814 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:39,814 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:39,815 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:39,815 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:39,815 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:39,816 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:39,816 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:39,817 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:35:39,818 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,819 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,821 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,822 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,823 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,824 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,825 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:35:39,826 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:35:39,826 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,831 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,834 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:35:39,834 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:35:39,835 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 21.3ms
2025-11-24 14:35:39,837 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:35:39,837 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:39,837 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:39,838 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:39,838 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:39,838 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:39,839 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:39,839 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:39,839 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:35:39,840 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,841 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,842 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,843 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,843 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,844 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,845 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:35:39,845 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:35:39,846 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,848 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:39,849 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:35:39,850 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:35:39,850 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.3ms
2025-11-24 14:35:41,472 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:35:41,473 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:41,473 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:41,473 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:41,473 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:41,474 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:41,475 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:41,475 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:41,475 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:35:41,476 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,477 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,478 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,479 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,481 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,482 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,484 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:35:41,484 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:35:41,484 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:35:41,484 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,486 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:35:41,487 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,488 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:35:41,489 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:41,489 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:41,489 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:41,489 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:35:41,489 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:35:41,490 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.6ms
2025-11-24 14:35:41,492 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:35:41,492 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:41,492 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:41,493 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:41,493 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:41,493 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:41,494 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:41,494 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:41,495 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:35:41,496 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,497 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,498 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,501 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,503 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,504 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,505 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:35:41,505 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:35:41,505 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:35:41,506 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,507 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:35:41,508 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:41,509 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:35:41,510 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:41,510 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:41,510 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:41,510 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:35:41,510 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:35:41,511 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 19.6ms
2025-11-24 14:35:42,013 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:35:42,014 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:42,014 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:42,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:42,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:42,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:42,015 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:42,015 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:42,016 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:35:42,016 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,018 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,019 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,020 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,022 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,023 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,025 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:35:42,025 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:35:42,025 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,027 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,030 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:35:42,030 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:35:42,031 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 17.4ms
2025-11-24 14:35:42,033 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:35:42,033 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:42,033 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:42,033 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:42,034 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:42,034 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:42,035 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:42,035 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:42,035 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:35:42,036 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,037 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,038 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,038 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,039 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,040 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,041 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:35:42,041 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:35:42,041 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,042 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,044 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:35:42,045 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:35:42,045 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.7ms
2025-11-24 14:35:42,734 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:35:42,735 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:42,735 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:42,735 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:42,735 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:42,736 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:42,737 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:42,737 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:42,737 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:35:42,738 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,739 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,740 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,741 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,743 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,744 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,745 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:35:42,745 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:35:42,746 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:35:42,746 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,748 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:35:42,749 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,751 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:35:42,751 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:42,751 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:42,752 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:42,752 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:35:42,752 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:35:42,753 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.1ms
2025-11-24 14:35:42,754 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:35:42,755 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:42,755 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:42,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:42,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:42,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:42,756 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:42,756 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:42,757 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:35:42,757 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,758 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,759 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,760 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,761 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,762 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,763 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:35:42,763 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:35:42,763 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:35:42,763 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,766 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:35:42,766 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:42,768 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:35:42,768 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:42,768 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:42,768 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:42,768 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:35:42,768 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:35:42,769 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.5ms
2025-11-24 14:35:44,633 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:35:44,634 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:44,634 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:44,634 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:44,635 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:44,635 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:44,636 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:44,636 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:44,636 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:35:44,637 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,638 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,639 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,640 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,642 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,643 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,644 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:35:44,644 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:35:44,644 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,646 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,649 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:35:44,649 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:35:44,650 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.3ms
2025-11-24 14:35:44,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:35:44,653 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:44,653 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:44,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:44,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:44,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:44,654 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:44,654 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:44,654 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:35:44,655 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,656 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,657 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,658 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,658 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,659 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,660 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:35:44,660 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:35:44,660 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,661 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:44,663 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:35:44,663 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:35:44,664 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 11.5ms
2025-11-24 14:35:47,752 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:35:47,752 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:47,752 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:47,753 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:47,753 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:47,753 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:47,754 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:47,754 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:47,754 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:35:47,755 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,757 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,758 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,759 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,760 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,761 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,762 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:35:47,763 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:35:47,763 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:35:47,763 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,765 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:35:47,765 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,768 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:35:47,769 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:47,769 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:47,769 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:47,769 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:35:47,770 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:35:47,770 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.7ms
2025-11-24 14:35:47,772 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:35:47,773 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:47,773 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:47,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:47,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:47,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:47,774 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:47,775 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:47,775 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:35:47,776 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,777 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,777 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,778 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,779 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,780 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,781 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:35:47,781 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:35:47,781 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:35:47,781 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,783 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:35:47,783 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:47,785 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:35:47,785 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:47,785 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:47,786 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:47,786 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:35:47,786 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:35:47,787 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.5ms
2025-11-24 14:35:48,861 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 14:35:48,862 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.6ms
2025-11-24 14:35:48,863 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 14:35:48,863 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.4ms
2025-11-24 14:35:48,864 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:35:48,864 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:48,864 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:48,865 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:48,865 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:48,865 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:48,866 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:48,867 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:48,867 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:35:48,868 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,870 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,871 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,872 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,873 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,874 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,875 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:35:48,875 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:35:48,875 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,877 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:35:48,877 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:35:48,878 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 14.4ms
2025-11-24 14:35:48,880 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:35:48,880 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:48,881 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:48,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:48,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:48,881 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:48,882 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:48,883 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:48,883 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:35:48,884 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,885 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,886 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,887 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,888 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,889 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,890 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:35:48,890 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:35:48,891 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:48,891 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:35:48,891 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:35:48,892 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 11.9ms
2025-11-24 14:35:51,072 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 14:35:51,073 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:51,073 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:51,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:51,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:51,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:51,076 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:51,076 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:51,076 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 14:35:51,077 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:51,078 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:51,080 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:51,080 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:51,084 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:51,085 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:51,086 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:35:51,087 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 14:35:51,087 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:51,091 - app.utils.menu_helper - ERROR - Error procesando item de menú 4: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:35:51,092 - app.utils.menu_helper - ERROR - Error procesando item de menú 5: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:35:51,093 - app.utils.menu_helper - INFO - Árbol de menú construido con 0 items raíz.
2025-11-24 14:35:51,093 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 0 items raíz.
2025-11-24 14:35:51,094 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 21.5ms
2025-11-24 14:35:52,574 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 14:35:52,574 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:52,575 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:52,575 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:52,575 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:52,575 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:52,580 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:52,581 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:52,581 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 14:35:52,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:52,582 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:52,584 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:52,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:52,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:52,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:52,589 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:35:52,589 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 14:35:52,589 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:52,593 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 14:35:52,594 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 20.2ms
2025-11-24 14:35:54,188 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:35:54,189 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:54,189 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:54,189 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:54,189 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:54,189 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:54,193 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:54,194 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:54,194 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:35:54,195 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,197 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,199 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,201 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,202 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,203 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,204 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:35:54,204 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:35:54,204 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:35:54,205 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,208 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:35:54,208 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,212 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:35:54,213 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:54,213 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:54,213 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:54,213 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:35:54,213 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:35:54,214 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 25.9ms
2025-11-24 14:35:54,216 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:35:54,216 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:54,217 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:54,217 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:54,217 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:54,217 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:54,218 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:54,218 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:54,218 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:35:54,219 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,220 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,221 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,222 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,223 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,224 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,225 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:35:54,226 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:35:54,226 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:35:54,226 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,228 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:35:54,228 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:54,230 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:35:54,230 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:54,230 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:54,230 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:35:54,231 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:35:54,231 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:35:54,231 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.6ms
2025-11-24 14:35:55,540 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:35:55,541 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:55,541 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:55,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:55,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:55,542 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:55,543 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:55,543 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:55,543 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:35:55,544 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,545 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,547 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,548 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,550 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,551 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,552 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:35:55,552 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:35:55,553 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,558 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,563 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:35:55,563 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:35:55,563 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 23.3ms
2025-11-24 14:35:55,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:35:55,565 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:55,566 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:55,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:55,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:55,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:55,567 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:55,568 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:55,568 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:35:55,569 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,570 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,571 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,572 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,573 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,574 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,575 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:35:55,575 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:35:55,575 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,578 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:55,580 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:35:55,580 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:35:55,581 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.6ms
2025-11-24 14:35:56,283 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 14:35:56,284 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.1ms
2025-11-24 14:35:56,285 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 14:35:56,285 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 14:35:56,287 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 14:35:56,287 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.1ms
2025-11-24 14:35:56,288 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.2ms
2025-11-24 14:35:56,289 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.7ms
2025-11-24 14:35:56,290 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:35:56,291 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:56,291 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:56,291 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:56,292 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:56,292 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:56,293 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:56,293 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:56,294 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:35:56,295 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,296 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,297 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,298 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,299 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,300 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,301 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:35:56,301 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:35:56,301 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,306 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,313 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:35:56,313 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:35:56,314 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:35:56,314 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.6ms
2025-11-24 14:35:56,315 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:56,315 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:56,315 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:56,315 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:56,315 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:56,316 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:56,316 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:56,316 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:35:56,317 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,318 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,319 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,320 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,320 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,321 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,322 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:35:56,322 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,325 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:35:56,325 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:35:56,327 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.5ms
2025-11-24 14:35:56,328 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:35:56,329 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:56,329 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:56,329 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:56,329 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:56,330 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:56,331 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:56,331 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:56,331 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:35:56,332 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,333 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,333 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,334 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,335 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,336 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,337 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:35:56,337 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:35:56,337 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,341 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:35:56,341 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:35:56,342 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:35:56,342 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:35:56,342 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:35:56,343 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:35:56,343 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:35:56,343 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:35:56,344 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:35:56,344 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:35:56,345 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:35:56,345 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 17.1ms
2025-11-24 14:35:56,346 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,347 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,348 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,348 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,349 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,350 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,351 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:35:56,351 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:35:56,351 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:35:56,352 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:35:56,353 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.9ms
2025-11-24 14:36:11,121 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:36:11,122 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:11,122 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:11,122 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:11,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:11,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:11,124 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:11,124 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:11,124 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:36:11,125 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,126 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,128 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,129 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,130 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,132 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,133 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:36:11,133 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:36:11,133 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:36:11,133 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,136 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:36:11,136 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,138 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:36:11,138 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:36:11,138 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:36:11,139 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:36:11,139 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:36:11,139 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:36:11,140 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.3ms
2025-11-24 14:36:11,142 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:36:11,142 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:11,142 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:11,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:11,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:11,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:11,144 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:11,144 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:11,145 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:36:11,145 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,146 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,147 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,148 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,149 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,150 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,151 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:36:11,151 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:36:11,151 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:36:11,151 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,153 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:36:11,153 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:11,154 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:36:11,155 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:36:11,155 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:36:11,155 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:36:11,155 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:36:11,155 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:36:11,156 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.5ms
2025-11-24 14:36:12,337 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:36:12,337 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:12,338 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:12,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:12,339 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:12,339 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:12,341 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:12,341 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:12,342 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:36:12,344 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,349 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,351 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,353 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,355 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,356 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,358 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:36:12,358 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:36:12,358 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,361 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,364 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:36:12,364 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:36:12,365 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 28.0ms
2025-11-24 14:36:12,366 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:36:12,367 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:12,367 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:12,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:12,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:12,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:12,368 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:12,369 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:12,369 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:36:12,369 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,370 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,371 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,372 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,373 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,374 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,375 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:36:12,375 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:36:12,376 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,377 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:12,379 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:36:12,379 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:36:12,380 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.5ms
2025-11-24 14:36:13,215 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:36:13,215 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:13,216 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:13,216 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:13,216 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:13,216 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:13,217 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:13,217 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:13,217 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:36:13,218 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,219 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,221 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,222 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,223 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,224 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,226 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:36:13,226 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:36:13,226 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:36:13,226 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,229 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:36:13,229 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,231 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:36:13,231 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:36:13,232 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:36:13,232 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:36:13,232 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:36:13,232 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:36:13,233 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.9ms
2025-11-24 14:36:13,235 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:36:13,235 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:13,235 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:13,235 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:13,235 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:13,236 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:13,237 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:13,237 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:13,237 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:36:13,238 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,239 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,240 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,241 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,242 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,243 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,244 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:36:13,244 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:36:13,244 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:36:13,245 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,246 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:36:13,246 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,247 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:36:13,248 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:36:13,248 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:36:13,248 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:36:13,248 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:36:13,248 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:36:13,249 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.2ms
2025-11-24 14:36:13,989 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:36:13,989 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:13,989 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:13,989 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:13,990 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:13,990 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:13,991 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:13,991 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:13,992 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:36:13,992 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,994 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,995 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,996 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,998 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:13,999 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:14,000 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:36:14,000 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:36:14,000 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:14,002 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:14,004 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:36:14,004 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:36:14,005 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.0ms
2025-11-24 14:36:14,006 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:36:14,007 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:14,008 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:14,008 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:14,008 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:14,008 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:14,010 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:14,010 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:14,010 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:36:14,011 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:14,012 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:14,013 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:14,014 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:14,015 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:14,016 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:14,017 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:36:14,017 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:36:14,017 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:14,018 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:14,020 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:36:14,020 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:36:14,021 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 14.2ms
2025-11-24 14:36:45,651 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:36:45,651 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:45,652 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:45,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:45,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:45,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:45,654 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:45,654 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:45,654 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:36:45,655 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 14:36:45,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 401 4.5ms
2025-11-24 14:36:45,658 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:36:45,658 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:45,659 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:45,659 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:45,659 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:45,659 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:45,661 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:45,661 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:45,661 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:36:45,662 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 14:36:45,662 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 401 4.5ms
2025-11-24 14:36:45,665 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 14:36:45,665 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-24 14:36:45,668 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 14:36:45,668 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:45,668 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:45,669 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:45,669 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:45,669 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:45,670 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:45,670 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:45,670 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 14:36:45,673 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,677 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 2, Usuario 1, Tipo: web
2025-11-24 14:36:45,678 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,680 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: 2, Level: 4, Type: tenant_admin)
2025-11-24 14:36:45,680 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,686 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 14:36:45,686 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,688 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,692 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 14:36:45,692 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 5, Rotación: True
2025-11-24 14:36:45,693 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,697 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 14:36:45,697 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 14:36:45,698 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 14:36:45,698 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 5
2025-11-24 14:36:45,698 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-11-24 14:36:45,699 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 30.8ms
2025-11-24 14:36:45,705 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:36:45,706 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:45,706 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:45,706 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:45,706 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:45,707 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:45,708 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:45,708 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:45,709 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:36:45,709 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,710 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,711 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,712 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,713 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,715 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,716 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:36:45,716 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:36:45,716 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,718 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:36:45,718 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:36:45,719 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 13.9ms
2025-11-24 14:36:45,721 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:36:45,722 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:45,722 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:45,722 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:45,723 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:45,723 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:45,724 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:45,725 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:45,725 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:36:45,726 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,727 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,729 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,730 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,731 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,732 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,736 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:36:45,736 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:36:45,736 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:45,742 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:36:45,743 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:36:45,744 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 23.2ms
2025-11-24 14:36:48,547 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 14:36:48,547 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:48,548 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:48,548 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:48,548 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:48,548 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:48,549 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:48,549 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:48,550 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 14:36:48,550 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:48,551 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:48,552 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:48,553 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:48,554 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:48,555 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:48,555 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:36:48,556 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 14:36:48,556 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:48,559 - app.utils.menu_helper - ERROR - Error procesando item de menú 4: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:36:48,560 - app.utils.menu_helper - ERROR - Error procesando item de menú 5: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:36:48,561 - app.utils.menu_helper - INFO - Árbol de menú construido con 0 items raíz.
2025-11-24 14:36:48,561 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 0 items raíz.
2025-11-24 14:36:48,562 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 15.3ms
2025-11-24 14:36:56,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:36:56,282 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:56,282 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:56,282 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:56,282 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:56,282 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:56,287 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:56,287 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:56,287 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:36:56,288 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,290 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,291 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,293 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,295 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,296 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,298 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:36:56,298 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:36:56,298 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,306 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,313 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:36:56,314 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:36:56,315 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:36:56,316 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 35.6ms
2025-11-24 14:36:56,316 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:56,316 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:56,316 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:56,316 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:56,317 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:56,321 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:56,321 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:56,321 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:36:56,323 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,324 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,325 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,326 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,327 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,328 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,329 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:36:56,329 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,332 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:36:56,332 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:36:56,334 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 19.3ms
2025-11-24 14:36:56,335 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:36:56,335 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:56,336 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:56,336 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:56,336 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:56,336 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:56,339 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:56,339 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:56,339 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:36:56,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,341 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,342 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,343 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,344 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,345 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,346 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:36:56,346 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:36:56,346 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,351 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,357 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:36:56,357 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:36:56,358 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:36:56,359 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:36:56,359 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:36:56,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:36:56,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:36:56,360 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:36:56,361 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:36:56,361 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:36:56,361 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:36:56,362 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,363 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,363 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,364 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,365 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,366 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,367 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:36:56,367 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:36:56,368 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:36:56,368 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:36:56,369 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 34.3ms
2025-11-24 14:36:56,370 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.0ms
2025-11-24 14:41:40,095 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'assets', 'backend', 'admin', 'www', 'cdn', 'api', 'static'}
2025-11-24 14:46:40,424 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'www', 'admin', 'assets', 'cdn', 'api', 'backend', 'static'}
2025-11-24 14:49:05,850 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 14:49:05,851 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 14:49:05,855 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 4.8ms
2025-11-24 14:49:05,855 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 3.7ms
2025-11-24 14:49:05,859 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:49:05,859 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:05,860 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:05,860 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:05,860 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:05,860 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:05,912 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:05,916 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 14:49:05,916 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:05,916 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:49:05,919 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:05,945 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:05,947 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:05,948 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:05,949 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:05,950 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:05,951 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:49:05,951 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:49:05,952 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:49:05,952 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:05,954 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:49:05,954 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:05,960 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:49:05,960 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:05,960 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:05,961 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:05,961 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:49:05,961 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:49:05,962 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 103.5ms
2025-11-24 14:49:07,478 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'www', 'assets', 'static', 'admin', 'cdn', 'backend'}
2025-11-24 14:49:07,524 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:49:07,524 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 14:49:07,525 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 14:49:07,525 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 14:49:07,526 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 14:49:07,526 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:07,527 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:07,527 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:07,527 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:07,527 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:07,549 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:07,552 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 14:49:07,552 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:07,552 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:49:07,554 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,563 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,564 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,565 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,566 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,567 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,568 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:49:07,568 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:49:07,568 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:49:07,568 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,570 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:49:07,570 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,572 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:49:07,572 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:07,572 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:07,572 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:07,572 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:49:07,572 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:49:07,573 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 48.4ms
2025-11-24 14:49:07,573 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 48.1ms
2025-11-24 14:49:07,573 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 47.9ms
2025-11-24 14:49:07,573 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 47.8ms
2025-11-24 14:49:07,576 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 52.8ms
2025-11-24 14:49:07,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:49:07,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:49:07,579 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:07,579 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:07,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:07,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:07,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:07,580 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:07,580 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:07,580 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:49:07,581 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:07,581 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:07,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:07,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:07,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:07,582 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:07,582 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:07,582 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:49:07,582 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,583 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,584 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,588 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:49:07,588 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:49:07,588 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,594 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,601 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:49:07,601 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:49:07,602 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,603 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,604 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,604 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,605 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,606 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,607 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:49:07,607 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,618 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:49:07,618 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:49:07,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 40.9ms
2025-11-24 14:49:07,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 40.9ms
2025-11-24 14:49:07,621 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:49:07,622 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:07,622 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:07,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:07,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:07,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:07,636 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:07,636 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:07,636 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:49:07,637 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,639 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,641 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,642 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,643 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,644 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,644 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:49:07,645 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:49:07,645 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,646 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,648 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:49:07,648 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:49:07,649 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:49:07,649 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:07,650 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:07,650 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:07,650 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:07,650 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:07,651 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:07,651 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:07,651 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:49:07,652 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,652 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,653 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,654 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,655 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,655 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,656 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:49:07,656 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:07,657 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:49:07,657 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:49:07,658 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 37.0ms
2025-11-24 14:49:07,659 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.1ms
2025-11-24 14:49:10,267 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:49:10,267 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:10,268 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:10,268 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:10,268 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:10,268 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:10,269 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:10,269 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:10,269 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:49:10,270 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,271 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,272 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,274 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,275 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,278 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,279 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:49:10,279 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:49:10,279 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:49:10,280 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,281 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:49:10,282 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,283 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:49:10,283 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:10,283 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:10,283 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:10,284 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:49:10,284 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:49:10,285 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.7ms
2025-11-24 14:49:10,286 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:49:10,287 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:10,287 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:10,287 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:10,287 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:10,287 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:10,288 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:10,288 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:10,289 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:49:10,289 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,290 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,291 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,292 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,292 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,294 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,295 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:49:10,296 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:49:10,296 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:49:10,296 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,297 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:49:10,297 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:10,299 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:49:10,299 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:10,299 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:10,299 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:10,299 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:49:10,299 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:49:10,300 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.6ms
2025-11-24 14:49:12,349 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 14:49:12,350 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.1ms
2025-11-24 14:49:12,351 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 14:49:12,351 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.9ms
2025-11-24 14:49:12,353 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:49:12,353 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:12,353 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:12,353 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:12,354 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:12,354 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:12,355 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:12,356 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:12,356 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:49:12,357 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,358 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,360 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,361 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,362 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,363 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,365 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:49:12,365 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:49:12,365 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,369 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,373 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:49:12,373 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:49:12,374 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 20.9ms
2025-11-24 14:49:12,375 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:49:12,376 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:12,376 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:12,376 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:12,376 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:12,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:12,378 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:12,378 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:12,378 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:49:12,379 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,380 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,381 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,382 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,383 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,384 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,385 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:49:12,385 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:49:12,385 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,386 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:12,388 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:49:12,388 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:49:12,388 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.0ms
2025-11-24 14:49:13,530 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 14:49:13,531 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 14:49:13,532 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.3ms
2025-11-24 14:49:13,532 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 0.8ms
2025-11-24 14:49:13,534 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:49:13,534 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:13,534 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:13,534 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:13,535 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:13,535 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:13,536 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:13,536 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:13,537 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:49:13,538 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,545 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,550 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,553 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,555 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,556 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,557 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:49:13,557 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:49:13,558 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,561 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:49:13,561 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:49:13,562 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 28.0ms
2025-11-24 14:49:13,566 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:49:13,567 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:13,567 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:13,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:13,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:13,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:13,569 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:13,569 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:13,569 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:49:13,570 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,571 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,572 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,573 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,574 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,575 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,575 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:49:13,575 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:49:13,576 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:13,576 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:49:13,577 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:49:13,577 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 10.9ms
2025-11-24 14:49:15,467 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/area/2/tree/
2025-11-24 14:49:15,468 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/area/2/tree/ 200 0.6ms
2025-11-24 14:49:15,469 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 14:49:15,470 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:15,470 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:15,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:15,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:15,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:15,471 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:15,472 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:15,472 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 14:49:15,472 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:15,473 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:15,474 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:15,475 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:15,476 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:15,476 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:15,477 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:49:15,478 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 14:49:15,478 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:15,481 - app.utils.menu_helper - ERROR - Error procesando item de menú 4: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:49:15,483 - app.utils.menu_helper - ERROR - Error procesando item de menú 5: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:49:15,484 - app.utils.menu_helper - INFO - Árbol de menú construido con 0 items raíz.
2025-11-24 14:49:15,484 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 0 items raíz.
2025-11-24 14:49:15,485 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 15.2ms
2025-11-24 14:49:17,437 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/area/1/tree/
2025-11-24 14:49:17,438 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/area/1/tree/ 200 0.7ms
2025-11-24 14:49:17,439 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 14:49:17,439 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:17,440 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:17,440 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:17,440 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:17,440 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:17,441 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:17,441 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:17,441 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 14:49:17,442 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:17,442 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:17,443 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:17,444 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:17,445 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:17,446 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:17,446 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:49:17,447 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 14:49:17,447 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:17,447 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 14:49:17,448 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 8.7ms
2025-11-24 14:49:19,599 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 14:49:19,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/sessions/admin/
2025-11-24 14:49:19,600 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 1.2ms
2025-11-24 14:49:19,601 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/sessions/admin/ 200 1.0ms
2025-11-24 14:49:19,603 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 14:49:19,604 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:19,604 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:19,604 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:19,605 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:19,605 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:19,606 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:19,606 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:19,606 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/sessions/admin/
2025-11-24 14:49:19,607 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,608 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,609 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,610 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,611 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,612 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,613 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,614 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-24 14:49:19,614 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,618 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 2 sesiones activas recuperadas - Cliente 2
2025-11-24 14:49:19,618 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 2 sesiones activas totales.
2025-11-24 14:49:19,618 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 14.9ms
2025-11-24 14:49:19,621 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/sessions/admin/
2025-11-24 14:49:19,621 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:19,621 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:19,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:19,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:19,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:19,623 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:19,623 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:19,623 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/sessions/admin/
2025-11-24 14:49:19,624 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,625 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,625 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,626 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,627 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,628 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,628 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,629 - app.api.v1.endpoints.auth - INFO - [ADMIN] Solicitud /sessions/admin/ por usuario: admin_acme
2025-11-24 14:49:19,629 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:19,630 - app.services.refresh_token_service - INFO - [ADMIN-SESSIONS] 2 sesiones activas recuperadas - Cliente 2
2025-11-24 14:49:19,630 - app.api.v1.endpoints.auth - INFO - [ADMIN] Recuperadas 2 sesiones activas totales.
2025-11-24 14:49:19,631 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/sessions/admin/ 200 9.7ms
2025-11-24 14:49:20,729 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:49:20,730 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:20,730 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:20,730 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:20,730 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:20,731 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:20,732 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:20,732 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:20,732 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:49:20,733 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,735 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,738 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,742 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,744 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,746 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,747 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:49:20,747 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:49:20,747 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,749 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:49:20,749 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:49:20,750 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 20.4ms
2025-11-24 14:49:20,752 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:49:20,754 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:20,754 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:20,756 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:20,757 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:20,757 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:20,758 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:20,759 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:20,759 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:49:20,760 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,761 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,762 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,763 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,764 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,765 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,766 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:49:20,766 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:49:20,766 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:20,767 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:49:20,767 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:49:20,768 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 15.3ms
2025-11-24 14:49:22,488 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:49:22,488 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:22,488 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:22,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:22,489 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:22,489 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:22,490 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:22,490 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:22,490 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:49:22,491 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,492 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,493 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,495 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,496 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,497 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,498 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:49:22,499 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:49:22,499 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:49:22,499 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,501 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:49:22,501 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,503 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:49:22,503 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:22,503 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:22,504 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:22,504 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:49:22,504 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:49:22,505 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.2ms
2025-11-24 14:49:22,507 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:49:22,508 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:22,508 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:22,508 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:22,508 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:22,508 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:22,509 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:22,510 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:22,510 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:49:22,510 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,511 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,512 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,513 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,513 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,514 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,515 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:49:22,515 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:49:22,515 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:49:22,515 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,517 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:49:22,517 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:22,518 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:49:22,518 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:22,519 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:22,519 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:49:22,519 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:49:22,519 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:49:22,520 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 12.8ms
2025-11-24 14:49:27,780 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:49:27,781 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:27,781 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:27,782 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:27,782 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:27,782 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:27,783 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:27,783 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:27,784 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:49:27,785 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,786 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,788 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,789 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,791 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,792 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,793 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:49:27,793 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:49:27,793 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,796 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,799 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:49:27,799 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:49:27,800 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:49:27,801 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:27,801 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:27,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:27,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:27,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:27,802 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:27,803 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:27,803 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:49:27,803 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 22.7ms
2025-11-24 14:49:27,804 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,805 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,806 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,806 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,807 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,808 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,809 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:49:27,809 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,810 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:49:27,810 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:49:27,812 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.8ms
2025-11-24 14:49:27,813 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:49:27,814 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:27,814 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:27,814 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:27,814 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:27,815 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:27,816 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:27,816 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:27,816 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:49:27,817 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,818 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,819 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,819 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,820 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,821 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,822 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:49:27,822 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:49:27,822 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,824 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,825 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:49:27,826 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:49:27,826 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:49:27,827 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:49:27,827 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:49:27,827 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:49:27,827 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:49:27,828 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:49:27,829 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:49:27,829 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:49:27,829 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:49:27,830 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,831 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,832 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,833 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,834 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,835 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,836 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:49:27,836 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:49:27,837 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:49:27,837 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:49:27,837 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.0ms
2025-11-24 14:49:27,838 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.8ms
2025-11-24 14:49:54,861 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'static', 'admin', 'www', 'assets', 'backend', 'cdn', 'api'}
2025-11-24 14:50:00,055 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 14:50:00,055 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.9ms
2025-11-24 14:50:00,059 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 14:50:00,059 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:00,060 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:00,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:00,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:00,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:00,088 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:00,092 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 14:50:00,092 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:00,093 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 14:50:00,101 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,113 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 2, Usuario 1, Tipo: web
2025-11-24 14:50:00,114 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,115 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: 2, Level: 4, Type: tenant_admin)
2025-11-24 14:50:00,116 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,120 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 14:50:00,121 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,121 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,124 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 14:50:00,125 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 6, Rotación: True
2025-11-24 14:50:00,125 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,129 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 14:50:00,129 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 14:50:00,129 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 14:50:00,129 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 6
2025-11-24 14:50:00,130 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-11-24 14:50:00,131 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 72.1ms
2025-11-24 14:50:00,137 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 14:50:00,137 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-24 14:50:00,139 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 14:50:00,140 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:00,140 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:00,140 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:00,140 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:00,140 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:00,142 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:00,142 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:00,142 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/me/
2025-11-24 14:50:00,143 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,144 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-11-24 14:50:00,144 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-24 14:50:00,144 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 2
2025-11-24 14:50:00,145 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,149 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,153 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,156 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 14:50:00,156 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-24 14:50:00,157 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 17.8ms
2025-11-24 14:50:00,185 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 14:50:00,186 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-11-24 14:50:00,186 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:50:00,187 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:00,188 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:00,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:00,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:00,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:00,189 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:00,189 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:00,189 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:50:00,189 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:50:00,190 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 14:50:00,191 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,192 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,194 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,195 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,196 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,197 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,198 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:50:00,198 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:50:00,198 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,200 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,202 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:50:00,202 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:50:00,202 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:00,203 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:00,203 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:00,203 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:00,203 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:00,204 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:00,204 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:00,204 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:50:00,205 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,206 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,207 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,208 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,210 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,210 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,211 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:50:00,211 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,212 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:50:00,212 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:50:00,213 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 23.1ms
2025-11-24 14:50:00,214 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 14:50:00,214 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 28.0ms
2025-11-24 14:50:00,215 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:00,215 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:00,215 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:00,215 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:00,215 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:00,216 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:00,217 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:00,217 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 14:50:00,217 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 27.7ms
2025-11-24 14:50:00,218 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,219 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,220 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,220 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,221 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 14:50:00,221 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 14:50:00,221 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,222 - app.db.queries - ERROR - Error en execute_procedure_params: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:50:00,223 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 175, in execute_procedure_params
    cursor.execute(query, tuple(params.values()))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 187, in execute_procedure_params
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:50:00,225 - app.services.menu_service - ERROR - Error de BD al obtener menú para usuario 1: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:50:00,225 - app.api.v1.endpoints.menus - ERROR - Error de servicio en GET /getmenu/ para usuario 1: Error de base de datos al obtener menú del usuario
2025-11-24 14:50:00,228 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 13.9ms
2025-11-24 14:50:00,228 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:50:00,229 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:50:00,229 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:00,230 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:00,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:00,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:00,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:00,231 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:00,232 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:00,232 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:50:00,233 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,234 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,235 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,236 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,237 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,237 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,238 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:50:00,238 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:50:00,238 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,240 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,244 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:50:00,244 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:50:00,245 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:00,245 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:00,245 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:00,245 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:00,245 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:00,246 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:00,246 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:00,246 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:50:00,247 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,248 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,249 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,250 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,251 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,252 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,253 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:50:00,253 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,254 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:50:00,254 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:50:00,254 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 14:50:00,255 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:00,255 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:00,255 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:00,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:00,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:00,257 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:00,257 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:00,258 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 14:50:00,259 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,260 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,261 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,262 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,263 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 14:50:00,263 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 14:50:00,263 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:00,264 - app.db.queries - ERROR - Error en execute_procedure_params: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:50:00,264 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 175, in execute_procedure_params
    cursor.execute(query, tuple(params.values()))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 187, in execute_procedure_params
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:50:00,266 - app.services.menu_service - ERROR - Error de BD al obtener menú para usuario 1: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:50:00,266 - app.api.v1.endpoints.menus - ERROR - Error de servicio en GET /getmenu/ para usuario 1: Error de base de datos al obtener menú del usuario
2025-11-24 14:50:00,266 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 38.2ms
2025-11-24 14:50:00,267 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 38.1ms
2025-11-24 14:50:00,268 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 13.9ms
2025-11-24 14:50:02,727 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:50:02,728 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:02,729 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:02,729 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:02,729 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:02,730 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:02,731 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:02,732 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:02,732 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:50:02,733 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,734 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,736 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,737 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,738 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,739 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,740 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:50:02,741 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:50:02,741 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:50:02,741 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,743 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:50:02,744 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,746 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:50:02,746 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:50:02,746 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:50:02,746 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:50:02,747 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:50:02,747 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:50:02,748 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 20.3ms
2025-11-24 14:50:02,750 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:50:02,750 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:02,750 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:02,750 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:02,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:02,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:02,752 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:02,752 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:02,752 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:50:02,753 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,754 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,755 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,756 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,757 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,757 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,758 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:50:02,758 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:50:02,759 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:50:02,759 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,761 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:50:02,761 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:02,763 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:50:02,764 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:50:02,764 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:50:02,764 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:50:02,764 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:50:02,764 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:50:02,765 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.2ms
2025-11-24 14:50:03,775 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:50:03,776 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:03,776 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:03,776 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:03,776 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:03,776 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:03,778 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:03,778 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:03,778 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:50:03,779 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,780 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,782 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,783 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,784 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,785 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,786 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:50:03,787 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:50:03,787 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,789 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,791 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:50:03,791 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:50:03,792 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.7ms
2025-11-24 14:50:03,794 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:50:03,794 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:03,795 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:03,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:03,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:03,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:03,797 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:03,797 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:03,797 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:50:03,798 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,799 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,800 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,801 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,802 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,803 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,804 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:50:03,804 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:50:03,804 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,805 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:03,807 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:50:03,807 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:50:03,807 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.7ms
2025-11-24 14:50:06,677 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:50:06,678 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:06,678 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:06,678 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:06,679 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:06,679 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:06,680 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:06,681 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:06,681 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:50:06,682 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,683 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,685 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,686 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,687 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,688 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,689 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:50:06,689 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:50:06,690 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,691 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:50:06,691 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:50:06,692 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 14.4ms
2025-11-24 14:50:06,694 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:50:06,694 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:06,694 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:06,694 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:06,695 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:06,695 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:06,696 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:06,697 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:06,697 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:50:06,698 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,700 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,701 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,702 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,703 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,704 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,705 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:50:06,705 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:50:06,705 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:06,706 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:50:06,706 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:50:06,707 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 13.4ms
2025-11-24 14:50:18,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:50:18,281 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:18,281 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:18,282 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:18,282 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:18,282 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:18,286 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:18,286 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:18,286 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:50:18,287 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,289 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,292 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,293 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,295 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,296 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,297 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:50:18,297 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:50:18,297 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,300 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,307 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:50:18,307 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:50:18,308 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:50:18,308 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:18,308 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:18,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:18,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:18,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:18,310 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:18,310 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:18,311 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:50:18,311 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,312 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,313 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,314 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,315 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,316 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,316 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:50:18,317 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,317 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:50:18,318 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:50:18,318 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 37.8ms
2025-11-24 14:50:18,319 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.4ms
2025-11-24 14:50:18,321 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:50:18,321 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:50:18,322 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:18,322 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:18,322 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:18,322 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:18,322 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:18,323 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:18,323 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:18,324 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:50:18,325 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,326 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,327 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,328 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,329 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,330 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,331 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:50:18,331 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:50:18,331 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,333 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,334 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:50:18,335 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:50:18,335 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:50:18,335 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:50:18,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:50:18,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:50:18,336 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:50:18,336 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:50:18,336 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:50:18,337 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:50:18,337 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,339 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,341 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,342 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,343 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:50:18,343 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:50:18,344 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:50:18,344 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:50:18,345 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.2ms
2025-11-24 14:50:18,345 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 24.0ms
2025-11-24 14:52:02,784 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:52:02,785 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:02,785 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:52:02,785 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:52:02,785 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:02,785 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:52:02,800 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:52:02,800 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:52:02,801 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:52:02,802 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,812 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,813 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,814 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,815 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,816 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,816 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:52:02,817 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:52:02,817 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,819 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:52:02,819 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:52:02,820 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 35.4ms
2025-11-24 14:52:02,822 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:52:02,822 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:02,822 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:52:02,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:52:02,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:02,823 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:52:02,825 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:52:02,825 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:52:02,825 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:52:02,826 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,828 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,829 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,830 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,831 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,832 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,833 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:52:02,833 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:52:02,833 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:02,834 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:52:02,835 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:52:02,835 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 13.8ms
2025-11-24 14:52:05,360 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 14:52:05,360 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:05,361 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:52:05,361 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:52:05,361 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:05,361 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:52:05,362 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:52:05,363 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:52:05,363 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 14:52:05,364 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:05,365 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:05,366 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:05,366 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:05,367 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:05,368 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:05,369 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:52:05,369 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 14:52:05,370 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:05,373 - app.utils.menu_helper - ERROR - Error procesando item de menú 4: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:52:05,375 - app.utils.menu_helper - ERROR - Error procesando item de menú 5: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:52:05,375 - app.utils.menu_helper - INFO - Árbol de menú construido con 0 items raíz.
2025-11-24 14:52:05,376 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 0 items raíz.
2025-11-24 14:52:05,376 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 16.4ms
2025-11-24 14:52:07,403 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 14:52:07,404 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:07,404 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:52:07,404 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:52:07,404 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:07,405 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:52:07,406 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:52:07,406 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:52:07,406 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 14:52:07,407 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:07,407 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:07,408 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:07,409 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:07,410 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:07,411 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:07,412 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:52:07,412 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 14:52:07,413 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:07,413 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 14:52:07,414 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 10.8ms
2025-11-24 14:52:10,224 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:52:10,224 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:10,225 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:52:10,225 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:52:10,225 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:10,225 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:52:10,226 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:52:10,226 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:52:10,226 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:52:10,227 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,228 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,229 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,231 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,232 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,233 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,235 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:52:10,235 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:52:10,235 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:52:10,236 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,238 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:52:10,238 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,243 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:52:10,243 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:52:10,243 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:52:10,244 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:52:10,244 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:52:10,244 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:52:10,245 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 20.8ms
2025-11-24 14:52:10,246 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:52:10,247 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:10,247 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:52:10,247 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:52:10,247 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:10,247 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:52:10,249 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:52:10,249 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:52:10,249 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:52:10,251 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,252 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,253 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,254 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,255 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,255 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,256 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:52:10,256 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:52:10,257 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:52:10,257 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,259 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:52:10,259 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:10,260 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:52:10,260 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:52:10,261 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:52:10,261 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:52:10,261 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:52:10,261 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:52:10,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.4ms
2025-11-24 14:52:11,049 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:52:11,049 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:11,049 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:52:11,049 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:52:11,050 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:11,050 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:52:11,051 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:52:11,051 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:52:11,051 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:52:11,052 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,053 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,054 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,055 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,056 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,057 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,058 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:52:11,059 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:52:11,059 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,061 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,070 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:52:11,070 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:52:11,071 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:52:11,071 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 22.7ms
2025-11-24 14:52:11,072 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:11,072 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:52:11,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:52:11,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:11,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:52:11,073 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:52:11,073 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:52:11,073 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:52:11,074 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,075 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,076 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,077 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,078 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,078 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,079 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:52:11,079 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,080 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:52:11,080 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:52:11,083 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.9ms
2025-11-24 14:52:11,083 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:52:11,084 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:11,085 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:52:11,085 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:52:11,085 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:11,085 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:52:11,086 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:52:11,086 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:52:11,086 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:52:11,087 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,088 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,089 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,090 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,091 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,092 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,092 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:52:11,093 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:52:11,093 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,095 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,097 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:52:11,097 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:52:11,098 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:52:11,099 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:11,099 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:52:11,100 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:52:11,100 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:11,100 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:52:11,101 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:52:11,101 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:52:11,101 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:52:11,102 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,103 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,104 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,104 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,105 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,106 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,107 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:52:11,107 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:11,107 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:52:11,107 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:52:11,108 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.6ms
2025-11-24 14:52:11,109 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.6ms
2025-11-24 14:52:12,113 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:52:12,113 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:12,114 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:52:12,114 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:52:12,114 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:12,114 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:52:12,115 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:52:12,115 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:52:12,116 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:52:12,116 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,118 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,120 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,121 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,122 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,123 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,124 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:52:12,124 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:52:12,125 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:52:12,125 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,127 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:52:12,127 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,129 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:52:12,129 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:52:12,130 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:52:12,130 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:52:12,130 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:52:12,130 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:52:12,131 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.1ms
2025-11-24 14:52:12,134 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:52:12,135 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:12,135 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:52:12,135 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:52:12,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:12,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:52:12,137 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:52:12,137 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:52:12,137 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:52:12,138 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,139 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,140 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,140 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,141 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,142 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,143 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:52:12,143 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:52:12,143 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:52:12,143 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,145 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:52:12,145 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:52:12,146 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:52:12,147 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:52:12,147 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:52:12,147 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:52:12,147 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:52:12,147 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:52:12,148 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.8ms
2025-11-24 14:52:18,165 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-24 14:52:18,165 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:18,166 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 14:52:18,166 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 14:52:18,166 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:18,166 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 14:52:18,166 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 14:52:18,166 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 14:52:18,167 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-24 14:52:18,167 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.4ms
2025-11-24 14:52:18,259 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-24 14:52:18,259 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:18,260 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 14:52:18,260 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 14:52:18,260 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:18,260 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 14:52:18,260 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 14:52:18,261 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 14:52:18,261 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-24 14:52:18,411 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 152.3ms
2025-11-24 14:52:33,273 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:52:33,274 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:33,274 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 14:52:33,274 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 14:52:33,274 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:33,274 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 14:52:33,275 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 14:52:33,275 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 14:52:33,275 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-24 14:52:33,276 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 401 2.3ms
2025-11-24 14:52:47,779 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 14:52:47,779 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:47,779 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 14:52:47,779 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 14:52:47,779 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:47,780 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 14:52:47,780 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 14:52:47,780 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 14:52:47,780 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 14:52:47,785 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 14:52:47,785 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 14:52:47,785 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 14:52:48,026 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 14:52:48,026 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-24 14:52:48,026 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-24 14:52:48,027 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 14:52:48,030 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 14:52:48,030 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11344, Rotación: False
2025-11-24 14:52:48,030 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11344
2025-11-24 14:52:48,031 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-24 14:52:48,031 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 252.7ms
2025-11-24 14:52:53,852 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:52:53,853 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:52:53,853 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 14:52:53,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 14:52:53,854 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:52:53,854 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 14:52:53,854 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 14:52:53,854 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 14:52:53,854 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-24 14:52:53,878 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:52:53,878 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-24 14:52:53,890 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:52:53,890 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-24 14:52:53,891 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 38.5ms
2025-11-24 14:55:52,309 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:55:52,309 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:55:52,310 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:55:52,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:55:52,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:55:52,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:55:52,324 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:55:52,327 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 14:55:52,327 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:55:52,328 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:55:52,329 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,336 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,339 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,341 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,342 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,343 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:55:52,344 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:55:52,344 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,349 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,353 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:55:52,354 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:55:52,355 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 45.8ms
2025-11-24 14:55:52,357 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:55:52,359 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:55:52,359 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:55:52,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:55:52,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:55:52,360 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:55:52,361 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:55:52,361 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:55:52,361 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:55:52,362 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,363 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,364 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,365 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,367 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,368 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,368 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:55:52,369 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:55:52,369 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,370 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:52,372 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:55:52,372 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:55:52,373 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.2ms
2025-11-24 14:55:53,103 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:55:53,104 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:55:53,104 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:55:53,104 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:55:53,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:55:53,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:55:53,106 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:55:53,106 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:55:53,106 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:55:53,107 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,108 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,111 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,112 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,114 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,115 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,116 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:55:53,116 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:55:53,117 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:55:53,117 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,119 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:55:53,120 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,124 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:55:53,125 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:55:53,125 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:55:53,125 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:55:53,125 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:55:53,126 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:55:53,126 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 23.0ms
2025-11-24 14:55:53,129 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:55:53,129 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:55:53,130 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:55:53,130 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:55:53,130 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:55:53,130 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:55:53,131 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:55:53,131 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:55:53,131 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:55:53,132 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,133 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,134 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,134 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,136 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,136 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,137 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:55:53,137 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:55:53,138 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:55:53,138 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,139 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:55:53,139 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:53,141 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:55:53,141 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:55:53,141 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:55:53,142 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:55:53,142 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:55:53,142 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:55:53,143 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.8ms
2025-11-24 14:55:55,290 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:55:55,291 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:55:55,291 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:55:55,291 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:55:55,291 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:55:55,291 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:55:55,292 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:55:55,293 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:55:55,293 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:55:55,294 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,295 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,297 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,298 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,299 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,300 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,301 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:55:55,301 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:55:55,301 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,303 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,305 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:55:55,305 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:55:55,306 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.7ms
2025-11-24 14:55:55,308 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:55:55,308 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:55:55,308 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:55:55,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:55:55,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:55:55,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:55:55,310 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:55:55,311 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:55:55,311 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:55:55,312 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,313 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,314 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,315 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,316 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,317 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,318 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:55:55,318 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:55:55,318 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,320 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:55,321 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:55:55,321 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:55:55,322 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 14.1ms
2025-11-24 14:55:56,386 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:55:56,386 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:55:56,386 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:55:56,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:55:56,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:55:56,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:55:56,388 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:55:56,388 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:55:56,388 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:55:56,389 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,390 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,392 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,393 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,396 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,397 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,398 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:55:56,399 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:55:56,399 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:55:56,399 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,401 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:55:56,401 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,403 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:55:56,403 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:55:56,403 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:55:56,403 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:55:56,403 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:55:56,404 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:55:56,404 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.9ms
2025-11-24 14:55:56,406 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:55:56,407 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:55:56,407 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:55:56,407 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:55:56,407 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:55:56,407 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:55:56,408 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:55:56,408 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:55:56,409 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:55:56,409 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,410 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,412 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,413 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,414 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,415 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,416 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:55:56,416 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:55:56,416 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:55:56,416 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,418 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:55:56,418 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:56,419 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:55:56,419 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:55:56,420 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:55:56,420 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:55:56,420 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:55:56,420 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:55:56,421 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.4ms
2025-11-24 14:55:58,285 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:55:58,286 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:55:58,286 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:55:58,286 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:55:58,287 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:55:58,287 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:55:58,288 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:55:58,288 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:55:58,288 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:55:58,289 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,290 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,291 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,292 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,294 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,294 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,296 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:55:58,296 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:55:58,296 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,300 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,307 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:55:58,307 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:55:58,308 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:55:58,308 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:55:58,309 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:55:58,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:55:58,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:55:58,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:55:58,310 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:55:58,310 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:55:58,310 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:55:58,310 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.9ms
2025-11-24 14:55:58,311 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,311 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,312 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,313 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,315 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,316 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,316 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:55:58,317 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,317 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:55:58,317 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:55:58,319 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.5ms
2025-11-24 14:55:58,320 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:55:58,320 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:55:58,320 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:55:58,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:55:58,321 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:55:58,321 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:55:58,322 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:55:58,322 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:55:58,322 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:55:58,323 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,324 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,325 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,325 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,326 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,327 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,328 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:55:58,328 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:55:58,328 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,330 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,333 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:55:58,333 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:55:58,334 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:55:58,335 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:55:58,335 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:55:58,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:55:58,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:55:58,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:55:58,336 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:55:58,336 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:55:58,336 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:55:58,337 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 17.0ms
2025-11-24 14:55:58,337 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,339 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,341 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,342 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:55:58,342 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:55:58,342 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:55:58,342 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:55:58,344 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.5ms
2025-11-24 14:59:03,030 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:59:03,031 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:03,031 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:03,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:03,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:03,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:03,048 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:03,049 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:03,049 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:59:03,050 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,060 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,062 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,063 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,064 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,064 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,065 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:59:03,065 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:59:03,066 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,068 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:59:03,068 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:59:03,069 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 38.6ms
2025-11-24 14:59:03,071 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:59:03,071 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:03,072 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:03,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:03,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:03,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:03,074 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:03,074 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:03,075 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:59:03,076 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,077 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,078 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,079 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,080 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,081 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,082 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:59:03,082 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:59:03,082 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:03,083 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:59:03,083 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:59:03,084 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 12.8ms
2025-11-24 14:59:05,052 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 14:59:05,052 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:05,052 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:05,053 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:05,053 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:05,053 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:05,054 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:05,054 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:05,054 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 14:59:05,055 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:05,056 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:05,057 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:05,058 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:05,059 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:05,060 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:05,061 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:59:05,061 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 14:59:05,061 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:05,064 - app.utils.menu_helper - ERROR - Error procesando item de menú 4: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:59:05,065 - app.utils.menu_helper - ERROR - Error procesando item de menú 5: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:59:05,065 - app.utils.menu_helper - INFO - Árbol de menú construido con 0 items raíz.
2025-11-24 14:59:05,066 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 0 items raíz.
2025-11-24 14:59:05,066 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 14.2ms
2025-11-24 14:59:06,685 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 14:59:06,686 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:06,686 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:06,686 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:06,686 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:06,687 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:06,688 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:06,688 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:06,688 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 14:59:06,688 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:06,689 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:06,690 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:06,691 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:06,692 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:06,693 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:06,694 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:59:06,694 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 14:59:06,694 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:06,695 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 14:59:06,696 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 10.4ms
2025-11-24 14:59:07,805 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:59:07,806 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:07,806 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:07,806 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:07,806 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:07,806 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:07,807 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:07,808 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:07,808 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:59:07,809 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,810 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,812 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,813 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,815 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,816 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,817 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:59:07,817 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:59:07,818 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,820 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,824 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:59:07,824 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:59:07,825 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 19.9ms
2025-11-24 14:59:07,827 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:59:07,828 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:07,828 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:07,828 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:07,828 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:07,828 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:07,830 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:07,830 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:07,830 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:59:07,831 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,832 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,833 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,833 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,834 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,835 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,836 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:59:07,836 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:59:07,836 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,838 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:07,839 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:59:07,839 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:59:07,840 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.6ms
2025-11-24 14:59:08,687 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 14:59:08,687 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.7ms
2025-11-24 14:59:08,688 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 14:59:08,689 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.6ms
2025-11-24 14:59:08,690 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:59:08,690 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:08,691 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:08,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:08,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:08,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:08,692 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:08,693 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:08,693 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:59:08,694 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,696 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,697 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,698 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,699 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,700 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,701 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:59:08,701 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:59:08,702 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:59:08,702 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,703 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:59:08,704 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,708 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:59:08,708 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:59:08,708 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:59:08,708 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:59:08,708 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:59:08,709 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:59:08,709 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 19.4ms
2025-11-24 14:59:08,712 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:59:08,712 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:08,712 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:08,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:08,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:08,713 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:08,714 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:08,714 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:08,715 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:59:08,715 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,716 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,717 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,718 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,718 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,719 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,720 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:59:08,720 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:59:08,720 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:59:08,720 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,722 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:59:08,722 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:08,723 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:59:08,724 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:59:08,724 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:59:08,724 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:59:08,724 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:59:08,724 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:59:08,725 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 12.9ms
2025-11-24 14:59:09,154 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 14:59:09,155 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.5ms
2025-11-24 14:59:09,156 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:59:09,157 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:09,157 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:09,157 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:09,157 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:09,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:09,159 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:09,159 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:09,159 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:59:09,160 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,162 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,164 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,165 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,166 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,167 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,168 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:59:09,168 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:59:09,168 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,170 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,178 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:59:09,179 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:59:09,180 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 14:59:09,181 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 14:59:09,181 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 0.9ms
2025-11-24 14:59:09,182 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 0.7ms
2025-11-24 14:59:09,182 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 25.6ms
2025-11-24 14:59:09,185 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:59:09,185 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:59:09,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:09,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:09,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:09,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:09,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:09,187 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:09,187 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:09,188 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:59:09,188 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,189 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,190 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,190 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,191 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,192 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,193 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:59:09,193 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:59:09,193 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,196 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,198 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:59:09,198 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:59:09,198 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:09,199 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:09,199 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:09,199 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:09,199 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:09,200 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:09,200 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:09,200 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:59:09,200 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,201 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,202 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,202 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,203 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,204 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,205 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:59:09,205 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,206 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:59:09,206 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:59:09,207 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 21.7ms
2025-11-24 14:59:09,207 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 21.5ms
2025-11-24 14:59:09,209 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:59:09,209 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:09,210 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:09,210 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:09,210 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:09,210 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:09,211 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:09,211 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:09,212 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:59:09,212 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,214 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,215 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,215 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,216 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,217 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,218 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:59:09,218 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:09,219 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:59:09,219 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:59:09,219 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.6ms
2025-11-24 14:59:10,211 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:59:10,212 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:10,212 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:10,212 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:10,212 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:10,212 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:10,214 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:10,214 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:10,214 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:59:10,215 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,216 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,217 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,219 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,220 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,221 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,222 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:59:10,222 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:59:10,223 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,224 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:59:10,224 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:59:10,225 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 13.5ms
2025-11-24 14:59:10,226 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:59:10,227 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:10,227 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:10,227 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:10,227 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:10,228 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:10,229 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:10,229 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:10,229 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:59:10,230 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,232 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,233 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,233 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,234 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,235 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,236 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:59:10,236 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:59:10,236 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:10,237 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:59:10,237 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:59:10,238 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 11.1ms
2025-11-24 14:59:12,449 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 14:59:12,450 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:12,450 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:12,450 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:12,450 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:12,451 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:12,452 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:12,452 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:12,452 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 14:59:12,453 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:12,454 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:12,454 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:12,455 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:12,456 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:12,457 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:12,458 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:59:12,458 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 14:59:12,458 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:12,459 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 14:59:12,460 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 10.4ms
2025-11-24 14:59:13,825 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 14:59:13,825 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:13,825 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:13,826 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:13,826 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:13,826 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:13,827 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:13,827 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:13,828 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 14:59:13,829 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,834 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 2, Usuario 1, Tipo: web
2025-11-24 14:59:13,834 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,837 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: 2, Level: 4, Type: tenant_admin)
2025-11-24 14:59:13,837 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,844 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 14:59:13,844 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,845 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,848 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 14:59:13,848 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 7, Rotación: True
2025-11-24 14:59:13,849 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,854 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 14:59:13,855 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 14:59:13,855 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 14:59:13,855 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 7
2025-11-24 14:59:13,856 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-11-24 14:59:13,856 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 31.4ms
2025-11-24 14:59:13,860 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 14:59:13,860 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:13,861 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:13,861 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:13,861 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:13,861 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:13,862 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:13,862 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:13,863 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/me/
2025-11-24 14:59:13,863 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,866 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-11-24 14:59:13,866 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-24 14:59:13,866 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 2
2025-11-24 14:59:13,866 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,872 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,877 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,880 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 14:59:13,880 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-24 14:59:13,880 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 20.4ms
2025-11-24 14:59:13,902 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 14:59:13,903 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 14:59:13,904 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 14:59:13,904 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.7ms
2025-11-24 14:59:13,904 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.2ms
2025-11-24 14:59:13,904 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:13,905 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:13,905 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:13,905 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:13,905 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:13,906 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:13,907 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:13,907 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 14:59:13,908 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,909 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,909 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,910 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,911 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 14:59:13,911 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 14:59:13,911 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,912 - app.db.queries - ERROR - Error en execute_procedure_params: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:59:13,912 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 175, in execute_procedure_params
    cursor.execute(query, tuple(params.values()))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 187, in execute_procedure_params
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:59:13,914 - app.services.menu_service - ERROR - Error de BD al obtener menú para usuario 1: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:59:13,914 - app.api.v1.endpoints.menus - ERROR - Error de servicio en GET /getmenu/ para usuario 1: Error de base de datos al obtener menú del usuario
2025-11-24 14:59:13,915 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:59:13,917 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:13,917 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:13,917 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:13,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:13,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:13,919 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:13,919 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:13,919 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:59:13,920 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 16.1ms
2025-11-24 14:59:13,920 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,921 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,922 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,923 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,924 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,925 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,925 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:59:13,925 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:59:13,926 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,926 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:59:13,927 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:59:13,928 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 12.2ms
2025-11-24 14:59:13,929 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 14:59:13,930 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:13,930 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:13,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:13,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:13,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:13,931 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:13,932 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:13,932 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 14:59:13,933 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,935 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,936 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,937 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,938 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 14:59:13,938 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 14:59:13,938 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,939 - app.db.queries - ERROR - Error en execute_procedure_params: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:59:13,939 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 175, in execute_procedure_params
    cursor.execute(query, tuple(params.values()))
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 187, in execute_procedure_params
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:59:13,940 - app.services.menu_service - ERROR - Error de BD al obtener menú para usuario 1: Error en el procedimiento: ('42000', "[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Could not find stored procedure 'sp_GetMenuForUser'. (2812) (SQLExecDirectW)")
2025-11-24 14:59:13,940 - app.api.v1.endpoints.menus - ERROR - Error de servicio en GET /getmenu/ para usuario 1: Error de base de datos al obtener menú del usuario
2025-11-24 14:59:13,942 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 14:59:13,942 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:13,943 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:13,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:13,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:13,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:13,944 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:13,944 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:13,944 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 14:59:13,945 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 15.8ms
2025-11-24 14:59:13,945 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,946 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,947 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,948 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,949 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,950 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,951 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:59:13,952 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 14:59:13,952 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:13,953 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 14:59:13,953 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 14:59:13,954 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 12.6ms
2025-11-24 14:59:15,975 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/area/2/tree/
2025-11-24 14:59:15,976 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/area/2/tree/ 200 0.7ms
2025-11-24 14:59:15,978 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 14:59:15,978 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:15,978 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:15,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:15,979 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:15,979 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:15,980 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:15,980 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:15,980 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 14:59:15,981 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:15,982 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:15,983 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:15,984 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:15,985 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:15,986 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:15,987 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:59:15,988 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 14:59:15,988 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:15,989 - app.utils.menu_helper - ERROR - Error procesando item de menú 4: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:59:15,990 - app.utils.menu_helper - ERROR - Error procesando item de menú 5: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 14:59:15,991 - app.utils.menu_helper - INFO - Árbol de menú construido con 0 items raíz.
2025-11-24 14:59:15,991 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 0 items raíz.
2025-11-24 14:59:15,991 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 13.8ms
2025-11-24 14:59:17,357 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/1/tree/
2025-11-24 14:59:17,357 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:17,358 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:17,358 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:17,358 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:17,358 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:17,359 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:17,359 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:17,359 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/1/tree/
2025-11-24 14:59:17,360 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:17,361 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:17,361 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:17,362 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:17,363 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:17,364 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:17,365 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/1/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 14:59:17,365 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 1
2025-11-24 14:59:17,365 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:17,366 - app.services.menu_service - INFO - No se encontraron menús para el cliente 2, área ID: 1.
2025-11-24 14:59:17,366 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/1/tree/ 200 9.3ms
2025-11-24 14:59:51,386 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:59:51,387 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:51,387 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:51,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:51,388 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:51,388 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:51,389 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:51,390 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:51,390 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:59:51,391 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,392 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,394 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,395 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,396 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,397 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,398 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:59:51,398 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:59:51,399 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,401 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,405 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:59:51,405 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:59:51,406 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:59:51,406 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:51,406 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:51,406 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:51,407 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:51,407 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:51,408 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:51,408 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:51,408 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:59:51,409 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,410 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,412 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,412 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,413 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,414 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,415 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:59:51,415 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,416 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:59:51,416 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:59:51,417 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 31.0ms
2025-11-24 14:59:51,419 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.9ms
2025-11-24 14:59:51,421 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:59:51,425 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:51,428 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:51,430 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:51,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:51,432 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:51,435 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:51,435 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:51,436 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:59:51,437 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,440 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,442 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,444 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,445 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,446 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,447 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:59:51,447 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:59:51,447 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,449 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,455 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:59:51,455 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:59:51,456 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:59:51,456 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:51,457 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:51,457 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:51,457 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:51,457 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:51,458 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:51,458 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:51,459 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:59:51,460 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,460 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,461 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,462 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,463 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,464 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,464 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:59:51,465 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:51,465 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:59:51,465 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:59:51,466 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 45.1ms
2025-11-24 14:59:51,467 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.9ms
2025-11-24 14:59:52,639 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:59:52,640 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:52,640 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:52,640 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:52,640 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:52,640 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:52,641 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:52,641 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:52,642 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:59:52,642 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,643 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,645 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,646 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,647 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,649 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,650 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:59:52,650 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:59:52,650 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:59:52,650 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,653 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:59:52,653 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,656 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:59:52,656 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:59:52,656 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:59:52,656 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:59:52,656 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:59:52,657 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:59:52,657 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.0ms
2025-11-24 14:59:52,659 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 14:59:52,659 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:52,659 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:52,660 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:52,660 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:52,660 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:52,661 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:52,661 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:52,661 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 14:59:52,662 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,662 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,663 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,664 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,665 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,666 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,667 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:59:52,667 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:59:52,667 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 14:59:52,667 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,669 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 14:59:52,670 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:52,672 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 14:59:52,672 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:59:52,672 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:59:52,672 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 14:59:52,672 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 14:59:52,673 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 14:59:52,673 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.7ms
2025-11-24 14:59:53,714 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 14:59:53,715 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.8ms
2025-11-24 14:59:53,715 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 14:59:53,718 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 2.0ms
2025-11-24 14:59:53,719 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:59:53,720 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:53,720 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:53,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:53,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:53,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:53,723 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:53,723 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:53,723 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:59:53,724 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,725 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,726 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,727 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,728 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,729 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,730 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:59:53,730 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:59:53,730 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,732 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,733 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:59:53,733 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:59:53,734 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 14.6ms
2025-11-24 14:59:53,736 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 14:59:53,736 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:53,736 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:53,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:53,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:53,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:53,738 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:53,738 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:53,739 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 14:59:53,739 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,740 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,741 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,742 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,743 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,744 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,744 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 14:59:53,745 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 14:59:53,745 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,746 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:53,748 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 14:59:53,748 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 14:59:53,749 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.1ms
2025-11-24 14:59:54,903 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:59:54,904 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:54,904 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:54,904 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:54,904 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:54,905 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:54,906 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:54,906 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:54,906 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:59:54,907 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,908 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,909 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,911 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,912 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,913 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,914 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:59:54,914 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:59:54,914 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,916 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,918 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:59:54,919 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:59:54,919 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:59:54,920 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:54,921 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:54,921 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:54,921 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:54,921 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:54,923 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:54,923 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:54,923 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:59:54,925 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,926 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,927 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,927 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,928 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,929 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,929 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:59:54,929 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,930 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:59:54,930 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:59:54,930 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 27.2ms
2025-11-24 14:59:54,931 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.9ms
2025-11-24 14:59:54,932 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 14:59:54,933 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:54,933 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:54,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:54,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:54,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:54,935 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:54,935 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:54,935 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 14:59:54,936 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,936 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,937 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,939 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,940 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,940 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,941 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 14:59:54,941 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 14:59:54,941 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,943 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,945 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 14:59:54,945 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 14:59:54,946 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 14:59:54,946 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 14:59:54,946 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 14:59:54,946 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 14:59:54,946 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 14:59:54,946 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 14:59:54,947 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 14:59:54,947 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 14:59:54,947 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 14:59:54,948 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,949 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,949 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,950 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,951 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,951 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,952 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 14:59:54,952 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 14:59:54,953 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 14:59:54,953 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 14:59:54,953 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 20.7ms
2025-11-24 14:59:54,955 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 8.9ms
2025-11-24 15:03:14,980 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:03:14,981 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:03:14,981 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:03:14,981 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:03:14,981 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:03:14,981 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:03:14,997 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:03:15,000 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 15:03:15,000 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:03:15,000 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:03:15,001 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,010 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,013 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,014 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,015 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,016 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,017 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:03:15,017 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:03:15,017 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,020 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:03:15,020 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:03:15,021 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 41.0ms
2025-11-24 15:03:15,023 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:03:15,023 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:03:15,024 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:03:15,024 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:03:15,024 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:03:15,024 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:03:15,025 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:03:15,026 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:03:15,026 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:03:15,027 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,028 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,030 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,031 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,032 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,033 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,033 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:03:15,034 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:03:15,034 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:15,034 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:03:15,035 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:03:15,035 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 12.2ms
2025-11-24 15:03:17,665 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:03:17,666 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:03:17,666 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:03:17,666 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:03:17,667 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:03:17,667 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:03:17,670 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:03:17,670 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:03:17,670 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/area/2/tree/
2025-11-24 15:03:17,671 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:17,672 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:17,673 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:17,674 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:17,675 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:17,676 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:17,677 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/area/2/tree/ recibida por usuario 1 del cliente 2.
2025-11-24 15:03:17,677 - app.services.menu_service - INFO - Obteniendo árbol de menú para cliente 2, area_id: 2
2025-11-24 15:03:17,677 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:03:17,682 - app.utils.menu_helper - ERROR - Error procesando item de menú 4: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 4, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 15:03:17,683 - app.utils.menu_helper - ERROR - Error procesando item de menú 5: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\utils\menu_helper.py", line 34, in build_menu_tree
    menu_item_obj = MenuItem(
        menu_id=menu_id,
    ...<10 lines>...
        children=[]
    )
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for MenuItem
cliente_id
  Field required [type=missing, input_value={'menu_id': 5, 'nombre': ...macén', 'children': []}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-24 15:03:17,684 - app.utils.menu_helper - INFO - Árbol de menú construido con 0 items raíz.
2025-11-24 15:03:17,685 - app.services.menu_service - INFO - Árbol de menú del cliente 2, área 2 construido con 0 items raíz.
2025-11-24 15:03:17,685 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/area/2/tree/ 200 19.6ms
2025-11-24 15:06:58,785 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'admin', 'api', 'assets', 'cdn', 'www', 'static', 'backend'}
2025-11-24 15:06:58,823 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:06:58,824 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:06:58,824 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:06:58,824 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:06:58,824 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:06:58,824 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:06:58,860 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:06:58,863 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 15:06:58,863 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:06:58,863 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:06:58,867 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,891 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,892 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,893 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,894 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,895 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,896 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:06:58,896 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:06:58,896 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,898 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,903 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:06:58,903 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:06:58,904 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 80.3ms
2025-11-24 15:06:58,906 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 15:06:58,907 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:06:58,907 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:06:58,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:06:58,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:06:58,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:06:58,909 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:06:58,909 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:06:58,909 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 15:06:58,910 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,910 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,911 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,912 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,912 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,913 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,914 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 15:06:58,914 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 15:06:58,914 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,916 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:58,917 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 15:06:58,917 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 15:06:58,918 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 11.7ms
2025-11-24 15:06:59,867 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:06:59,867 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:06:59,867 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:06:59,868 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:06:59,868 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:06:59,868 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:06:59,869 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:06:59,869 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:06:59,869 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:06:59,870 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,871 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,872 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,873 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,875 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,876 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,877 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:06:59,878 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:06:59,878 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,880 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:06:59,880 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:06:59,881 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 14.0ms
2025-11-24 15:06:59,883 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 15:06:59,883 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:06:59,883 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:06:59,883 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:06:59,884 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:06:59,884 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:06:59,885 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:06:59,885 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 15:06:59,885 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 15:06:59,886 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,887 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,888 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,888 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,889 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,890 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,892 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 15:06:59,892 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 15:06:59,892 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 15:06:59,894 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 15:06:59,894 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 15:06:59,894 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 11.8ms
2025-11-24 15:07:01,388 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/area/2/tree/
2025-11-24 15:07:01,388 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 15:07:01,389 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 15:07:01,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 15:07:01,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 15:07:01,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 15:07:01,390 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 15:07:01,390 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost

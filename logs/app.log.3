2025-11-18 13:19:28,700 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:19:28,702 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:19:28,702 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:19:28,704 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:19:28,704 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:19:28,706 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:19:28,707 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:19:28,707 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.8ms
2025-11-18 13:19:28,717 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:19:28,717 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:19:28,718 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:19:28,718 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:19:28,718 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:19:28,718 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:19:28,718 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:19:28,718 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:19:28,719 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:19:28,722 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:19:28,722 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:19:28,723 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:19:28,723 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.9ms
2025-11-18 13:19:28,725 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:19:28,726 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:19:28,726 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:19:28,726 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:19:28,726 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:19:28,726 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:19:28,726 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:19:28,727 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:19:28,727 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:19:28,730 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:19:28,730 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:19:28,731 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:19:28,731 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.0ms
2025-11-18 13:19:28,872 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:19:28,873 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:19:28,873 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:19:28,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:19:28,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:19:28,873 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:19:28,873 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:19:28,874 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:19:28,874 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:19:28,876 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 13:19:28,877 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 13:19:28,877 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.3ms
2025-11-18 13:19:29,053 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:19:29,054 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:19:29,054 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:19:29,054 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:19:29,054 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:19:29,054 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:19:29,054 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:19:29,054 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:19:29,055 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:19:29,057 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 13:19:29,058 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 13:19:29,058 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.0ms
2025-11-18 13:19:29,236 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:19:29,236 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:19:29,237 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:19:29,237 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:19:29,237 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:19:29,237 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:19:29,237 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:19:29,237 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:19:29,238 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:19:29,240 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 13:19:29,240 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 13:19:29,240 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.4ms
2025-11-18 13:19:29,429 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:19:29,429 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:19:29,429 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:19:29,430 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:19:29,430 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:19:29,430 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:19:29,430 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:19:29,430 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:19:29,431 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:19:29,434 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 13:19:29,435 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 13:19:29,435 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 6.3ms
2025-11-18 13:19:29,599 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:19:29,599 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:19:29,600 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:19:29,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:19:29,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:19:29,600 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:19:29,601 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:19:29,601 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:19:29,601 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:19:29,604 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 13:19:29,604 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 13:19:29,605 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.8ms
2025-11-18 13:21:02,554 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 13:21:02,554 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:02,554 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:02,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:02,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:02,555 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:02,555 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:02,555 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:02,555 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 13:21:02,564 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 13:21:02,564 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 13:21:02,565 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 13:21:02,773 - app.core.auth - WARNING - [AUTH] Contraseña incorrecta para: username='superadmin', usuario_id=1
2025-11-18 13:21:02,774 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 220.0ms
2025-11-18 13:21:08,911 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 13:21:08,912 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:08,912 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:08,912 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:08,912 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:08,912 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:08,913 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:08,913 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:08,913 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 13:21:08,915 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 13:21:08,915 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 13:21:08,915 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 13:21:09,123 - app.core.auth - WARNING - [AUTH] Contraseña incorrecta para: username='superadmin', usuario_id=1
2025-11-18 13:21:09,123 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 211.9ms
2025-11-18 13:21:12,075 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 13:21:12,075 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:12,075 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:12,076 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:12,076 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:12,076 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:12,076 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:12,076 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:12,076 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 13:21:12,079 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 13:21:12,079 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 13:21:12,079 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 13:21:12,289 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 13:21:12,289 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 13:21:12,290 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 13:21:12,291 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:21:12,291 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2103
2025-11-18 13:21:12,291 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2103
2025-11-18 13:21:12,291 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 13:21:12,292 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 216.9ms
2025-11-18 13:21:12,311 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:21:12,312 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:12,312 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:12,312 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:12,312 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:12,312 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:12,313 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:12,313 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:12,313 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:21:12,321 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:21:12,322 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:21:12,323 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:21:12,324 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 12.3ms
2025-11-18 13:21:12,326 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 13:21:12,327 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:12,327 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:12,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:12,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:12,327 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:12,327 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:12,328 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:12,328 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 13:21:12,333 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 13:21:12,334 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 13:21:12,338 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 13:21:12,338 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 13:21:12,339 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 12.6ms
2025-11-18 13:21:12,341 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 13:21:12,341 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:12,341 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:12,341 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:12,341 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:12,342 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:12,342 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:12,342 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:12,342 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 13:21:12,346 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 13:21:12,347 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 13:21:12,347 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 13:21:12,348 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 7.3ms
2025-11-18 13:21:12,350 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:21:12,350 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:12,350 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:12,351 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:12,351 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:12,351 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:12,351 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:12,351 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:12,351 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:21:12,355 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:21:12,355 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:21:12,356 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:21:12,356 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.3ms
2025-11-18 13:21:12,358 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 13:21:12,358 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:12,358 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:12,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:12,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:12,359 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:12,359 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:12,359 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:12,359 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 13:21:12,364 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 13:21:12,365 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 13:21:12,368 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 13:21:12,368 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 13:21:12,369 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 11.0ms
2025-11-18 13:21:12,370 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 13:21:12,371 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:12,371 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:12,371 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:12,371 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:12,371 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:12,371 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:12,372 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:12,372 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 13:21:12,375 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 13:21:12,376 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 13:21:12,376 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 13:21:12,377 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 6.2ms
2025-11-18 13:21:15,669 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 13:21:15,670 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:15,670 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:15,670 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:15,670 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:15,670 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:15,671 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:15,671 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:15,671 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 13:21:15,674 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 13:21:15,674 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDkwOTcyLCJpYXQiOjE3NjM0OTAwNzIsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.i5x-at3usIjWIH_NqJRARkt82rfm37s91BdWjOqrDDY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk0ODcyLCJpYXQiOjE3NjM0OTAwNzIsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.bMZtwye8lrryLpCqWK-mdK848MdZlGkZ6ufTUeUjfzc'}
2025-11-18 13:21:15,675 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 13:21:15,675 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 13:21:15,675 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 13:21:15,675 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 13:21:15,677 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 13:21:15,677 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.1ms
2025-11-18 13:21:15,680 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 13:21:15,680 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:15,680 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:15,681 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:15,681 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:15,681 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:15,681 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:15,681 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:15,681 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 13:21:15,686 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 13:21:15,687 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDkwOTcyLCJpYXQiOjE3NjM0OTAwNzIsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.i5x-at3usIjWIH_NqJRARkt82rfm37s91BdWjOqrDDY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk0ODcyLCJpYXQiOjE3NjM0OTAwNzIsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.bMZtwye8lrryLpCqWK-mdK848MdZlGkZ6ufTUeUjfzc'}
2025-11-18 13:21:15,687 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 13:21:15,687 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 13:21:15,687 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 13:21:15,688 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 13:21:15,689 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 13:21:15,690 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.2ms
2025-11-18 13:21:18,827 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:21:18,827 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:18,827 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:18,827 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:18,828 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:18,828 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:18,828 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:18,828 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:18,828 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:21:18,831 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:21:18,832 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:21:18,833 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:21:18,834 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:21:18,834 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:21:18,836 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:21:18,836 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2104
2025-11-18 13:21:18,836 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2104
2025-11-18 13:21:18,837 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:21:18,837 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.4ms
2025-11-18 13:21:18,843 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:21:18,844 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:18,844 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:18,844 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:18,845 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:18,845 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:18,845 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:18,845 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:18,845 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:21:18,847 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:21:18,848 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:21:18,851 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:21:18,851 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:21:18,852 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.2ms
2025-11-18 13:21:34,929 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:21:34,930 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:34,930 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:34,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:34,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:34,930 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:34,931 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:34,931 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:34,931 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:21:34,933 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:21:34,934 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:21:34,936 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:21:34,937 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:21:34,937 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:21:34,941 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:21:34,941 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2105
2025-11-18 13:21:34,942 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2105
2025-11-18 13:21:34,942 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:21:34,942 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.3ms
2025-11-18 13:21:34,947 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:21:34,947 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:21:34,947 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:21:34,947 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:21:34,947 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:21:34,948 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:21:34,948 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:21:34,948 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:21:34,948 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:21:34,950 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:21:34,950 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:21:34,953 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:21:34,953 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:21:34,954 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.2ms
2025-11-18 13:22:17,708 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:22:17,709 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:17,709 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:17,709 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:17,709 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:17,709 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:17,710 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:17,710 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:17,710 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:22:17,714 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:22:17,714 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:22:17,715 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:22:17,716 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 13:22:17,717 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:22:17,718 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:17,718 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:17,718 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:17,718 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:17,718 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:17,718 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:17,719 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:17,719 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:22:17,722 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:22:17,722 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:22:17,723 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:22:17,723 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.2ms
2025-11-18 13:22:29,943 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:22:29,944 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:29,944 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:29,944 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:29,944 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:29,944 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:29,945 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:29,945 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:29,945 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:22:29,947 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:22:29,948 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:22:29,950 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:22:29,950 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:22:29,950 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:22:29,952 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:22:29,952 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2106
2025-11-18 13:22:29,952 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2106
2025-11-18 13:22:29,953 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:22:29,953 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.8ms
2025-11-18 13:22:29,957 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:22:29,957 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:29,957 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:29,958 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:29,958 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:29,958 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:29,958 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:29,958 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:29,958 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:22:29,960 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:22:29,960 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:22:29,962 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:22:29,962 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:22:29,963 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 5.7ms
2025-11-18 13:22:29,974 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:22:29,975 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:29,975 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:29,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:29,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:29,975 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:29,975 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:29,976 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:29,976 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:22:29,979 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:22:29,979 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:22:29,980 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:22:29,980 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.7ms
2025-11-18 13:22:29,981 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:22:29,982 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:29,982 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:29,982 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:29,982 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:29,982 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:29,982 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:29,982 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:29,983 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:22:29,985 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:22:29,985 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:22:29,986 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:22:29,987 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.4ms
2025-11-18 13:22:31,765 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:22:31,765 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:31,765 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:31,766 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:31,766 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:31,766 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:31,766 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:31,766 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:31,766 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:22:31,768 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:22:31,769 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:22:31,771 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:22:31,771 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:22:31,771 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:22:31,773 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:22:31,774 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2107
2025-11-18 13:22:31,774 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2107
2025-11-18 13:22:31,774 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:22:31,775 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.0ms
2025-11-18 13:22:31,779 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:22:31,779 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:31,779 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:31,780 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:31,780 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:31,780 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:31,780 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:31,780 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:31,780 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:22:31,783 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:22:31,783 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:22:31,785 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:22:31,785 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:22:31,786 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.6ms
2025-11-18 13:22:31,797 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:22:31,797 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:31,798 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:31,798 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:31,798 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:31,798 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:31,798 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:31,798 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:31,799 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:22:31,801 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:22:31,802 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:22:31,802 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:22:31,803 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.8ms
2025-11-18 13:22:31,804 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:22:31,804 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:31,805 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:31,805 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:31,805 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:31,805 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:31,805 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:31,805 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:31,806 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:22:31,809 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:22:31,809 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:22:31,810 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:22:31,811 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.6ms
2025-11-18 13:22:33,220 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:22:33,221 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:33,221 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:33,221 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:33,221 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:33,221 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:33,221 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:33,222 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:33,222 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:22:33,224 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:22:33,225 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:22:33,226 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:22:33,227 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:22:33,227 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:22:33,229 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:22:33,229 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2108
2025-11-18 13:22:33,229 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2108
2025-11-18 13:22:33,230 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:22:33,230 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.1ms
2025-11-18 13:22:33,234 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:22:33,235 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:33,235 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:33,235 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:33,235 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:33,235 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:33,236 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:33,236 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:33,236 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:22:33,237 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:22:33,237 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:22:33,239 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:22:33,239 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:22:33,240 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 5.5ms
2025-11-18 13:22:33,249 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:22:33,249 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:33,249 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:33,249 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:33,249 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:33,250 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:33,250 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:33,250 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:33,250 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:22:33,253 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:22:33,253 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:22:33,254 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:22:33,255 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.0ms
2025-11-18 13:22:33,256 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:22:33,257 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:33,257 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:33,257 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:33,257 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:33,257 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:33,258 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:33,258 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:33,258 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:22:33,262 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:22:33,262 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:22:33,263 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:22:33,264 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.1ms
2025-11-18 13:22:33,870 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:22:33,871 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:33,871 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:33,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:33,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:33,871 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:33,872 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:33,872 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:33,872 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:22:33,874 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:22:33,875 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:22:33,877 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:22:33,877 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:22:33,877 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:22:33,879 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b957efcf31f29b7f45fa33b2fb453e496d3a248ee24863e91e0ba5ae3eb35ab2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-11-18 13:22:33,879 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b957efcf31f29b7f45fa33b2fb453e496d3a248ee24863e91e0ba5ae3eb35ab2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b957efcf31f29b7f45fa33b2fb453e496d3a248ee24863e91e0ba5ae3eb35ab2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b957efcf31f29b7f45fa33b2fb453e496d3a248ee24863e91e0ba5ae3eb35ab2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-11-18 13:22:33,881 - app.services.refresh_token_service - CRITICAL - [SECURITY ALERT - TOKEN REUSE] Colisión de Refresh Token (hash) detectada para cliente 1, usuario 1. Revocando todas las sesiones del usuario para mitigar el riesgo.
2025-11-18 13:22:33,882 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-11-18 13:22:33,882 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 0 tokens revocados para cliente 1, usuario 1
2025-11-18 13:22:33,883 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b957efcf31f29b7f45fa33b2fb453e496d3a248ee24863e91e0ba5ae3eb35ab2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 91, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b957efcf31f29b7f45fa33b2fb453e496d3a248ee24863e91e0ba5ae3eb35ab2). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 117, in store_refresh_token
    raise AuthenticationError(
    ...<2 lines>...
    )
app.core.exceptions.AuthenticationError: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
2025-11-18 13:22:33,884 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-11-18 13:22:33,884 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:22:33,885 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.2ms
2025-11-18 13:22:33,888 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:22:33,889 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:33,889 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:33,889 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:33,889 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:33,889 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:33,889 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:33,889 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:33,890 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:22:33,891 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:22:33,892 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:22:33,894 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:22:33,894 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:22:33,895 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.6ms
2025-11-18 13:22:33,905 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:22:33,906 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:33,906 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:33,906 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:33,906 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:33,906 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:33,907 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:33,907 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:33,907 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:22:33,911 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:22:33,912 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:22:33,913 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:22:33,913 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.7ms
2025-11-18 13:22:33,915 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:22:33,915 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:33,915 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:33,915 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:33,915 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:33,916 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:33,916 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:33,916 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:33,916 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:22:33,919 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:22:33,919 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:22:33,920 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:22:33,920 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.7ms
2025-11-18 13:22:34,538 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:22:34,538 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:22:34,538 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:22:34,538 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:22:34,538 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:22:34,539 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:22:34,539 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:22:34,539 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:22:34,539 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:22:34,542 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 13:22:34,542 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 13:22:34,543 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.0ms
2025-11-18 13:28:11,244 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 13:28:11,244 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-18 13:28:11,560 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:28:11,561 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:11,561 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:11,561 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:11,561 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:11,561 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:11,562 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:11,562 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:11,562 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:28:11,572 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 13:28:11,572 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 13:28:11,573 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 12.6ms
2025-11-18 13:28:22,575 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 13:28:22,576 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-18 13:28:22,577 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 13:28:22,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:22,578 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:22,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:22,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:22,578 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:22,578 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:22,578 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:22,578 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 13:28:22,582 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 13:28:22,583 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 13:28:22,583 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 13:28:22,792 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 13:28:22,793 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 13:28:22,793 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 13:28:22,794 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:28:22,794 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2110
2025-11-18 13:28:22,795 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2110
2025-11-18 13:28:22,795 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 13:28:22,795 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 218.0ms
2025-11-18 13:28:22,820 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 13:28:22,821 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.6ms
2025-11-18 13:28:22,823 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 13:28:22,824 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:22,824 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:22,824 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:22,825 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:22,825 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:22,825 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:22,825 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:22,825 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:22,825 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:22,826 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.4ms
2025-11-18 13:28:22,829 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:22,829 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:22,830 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:22,831 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-18 13:28:22,832 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 13:28:22,833 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 0.7ms
2025-11-18 13:28:22,833 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 13:28:22,834 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:22,834 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:22,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:22,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:22,835 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:22,835 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:22,835 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:22,835 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 13:28:22,841 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 13:28:22,841 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 13:28:22,845 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 13:28:22,845 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 13:28:22,846 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 12.6ms
2025-11-18 13:28:22,847 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 13:28:22,848 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.6ms
2025-11-18 13:28:22,848 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 13:28:22,849 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:22,849 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:22,849 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:22,849 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:22,849 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:22,850 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:22,850 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:22,850 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 13:28:22,855 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 13:28:22,856 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 13:28:22,856 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 13:28:22,857 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.1ms
2025-11-18 13:28:22,858 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 13:28:22,858 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.6ms
2025-11-18 13:28:22,859 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:22,860 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:22,860 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:22,860 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:22,860 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:22,860 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:22,861 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:22,861 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:22,861 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:22,865 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:22,865 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:22,866 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:22,866 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-18 13:28:22,867 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 13:28:22,868 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 0.5ms
2025-11-18 13:28:22,868 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 13:28:22,869 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:22,869 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:22,869 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:22,869 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:22,870 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:22,870 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:22,870 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:22,870 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 13:28:22,876 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 13:28:22,876 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 13:28:22,880 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 13:28:22,880 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 13:28:22,881 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 12.4ms
2025-11-18 13:28:22,883 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 13:28:22,883 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:22,883 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:22,883 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:22,883 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:22,884 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:22,884 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:22,884 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:22,884 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 13:28:22,889 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 13:28:22,890 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 13:28:22,890 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 13:28:22,891 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 8.1ms
2025-11-18 13:28:25,757 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 13:28:25,758 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.8ms
2025-11-18 13:28:25,758 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 13:28:25,760 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.4ms
2025-11-18 13:28:25,761 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 13:28:25,762 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:25,762 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:25,762 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:25,762 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:25,762 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:25,762 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:25,763 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:25,763 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 13:28:25,768 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 13:28:25,768 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDkxNDAyLCJpYXQiOjE3NjM0OTA1MDIsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.QMXuOyHaavx8n3PdenYasIAhOLAgIFH-HoRmtFINTkw', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk1MzAyLCJpYXQiOjE3NjM0OTA1MDIsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.51V6ken6oH6RpWBRH0Ljr3af6Cwi5wllTYCwK3FEwto'}
2025-11-18 13:28:25,768 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 13:28:25,768 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 13:28:25,769 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 13:28:25,769 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 13:28:25,770 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 13:28:25,771 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.0ms
2025-11-18 13:28:25,773 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 13:28:25,774 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:25,774 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:25,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:25,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:25,774 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:25,775 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:25,775 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:25,775 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 13:28:25,780 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 13:28:25,780 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDkxNDAyLCJpYXQiOjE3NjM0OTA1MDIsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.QMXuOyHaavx8n3PdenYasIAhOLAgIFH-HoRmtFINTkw', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk1MzAyLCJpYXQiOjE3NjM0OTA1MDIsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.51V6ken6oH6RpWBRH0Ljr3af6Cwi5wllTYCwK3FEwto'}
2025-11-18 13:28:25,780 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 13:28:25,780 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 13:28:25,781 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 13:28:25,781 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 13:28:25,782 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 13:28:25,783 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.8ms
2025-11-18 13:28:26,200 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 13:28:26,201 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 13:28:26,201 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.4ms
2025-11-18 13:28:26,202 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.3ms
2025-11-18 13:28:26,204 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 13:28:26,204 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:26,204 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:26,204 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:26,204 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:26,205 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:26,205 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:26,205 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:26,205 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 13:28:26,210 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 13:28:26,211 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 13:28:26,212 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 13:28:26,212 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 8.6ms
2025-11-18 13:28:26,214 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 13:28:26,214 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:26,215 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:26,215 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:26,215 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:26,215 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:26,215 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:26,215 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:26,216 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 13:28:26,220 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 13:28:26,220 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 13:28:26,221 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 13:28:26,221 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 7.1ms
2025-11-18 13:28:26,771 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 13:28:26,772 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:26,772 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:26,772 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:26,772 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:26,773 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:26,773 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:26,773 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:26,773 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 13:28:26,778 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 13:28:26,778 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDkxNDAyLCJpYXQiOjE3NjM0OTA1MDIsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.QMXuOyHaavx8n3PdenYasIAhOLAgIFH-HoRmtFINTkw', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk1MzAyLCJpYXQiOjE3NjM0OTA1MDIsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.51V6ken6oH6RpWBRH0Ljr3af6Cwi5wllTYCwK3FEwto'}
2025-11-18 13:28:26,778 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 13:28:26,779 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 13:28:26,779 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 13:28:26,779 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 13:28:26,781 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 13:28:26,782 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.2ms
2025-11-18 13:28:26,784 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 13:28:26,784 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:26,785 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:26,785 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:26,785 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:26,785 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:26,785 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:26,785 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:26,786 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 13:28:26,790 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 13:28:26,790 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDkxNDAyLCJpYXQiOjE3NjM0OTA1MDIsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.QMXuOyHaavx8n3PdenYasIAhOLAgIFH-HoRmtFINTkw', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk1MzAyLCJpYXQiOjE3NjM0OTA1MDIsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.51V6ken6oH6RpWBRH0Ljr3af6Cwi5wllTYCwK3FEwto'}
2025-11-18 13:28:26,790 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 13:28:26,791 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 13:28:26,791 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 13:28:26,791 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 13:28:26,793 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 13:28:26,793 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.6ms
2025-11-18 13:28:29,295 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:28:29,295 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:29,295 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:29,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:29,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:29,296 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:29,296 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:29,296 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:29,296 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:28:29,299 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:28:29,300 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:28:29,302 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:28:29,303 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:28:29,303 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:28:29,304 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:28:29,305 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2111
2025-11-18 13:28:29,306 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2111
2025-11-18 13:28:29,306 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:28:29,306 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.7ms
2025-11-18 13:28:29,312 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 13:28:29,312 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-18 13:28:29,315 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:28:29,316 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:29,316 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:29,316 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:29,316 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:29,316 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:29,316 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:29,317 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:29,317 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:28:29,319 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:28:29,319 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:28:29,321 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:28:29,322 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:28:29,322 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.0ms
2025-11-18 13:28:37,009 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:37,009 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:37,010 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:37,010 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:37,010 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:37,010 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:37,010 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:37,011 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:37,011 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:37,015 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:37,016 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:37,017 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:37,018 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.3ms
2025-11-18 13:28:37,020 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:37,021 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:37,021 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:37,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:37,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:37,022 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:37,022 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:37,022 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:37,022 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:37,027 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:37,027 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:37,028 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:37,029 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.6ms
2025-11-18 13:28:40,765 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:28:40,766 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:40,766 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:40,766 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:40,766 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:40,767 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:40,767 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:40,767 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:40,767 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:28:40,770 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:28:40,772 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:28:40,774 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:28:40,775 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:28:40,775 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:28:40,777 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:28:40,778 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2112
2025-11-18 13:28:40,778 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2112
2025-11-18 13:28:40,778 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:28:40,779 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.5ms
2025-11-18 13:28:40,783 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:28:40,783 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:40,783 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:40,784 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:40,784 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:40,784 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:40,784 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:40,784 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:40,784 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:28:40,786 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:28:40,786 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:28:40,789 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:28:40,789 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:28:40,790 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.7ms
2025-11-18 13:28:40,801 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:40,801 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:40,802 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:40,802 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:40,802 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:40,802 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:40,802 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:40,802 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:40,802 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:40,807 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:40,807 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:40,808 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:40,808 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.2ms
2025-11-18 13:28:40,810 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:40,810 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:40,811 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:40,811 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:40,811 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:40,811 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:40,811 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:40,811 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:40,812 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:40,815 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:40,815 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:40,816 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:40,816 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.5ms
2025-11-18 13:28:41,822 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:28:41,822 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:41,823 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:41,823 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:41,823 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:41,823 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:41,823 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:41,824 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:41,824 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:28:41,826 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:28:41,827 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:28:41,829 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:28:41,829 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:28:41,830 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:28:41,831 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:28:41,832 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2113
2025-11-18 13:28:41,832 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2113
2025-11-18 13:28:41,832 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:28:41,833 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.1ms
2025-11-18 13:28:41,837 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:28:41,837 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:41,837 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:41,837 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:41,837 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:41,837 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:41,838 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:41,838 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:41,838 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:28:41,840 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:28:41,840 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:28:41,843 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:28:41,843 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:28:41,843 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.7ms
2025-11-18 13:28:41,852 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:41,852 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:41,852 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:41,852 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:41,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:41,853 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:41,853 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:41,853 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:41,853 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:41,857 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:41,857 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:41,859 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:41,859 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 13:28:41,861 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:41,861 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:41,862 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:41,862 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:41,862 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:41,862 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:41,862 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:41,862 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:41,862 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:41,866 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:41,866 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:41,867 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:41,867 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.2ms
2025-11-18 13:28:43,044 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:28:43,045 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:43,045 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:43,045 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:43,045 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:43,046 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:43,046 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:43,046 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:43,046 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:28:43,048 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:28:43,049 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:28:43,051 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:28:43,051 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:28:43,051 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:28:43,053 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:28:43,054 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2114
2025-11-18 13:28:43,054 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2114
2025-11-18 13:28:43,054 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:28:43,055 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.6ms
2025-11-18 13:28:43,061 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:28:43,062 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:43,062 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:43,062 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:43,062 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:43,063 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:43,063 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:43,063 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:43,063 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:28:43,065 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:28:43,065 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:28:43,067 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:28:43,067 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:28:43,068 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.2ms
2025-11-18 13:28:43,079 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:43,080 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:43,080 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:43,080 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:43,080 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:43,080 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:43,081 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:43,081 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:43,081 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:43,084 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:43,084 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:43,085 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:43,086 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.4ms
2025-11-18 13:28:43,088 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:43,088 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:43,088 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:43,088 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:43,088 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:43,088 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:43,089 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:43,089 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:43,089 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:43,094 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:43,094 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:43,095 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:43,095 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.9ms
2025-11-18 13:28:44,876 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:28:44,876 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:44,876 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:44,877 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:44,877 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:44,877 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:44,877 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:44,877 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:44,877 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:28:44,879 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:28:44,881 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:28:44,978 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:28:44,979 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:28:44,979 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:28:44,980 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:28:44,981 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2115
2025-11-18 13:28:44,981 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2115
2025-11-18 13:28:44,981 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:28:44,981 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 105.9ms
2025-11-18 13:28:44,985 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:28:44,985 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:44,985 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:44,985 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:44,986 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:44,986 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:44,986 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:44,986 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:44,986 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:28:44,988 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:28:44,988 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:28:44,990 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:28:44,990 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:28:44,990 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 5.6ms
2025-11-18 13:28:45,003 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:45,003 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:45,004 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:45,004 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:45,004 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:45,004 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:45,004 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:45,004 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:45,004 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:45,008 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:45,008 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:45,009 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:45,010 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.6ms
2025-11-18 13:28:45,012 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:45,012 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:45,012 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:45,012 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:45,013 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:45,013 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:45,013 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:45,013 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:45,013 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:45,016 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:45,017 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:45,017 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:45,018 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.1ms
2025-11-18 13:28:46,377 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:28:46,377 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:46,378 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:46,378 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:46,378 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:46,378 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:46,379 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:46,379 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:46,379 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:28:46,381 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:28:46,382 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:28:46,384 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:28:46,384 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:28:46,385 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:28:46,386 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:28:46,387 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2116
2025-11-18 13:28:46,387 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2116
2025-11-18 13:28:46,387 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:28:46,388 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.7ms
2025-11-18 13:28:46,392 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:28:46,393 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:46,393 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:46,393 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:46,393 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:46,393 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:46,394 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:46,394 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:46,394 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:28:46,396 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:28:46,396 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:28:46,398 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:28:46,398 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:28:46,399 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.9ms
2025-11-18 13:28:46,410 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:46,410 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:46,410 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:46,410 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:46,411 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:46,411 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:46,411 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:46,411 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:46,412 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:46,415 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:46,415 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:46,416 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:46,417 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.9ms
2025-11-18 13:28:46,418 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:46,419 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:46,419 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:46,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:46,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:46,419 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:46,420 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:46,420 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:46,420 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:46,423 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:46,423 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:46,424 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:46,425 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.2ms
2025-11-18 13:28:47,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:28:47,565 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:47,565 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:47,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:47,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:47,566 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:47,566 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:47,566 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:47,566 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:28:47,570 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:28:47,571 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:28:47,573 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:28:47,573 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:28:47,574 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:28:47,575 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:28:47,576 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2117
2025-11-18 13:28:47,576 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2117
2025-11-18 13:28:47,576 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:28:47,577 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.8ms
2025-11-18 13:28:47,582 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:28:47,583 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:47,583 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:47,583 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:47,583 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:47,583 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:47,583 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:47,584 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:47,584 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:28:47,586 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:28:47,586 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:28:47,588 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:28:47,588 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:28:47,588 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.3ms
2025-11-18 13:28:47,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:47,601 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:47,601 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:47,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:47,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:47,601 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:47,602 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:47,602 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:47,602 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:47,605 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:47,605 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:47,606 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:47,607 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.3ms
2025-11-18 13:28:47,608 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:47,609 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:47,609 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:47,609 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:47,609 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:47,609 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:47,609 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:47,610 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:47,610 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:47,614 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:47,614 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:47,615 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:47,616 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.7ms
2025-11-18 13:28:48,439 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:28:48,439 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:48,439 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:48,439 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:48,439 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:48,440 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:48,440 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:48,440 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:48,440 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:28:48,443 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:28:48,450 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:28:48,452 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:28:48,452 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:28:48,452 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:28:48,454 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:28:48,454 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2118
2025-11-18 13:28:48,455 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2118
2025-11-18 13:28:48,455 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:28:48,455 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.8ms
2025-11-18 13:28:48,459 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:28:48,460 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:48,460 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:48,460 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:48,460 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:48,460 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:48,460 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:48,461 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:48,461 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:28:48,463 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:28:48,463 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:28:48,465 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:28:48,466 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:28:48,466 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.8ms
2025-11-18 13:28:48,478 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:48,479 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:48,479 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:48,479 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:48,480 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:48,480 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:48,480 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:48,480 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:48,480 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:48,484 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:48,484 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:48,485 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:48,485 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.9ms
2025-11-18 13:28:48,487 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:48,487 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:48,488 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:48,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:48,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:48,488 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:48,488 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:48,488 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:48,488 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:48,491 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:48,492 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:48,493 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:48,493 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.9ms
2025-11-18 13:28:49,076 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:28:49,077 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:49,077 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:49,077 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:49,077 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:49,078 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:49,078 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:49,078 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:49,078 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:28:49,080 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:28:49,082 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:28:49,083 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:28:49,084 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:28:49,084 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:28:49,086 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:28:49,086 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2119
2025-11-18 13:28:49,086 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2119
2025-11-18 13:28:49,087 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:28:49,087 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.8ms
2025-11-18 13:28:49,091 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:28:49,091 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:49,091 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:49,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:49,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:49,092 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:49,092 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:49,092 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:49,092 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:28:49,094 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:28:49,094 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:28:49,097 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:28:49,097 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:28:49,098 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.8ms
2025-11-18 13:28:49,108 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:49,108 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:49,109 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:49,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:49,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:49,109 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:49,109 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:49,109 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:49,110 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:49,159 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:49,160 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:49,161 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:49,162 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 53.9ms
2025-11-18 13:28:49,169 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:49,170 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:49,170 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:49,170 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:49,170 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:49,170 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:49,170 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:49,171 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:49,171 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:49,174 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:49,175 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:49,176 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:49,177 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 13:28:49,742 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:28:49,743 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:49,743 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:49,743 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:49,743 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:49,743 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:49,743 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:49,743 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:49,744 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:28:49,746 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:28:49,747 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:28:49,749 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:28:49,749 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:28:49,750 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:28:49,751 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (eb2a733d97e8441a575dae30afb974dc933a344bfc90a4e4e80b8aa7aae7269d). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-11-18 13:28:49,752 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (eb2a733d97e8441a575dae30afb974dc933a344bfc90a4e4e80b8aa7aae7269d). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (eb2a733d97e8441a575dae30afb974dc933a344bfc90a4e4e80b8aa7aae7269d). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (eb2a733d97e8441a575dae30afb974dc933a344bfc90a4e4e80b8aa7aae7269d). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-11-18 13:28:49,754 - app.services.refresh_token_service - CRITICAL - [SECURITY ALERT - TOKEN REUSE] Colisión de Refresh Token (hash) detectada para cliente 1, usuario 1. Revocando todas las sesiones del usuario para mitigar el riesgo.
2025-11-18 13:28:49,755 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-11-18 13:28:49,755 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 0 tokens revocados para cliente 1, usuario 1
2025-11-18 13:28:49,755 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (eb2a733d97e8441a575dae30afb974dc933a344bfc90a4e4e80b8aa7aae7269d). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 91, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (eb2a733d97e8441a575dae30afb974dc933a344bfc90a4e4e80b8aa7aae7269d). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 117, in store_refresh_token
    raise AuthenticationError(
    ...<2 lines>...
    )
app.core.exceptions.AuthenticationError: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
2025-11-18 13:28:49,757 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-11-18 13:28:49,757 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:28:49,758 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.6ms
2025-11-18 13:28:49,761 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:28:49,762 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:49,762 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:49,762 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:49,762 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:49,763 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:49,763 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:49,763 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:49,763 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:28:49,765 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:28:49,765 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:28:49,768 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:28:49,768 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:28:49,768 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.0ms
2025-11-18 13:28:49,777 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:49,777 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:49,778 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:49,778 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:49,778 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:49,778 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:49,778 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:49,778 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:49,778 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:49,783 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:49,783 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:49,784 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:49,785 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.7ms
2025-11-18 13:28:49,786 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:28:49,787 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:49,787 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:49,787 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:49,787 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:49,787 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:49,788 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:49,788 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:49,788 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:28:49,791 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:28:49,791 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:28:49,792 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:28:49,792 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.1ms
2025-11-18 13:28:50,384 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:28:50,385 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:28:50,385 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:28:50,385 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:28:50,385 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:28:50,385 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:28:50,385 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:28:50,386 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:28:50,386 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:28:50,388 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 13:28:50,388 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 13:28:50,389 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.7ms
2025-11-18 13:29:01,238 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:29:01,238 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:29:01,238 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 13:29:01,238 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 13:29:01,239 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:29:01,239 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 13:29:01,240 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 13:29:01,240 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 13:29:01,241 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 4: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 13:29:01,241 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 4, usando Single-DB como fallback
2025-11-18 13:29:01,241 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:29:01,241 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:29:01,242 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 13:29:01,243 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.9ms
2025-11-18 13:29:12,267 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 13:29:12,268 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-18 13:29:12,269 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 13:29:12,270 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:29:12,270 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 13:29:12,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 13:29:12,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:29:12,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 13:29:12,271 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 13:29:12,271 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:29:12,272 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 13:29:12,273 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-18 13:29:12,274 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-18 13:29:12,274 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-18 13:29:12,485 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 13:29:12,486 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-18 13:29:12,487 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:29:12,488 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 4, Usuario 2 - Cliente: web - Token ID: 2121
2025-11-18 13:29:12,488 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2121
2025-11-18 13:29:12,488 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-18 13:29:12,489 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 219.2ms
2025-11-18 13:29:12,511 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 13:29:12,511 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.7ms
2025-11-18 13:29:12,514 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-18 13:29:12,514 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:29:12,515 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:29:12,515 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 13:29:12,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 13:29:12,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:29:12,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 13:29:12,517 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 13:29:12,517 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:29:12,517 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:29:12,518 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 4.0ms
2025-11-18 13:29:12,523 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 13:29:12,523 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 13:29:12,524 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 13:29:12,525 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.3ms
2025-11-18 13:29:12,527 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 13:29:12,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-18 13:29:12,566 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 39.0ms
2025-11-18 13:29:12,567 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.5ms
2025-11-18 13:29:12,567 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-18 13:29:12,568 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:29:12,568 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 13:29:12,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 13:29:12,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:29:12,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 13:29:12,570 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 13:29:12,570 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:29:12,570 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-18 13:29:12,575 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 13:29:12,576 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 9.0ms
2025-11-18 13:29:12,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:29:12,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:29:12,579 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 13:29:12,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 13:29:12,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:29:12,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 13:29:12,580 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 13:29:12,580 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:29:12,580 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:29:12,583 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 13:29:12,584 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 13:29:12,585 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 13:29:12,585 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.1ms
2025-11-18 13:29:12,587 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-18 13:29:12,588 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:29:12,588 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 13:29:12,588 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 13:29:12,588 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:29:12,588 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 13:29:12,590 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 13:29:12,590 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:29:12,590 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/
2025-11-18 13:29:12,594 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 13:29:12,595 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 403 7.3ms
2025-11-18 13:29:14,655 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 13:29:14,656 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 13:29:14,656 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.0ms
2025-11-18 13:29:14,656 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.6ms
2025-11-18 13:29:14,659 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 13:29:14,659 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:29:14,659 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 13:29:14,659 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 13:29:14,660 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:29:14,660 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 13:29:14,661 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 13:29:14,661 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:29:14,661 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 13:29:14,666 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 13:29:14,667 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 8.3ms
2025-11-18 13:29:14,669 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 13:29:14,669 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:29:14,669 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 13:29:14,669 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 13:29:14,670 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:29:14,670 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 13:29:14,671 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 13:29:14,671 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:29:14,672 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 13:29:14,676 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 13:29:14,677 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 7.8ms
2025-11-18 13:29:18,367 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 13:29:18,367 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-18 13:29:18,369 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:29:18,370 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:29:18,370 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 13:29:18,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 13:29:18,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:29:18,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 13:29:18,371 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 13:29:18,372 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:29:18,372 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:29:18,373 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 13:29:18,373 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.3ms
2025-11-18 13:31:51,377 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 13:31:51,377 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:31:51,377 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:31:51,378 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:31:51,378 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 13:31:51,378 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 13:31:51,378 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:31:51,378 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 13:31:51,388 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 13:31:51,388 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:31:51,388 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:31:51,389 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:31:51,389 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:31:51,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:31:51,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:31:51,389 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:31:51,389 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:31:51,389 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:31:51,389 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:31:51,390 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 13.1ms
2025-11-18 13:31:51,391 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 13:31:51,392 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 13:31:51,393 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 13:31:51,393 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 16.0ms
2025-11-18 13:31:51,393 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 16.0ms
2025-11-18 13:31:51,395 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:31:51,396 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:31:51,396 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': acme.midominio.com:5173
2025-11-18 13:31:51,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-18 13:31:51,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:31:51,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-18 13:31:51,399 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-18 13:31:51,400 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 13:31:51,400 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 2: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 13:31:51,400 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 2, usando Single-DB como fallback
2025-11-18 13:31:51,401 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:31:51,401 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:31:51,402 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 13:31:51,402 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 7.0ms
2025-11-18 13:31:53,588 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:31:53,589 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:31:53,589 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:31:53,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:31:53,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:31:53,589 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:31:53,589 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:31:53,589 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:31:53,590 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:31:53,591 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 13:31:53,592 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 13:31:53,592 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.7ms
2025-11-18 13:32:10,609 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 13:32:10,609 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:10,609 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:10,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:10,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:10,610 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:10,610 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:10,610 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:10,610 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 13:32:10,612 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 13:32:10,612 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 13:32:10,612 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 13:32:10,824 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 13:32:10,824 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 13:32:10,824 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 13:32:10,826 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:32:10,826 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2122
2025-11-18 13:32:10,826 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2122
2025-11-18 13:32:10,826 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 13:32:10,827 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 217.8ms
2025-11-18 13:32:10,846 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:32:10,846 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:10,847 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:10,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:10,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:10,847 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:10,847 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:10,847 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:10,847 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:32:10,851 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:32:10,851 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:32:10,853 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:32:10,853 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.6ms
2025-11-18 13:32:10,856 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 13:32:10,856 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:10,856 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:10,857 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:10,857 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:10,857 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:10,857 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:10,857 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:10,857 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 13:32:10,862 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 13:32:10,863 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 13:32:10,866 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 13:32:10,867 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 13:32:10,867 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 11.3ms
2025-11-18 13:32:10,869 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 13:32:10,870 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:10,870 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:10,870 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:10,870 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:10,870 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:10,871 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:10,871 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:10,871 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 13:32:10,876 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 13:32:10,877 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 13:32:10,877 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 13:32:10,877 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 7.9ms
2025-11-18 13:32:10,879 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 13:32:10,879 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:10,880 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:10,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:10,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:10,880 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:10,880 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:10,880 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:10,881 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 13:32:10,884 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 13:32:10,884 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 13:32:10,884 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 13:32:10,885 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.6ms
2025-11-18 13:32:10,887 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 13:32:10,887 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:10,887 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:10,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:10,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:10,888 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:10,888 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:10,888 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:10,888 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 13:32:10,893 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 13:32:10,893 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 13:32:10,896 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 13:32:10,896 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 13:32:10,897 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 10.2ms
2025-11-18 13:32:10,899 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 13:32:10,899 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:10,899 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:10,899 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:10,899 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:10,900 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:10,900 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:10,900 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:10,900 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 13:32:10,904 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 13:32:10,905 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 13:32:10,905 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 13:32:10,906 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 7.1ms
2025-11-18 13:32:13,562 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 13:32:13,562 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:13,562 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:13,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:13,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:13,563 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:13,563 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:13,563 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:13,564 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 13:32:13,568 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 13:32:13,568 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDkxNjMwLCJpYXQiOjE3NjM0OTA3MzAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.4eZNS7Xl42PY7HVyVFB6Xea7NvaCYc6p--UsM1IlbA4', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk1NTMwLCJpYXQiOjE3NjM0OTA3MzAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.iQ1gM7uLqI6DKJrg4Qi3kNHeqnS4_DKGl9KlhTUErTs'}
2025-11-18 13:32:13,569 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 13:32:13,569 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 13:32:13,569 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 13:32:13,569 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 13:32:13,571 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 13:32:13,572 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.0ms
2025-11-18 13:32:13,574 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 13:32:13,574 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:13,575 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:13,575 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:13,575 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:13,575 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:13,575 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:13,576 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:13,576 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 13:32:13,580 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 13:32:13,580 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDkxNjMwLCJpYXQiOjE3NjM0OTA3MzAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.4eZNS7Xl42PY7HVyVFB6Xea7NvaCYc6p--UsM1IlbA4', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk1NTMwLCJpYXQiOjE3NjM0OTA3MzAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.iQ1gM7uLqI6DKJrg4Qi3kNHeqnS4_DKGl9KlhTUErTs'}
2025-11-18 13:32:13,581 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 13:32:13,581 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 13:32:13,581 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 13:32:13,581 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 13:32:13,583 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 13:32:13,583 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.5ms
2025-11-18 13:32:14,164 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 13:32:14,164 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:14,165 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:14,165 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:14,165 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:14,165 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:14,165 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:14,165 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:14,165 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 13:32:14,169 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 13:32:14,170 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 13:32:14,171 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 13:32:14,171 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 7.6ms
2025-11-18 13:32:14,174 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 13:32:14,174 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:14,174 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:14,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:14,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:14,175 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:14,175 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:14,175 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:14,175 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 13:32:14,179 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 13:32:14,179 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 13:32:14,181 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 13:32:14,181 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 7.3ms
2025-11-18 13:32:15,702 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 13:32:15,703 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:15,703 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:15,703 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:15,704 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:15,704 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:15,704 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:15,704 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:15,704 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 13:32:15,708 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 13:32:15,708 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDkxNjMwLCJpYXQiOjE3NjM0OTA3MzAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.4eZNS7Xl42PY7HVyVFB6Xea7NvaCYc6p--UsM1IlbA4', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk1NTMwLCJpYXQiOjE3NjM0OTA3MzAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.iQ1gM7uLqI6DKJrg4Qi3kNHeqnS4_DKGl9KlhTUErTs'}
2025-11-18 13:32:15,708 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 13:32:15,708 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 13:32:15,709 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 13:32:15,709 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 13:32:15,711 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 13:32:15,711 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.1ms
2025-11-18 13:32:15,713 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 13:32:15,714 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:15,714 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:15,714 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:15,714 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:15,714 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:15,715 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:15,715 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:15,715 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 13:32:15,719 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 13:32:15,719 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDkxNjMwLCJpYXQiOjE3NjM0OTA3MzAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.4eZNS7Xl42PY7HVyVFB6Xea7NvaCYc6p--UsM1IlbA4', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk1NTMwLCJpYXQiOjE3NjM0OTA3MzAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.iQ1gM7uLqI6DKJrg4Qi3kNHeqnS4_DKGl9KlhTUErTs'}
2025-11-18 13:32:15,719 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 13:32:15,720 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 13:32:15,720 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 13:32:15,720 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 13:32:15,721 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 13:32:15,722 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.4ms
2025-11-18 13:32:17,110 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 13:32:17,111 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:17,111 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:17,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:17,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:17,112 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:17,112 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:17,112 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:17,112 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 13:32:17,114 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 13:32:17,114 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 13:32:17,115 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 13:32:17,116 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 13:32:17,116 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 13:32:17,117 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 13:32:17,117 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2123
2025-11-18 13:32:17,118 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2123
2025-11-18 13:32:17,118 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 13:32:17,118 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.0ms
2025-11-18 13:32:17,122 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 13:32:17,122 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 13:32:17,122 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 13:32:17,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 13:32:17,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 13:32:17,123 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 13:32:17,123 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 13:32:17,123 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 13:32:17,123 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 13:32:17,124 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 13:32:17,125 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 13:32:17,127 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 13:32:17,127 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 13:32:17,128 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.0ms
2025-11-18 14:15:11,386 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 14:15:11,387 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 14:15:11,387 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 14:15:11,387 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.3ms
2025-11-18 14:15:11,387 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-18 14:15:11,387 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-18 14:15:11,703 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:15:11,704 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:15:11,704 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': acme.midominio.com:5173
2025-11-18 14:15:11,704 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-18 14:15:11,704 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:15:11,704 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-18 14:15:11,716 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-18 14:15:11,716 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 14:15:11,716 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 2: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 14:15:11,717 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 2, usando Single-DB como fallback
2025-11-18 14:15:11,717 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:15:11,717 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:15:11,717 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:15:11,717 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:15:11,718 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:15:11,718 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:15:11,718 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:15:11,718 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:15:11,718 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:15:11,719 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:15:11,720 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 14:15:11,720 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 4: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 14:15:11,720 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 4, usando Single-DB como fallback
2025-11-18 14:15:11,721 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:15:11,721 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:15:11,721 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:15:11,721 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:15:11,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:15:11,721 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:15:11,722 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:15:11,722 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:15:11,722 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:15:11,722 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:15:11,723 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 14:15:11,723 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 14:15:11,724 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:15:11,725 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:15:11,726 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:15:11,726 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:15:11,726 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:15:11,729 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:15:11,730 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2124
2025-11-18 14:15:11,730 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2124
2025-11-18 14:15:11,730 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:15:11,730 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 27.2ms
2025-11-18 14:15:11,731 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 13.4ms
2025-11-18 14:15:11,731 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.3ms
2025-11-18 14:15:11,736 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 14:15:11,736 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.6ms
2025-11-18 14:15:11,738 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:15:11,738 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:15:11,738 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:15:11,738 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:15:11,738 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:15:11,739 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:15:11,739 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:15:11,739 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:15:11,739 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:15:11,740 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:15:11,740 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:15:11,742 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:15:11,742 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:15:11,742 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 4.4ms
2025-11-18 14:21:59,713 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-18 14:21:59,713 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:21:59,714 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: 127.0.0.1:8000
2025-11-18 14:21:59,714 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-18 14:21:59,714 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:21:59,714 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:21:59,714 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:21:59,715 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:21:59,715 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-18 14:21:59,715 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.8ms
2025-11-18 14:22:01,223 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-18 14:22:01,260 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-18 14:22:01,261 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:22:01,261 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: 127.0.0.1:8000
2025-11-18 14:22:01,261 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-18 14:22:01,261 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:22:01,261 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:22:01,261 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:22:01,262 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:22:01,262 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-18 14:22:01,377 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 116.6ms
2025-11-18 14:22:14,927 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 14:22:14,928 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:22:14,928 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: 127.0.0.1:8000
2025-11-18 14:22:14,928 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-18 14:22:14,928 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:22:14,928 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:22:14,929 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:22:14,929 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:22:14,929 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 14:22:14,956 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 14:22:14,956 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 14:22:14,956 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 14:22:15,191 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 14:22:15,191 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 14:22:15,191 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 14:22:15,195 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:22:15,196 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2125
2025-11-18 14:22:15,196 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2125
2025-11-18 14:22:15,196 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 14:22:15,197 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 269.4ms
2025-11-18 14:22:26,413 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:22:26,413 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:22:26,413 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: 127.0.0.1:8000
2025-11-18 14:22:26,413 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-18 14:22:26,414 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:22:26,414 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:22:26,414 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:22:26,414 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:22:26,414 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:22:26,424 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:22:26,424 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk0NjM1LCJpYXQiOjE3NjM0OTM3MzUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.fnD3XfA0sf5sglAcJR6Ktoqal8SIE9_lFk23-SZMIWM', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'accept': 'application/json', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'sec-ch-ua-mobile': '?0', 'sec-fetch-site': 'same-origin', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk4NTM1LCJpYXQiOjE3NjM0OTM3MzUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.zjJyxxMXt864fJwoL8NtxgUfYOidxB9rlOkVWPi06NY'}
2025-11-18 14:22:26,424 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 14:22:26,425 - app.api.v1.endpoints.clientes - INFO - URL completa: http://127.0.0.1:8000/api/v1/clientes/?skip=0&limit=100&solo_activos=true
2025-11-18 14:22:26,425 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:22:26,425 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 14:22:26,427 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:22:26,428 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 15.0ms
2025-11-18 14:23:36,379 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:23:36,380 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:23:36,380 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:23:36,380 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:23:36,380 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:23:36,381 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:23:36,381 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:23:36,381 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:23:36,381 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:23:36,381 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:23:36,382 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:23:36,382 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:23:36,383 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:23:36,383 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:23:36,383 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:23:36,383 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:23:36,395 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:23:36,396 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 14:23:36,396 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 4: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 14:23:36,397 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 4, usando Single-DB como fallback
2025-11-18 14:23:36,397 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:23:36,398 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:23:36,398 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:23:36,398 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': acme.midominio.com:5173
2025-11-18 14:23:36,398 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.midominio.com'
2025-11-18 14:23:36,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:23:36,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-18 14:23:36,400 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-18 14:23:36,400 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 14:23:36,401 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 2: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 14:23:36,401 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 2, usando Single-DB como fallback
2025-11-18 14:23:36,401 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:23:36,402 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:23:36,405 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:23:36,406 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:23:36,407 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:23:36,408 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:23:36,408 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:23:36,409 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:23:36,410 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2126
2025-11-18 14:23:36,410 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2126
2025-11-18 14:23:36,410 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:23:36,411 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 14:23:36,412 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 14:23:36,412 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 33.0ms
2025-11-18 14:23:36,412 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 30.8ms
2025-11-18 14:23:36,413 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 30.7ms
2025-11-18 14:23:36,419 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:23:36,419 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:23:36,420 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:23:36,420 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:23:36,420 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:23:36,420 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:23:36,420 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:23:36,421 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:23:36,421 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:23:36,423 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:23:36,423 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:23:36,425 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:23:36,426 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:23:36,426 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.4ms
2025-11-18 14:23:50,184 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:23:50,185 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:23:50,185 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:23:50,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:23:50,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:23:50,185 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:23:50,186 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:23:50,186 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:23:50,186 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:23:50,188 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:23:50,189 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:23:50,190 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:23:50,191 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:23:50,191 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:23:50,192 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:23:50,193 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2127
2025-11-18 14:23:50,193 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2127
2025-11-18 14:23:50,194 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:23:50,194 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.8ms
2025-11-18 14:23:50,200 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:23:50,200 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:23:50,200 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:23:50,201 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:23:50,201 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:23:50,201 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:23:50,201 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:23:50,201 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:23:50,202 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:23:50,203 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:23:50,203 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:23:50,206 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:23:50,206 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:23:50,206 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.5ms
2025-11-18 14:23:56,768 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:23:56,768 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:23:56,769 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:23:56,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:23:56,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:23:56,769 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:23:56,769 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:23:56,769 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:23:56,770 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:23:56,772 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:23:56,773 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:23:56,773 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:23:56,774 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:23:56,774 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:23:56,775 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:23:56,776 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2128
2025-11-18 14:23:56,776 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2128
2025-11-18 14:23:56,776 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:23:56,776 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.5ms
2025-11-18 14:23:56,780 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:23:56,781 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:23:56,781 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:23:56,781 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:23:56,781 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:23:56,781 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:23:56,782 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:23:56,782 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:23:56,782 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:23:56,784 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:23:56,784 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:23:56,787 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:23:56,787 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:23:56,787 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.1ms
2025-11-18 14:24:08,159 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 14:24:08,159 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-18 14:24:08,161 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 14:24:08,161 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:08,162 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:08,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:08,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:08,162 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:08,162 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:08,162 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:08,163 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 14:24:08,165 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 14:24:08,165 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 14:24:08,165 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 14:24:08,384 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 14:24:08,384 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 14:24:08,384 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 14:24:08,385 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:24:08,386 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2129
2025-11-18 14:24:08,386 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2129
2025-11-18 14:24:08,386 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 14:24:08,386 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 225.3ms
2025-11-18 14:24:08,411 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 14:24:08,411 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-18 14:24:08,412 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 14:24:08,413 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.2ms
2025-11-18 14:24:08,414 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 14:24:08,415 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:24:08,415 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:08,416 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:08,416 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:08,416 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:08,416 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:08,417 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:08,417 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:08,417 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:24:08,417 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 14:24:08,418 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 3.1ms
2025-11-18 14:24:08,421 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:24:08,422 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:24:08,424 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:24:08,425 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 14:24:08,426 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.5ms
2025-11-18 14:24:08,427 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 14:24:08,428 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.8ms
2025-11-18 14:24:08,428 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 14:24:08,430 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:24:08,430 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.2ms
2025-11-18 14:24:08,431 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:08,431 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:08,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:08,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:08,431 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:08,432 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:08,432 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:08,432 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:24:08,438 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:24:08,438 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:24:08,442 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:24:08,442 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:24:08,443 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 13.4ms
2025-11-18 14:24:08,446 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:24:08,447 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:08,447 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:08,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:08,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:08,447 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:08,448 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:08,448 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:08,448 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:24:08,452 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:24:08,453 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:24:08,453 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:24:08,454 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 7.6ms
2025-11-18 14:24:08,456 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:24:08,456 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:08,456 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:08,456 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:08,456 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:08,457 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:08,457 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:08,457 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:08,457 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:24:08,461 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:24:08,461 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:24:08,462 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:24:08,463 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-18 14:24:08,465 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:24:08,465 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:08,465 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:08,465 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:08,465 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:08,466 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:08,466 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:08,466 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:08,466 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:24:08,470 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:24:08,471 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:24:08,474 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:24:08,474 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:24:08,475 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 10.2ms
2025-11-18 14:24:08,477 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:24:08,477 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:08,477 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:08,478 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:08,478 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:08,478 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:08,478 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:08,478 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:08,478 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:24:08,483 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:24:08,484 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:24:08,484 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:24:08,485 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 7.7ms
2025-11-18 14:24:10,497 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 14:24:10,498 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 14:24:10,498 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.3ms
2025-11-18 14:24:10,499 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.4ms
2025-11-18 14:24:10,501 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:24:10,501 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:10,502 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:10,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:10,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:10,502 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:10,502 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:10,503 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:10,503 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:24:10,507 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:24:10,508 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk0NzQ4LCJpYXQiOjE3NjM0OTM4NDgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.dYnmVD4oLXz_ng0s6Ba0hTwlQGfqqj4jrnJSpWh0eoQ', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk4NjQ4LCJpYXQiOjE3NjM0OTM4NDgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.XWWDPIaNDDq_7dujPMof-93qd2S6Gd2v0JZNeLTYEWQ'}
2025-11-18 14:24:10,508 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:24:10,508 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:24:10,508 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:24:10,509 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:24:10,510 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:24:10,511 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.7ms
2025-11-18 14:24:10,513 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:24:10,513 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:10,514 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:10,514 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:10,514 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:10,514 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:10,514 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:10,515 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:10,515 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:24:10,519 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:24:10,519 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk0NzQ4LCJpYXQiOjE3NjM0OTM4NDgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.dYnmVD4oLXz_ng0s6Ba0hTwlQGfqqj4jrnJSpWh0eoQ', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk4NjQ4LCJpYXQiOjE3NjM0OTM4NDgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.XWWDPIaNDDq_7dujPMof-93qd2S6Gd2v0JZNeLTYEWQ'}
2025-11-18 14:24:10,519 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:24:10,520 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:24:10,520 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:24:10,520 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:24:10,521 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:24:10,522 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.0ms
2025-11-18 14:24:12,135 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 14:24:12,135 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.5ms
2025-11-18 14:24:12,137 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 14:24:12,137 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.6ms
2025-11-18 14:24:12,138 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 14:24:12,138 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:12,138 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:12,139 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:12,139 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:12,139 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:12,139 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:12,139 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:12,140 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 14:24:12,145 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 14:24:12,145 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 14:24:12,147 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 14:24:12,147 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.3ms
2025-11-18 14:24:12,150 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 14:24:12,150 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:12,150 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:12,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:12,151 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:12,151 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:12,151 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:12,151 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:12,151 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 14:24:12,155 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 14:24:12,156 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 14:24:12,157 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 14:24:12,157 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 7.8ms
2025-11-18 14:24:12,863 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 14:24:12,864 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 14:24:12,864 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.6ms
2025-11-18 14:24:12,865 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 14:24:12,865 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 14:24:12,866 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 2.0ms
2025-11-18 14:24:12,866 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.7ms
2025-11-18 14:24:12,867 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.7ms
2025-11-18 14:24:12,869 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:24:12,870 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:12,870 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:12,870 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:12,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:12,871 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:12,871 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:12,871 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:12,871 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:24:12,876 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:24:12,876 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk0NzQ4LCJpYXQiOjE3NjM0OTM4NDgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.dYnmVD4oLXz_ng0s6Ba0hTwlQGfqqj4jrnJSpWh0eoQ', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk4NjQ4LCJpYXQiOjE3NjM0OTM4NDgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.XWWDPIaNDDq_7dujPMof-93qd2S6Gd2v0JZNeLTYEWQ'}
2025-11-18 14:24:12,876 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 14:24:12,876 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 14:24:12,877 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:24:12,877 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 14:24:12,878 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:24:12,879 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 14:24:12,879 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:12,879 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:12,879 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:12,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:12,880 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:12,880 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:12,880 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:12,880 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 14:24:12,884 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 14:24:12,885 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 14:24:12,886 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 14:24:12,886 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 17.2ms
2025-11-18 14:24:12,887 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 8.5ms
2025-11-18 14:24:12,888 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:24:12,889 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:12,889 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:12,890 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:12,890 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:12,890 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:12,890 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:12,890 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:12,890 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:24:12,894 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:24:12,895 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk0NzQ4LCJpYXQiOjE3NjM0OTM4NDgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.dYnmVD4oLXz_ng0s6Ba0hTwlQGfqqj4jrnJSpWh0eoQ', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk4NjQ4LCJpYXQiOjE3NjM0OTM4NDgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.XWWDPIaNDDq_7dujPMof-93qd2S6Gd2v0JZNeLTYEWQ'}
2025-11-18 14:24:12,895 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 14:24:12,895 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 14:24:12,895 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:24:12,895 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 14:24:12,897 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:24:12,897 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 14:24:12,897 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:12,898 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:12,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:12,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:12,898 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:12,898 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:12,898 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:12,899 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 14:24:12,903 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 14:24:12,903 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 14:24:12,904 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 14:24:12,905 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/conexiones/clientes/2
2025-11-18 14:24:12,905 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/conexiones/clientes/2
2025-11-18 14:24:12,905 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 17.0ms
2025-11-18 14:24:12,906 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.3ms
2025-11-18 14:24:12,907 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/conexiones/clientes/2 200 1.8ms
2025-11-18 14:24:12,907 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/conexiones/clientes/2 200 1.7ms
2025-11-18 14:24:12,909 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:24:12,909 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:12,910 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:12,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:12,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:12,910 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:12,910 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:12,910 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:12,911 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:24:12,915 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:24:12,915 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk0NzQ4LCJpYXQiOjE3NjM0OTM4NDgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.dYnmVD4oLXz_ng0s6Ba0hTwlQGfqqj4jrnJSpWh0eoQ', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk4NjQ4LCJpYXQiOjE3NjM0OTM4NDgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.XWWDPIaNDDq_7dujPMof-93qd2S6Gd2v0JZNeLTYEWQ'}
2025-11-18 14:24:12,916 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 14:24:12,916 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 14:24:12,916 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:24:12,916 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 14:24:12,918 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:24:12,918 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 14:24:12,919 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 14:24:12,919 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:12,919 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:12,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:12,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:12,920 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:12,920 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:12,920 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:12,920 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 14:24:12,920 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:12,920 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:12,921 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:12,921 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:12,921 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:12,921 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:12,921 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:12,921 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 14:24:12,925 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 14:24:12,925 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 14:24:12,926 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 14:24:12,929 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 14:24:12,929 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 14:24:12,930 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 14:24:12,931 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 22.1ms
2025-11-18 14:24:12,932 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 13.5ms
2025-11-18 14:24:12,932 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 13.4ms
2025-11-18 14:24:12,935 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 14:24:12,935 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:12,935 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:12,935 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:12,936 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:12,936 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:12,936 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:12,936 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:12,936 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 14:24:12,940 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 14:24:12,940 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 14:24:12,941 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 14:24:12,942 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 7.1ms
2025-11-18 14:24:12,943 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 14:24:12,944 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:12,944 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:12,944 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:12,944 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:12,944 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:12,944 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:12,944 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:12,945 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 14:24:12,948 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 14:24:12,948 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 14:24:12,950 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 14:24:12,950 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 6.9ms
2025-11-18 14:24:12,952 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 14:24:12,952 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:12,952 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:12,953 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:12,953 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:12,953 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:12,953 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:12,953 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:12,953 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 14:24:12,957 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 14:24:12,957 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 14:24:12,958 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 14:24:12,959 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 6.8ms
2025-11-18 14:24:15,350 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:24:15,351 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:15,351 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:15,351 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:15,351 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:15,351 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:15,352 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:15,352 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:15,352 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:24:15,355 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:24:15,356 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:24:15,357 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:24:15,358 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:24:15,358 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:24:15,360 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:24:15,360 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2130
2025-11-18 14:24:15,361 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2130
2025-11-18 14:24:15,361 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:24:15,362 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.6ms
2025-11-18 14:24:15,366 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:24:15,366 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:15,366 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:15,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:15,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:15,367 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:15,367 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:15,367 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:15,368 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:24:15,370 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:24:15,370 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:24:15,372 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:24:15,372 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:24:15,373 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.9ms
2025-11-18 14:24:24,122 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:24:24,123 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:24,123 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:24,124 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:24,124 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:24,124 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:24,124 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:24,124 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:24,124 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:24:24,128 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:24:24,129 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:24:24,131 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:24:24,131 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.9ms
2025-11-18 14:24:24,134 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:24:24,134 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:24,134 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:24,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:24,135 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:24,135 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:24,135 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:24,135 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:24,135 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:24:24,139 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:24:24,140 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:24:24,141 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:24:24,141 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.8ms
2025-11-18 14:24:29,307 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:24:29,308 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:29,308 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:29,308 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:29,308 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:29,308 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:29,309 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:29,309 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:29,309 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:24:29,312 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:24:29,313 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:24:29,315 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:24:29,316 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:24:29,316 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:24:29,318 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:24:29,318 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2131
2025-11-18 14:24:29,319 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2131
2025-11-18 14:24:29,319 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:24:29,319 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.4ms
2025-11-18 14:24:29,324 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:24:29,324 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:29,325 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:29,325 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:29,325 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:29,325 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:29,326 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:29,326 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:29,326 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:24:29,328 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:24:29,328 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:24:29,332 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:24:29,332 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:24:29,333 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.9ms
2025-11-18 14:24:29,344 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:24:29,344 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:29,344 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:29,344 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:29,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:29,345 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:29,345 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:29,345 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:29,345 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:24:29,350 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:24:29,350 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:24:29,351 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:24:29,352 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.1ms
2025-11-18 14:24:29,354 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:24:29,354 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:29,354 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:29,354 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:29,354 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:29,355 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:29,355 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:29,355 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:29,355 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:24:29,358 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:24:29,359 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:24:29,360 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:24:29,360 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.5ms
2025-11-18 14:24:29,964 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:24:29,965 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:29,965 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:29,966 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:29,966 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:29,966 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:29,966 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:29,966 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:29,966 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:24:29,969 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:24:29,970 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:24:29,972 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:24:29,973 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:24:29,973 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:24:29,975 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (c16a055a410e9de10a64404c1d98d504db67acd7c3e13e8602eda6b21d5770cf). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-11-18 14:24:29,976 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (c16a055a410e9de10a64404c1d98d504db67acd7c3e13e8602eda6b21d5770cf). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (c16a055a410e9de10a64404c1d98d504db67acd7c3e13e8602eda6b21d5770cf). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (c16a055a410e9de10a64404c1d98d504db67acd7c3e13e8602eda6b21d5770cf). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-11-18 14:24:29,978 - app.services.refresh_token_service - CRITICAL - [SECURITY ALERT - TOKEN REUSE] Colisión de Refresh Token (hash) detectada para cliente 1, usuario 1. Revocando todas las sesiones del usuario para mitigar el riesgo.
2025-11-18 14:24:29,980 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 2
2025-11-18 14:24:29,981 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 2 tokens revocados para cliente 1, usuario 1
2025-11-18 14:24:29,981 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (c16a055a410e9de10a64404c1d98d504db67acd7c3e13e8602eda6b21d5770cf). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 91, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (c16a055a410e9de10a64404c1d98d504db67acd7c3e13e8602eda6b21d5770cf). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 117, in store_refresh_token
    raise AuthenticationError(
    ...<2 lines>...
    )
app.core.exceptions.AuthenticationError: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
2025-11-18 14:24:29,984 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-11-18 14:24:29,984 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:24:29,985 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 20.2ms
2025-11-18 14:24:30,000 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:24:30,000 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:30,000 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:30,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:30,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:30,001 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:30,001 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:30,001 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:30,002 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:24:30,003 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:24:30,004 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:24:30,007 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:24:30,007 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:24:30,008 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.9ms
2025-11-18 14:24:30,021 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:24:30,021 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:30,021 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:30,021 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:30,021 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:30,022 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:30,022 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:30,022 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:30,022 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:24:30,025 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:24:30,025 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:24:30,026 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:24:30,027 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.2ms
2025-11-18 14:24:30,028 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:24:30,029 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:30,029 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:30,029 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:30,029 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:30,030 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:30,030 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:30,030 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:30,030 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:24:30,034 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:24:30,035 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:24:30,035 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:24:30,036 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 14:24:31,438 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:24:31,439 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:24:31,439 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:24:31,439 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:24:31,439 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:24:31,439 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:24:31,440 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:24:31,440 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:24:31,440 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:24:31,442 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 14:24:31,443 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 14:24:31,444 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.2ms
2025-11-18 14:26:04,069 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 14:26:04,069 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:26:04,069 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:26:04,070 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:26:04,070 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:26:04,070 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:26:04,070 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:26:04,070 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:26:04,070 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 14:26:04,080 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 14:26:04,080 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 14:26:04,080 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 14:26:04,293 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 14:26:04,293 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 14:26:04,293 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 14:26:04,294 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:26:04,295 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2133
2025-11-18 14:26:04,295 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2133
2025-11-18 14:26:04,295 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 14:26:04,296 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 226.7ms
2025-11-18 14:26:04,313 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:26:04,314 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:26:04,314 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:26:04,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:26:04,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:26:04,315 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:26:04,315 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:26:04,315 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:26:04,315 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:26:04,320 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:26:04,320 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:26:04,321 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:26:04,322 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.1ms
2025-11-18 14:26:04,324 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:26:04,324 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:26:04,325 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:26:04,325 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:26:04,325 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:26:04,325 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:26:04,325 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:26:04,325 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:26:04,326 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:26:04,331 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:26:04,332 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:26:04,336 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:26:04,336 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:26:04,337 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:26:04,337 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:26:04,337 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:26:04,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:26:04,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:26:04,338 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:26:04,338 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:26:04,338 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:26:04,339 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:26:04,344 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:26:04,344 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:26:04,345 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:26:04,345 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 21.0ms
2025-11-18 14:26:04,346 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.2ms
2025-11-18 14:26:04,347 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:26:04,348 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:26:04,348 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:26:04,348 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:26:04,348 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:26:04,348 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:26:04,348 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:26:04,349 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:26:04,349 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:26:04,352 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:26:04,353 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:26:04,354 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:26:04,354 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:26:04,355 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:26:04,355 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:26:04,355 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:26:04,355 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:26:04,355 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:26:04,355 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:26:04,356 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:26:04,356 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:26:04,361 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:26:04,361 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:26:04,365 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:26:04,365 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:26:04,365 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 17.9ms
2025-11-18 14:26:04,366 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 11.7ms
2025-11-18 14:26:04,367 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:26:04,367 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:26:04,368 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:26:04,368 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:26:04,368 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:26:04,368 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:26:04,368 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:26:04,369 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:26:04,369 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:26:04,374 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:26:04,375 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:26:04,375 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:26:04,376 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 8.9ms
2025-11-18 14:26:05,200 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:26:05,201 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:26:05,201 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:26:05,201 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:26:05,201 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:26:05,202 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:26:05,202 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:26:05,202 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:26:05,202 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:26:05,207 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:26:05,208 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk0ODY0LCJpYXQiOjE3NjM0OTM5NjQsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.xI_5cblIiGtER2Pb7xi6R2dQ-Uv-ojj1j_e-REFe_vY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk4NzY0LCJpYXQiOjE3NjM0OTM5NjQsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.zqgF0hBTkBeObDaie6V6PYqimlOKsM6FvluCnTFUmyw'}
2025-11-18 14:26:05,208 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:26:05,208 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:26:05,208 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:26:05,209 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:26:05,210 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:26:05,211 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.4ms
2025-11-18 14:26:05,213 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:26:05,213 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:26:05,213 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:26:05,213 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:26:05,213 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:26:05,214 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:26:05,214 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:26:05,214 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:26:05,214 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:26:05,217 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:26:05,217 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk0ODY0LCJpYXQiOjE3NjM0OTM5NjQsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.xI_5cblIiGtER2Pb7xi6R2dQ-Uv-ojj1j_e-REFe_vY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk4NzY0LCJpYXQiOjE3NjM0OTM5NjQsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.zqgF0hBTkBeObDaie6V6PYqimlOKsM6FvluCnTFUmyw'}
2025-11-18 14:26:05,218 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:26:05,218 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:26:05,218 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:26:05,218 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:26:05,219 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:26:05,220 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.3ms
2025-11-18 14:26:06,973 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 14:26:06,973 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-18 14:26:06,975 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:26:06,975 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:26:06,976 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:26:06,976 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:26:06,976 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:26:06,976 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:26:06,976 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:26:06,976 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:26:06,977 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:26:06,978 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:26:06,979 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:26:06,981 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:26:06,981 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:26:06,981 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:26:06,982 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:26:06,983 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2134
2025-11-18 14:26:06,983 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2134
2025-11-18 14:26:06,983 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:26:06,984 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.5ms
2025-11-18 14:26:06,987 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 14:26:06,988 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-18 14:26:06,990 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:26:06,991 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:26:06,991 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:26:06,991 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:26:06,991 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:26:06,991 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:26:06,992 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:26:06,992 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:26:06,992 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:26:06,994 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:26:06,994 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:26:06,996 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:26:06,996 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:26:06,997 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.4ms
2025-11-18 14:28:19,727 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:28:19,727 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:19,727 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:19,728 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:19,728 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:19,728 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:19,728 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:19,728 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:19,728 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:28:19,739 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:28:19,741 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:28:19,742 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:28:19,742 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:28:19,743 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:28:19,744 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:28:19,744 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2135
2025-11-18 14:28:19,744 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2135
2025-11-18 14:28:19,745 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:28:19,745 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 18.5ms
2025-11-18 14:28:19,750 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:28:19,750 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:19,750 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:19,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:19,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:19,751 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:19,751 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:19,751 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:19,751 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:28:19,753 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:28:19,753 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:28:19,755 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:28:19,756 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:28:19,756 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.6ms
2025-11-18 14:28:20,799 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:20,800 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:20,800 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:20,800 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:20,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:20,801 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:20,801 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:20,801 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:20,801 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:20,805 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:28:20,807 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:28:20,808 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:28:20,809 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.6ms
2025-11-18 14:28:20,811 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:20,812 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:20,812 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:20,812 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:20,812 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:20,812 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:20,813 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:20,813 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:20,813 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:20,818 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:28:20,818 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:28:20,819 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:28:20,820 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.8ms
2025-11-18 14:28:22,183 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-18 14:28:22,184 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-18 14:28:22,186 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-18 14:28:22,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:22,186 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:22,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:22,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:22,186 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:22,187 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:22,187 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:22,187 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-18 14:28:22,189 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:28:22,190 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:28:22,190 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-18 14:28:22,190 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 4.7ms
2025-11-18 14:28:33,884 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 14:28:33,884 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:33,884 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:33,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:33,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:33,885 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:33,885 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:33,885 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:33,886 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 14:28:33,888 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 14:28:33,888 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 14:28:33,888 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 14:28:34,096 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 14:28:34,096 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 14:28:34,096 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 14:28:34,097 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:28:34,098 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2136
2025-11-18 14:28:34,098 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2136
2025-11-18 14:28:34,098 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 14:28:34,099 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 214.9ms
2025-11-18 14:28:34,116 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:34,116 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:34,116 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:34,117 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:34,117 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:34,117 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:34,118 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:34,118 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:34,118 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:34,123 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:28:34,123 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:28:34,124 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:28:34,125 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.6ms
2025-11-18 14:28:34,126 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:28:34,127 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:34,127 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:34,127 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:34,127 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:34,127 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:34,127 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:34,128 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:34,128 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:28:34,134 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:28:34,135 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:28:34,139 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:28:34,139 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:28:34,139 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 13.0ms
2025-11-18 14:28:34,142 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:28:34,142 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:34,142 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:34,142 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:34,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:34,143 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:34,143 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:34,143 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:34,143 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:28:34,149 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:28:34,150 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:28:34,150 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:28:34,150 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 8.8ms
2025-11-18 14:28:34,152 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:34,153 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:34,153 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:34,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:34,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:34,153 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:34,154 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:34,154 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:34,154 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:34,157 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:28:34,157 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:28:34,158 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:28:34,159 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.1ms
2025-11-18 14:28:34,160 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:28:34,161 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:34,161 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:34,161 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:34,161 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:34,161 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:34,161 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:34,162 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:34,162 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:28:34,167 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:28:34,167 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:28:34,171 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:28:34,171 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:28:34,171 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 10.9ms
2025-11-18 14:28:34,173 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:28:34,173 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:34,173 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:34,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:34,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:34,174 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:34,174 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:34,174 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:34,174 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:28:34,179 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:28:34,180 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:28:34,180 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:28:34,181 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 7.7ms
2025-11-18 14:28:35,217 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:28:35,218 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:35,218 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:35,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:35,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:35,219 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:35,220 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:35,220 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:35,220 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:28:35,225 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:28:35,226 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk1MDE0LCJpYXQiOjE3NjM0OTQxMTQsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.qOsd2L-KSLVQWexuZn-a_vUvdxQMS5RS7BGkjqBR-RA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk4OTE0LCJpYXQiOjE3NjM0OTQxMTQsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.Ai_3611AAzJ9KQ8VtuBi_lP7FbIueCRX-2XyOxA4fx0'}
2025-11-18 14:28:35,226 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:28:35,226 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:28:35,226 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:28:35,226 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:28:35,229 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:28:35,229 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 12.0ms
2025-11-18 14:28:35,232 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:28:35,232 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:35,232 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:35,233 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:35,233 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:35,233 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:35,233 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:35,233 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:35,233 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:28:35,238 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:28:35,238 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk1MDE0LCJpYXQiOjE3NjM0OTQxMTQsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.qOsd2L-KSLVQWexuZn-a_vUvdxQMS5RS7BGkjqBR-RA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk4OTE0LCJpYXQiOjE3NjM0OTQxMTQsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.Ai_3611AAzJ9KQ8VtuBi_lP7FbIueCRX-2XyOxA4fx0'}
2025-11-18 14:28:35,238 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:28:35,238 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:28:35,238 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:28:35,239 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:28:35,240 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:28:35,241 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.1ms
2025-11-18 14:28:36,585 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:28:36,586 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:36,586 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:36,586 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:36,586 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:36,586 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:36,587 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:36,587 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:36,587 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:28:36,589 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:28:36,590 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:28:36,592 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:28:36,592 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:28:36,593 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:28:36,595 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:28:36,595 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2137
2025-11-18 14:28:36,596 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2137
2025-11-18 14:28:36,596 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:28:36,596 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.1ms
2025-11-18 14:28:36,602 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:28:36,602 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:36,602 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:36,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:36,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:36,603 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:36,603 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:36,603 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:36,603 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:28:36,605 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:28:36,605 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:28:36,607 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:28:36,607 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:28:36,608 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.2ms
2025-11-18 14:28:38,142 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:38,142 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:38,143 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:38,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:38,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:38,143 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:38,143 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:38,143 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:38,144 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:38,148 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:28:38,148 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:28:38,149 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:28:38,150 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.1ms
2025-11-18 14:28:38,152 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:38,153 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:38,153 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:38,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:38,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:38,153 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:38,154 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:38,154 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:38,154 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:38,159 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:28:38,159 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:28:38,160 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:28:38,161 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.3ms
2025-11-18 14:28:38,936 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:28:38,936 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:38,937 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:38,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:38,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:38,937 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:38,937 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:38,937 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:38,938 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:28:38,940 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:28:38,941 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:28:38,943 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:28:38,943 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:28:38,943 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:28:38,945 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:28:38,945 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2138
2025-11-18 14:28:38,945 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2138
2025-11-18 14:28:38,946 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:28:38,946 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.6ms
2025-11-18 14:28:38,952 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:28:38,953 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:38,953 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:38,953 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:38,953 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:38,954 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:38,954 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:38,954 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:38,954 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:28:38,956 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:28:38,956 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:28:38,958 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:28:38,958 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:28:38,959 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.5ms
2025-11-18 14:28:38,971 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:38,971 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:38,971 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:38,971 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:38,972 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:38,972 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:38,972 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:38,972 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:38,972 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:38,975 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:28:38,975 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:28:38,976 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:28:38,977 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.1ms
2025-11-18 14:28:38,979 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:38,979 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:38,979 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:38,979 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:38,979 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:38,980 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:38,980 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:38,980 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:38,980 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:38,984 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:28:38,984 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:28:38,986 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:28:38,986 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.8ms
2025-11-18 14:28:39,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:28:39,152 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:39,152 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:39,152 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:39,152 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:39,152 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:39,152 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:39,152 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:39,153 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:28:39,155 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:28:39,157 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:28:39,158 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:28:39,159 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:28:39,159 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:28:39,161 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:28:39,162 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2139
2025-11-18 14:28:39,162 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2139
2025-11-18 14:28:39,162 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:28:39,163 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.8ms
2025-11-18 14:28:39,168 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:28:39,168 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:39,168 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:39,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:39,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:39,169 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:39,169 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:39,169 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:39,169 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:28:39,171 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:28:39,171 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:28:39,173 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:28:39,173 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:28:39,174 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.1ms
2025-11-18 14:28:39,185 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:39,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:39,186 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:39,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:39,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:39,186 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:39,187 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:39,187 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:39,187 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:39,190 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:28:39,190 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:28:39,191 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:28:39,192 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.5ms
2025-11-18 14:28:39,194 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:39,194 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:39,194 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:39,194 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:39,194 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:39,195 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:39,195 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:39,195 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:39,195 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:39,199 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:28:39,199 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:28:39,200 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:28:39,201 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.0ms
2025-11-18 14:28:39,336 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:28:39,337 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:39,337 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:39,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:39,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:39,338 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:39,338 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:39,338 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:39,338 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:28:39,340 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:28:39,341 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:28:39,343 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:28:39,344 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:28:39,344 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:28:39,346 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (8f5eaaf0f6c66b31a7230a8708aeaa00929acc6fca00c478ec1e9dc375c52b0e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-11-18 14:28:39,347 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (8f5eaaf0f6c66b31a7230a8708aeaa00929acc6fca00c478ec1e9dc375c52b0e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (8f5eaaf0f6c66b31a7230a8708aeaa00929acc6fca00c478ec1e9dc375c52b0e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (8f5eaaf0f6c66b31a7230a8708aeaa00929acc6fca00c478ec1e9dc375c52b0e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-11-18 14:28:39,348 - app.services.refresh_token_service - CRITICAL - [SECURITY ALERT - TOKEN REUSE] Colisión de Refresh Token (hash) detectada para cliente 1, usuario 1. Revocando todas las sesiones del usuario para mitigar el riesgo.
2025-11-18 14:28:39,349 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-11-18 14:28:39,349 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 0 tokens revocados para cliente 1, usuario 1
2025-11-18 14:28:39,350 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (8f5eaaf0f6c66b31a7230a8708aeaa00929acc6fca00c478ec1e9dc375c52b0e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 91, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (8f5eaaf0f6c66b31a7230a8708aeaa00929acc6fca00c478ec1e9dc375c52b0e). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 117, in store_refresh_token
    raise AuthenticationError(
    ...<2 lines>...
    )
app.core.exceptions.AuthenticationError: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
2025-11-18 14:28:39,351 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-11-18 14:28:39,352 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:28:39,352 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.0ms
2025-11-18 14:28:39,356 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:28:39,357 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:39,357 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:39,357 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:39,357 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:39,358 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:39,358 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:39,358 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:39,358 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:28:39,360 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:28:39,360 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:28:39,362 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:28:39,362 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:28:39,363 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.8ms
2025-11-18 14:28:39,376 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:39,377 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:39,377 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:39,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:39,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:39,377 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:39,378 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:39,378 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:39,378 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:39,382 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:28:39,382 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:28:39,383 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:28:39,384 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 14:28:39,387 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:39,387 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:39,387 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:39,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:39,388 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:39,388 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:39,388 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:39,388 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:39,388 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:39,391 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:28:39,392 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:28:39,393 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:28:39,393 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.5ms
2025-11-18 14:28:39,547 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:28:39,548 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:39,548 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:39,548 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:39,549 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:39,549 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:39,549 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:39,549 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:39,549 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:28:39,553 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 14:28:39,553 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 14:28:39,553 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 6.0ms
2025-11-18 14:28:39,741 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:28:39,741 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:39,741 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:39,742 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:39,742 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:39,742 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:39,742 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:39,742 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:39,742 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:28:39,745 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 14:28:39,745 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 14:28:39,746 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.2ms
2025-11-18 14:28:39,984 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:28:39,985 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:39,985 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:28:39,985 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:28:39,985 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:39,986 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:28:39,986 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:28:39,986 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:39,986 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:28:39,989 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 14:28:39,989 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 14:28:39,990 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.8ms
2025-11-18 14:28:50,761 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 14:28:50,762 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-18 14:28:51,065 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 14:28:51,065 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:51,065 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:28:51,066 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:28:51,066 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:51,066 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:28:51,067 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:28:51,068 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 14:28:51,068 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 4: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 14:28:51,068 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 4, usando Single-DB como fallback
2025-11-18 14:28:51,068 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:51,069 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 14:28:51,070 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-18 14:28:51,071 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-18 14:28:51,071 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-18 14:28:51,279 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 14:28:51,280 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-18 14:28:51,281 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:28:51,282 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 4, Usuario 2 - Cliente: web - Token ID: 2141
2025-11-18 14:28:51,282 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2141
2025-11-18 14:28:51,282 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-18 14:28:51,283 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 217.9ms
2025-11-18 14:28:51,308 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 14:28:51,309 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-11-18 14:28:51,309 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 14:28:51,310 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.0ms
2025-11-18 14:28:51,312 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 14:28:51,313 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-18 14:28:51,313 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:51,314 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:51,314 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:28:51,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:28:51,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:51,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:28:51,316 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:28:51,316 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:51,316 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:51,316 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 14:28:51,321 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 14:28:51,321 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 14:28:51,322 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 14:28:51,323 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 6.5ms
2025-11-18 14:28:51,323 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.2ms
2025-11-18 14:28:51,326 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 14:28:51,326 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:51,326 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:28:51,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:28:51,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:51,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:28:51,328 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:28:51,328 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:51,328 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 14:28:51,334 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 14:28:51,335 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 8.9ms
2025-11-18 14:28:51,335 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:28:51,336 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:51,336 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:28:51,336 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:28:51,336 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:51,336 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:28:51,337 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:28:51,337 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:51,338 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:28:51,341 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 14:28:51,341 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 14:28:51,342 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 14:28:51,343 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.5ms
2025-11-18 14:28:51,344 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 14:28:51,344 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:51,345 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:28:51,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:28:51,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:51,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:28:51,346 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:28:51,347 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:51,347 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 14:28:51,352 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 14:28:51,352 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 8.4ms
2025-11-18 14:28:53,959 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 14:28:53,960 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-18 14:28:53,962 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:28:53,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:28:53,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:28:53,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:28:53,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:28:53,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:28:53,964 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:28:53,964 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:28:53,965 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:28:53,966 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 14:28:53,966 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.4ms
2025-11-18 14:29:14,974 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:29:14,975 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:14,975 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:29:14,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:29:14,976 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:14,976 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:29:14,977 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:29:14,977 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:14,977 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:29:14,979 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 14:29:14,979 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.8ms
2025-11-18 14:29:22,269 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 14:29:22,270 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:22,270 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:29:22,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:29:22,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:22,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:29:22,271 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:29:22,272 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:22,272 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 14:29:22,274 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-18 14:29:22,274 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-18 14:29:22,275 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-18 14:29:22,486 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 14:29:22,486 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-18 14:29:22,488 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:29:22,488 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 4, Usuario 2 - Cliente: web - Token ID: 2142
2025-11-18 14:29:22,488 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2142
2025-11-18 14:29:22,489 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-18 14:29:22,489 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 220.0ms
2025-11-18 14:29:22,515 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:29:22,516 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:22,516 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:29:22,517 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:29:22,517 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:22,517 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:29:22,518 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:29:22,518 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:22,519 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:29:22,519 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 14:29:22,523 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 14:29:22,523 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 14:29:22,524 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 14:29:22,525 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:22,525 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:29:22,525 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:29:22,525 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:22,525 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:29:22,527 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:29:22,527 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:22,527 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 14:29:22,531 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 14:29:22,532 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 16.2ms
2025-11-18 14:29:22,532 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 13.0ms
2025-11-18 14:29:22,534 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:29:22,535 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:22,535 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:29:22,535 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:29:22,535 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:22,535 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:29:22,536 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:29:22,536 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:22,537 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:29:22,537 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 14:29:22,540 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 14:29:22,541 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 14:29:22,542 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 14:29:22,542 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:22,542 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:29:22,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:29:22,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:22,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:29:22,544 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:29:22,544 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:22,544 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 14:29:22,549 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 14:29:22,550 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.8ms
2025-11-18 14:29:22,550 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 13.4ms
2025-11-18 14:29:24,523 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:29:24,523 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:24,523 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:29:24,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:29:24,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:24,524 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:29:24,525 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:29:24,525 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:24,525 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:29:24,527 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 14:29:24,527 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.8ms
2025-11-18 14:29:38,204 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 14:29:38,205 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:38,205 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:38,205 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:38,205 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:38,205 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:38,205 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:38,206 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:38,206 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 14:29:38,208 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 14:29:38,208 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 14:29:38,208 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 14:29:38,422 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 14:29:38,422 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 14:29:38,422 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 14:29:38,424 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:29:38,424 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2143
2025-11-18 14:29:38,424 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2143
2025-11-18 14:29:38,425 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 14:29:38,425 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 221.0ms
2025-11-18 14:29:38,448 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:29:38,449 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:38,449 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:38,449 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:38,449 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:38,450 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:38,450 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:38,450 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:38,450 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:29:38,454 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:29:38,454 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:29:38,455 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:29:38,456 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.9ms
2025-11-18 14:29:38,459 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:29:38,459 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:38,459 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:38,459 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:38,460 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:38,460 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:38,460 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:38,460 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:38,460 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:29:38,465 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:29:38,465 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:29:38,469 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:29:38,469 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:29:38,470 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:29:38,470 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:38,470 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:38,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:38,471 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:38,471 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:38,471 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:38,471 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:38,471 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:29:38,476 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:29:38,477 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:29:38,477 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:29:38,478 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 19.1ms
2025-11-18 14:29:38,479 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 8.6ms
2025-11-18 14:29:38,480 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:29:38,480 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:38,480 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:38,480 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:38,481 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:38,481 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:38,481 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:38,481 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:38,481 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:29:38,484 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:29:38,485 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:29:38,486 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:29:38,486 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:29:38,486 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:38,487 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:38,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:38,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:38,487 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:38,487 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:38,487 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:38,487 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:29:38,493 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:29:38,493 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:29:38,496 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:29:38,496 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:29:38,496 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 16.6ms
2025-11-18 14:29:38,497 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 11.3ms
2025-11-18 14:29:38,499 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:29:38,499 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:38,499 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:38,499 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:38,499 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:38,500 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:38,500 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:38,500 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:38,500 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:29:38,504 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:29:38,505 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:29:38,505 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:29:38,506 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 7.0ms
2025-11-18 14:29:40,127 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:29:40,128 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:40,128 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:40,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:40,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:40,129 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:40,129 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:40,130 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:40,131 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:29:40,136 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:29:40,137 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk1MDc4LCJpYXQiOjE3NjM0OTQxNzgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.4GF8bGv5IUStpQ7Fzc0VCjYHghPkocW21OMsL9LyrIY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk4OTc4LCJpYXQiOjE3NjM0OTQxNzgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.8DlWbaG3O-VinV7M9lFhnhPRb9cYYy7MqgXgL0CLOp0'}
2025-11-18 14:29:40,137 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:29:40,137 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:29:40,137 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:29:40,137 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:29:40,139 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:29:40,140 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 12.5ms
2025-11-18 14:29:40,142 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:29:40,143 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:40,143 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:40,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:40,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:40,144 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:40,144 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:40,144 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:40,144 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:29:40,148 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:29:40,148 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk1MDc4LCJpYXQiOjE3NjM0OTQxNzgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.4GF8bGv5IUStpQ7Fzc0VCjYHghPkocW21OMsL9LyrIY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk4OTc4LCJpYXQiOjE3NjM0OTQxNzgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.8DlWbaG3O-VinV7M9lFhnhPRb9cYYy7MqgXgL0CLOp0'}
2025-11-18 14:29:40,148 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:29:40,149 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:29:40,149 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:29:40,149 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:29:40,150 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:29:40,151 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.6ms
2025-11-18 14:29:41,661 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:29:41,662 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:41,662 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:41,662 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:41,662 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:41,663 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:41,663 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:41,663 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:41,663 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:29:41,666 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:29:41,667 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:29:41,674 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:29:41,675 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:29:41,675 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:29:41,677 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:29:41,678 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2144
2025-11-18 14:29:41,678 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2144
2025-11-18 14:29:41,679 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:29:41,679 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 18.1ms
2025-11-18 14:29:41,684 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:29:41,685 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:41,685 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:41,685 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:41,685 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:41,685 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:41,686 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:41,686 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:41,686 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:29:41,688 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:29:41,688 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:29:41,691 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:29:41,691 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:29:41,691 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.9ms
2025-11-18 14:29:42,541 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:29:42,542 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:42,542 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:42,542 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:42,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:42,543 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:42,543 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:42,543 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:42,543 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:29:42,546 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:29:42,547 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:29:42,550 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:29:42,551 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:29:42,551 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:29:42,553 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:29:42,553 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2145
2025-11-18 14:29:42,554 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2145
2025-11-18 14:29:42,554 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:29:42,555 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.1ms
2025-11-18 14:29:42,562 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:29:42,563 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:42,563 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:42,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:42,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:42,564 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:42,564 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:42,564 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:42,564 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:29:42,566 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:29:42,566 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:29:42,568 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:29:42,568 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:29:42,569 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.8ms
2025-11-18 14:29:43,072 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:29:43,072 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:43,073 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:43,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:43,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:43,073 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:43,073 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:43,073 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:43,074 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:29:43,077 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:29:43,077 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:29:43,079 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:29:43,080 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.3ms
2025-11-18 14:29:43,083 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:29:43,083 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:43,083 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:43,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:43,084 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:43,084 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:43,084 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:43,084 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:43,084 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:29:43,088 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:29:43,089 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:29:43,090 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:29:43,090 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 14:29:43,590 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:29:43,590 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:43,590 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:43,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:43,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:43,591 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:43,591 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:43,591 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:43,591 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:29:43,594 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:29:43,595 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:29:43,597 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:29:43,598 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:29:43,598 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:29:43,600 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:29:43,601 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Cliente 1, Usuario 1 - Cliente: web - Token ID: 2146
2025-11-18 14:29:43,601 - app.api.v1.endpoints.auth - INFO - [REFRESH] Nuevo token almacenado - ID: 2146
2025-11-18 14:29:43,601 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:29:43,602 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.1ms
2025-11-18 14:29:43,606 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:29:43,606 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:43,606 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:43,607 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:43,607 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:43,607 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:43,607 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:43,607 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:43,607 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:29:43,609 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:29:43,609 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:29:43,611 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:29:43,612 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:29:43,612 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.6ms
2025-11-18 14:29:43,633 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:29:43,633 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:43,633 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:43,633 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:43,633 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:43,634 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:43,634 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:43,634 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:43,634 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:29:43,637 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:29:43,637 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:29:43,638 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:29:43,639 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.9ms
2025-11-18 14:29:43,640 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:29:43,641 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:43,641 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:43,641 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:43,641 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:43,641 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:43,641 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:43,642 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:43,642 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:29:43,646 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:29:43,646 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:29:43,647 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:29:43,648 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.5ms
2025-11-18 14:29:43,965 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:29:43,966 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:43,966 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:43,966 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:43,966 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:43,967 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:43,967 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:43,967 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:43,967 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:29:43,970 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido para cliente 1, usuario 1 - Cliente: web
2025-11-18 14:29:43,971 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:29:43,972 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:29:43,973 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya estaba revocado para cliente 1, usuario 1
2025-11-18 14:29:43,973 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo ya estaba revocado o no existía para superadmin
2025-11-18 14:29:43,975 - app.db.queries - ERROR - Error en execute_insert: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b388afac44503c298d17e0ab7bdfd9c89074ce8c1d3d671df188e7fc4f60091a). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-11-18 14:29:43,976 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b388afac44503c298d17e0ab7bdfd9c89074ce8c1d3d671df188e7fc4f60091a). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b388afac44503c298d17e0ab7bdfd9c89074ce8c1d3d671df188e7fc4f60091a). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b388afac44503c298d17e0ab7bdfd9c89074ce8c1d3d671df188e7fc4f60091a). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")
2025-11-18 14:29:43,978 - app.services.refresh_token_service - CRITICAL - [SECURITY ALERT - TOKEN REUSE] Colisión de Refresh Token (hash) detectada para cliente 1, usuario 1. Revocando todas las sesiones del usuario para mitigar el riesgo.
2025-11-18 14:29:43,979 - app.db.queries - INFO - Actualización exitosa, filas afectadas: 0
2025-11-18 14:29:43,980 - app.services.refresh_token_service - INFO - [REVOKE-ALL] 0 tokens revocados para cliente 1, usuario 1
2025-11-18 14:29:43,980 - app.services.base_service - ERROR - ERROR INESPERADO en store_refresh_token: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 72, in execute_insert
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.IntegrityError: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b388afac44503c298d17e0ab7bdfd9c89074ce8c1d3d671df188e7fc4f60091a). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 91, in store_refresh_token
    result = execute_insert(INSERT_REFRESH_TOKEN, params)
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 93, in execute_insert
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la inserción: ('23000', "[23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Violation of UNIQUE KEY constraint 'UQ__refresh___9F6BDB13DC433704'. Cannot insert duplicate key in object 'dbo.refresh_tokens'. The duplicate key value is (b388afac44503c298d17e0ab7bdfd9c89074ce8c1d3d671df188e7fc4f60091a). (2627) (SQLExecDirectW); [23000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]The statement has been terminated. (3621)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\refresh_token_service.py", line 117, in store_refresh_token
    raise AuthenticationError(
    ...<2 lines>...
    )
app.core.exceptions.AuthenticationError: Error de seguridad: Posible reuso de token detectado. Todas las sesiones han sido cerradas.
2025-11-18 14:29:43,982 - app.api.v1.endpoints.auth - ERROR - [REFRESH] Error almacenando nuevo refresh token: Error interno del servidor en store_refresh_token
2025-11-18 14:29:43,982 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente para usuario: superadmin
2025-11-18 14:29:43,983 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 17.5ms
2025-11-18 14:29:43,987 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:29:43,987 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:43,988 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:43,988 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:43,988 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:43,988 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:43,988 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:43,989 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:43,989 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:29:43,990 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:29:43,991 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:29:43,993 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:29:43,993 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:29:43,994 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.9ms
2025-11-18 14:29:44,016 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:29:44,017 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:44,017 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:44,017 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:44,018 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:44,018 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:44,018 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:44,018 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:44,018 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:29:44,023 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:29:44,023 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:29:44,024 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:29:44,024 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.1ms
2025-11-18 14:29:44,027 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:29:44,027 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:44,027 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:44,028 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:44,028 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:44,028 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:44,029 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:44,029 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:44,029 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:29:44,034 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:29:44,035 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:29:44,036 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:29:44,036 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.6ms
2025-11-18 14:29:44,395 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:29:44,395 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:29:44,395 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:29:44,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:29:44,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:29:44,396 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:29:44,396 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:29:44,396 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:29:44,396 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:29:44,399 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado
2025-11-18 14:29:44,399 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 14:29:44,400 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.4ms
2025-11-18 14:40:01,192 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 14:40:01,193 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.3ms
2025-11-18 14:40:45,943 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-18 14:40:45,988 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:40:45,988 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:40:45,989 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:40:45,989 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:40:45,989 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:40:45,989 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:40:45,989 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:40:45,990 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:40:45,990 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:40:45,991 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 400 3.5ms
2025-11-18 14:40:52,341 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:40:52,341 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:40:52,342 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:40:52,342 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:40:52,342 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:40:52,342 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:40:52,342 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:40:52,342 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:40:52,343 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:40:52,349 - app.core.auth - ERROR - Error validando refresh token: type object 'RefreshTokenService' has no attribute 'validate_refresh_token'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 462, in get_current_user_from_refresh
    db_token_data = await RefreshTokenService.validate_refresh_token(refresh_token)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'RefreshTokenService' has no attribute 'validate_refresh_token'. Did you mean: 'store_refresh_token'?
2025-11-18 14:40:52,351 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 10.4ms
2025-11-18 14:41:10,167 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:41:10,168 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:10,168 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:10,168 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:10,168 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:10,169 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:10,169 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:10,169 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:10,169 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:41:10,170 - app.core.auth - ERROR - Error validando refresh token: type object 'RefreshTokenService' has no attribute 'validate_refresh_token'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 462, in get_current_user_from_refresh
    db_token_data = await RefreshTokenService.validate_refresh_token(refresh_token)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'RefreshTokenService' has no attribute 'validate_refresh_token'. Did you mean: 'store_refresh_token'?
2025-11-18 14:41:10,171 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.0ms
2025-11-18 14:41:19,670 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 14:41:19,670 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-18 14:41:19,672 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 14:41:19,672 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:19,672 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:19,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:19,672 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:19,673 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:19,673 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:19,673 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:19,673 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 14:41:19,697 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 14:41:19,698 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 14:41:19,698 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 14:41:19,929 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 14:41:19,929 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 14:41:19,929 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 14:41:19,931 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:41:19,931 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Nuevo token insertado - Cliente 1, Usuario 1 - Cliente: web - Token ID: 2148
2025-11-18 14:41:19,931 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2148
2025-11-18 14:41:19,931 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 14:41:19,932 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 260.2ms
2025-11-18 14:41:19,957 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 14:41:19,958 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-18 14:41:19,959 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 14:41:19,960 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.9ms
2025-11-18 14:41:19,961 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 14:41:19,961 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:41:19,962 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 0.9ms
2025-11-18 14:41:19,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:19,962 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:19,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:19,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:19,963 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:19,963 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:19,963 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:19,963 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:41:19,964 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 14:41:19,968 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:41:19,968 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:41:19,969 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:41:19,970 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 6.2ms
2025-11-18 14:41:19,970 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.9ms
2025-11-18 14:41:19,972 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 14:41:19,973 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.7ms
2025-11-18 14:41:19,974 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 14:41:19,974 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 0.4ms
2025-11-18 14:41:19,975 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:41:19,976 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:19,976 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:19,976 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:19,976 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:19,976 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:19,977 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:19,977 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:19,977 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:41:19,982 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:41:19,982 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:41:19,986 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:41:19,986 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:41:19,986 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 10.7ms
2025-11-18 14:41:19,989 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:41:19,990 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:19,990 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:19,990 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:19,990 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:19,990 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:19,990 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:19,990 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:19,991 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:41:19,995 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:41:19,995 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:41:19,996 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:41:19,996 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 7.0ms
2025-11-18 14:41:19,998 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:41:19,998 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:19,998 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:19,998 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:19,999 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:19,999 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:19,999 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:19,999 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:19,999 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:41:20,003 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:41:20,003 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:41:20,004 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:41:20,004 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.5ms
2025-11-18 14:41:20,007 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:41:20,007 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:20,007 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:20,008 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:20,008 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:20,008 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:20,008 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:20,008 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:20,008 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:41:20,013 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:41:20,013 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:41:20,016 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:41:20,016 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:41:20,017 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 10.1ms
2025-11-18 14:41:20,019 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:41:20,019 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:20,019 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:20,019 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:20,019 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:20,020 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:20,020 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:20,020 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:20,020 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:41:20,025 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:41:20,026 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:41:20,026 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:41:20,026 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 7.7ms
2025-11-18 14:41:22,010 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 14:41:22,011 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-18 14:41:22,011 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 14:41:22,013 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.6ms
2025-11-18 14:41:22,015 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:41:22,016 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:22,016 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:22,016 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:22,016 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:22,016 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:22,017 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:22,017 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:22,017 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:41:22,021 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:41:22,021 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk1Nzc5LCJpYXQiOjE3NjM0OTQ4NzksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.xKIjlebI7Ah-FdwSWe_f-Y7uvNRNZtn5gMnq1mCZOVY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk5Njc5LCJpYXQiOjE3NjM0OTQ4NzksInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.x6DbbhMxefY_QN4-h62NRGmDU4MuPQq0Fb5Bl1tWsRA'}
2025-11-18 14:41:22,022 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:41:22,022 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:41:22,022 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:41:22,022 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:41:22,024 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:41:22,025 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.6ms
2025-11-18 14:41:22,027 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:41:22,027 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:22,028 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:22,028 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:22,028 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:22,028 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:22,028 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:22,028 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:22,029 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:41:22,032 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:41:22,033 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk1Nzc5LCJpYXQiOjE3NjM0OTQ4NzksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.xKIjlebI7Ah-FdwSWe_f-Y7uvNRNZtn5gMnq1mCZOVY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk5Njc5LCJpYXQiOjE3NjM0OTQ4NzksInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.x6DbbhMxefY_QN4-h62NRGmDU4MuPQq0Fb5Bl1tWsRA'}
2025-11-18 14:41:22,033 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:41:22,033 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:41:22,033 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:41:22,033 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:41:22,035 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:41:22,035 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.5ms
2025-11-18 14:41:23,316 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 14:41:23,316 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.7ms
2025-11-18 14:41:23,318 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 14:41:23,318 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.5ms
2025-11-18 14:41:23,319 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 14:41:23,320 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:23,320 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:23,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:23,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:23,320 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:23,320 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:23,321 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:23,321 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 14:41:23,326 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 14:41:23,327 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 14:41:23,328 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 14:41:23,329 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.1ms
2025-11-18 14:41:23,331 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 14:41:23,331 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:23,332 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:23,332 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:23,332 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:23,332 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:23,332 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:23,332 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:23,333 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 14:41:23,337 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 14:41:23,337 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 14:41:23,338 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 14:41:23,339 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 7.5ms
2025-11-18 14:41:26,065 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:41:26,065 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:41:26,066 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:41:26,066 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:41:26,066 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:41:26,066 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:41:26,066 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:41:26,066 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:41:26,066 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:41:26,068 - app.core.auth - ERROR - Error validando refresh token: type object 'RefreshTokenService' has no attribute 'validate_refresh_token'
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 462, in get_current_user_from_refresh
    db_token_data = await RefreshTokenService.validate_refresh_token(refresh_token)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'RefreshTokenService' has no attribute 'validate_refresh_token'. Did you mean: 'store_refresh_token'?
2025-11-18 14:41:26,068 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.2ms
2025-11-18 14:43:06,682 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=midominio.com, SYSTEM_ID=1
2025-11-18 14:43:10,149 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:10,150 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:10,150 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:10,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:10,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:10,151 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:10,151 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:10,151 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:10,151 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:10,212 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:10,214 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:10,219 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:10,220 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2149, Rotación: True
2025-11-18 14:43:10,221 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:10,222 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:10,222 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:10,222 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2149
2025-11-18 14:43:10,222 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:10,223 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 74.0ms
2025-11-18 14:43:10,541 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 14:43:10,541 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-18 14:43:10,543 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:10,543 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:10,543 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:10,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:10,544 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:10,544 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:10,544 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:10,544 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:10,544 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:10,546 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:10,546 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:10,548 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:10,548 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:10,549 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.4ms
2025-11-18 14:43:24,301 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 14:43:24,301 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:24,301 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:24,302 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:24,302 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:24,302 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:24,302 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:24,302 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:24,302 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 14:43:24,308 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 14:43:24,308 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 14:43:24,308 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 14:43:24,552 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 14:43:24,552 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 14:43:24,552 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 14:43:24,553 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:24,553 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2150, Rotación: False
2025-11-18 14:43:24,554 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2150
2025-11-18 14:43:24,554 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 14:43:24,554 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 253.6ms
2025-11-18 14:43:24,574 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:24,574 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:24,575 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:24,575 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:24,575 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:24,575 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:24,576 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:24,576 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:24,576 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:24,582 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:24,583 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:24,584 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:24,585 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.3ms
2025-11-18 14:43:24,588 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:43:24,589 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:24,589 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:24,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:24,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:24,590 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:24,591 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:24,591 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:24,591 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:43:24,602 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:43:24,603 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:43:24,609 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:43:24,609 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:43:24,610 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 22.2ms
2025-11-18 14:43:24,613 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:43:24,613 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:24,613 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:24,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:24,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:24,614 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:24,614 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:24,614 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:24,614 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:43:24,620 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:43:24,621 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:43:24,621 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:43:24,621 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 8.9ms
2025-11-18 14:43:24,625 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:24,626 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:24,626 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:24,626 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:24,627 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:24,627 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:24,627 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:24,628 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:24,628 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:24,632 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:24,633 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:24,634 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:24,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.4ms
2025-11-18 14:43:24,636 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 14:43:24,636 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:24,637 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:24,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:24,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:24,637 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:24,637 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:24,638 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:24,638 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 14:43:24,645 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 14:43:24,646 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 14:43:24,649 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 14:43:24,650 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 14:43:24,650 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 14.2ms
2025-11-18 14:43:24,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 14:43:24,652 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:24,653 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:24,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:24,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:24,653 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:24,653 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:24,654 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:24,654 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 14:43:24,661 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 14:43:24,662 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 14:43:24,663 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 14:43:24,663 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.0ms
2025-11-18 14:43:25,621 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:43:25,621 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:25,621 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:25,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:25,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:25,622 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:25,623 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:25,623 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:25,623 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:43:25,630 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:43:25,631 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk1OTA0LCJpYXQiOjE3NjM0OTUwMDQsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.Eeyy8dKmGG5ccddeXdD2ZukUWEMzt9P7sDdDifE1uEA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk5ODA0LCJpYXQiOjE3NjM0OTUwMDQsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.xrogRfF25t0ocsBVRHsMm94fOCLxsRkhCuVoGK6yUH8'}
2025-11-18 14:43:25,631 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:43:25,631 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:43:25,631 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:43:25,632 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:43:25,633 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:43:25,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.2ms
2025-11-18 14:43:25,636 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 14:43:25,636 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:25,636 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:25,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:25,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:25,637 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:25,637 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:25,637 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:25,638 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 14:43:25,643 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 14:43:25,643 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'localhost:8000', 'connection': 'keep-alive', 'sec-ch-ua-platform': '"Windows"', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNDk1OTA0LCJpYXQiOjE3NjM0OTUwMDQsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjEsImlzX3N1cGVyX2FkbWluIjpmYWxzZSwidXNlcl90eXBlIjoidXNlciJ9.Eeyy8dKmGG5ccddeXdD2ZukUWEMzt9P7sDdDifE1uEA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'sec-ch-ua': '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'sec-ch-ua-mobile': '?0', 'origin': 'http://localhost:5173', 'sec-fetch-site': 'same-site', 'sec-fetch-mode': 'cors', 'sec-fetch-dest': 'empty', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzY0MDk5ODA0LCJpYXQiOjE3NjM0OTUwMDQsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjoxLCJpc19zdXBlcl9hZG1pbiI6ZmFsc2UsInVzZXJfdHlwZSI6InVzZXIifQ.xrogRfF25t0ocsBVRHsMm94fOCLxsRkhCuVoGK6yUH8'}
2025-11-18 14:43:25,643 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 14:43:25,644 - app.api.v1.endpoints.clientes - INFO - URL completa: http://localhost:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 14:43:25,644 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 14:43:25,644 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 14:43:25,646 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 14:43:25,647 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 11.0ms
2025-11-18 14:43:27,842 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:27,842 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:27,843 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:27,843 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:27,843 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:27,843 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:27,843 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:27,844 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:27,844 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:27,847 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:27,849 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:27,852 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:27,852 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2151, Rotación: True
2025-11-18 14:43:27,854 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:27,854 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:27,854 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:27,855 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2151
2025-11-18 14:43:27,855 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:27,855 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.8ms
2025-11-18 14:43:27,865 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:27,865 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:27,865 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:27,866 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:27,866 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:27,866 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:27,866 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:27,866 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:27,867 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:27,869 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:27,869 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:27,872 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:27,872 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:27,873 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.3ms
2025-11-18 14:43:30,456 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:30,456 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:30,457 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:30,457 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:30,457 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:30,457 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:30,458 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:30,458 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:30,458 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:30,463 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:30,463 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:30,464 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:30,465 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.8ms
2025-11-18 14:43:30,467 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:30,467 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:30,467 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:30,467 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:30,468 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:30,468 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:30,468 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:30,468 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:30,469 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:30,474 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:30,474 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:30,475 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:30,476 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.2ms
2025-11-18 14:43:31,521 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:31,522 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:31,522 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:31,522 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:31,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:31,523 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:31,523 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:31,523 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:31,523 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:31,532 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:31,533 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:31,536 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:31,536 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2152, Rotación: True
2025-11-18 14:43:31,538 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:31,538 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:31,538 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:31,539 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2152
2025-11-18 14:43:31,539 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:31,540 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 18.5ms
2025-11-18 14:43:31,544 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:31,545 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:31,545 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:31,545 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:31,545 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:31,546 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:31,546 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:31,546 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:31,546 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:31,548 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:31,548 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:31,550 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:31,551 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:31,551 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.9ms
2025-11-18 14:43:31,564 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:31,564 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:31,565 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:31,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:31,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:31,565 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:31,565 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:31,566 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:31,566 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:31,570 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:31,570 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:31,571 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:31,572 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.8ms
2025-11-18 14:43:31,574 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:31,574 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:31,574 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:31,574 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:31,574 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:31,574 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:31,575 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:31,575 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:31,575 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:31,579 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:31,580 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:31,581 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:31,582 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.3ms
2025-11-18 14:43:31,995 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:31,996 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:31,996 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:31,996 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:31,996 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:31,996 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:31,996 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:31,997 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:31,997 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:31,999 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:32,001 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:32,004 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:32,004 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2153, Rotación: True
2025-11-18 14:43:32,006 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:32,006 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:32,007 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:32,007 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2153
2025-11-18 14:43:32,007 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:32,008 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.7ms
2025-11-18 14:43:32,013 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:32,013 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:32,014 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:32,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:32,014 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:32,014 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:32,015 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:32,015 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:32,015 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:32,017 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:32,018 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:32,021 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:32,021 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:32,021 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.6ms
2025-11-18 14:43:32,039 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:32,040 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:32,040 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:32,040 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:32,040 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:32,041 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:32,041 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:32,041 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:32,041 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:32,045 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:32,045 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:32,046 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:32,046 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.2ms
2025-11-18 14:43:32,049 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:32,049 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:32,050 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:32,050 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:32,050 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:32,050 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:32,051 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:32,051 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:32,051 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:32,055 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:32,055 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:32,056 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:32,056 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-18 14:43:32,400 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:32,400 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:32,401 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:32,401 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:32,401 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:32,401 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:32,401 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:32,402 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:32,402 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:32,404 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:32,406 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:32,407 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2153
2025-11-18 14:43:32,408 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2153
2025-11-18 14:43:32,408 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:32,409 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.8ms
2025-11-18 14:43:32,415 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:32,415 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:32,416 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:32,416 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:32,416 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:32,416 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:32,417 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:32,417 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:32,417 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:32,419 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:32,419 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:32,422 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:32,422 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:32,423 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.2ms
2025-11-18 14:43:32,437 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:32,437 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:32,438 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:32,438 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:32,438 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:32,438 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:32,438 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:32,439 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:32,439 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:32,442 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:32,443 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:32,444 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:32,444 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.2ms
2025-11-18 14:43:32,446 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:32,447 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:32,447 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:32,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:32,448 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:32,448 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:32,448 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:32,448 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:32,449 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:32,452 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:32,452 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:32,453 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:32,454 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.2ms
2025-11-18 14:43:32,787 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:32,787 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:32,787 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:32,787 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:32,788 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:32,788 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:32,788 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:32,788 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:32,788 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:32,791 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:32,792 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:32,795 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2153
2025-11-18 14:43:32,795 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2153
2025-11-18 14:43:32,795 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:32,796 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.4ms
2025-11-18 14:43:32,803 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:32,804 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:32,804 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:32,804 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:32,804 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:32,805 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:32,805 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:32,805 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:32,805 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:32,807 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:32,807 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:32,809 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:32,810 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:32,810 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.4ms
2025-11-18 14:43:32,826 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:32,826 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:32,826 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:32,826 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:32,826 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:32,827 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:32,827 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:32,827 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:32,827 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:32,832 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:32,832 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:32,833 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:32,834 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.5ms
2025-11-18 14:43:32,836 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:32,836 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:32,836 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:32,837 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:32,837 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:32,837 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:32,837 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:32,837 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:32,837 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:32,841 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:32,841 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:32,842 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:32,842 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.3ms
2025-11-18 14:43:33,144 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:33,145 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:33,145 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:33,145 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:33,146 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:33,146 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:33,146 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:33,146 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:33,146 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:33,149 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:33,152 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:33,158 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:33,159 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2154, Rotación: True
2025-11-18 14:43:33,163 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:33,164 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:33,164 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:33,164 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2154
2025-11-18 14:43:33,164 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:33,165 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 20.6ms
2025-11-18 14:43:33,170 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:33,171 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:33,171 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:33,171 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:33,171 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:33,172 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:33,172 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:33,172 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:33,172 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:33,174 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:33,174 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:33,176 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:33,176 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:33,177 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.8ms
2025-11-18 14:43:33,190 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:33,191 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:33,191 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:33,191 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:33,191 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:33,191 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:33,192 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:33,192 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:33,192 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:33,197 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:33,197 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:33,199 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:33,199 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.1ms
2025-11-18 14:43:33,202 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:33,202 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:33,202 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:33,202 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:33,202 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:33,203 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:33,203 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:33,203 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:33,203 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:33,206 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:33,207 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:33,207 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:33,208 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.4ms
2025-11-18 14:43:33,670 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:33,671 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:33,671 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:33,671 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:33,671 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:33,672 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:33,672 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:33,672 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:33,672 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:33,675 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:33,676 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:33,677 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2154
2025-11-18 14:43:33,677 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2154
2025-11-18 14:43:33,677 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:33,678 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.0ms
2025-11-18 14:43:33,685 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:33,685 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:33,686 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:33,686 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:33,686 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:33,686 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:33,686 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:33,687 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:33,687 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:33,689 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:33,689 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:33,692 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:33,692 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:33,693 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.4ms
2025-11-18 14:43:33,707 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:33,708 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:33,708 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:33,708 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:33,708 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:33,708 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:33,709 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:33,709 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:33,709 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:33,713 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:33,713 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:33,714 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:33,715 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.1ms
2025-11-18 14:43:33,717 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:33,718 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:33,718 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:33,718 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:33,718 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:33,719 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:33,719 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:33,719 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:33,719 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:33,722 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:33,723 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:33,723 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:33,724 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.4ms
2025-11-18 14:43:34,166 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:34,167 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:34,167 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:34,167 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:34,167 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:34,168 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:34,168 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:34,168 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:34,168 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:34,171 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:34,172 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:34,175 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:34,176 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2155, Rotación: True
2025-11-18 14:43:34,178 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:34,178 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:34,179 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:34,179 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2155
2025-11-18 14:43:34,179 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:34,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.7ms
2025-11-18 14:43:34,187 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:34,187 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:34,188 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:34,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:34,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:34,188 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:34,188 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:34,189 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:34,189 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:34,191 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:34,191 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:34,195 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:34,196 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:34,196 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.4ms
2025-11-18 14:43:34,210 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:34,210 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:34,210 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:34,211 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:34,212 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:34,212 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:34,213 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:34,213 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:34,213 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:34,219 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:34,219 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:34,220 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:34,221 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.5ms
2025-11-18 14:43:34,223 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:34,224 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:34,224 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:34,224 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:34,224 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:34,224 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:34,224 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:34,225 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:34,225 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:34,229 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:34,230 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:34,231 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:34,232 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.7ms
2025-11-18 14:43:34,633 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:34,633 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:34,634 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:34,634 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:34,634 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:34,634 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:34,634 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:34,634 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:34,635 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:34,637 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:34,639 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:34,640 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2155
2025-11-18 14:43:34,641 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2155
2025-11-18 14:43:34,641 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:34,642 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.8ms
2025-11-18 14:43:34,647 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:34,647 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:34,648 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:34,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:34,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:34,649 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:34,649 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:34,649 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:34,649 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:34,651 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:34,652 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:34,655 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:34,655 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:34,656 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.2ms
2025-11-18 14:43:34,672 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:34,673 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:34,673 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:34,673 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:34,673 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:34,674 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:34,674 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:34,674 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:34,674 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:34,678 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:34,678 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:34,679 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:34,679 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.9ms
2025-11-18 14:43:34,681 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:34,682 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:34,682 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:34,682 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:34,682 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:34,683 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:34,683 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:34,683 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:34,684 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:34,687 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:34,687 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:34,688 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:34,689 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 14:43:35,096 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:35,097 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:35,097 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:35,097 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:35,097 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:35,097 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:35,098 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:35,098 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:35,098 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:35,100 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:35,101 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:35,104 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:35,104 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2156, Rotación: True
2025-11-18 14:43:35,105 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:35,106 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:35,106 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:35,106 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2156
2025-11-18 14:43:35,107 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:35,107 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.2ms
2025-11-18 14:43:35,112 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:35,112 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:35,113 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:35,113 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:35,113 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:35,113 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:35,113 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:35,114 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:35,114 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:35,116 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:35,116 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:35,119 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:35,119 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:35,120 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.3ms
2025-11-18 14:43:35,135 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:35,135 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:35,135 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:35,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:35,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:35,136 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:35,136 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:35,136 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:35,137 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:35,141 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:35,141 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:35,142 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:35,142 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.6ms
2025-11-18 14:43:35,144 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:35,144 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:35,144 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:35,145 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:35,145 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:35,145 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:35,145 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:35,145 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:35,145 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:35,150 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:35,151 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:35,152 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:35,152 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.5ms
2025-11-18 14:43:35,529 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:35,529 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:35,530 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:35,530 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:35,530 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:35,530 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:35,530 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:35,530 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:35,531 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:35,533 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:35,534 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:35,536 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2156
2025-11-18 14:43:35,536 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2156
2025-11-18 14:43:35,537 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:35,537 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.5ms
2025-11-18 14:43:35,542 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:35,542 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:35,543 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:35,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:35,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:35,543 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:35,543 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:35,544 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:35,544 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:35,546 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:35,546 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:35,548 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:35,548 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:35,549 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.7ms
2025-11-18 14:43:35,570 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:35,570 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:35,571 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:35,571 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:35,571 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:35,571 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:35,571 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:35,571 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:35,572 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:35,575 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:35,575 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:35,576 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:35,577 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.8ms
2025-11-18 14:43:35,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:35,579 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:35,579 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:35,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:35,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:35,580 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:35,580 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:35,580 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:35,580 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:35,585 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:35,585 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:35,587 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:35,588 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.6ms
2025-11-18 14:43:35,964 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:35,965 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:35,965 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:35,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:35,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:35,965 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:35,966 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:35,966 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:35,966 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:35,969 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:35,970 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:35,972 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2156
2025-11-18 14:43:35,972 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2156
2025-11-18 14:43:35,972 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:35,973 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.6ms
2025-11-18 14:43:35,977 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:35,978 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:35,978 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:35,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:35,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:35,978 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:35,979 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:35,979 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:35,979 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:35,981 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:35,981 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:35,985 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:35,985 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:35,986 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.8ms
2025-11-18 14:43:36,009 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:36,009 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:36,009 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:36,010 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:36,010 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:36,010 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:36,010 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:36,010 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:36,011 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:36,013 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:36,014 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:36,014 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:36,015 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.0ms
2025-11-18 14:43:36,017 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:36,018 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:36,018 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:36,018 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:36,018 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:36,018 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:36,019 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:36,019 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:36,019 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:36,023 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:36,023 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:36,024 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:36,025 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.5ms
2025-11-18 14:43:36,376 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:36,376 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:36,377 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:36,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:36,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:36,377 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:36,377 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:36,378 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:36,378 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:36,380 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:36,381 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:36,385 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:36,386 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2157, Rotación: True
2025-11-18 14:43:36,389 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:36,390 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:36,390 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:36,391 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2157
2025-11-18 14:43:36,391 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:36,392 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.7ms
2025-11-18 14:43:36,397 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:36,398 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:36,398 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:36,398 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:36,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:36,399 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:36,399 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:36,399 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:36,399 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:36,402 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:36,402 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:36,404 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:36,404 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:36,405 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.7ms
2025-11-18 14:43:36,416 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:36,416 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:36,417 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:36,417 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:36,417 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:36,417 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:36,417 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:36,418 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:36,418 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:36,422 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:36,423 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:36,424 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:36,424 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.1ms
2025-11-18 14:43:36,426 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:36,426 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:36,427 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:36,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:36,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:36,427 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:36,427 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:36,428 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:36,428 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:36,432 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:36,432 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:36,433 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:36,434 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.1ms
2025-11-18 14:43:36,737 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:36,737 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:36,737 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:36,738 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:36,738 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:36,738 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:36,738 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:36,738 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:36,739 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:36,743 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:36,748 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:36,750 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2157
2025-11-18 14:43:36,751 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2157
2025-11-18 14:43:36,751 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:36,752 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.3ms
2025-11-18 14:43:36,758 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:36,758 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:36,759 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:36,759 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:36,759 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:36,760 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:36,760 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:36,760 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:36,760 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:36,762 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:36,763 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:36,765 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:36,765 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:36,766 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.6ms
2025-11-18 14:43:36,779 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:36,780 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:36,780 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:36,780 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:36,781 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:36,781 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:36,781 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:36,781 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:36,781 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:36,786 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:36,786 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:36,788 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:36,788 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.8ms
2025-11-18 14:43:36,791 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:36,791 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:36,791 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:36,791 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:36,792 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:36,792 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:36,792 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:36,792 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:36,792 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:36,797 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:36,798 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:36,799 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:36,799 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.5ms
2025-11-18 14:43:37,089 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:37,089 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:37,090 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:37,090 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:37,090 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:37,090 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:37,090 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:37,091 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:37,091 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:37,094 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:37,096 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:37,099 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:37,101 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2158, Rotación: True
2025-11-18 14:43:37,103 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:37,104 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:37,104 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:37,104 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2158
2025-11-18 14:43:37,104 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:37,105 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.9ms
2025-11-18 14:43:37,119 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:37,120 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:37,120 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:37,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:37,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:37,121 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:37,121 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:37,121 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:37,121 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:37,122 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:37,123 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:37,125 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:37,125 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:37,125 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 5.9ms
2025-11-18 14:43:37,139 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:37,140 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:37,140 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:37,140 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:37,140 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:37,141 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:37,141 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:37,141 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:37,141 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:37,145 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:37,145 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:37,146 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:37,146 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.1ms
2025-11-18 14:43:37,148 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:37,148 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:37,148 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:37,149 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:37,149 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:37,149 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:37,149 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:37,149 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:37,150 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:37,154 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:37,155 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:37,156 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:37,156 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 14:43:37,463 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:37,463 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:37,463 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:37,464 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:37,464 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:37,464 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:37,464 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:37,464 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:37,464 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:37,466 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:37,468 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:37,469 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2158
2025-11-18 14:43:37,469 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2158
2025-11-18 14:43:37,470 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:37,470 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 7.8ms
2025-11-18 14:43:37,475 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:37,476 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:37,476 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:37,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:37,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:37,477 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:37,477 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:37,477 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:37,477 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:37,479 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:37,479 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:37,482 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:37,482 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:37,482 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.0ms
2025-11-18 14:43:37,497 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:37,497 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:37,498 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:37,498 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:37,498 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:37,498 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:37,498 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:37,499 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:37,499 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:37,504 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:37,504 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:37,505 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:37,506 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.5ms
2025-11-18 14:43:37,507 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:37,508 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:37,508 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:37,508 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:37,508 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:37,508 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:37,508 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:37,509 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:37,509 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:37,513 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:37,513 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:37,514 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:37,514 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.8ms
2025-11-18 14:43:37,842 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:37,843 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:37,843 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:37,843 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:37,844 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:37,844 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:37,844 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:37,844 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:37,844 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:37,847 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:37,848 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:37,856 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2158
2025-11-18 14:43:37,856 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2158
2025-11-18 14:43:37,857 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:37,857 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.7ms
2025-11-18 14:43:37,863 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:37,864 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:37,864 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:37,864 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:37,864 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:37,864 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:37,865 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:37,865 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:37,865 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:37,867 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:37,867 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:37,869 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:37,870 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:37,871 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.5ms
2025-11-18 14:43:37,883 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:37,884 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:37,885 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:37,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:37,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:37,886 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:37,886 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:37,886 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:37,886 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:37,891 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:37,891 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:37,893 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:37,894 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.4ms
2025-11-18 14:43:37,896 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:37,897 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:37,897 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:37,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:37,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:37,897 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:37,898 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:37,898 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:37,898 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:37,903 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:37,903 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:37,904 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:37,905 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.7ms
2025-11-18 14:43:38,204 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:38,205 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:38,205 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:38,205 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:38,206 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:38,206 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:38,206 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:38,206 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:38,206 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:38,209 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:38,210 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:38,213 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:38,213 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2159, Rotación: True
2025-11-18 14:43:38,215 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:38,215 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:38,216 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:38,216 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2159
2025-11-18 14:43:38,216 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:38,217 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.1ms
2025-11-18 14:43:38,224 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:38,224 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:38,225 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:38,225 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:38,225 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:38,225 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:38,225 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:38,225 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:38,226 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:38,227 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:38,228 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:38,231 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:38,231 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:38,231 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.7ms
2025-11-18 14:43:38,247 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:38,248 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:38,248 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:38,248 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:38,248 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:38,248 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:38,249 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:38,249 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:38,249 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:38,254 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:38,254 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:38,255 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:38,256 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.0ms
2025-11-18 14:43:38,258 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:38,258 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:38,258 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:38,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:38,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:38,259 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:38,259 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:38,259 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:38,260 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:38,264 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:38,264 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:38,265 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:38,266 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 14:43:38,630 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:38,631 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:38,631 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:38,631 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:38,632 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:38,632 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:38,632 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:38,632 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:38,632 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:38,635 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:38,636 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:38,639 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2159
2025-11-18 14:43:38,639 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2159
2025-11-18 14:43:38,639 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:38,640 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.7ms
2025-11-18 14:43:38,646 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:38,647 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:38,647 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:38,647 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:38,647 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:38,648 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:38,648 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:38,648 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:38,648 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:38,650 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:38,650 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:38,654 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:38,654 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:38,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.4ms
2025-11-18 14:43:38,669 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:38,669 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:38,669 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:38,670 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:38,670 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:38,670 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:38,671 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:38,671 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:38,671 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:38,675 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:38,675 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:38,677 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:38,677 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.7ms
2025-11-18 14:43:38,679 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:38,679 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:38,679 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:38,680 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:38,680 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:38,680 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:38,680 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:38,680 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:38,680 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:38,684 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:38,684 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:38,686 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:38,687 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.6ms
2025-11-18 14:43:38,999 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:39,000 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,000 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,000 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,000 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,001 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,001 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,001 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,001 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:39,004 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:39,005 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:39,014 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:39,014 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2160, Rotación: True
2025-11-18 14:43:39,015 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:39,016 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:39,016 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:39,016 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2160
2025-11-18 14:43:39,017 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:39,017 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 17.8ms
2025-11-18 14:43:39,024 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:39,025 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,025 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,026 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,026 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,026 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,026 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,026 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,026 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:39,029 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:39,029 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:39,031 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:39,031 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:39,032 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.4ms
2025-11-18 14:43:39,045 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:39,045 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,045 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,045 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,045 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,046 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,046 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,046 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,046 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:39,050 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:39,050 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:39,051 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:39,051 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.8ms
2025-11-18 14:43:39,054 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:39,054 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,054 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,055 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,055 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,055 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,055 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,055 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,056 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:39,060 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:39,060 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:39,062 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:39,062 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.8ms
2025-11-18 14:43:39,343 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:39,343 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,343 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,343 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,344 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,344 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,344 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,344 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,344 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:39,347 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:39,348 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:39,349 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2160
2025-11-18 14:43:39,349 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2160
2025-11-18 14:43:39,349 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:39,350 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 7.5ms
2025-11-18 14:43:39,360 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:39,360 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,360 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,361 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,361 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,361 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,361 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,362 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,362 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:39,364 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:39,364 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:39,366 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:39,366 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:39,367 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.3ms
2025-11-18 14:43:39,381 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:39,382 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,382 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,382 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,382 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,382 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,382 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,383 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,383 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:39,387 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:39,387 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:39,389 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:39,389 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.1ms
2025-11-18 14:43:39,392 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:39,392 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,392 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,392 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,392 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,393 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,393 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,393 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,393 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:39,397 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:39,398 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:39,399 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:39,399 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.6ms
2025-11-18 14:43:39,599 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:39,599 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,600 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,600 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,600 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,601 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,601 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:39,604 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:39,606 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:39,607 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2160
2025-11-18 14:43:39,607 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2160
2025-11-18 14:43:39,608 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:39,608 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.4ms
2025-11-18 14:43:39,622 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:39,623 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,623 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,624 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,624 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,624 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,624 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,624 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,625 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:39,626 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:39,627 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:39,629 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:39,630 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:39,630 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.9ms
2025-11-18 14:43:39,643 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:39,644 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,644 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,644 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,644 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,644 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,645 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,645 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,645 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:39,648 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:39,648 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:39,649 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:39,650 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.4ms
2025-11-18 14:43:39,651 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:39,652 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,652 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,652 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,653 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,653 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,653 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,653 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:39,658 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:39,658 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:39,660 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:39,660 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.9ms
2025-11-18 14:43:39,927 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:39,928 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,928 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,928 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,928 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,929 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,929 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,929 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,929 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:39,932 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:39,933 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:39,934 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2160
2025-11-18 14:43:39,935 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2160
2025-11-18 14:43:39,935 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:39,936 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.4ms
2025-11-18 14:43:39,943 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:39,944 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,944 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,944 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,944 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,945 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,945 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,945 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,945 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:39,947 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:39,947 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:39,950 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:39,951 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:39,951 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.2ms
2025-11-18 14:43:39,967 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:39,968 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,968 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,968 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,969 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,969 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,969 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,969 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,969 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:39,974 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:39,975 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:39,976 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:39,977 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.4ms
2025-11-18 14:43:39,979 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:39,980 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:39,980 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:39,980 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:39,980 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:39,981 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:39,981 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:39,981 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:39,981 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:39,986 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:39,986 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:39,988 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:39,989 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.9ms
2025-11-18 14:43:40,192 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:40,193 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:40,193 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:40,193 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:40,193 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:40,194 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:40,194 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:40,194 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:40,194 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:40,197 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:40,199 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:40,202 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:40,203 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2161, Rotación: True
2025-11-18 14:43:40,205 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:40,205 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:40,206 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:40,206 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2161
2025-11-18 14:43:40,206 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:40,207 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.0ms
2025-11-18 14:43:40,212 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:40,212 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:40,213 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:40,213 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:40,213 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:40,213 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:40,214 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:40,214 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:40,214 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:40,216 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:40,216 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:40,219 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:40,219 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:40,220 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.8ms
2025-11-18 14:43:40,235 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:40,236 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:40,236 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:40,236 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:40,236 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:40,237 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:40,237 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:40,237 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:40,237 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:40,242 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:40,242 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:40,243 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:40,244 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.1ms
2025-11-18 14:43:40,246 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:40,246 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:40,246 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:40,247 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:40,247 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:40,247 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:40,247 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:40,247 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:40,247 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:40,251 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:40,251 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:40,253 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:40,253 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.2ms
2025-11-18 14:43:40,482 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:40,482 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:40,482 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:40,482 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:40,483 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:40,483 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:40,483 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:40,483 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:40,483 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:40,486 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:40,487 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:40,489 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2161
2025-11-18 14:43:40,489 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2161
2025-11-18 14:43:40,490 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:40,490 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.8ms
2025-11-18 14:43:40,497 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:40,498 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:40,498 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:40,498 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:40,498 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:40,499 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:40,499 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:40,499 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:40,499 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:40,501 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:40,501 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:40,504 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:40,504 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:40,505 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.9ms
2025-11-18 14:43:40,519 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:40,519 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:40,519 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:40,520 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:40,520 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:40,520 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:40,521 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:40,521 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:40,521 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:40,526 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:40,526 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:40,527 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:40,528 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.4ms
2025-11-18 14:43:40,531 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:40,531 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:40,531 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:40,531 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:40,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:40,532 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:40,532 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:40,532 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:40,532 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:40,536 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:40,537 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:40,538 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:40,539 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.6ms
2025-11-18 14:43:40,740 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:40,741 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:40,741 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:40,741 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:40,741 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:40,742 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:40,742 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:40,742 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:40,742 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:40,744 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:40,745 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:40,747 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2161
2025-11-18 14:43:40,747 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2161
2025-11-18 14:43:40,747 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:40,748 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 7.7ms
2025-11-18 14:43:40,753 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:40,754 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:40,754 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:40,754 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:40,754 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:40,755 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:40,755 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:40,755 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:40,755 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:40,757 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:40,757 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:40,760 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:40,760 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:40,761 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.0ms
2025-11-18 14:43:40,774 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:40,774 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:40,774 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:40,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:40,775 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:40,775 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:40,775 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:40,775 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:40,775 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:40,778 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:40,779 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:40,779 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:40,780 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.4ms
2025-11-18 14:43:40,782 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:40,782 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:40,782 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:40,782 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:40,783 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:40,783 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:40,783 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:40,783 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:40,783 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:40,787 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:40,787 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:40,789 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:40,790 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.2ms
2025-11-18 14:43:41,019 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:41,019 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,019 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,020 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,020 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,020 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,020 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,021 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,021 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:41,024 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:41,025 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:41,028 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:41,029 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2162, Rotación: True
2025-11-18 14:43:41,031 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:41,032 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:41,032 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:41,033 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2162
2025-11-18 14:43:41,033 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:41,033 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.5ms
2025-11-18 14:43:41,040 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:41,040 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,040 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,040 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,041 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,041 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,041 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,041 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,042 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:41,043 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:41,044 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:41,046 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:41,046 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:41,047 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.2ms
2025-11-18 14:43:41,064 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:41,064 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,065 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,065 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,065 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,065 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,065 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,065 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,066 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:41,069 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:41,069 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:41,070 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:41,071 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.8ms
2025-11-18 14:43:41,073 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:41,074 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,074 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,074 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,074 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,075 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,075 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,075 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,075 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:41,079 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:41,079 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:41,080 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:41,080 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.2ms
2025-11-18 14:43:41,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:41,281 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,281 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,281 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,281 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,281 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,281 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,282 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,282 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:41,284 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:41,285 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:41,286 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2162
2025-11-18 14:43:41,286 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2162
2025-11-18 14:43:41,287 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:41,287 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 7.5ms
2025-11-18 14:43:41,303 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:41,304 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,305 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,305 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,306 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,306 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,307 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,307 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,308 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:41,311 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:41,311 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:41,315 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:41,315 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:41,316 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 13.3ms
2025-11-18 14:43:41,333 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:41,334 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,334 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,334 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,335 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,335 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,335 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:41,343 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:41,343 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:41,344 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:41,344 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.3ms
2025-11-18 14:43:41,346 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:41,346 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,346 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,347 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,347 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,347 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,347 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,347 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,347 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:41,351 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:41,351 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:41,353 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:41,353 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 14:43:41,549 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:41,549 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,549 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,550 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,550 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,550 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,551 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:41,554 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:41,555 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:41,557 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2162
2025-11-18 14:43:41,558 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2162
2025-11-18 14:43:41,558 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:41,559 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.9ms
2025-11-18 14:43:41,567 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:41,567 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,567 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,568 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,568 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,568 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,568 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:41,570 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:41,570 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:41,574 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:41,574 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:41,575 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.1ms
2025-11-18 14:43:41,588 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:41,589 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,589 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,590 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,590 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,590 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,590 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:41,595 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:41,595 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:41,597 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:41,597 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.0ms
2025-11-18 14:43:41,599 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:41,599 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,600 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,600 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,600 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,600 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,600 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:41,604 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:41,604 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:41,606 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:41,606 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-18 14:43:41,817 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:41,817 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,817 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,818 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,818 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,818 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,818 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,818 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,818 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:41,821 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:41,822 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:41,824 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2162
2025-11-18 14:43:41,824 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2162
2025-11-18 14:43:41,825 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:41,825 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.7ms
2025-11-18 14:43:41,833 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:41,833 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,834 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,834 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,834 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,834 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,834 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,834 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,835 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:41,836 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:41,836 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:41,839 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:41,839 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:41,841 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.7ms
2025-11-18 14:43:41,853 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:41,853 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,853 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,854 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,854 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,854 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,854 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,854 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:41,859 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:41,859 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:41,861 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:41,861 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.7ms
2025-11-18 14:43:41,864 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:41,864 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:41,864 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:41,864 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:41,865 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:41,865 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:41,865 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:41,865 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:41,865 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:41,869 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:41,869 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:41,870 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:41,871 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.2ms
2025-11-18 14:43:42,113 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:42,113 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,114 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,114 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,114 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,114 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,114 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,114 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,115 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:42,117 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:42,119 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:42,122 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:42,122 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2163, Rotación: True
2025-11-18 14:43:42,124 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:42,124 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:42,125 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:42,125 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2163
2025-11-18 14:43:42,125 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:42,126 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.4ms
2025-11-18 14:43:42,133 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:42,133 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,134 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,134 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,134 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,135 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,135 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:42,136 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:42,136 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:42,139 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:42,139 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:42,140 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.0ms
2025-11-18 14:43:42,153 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:42,154 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,154 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,154 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,154 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,154 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,155 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,155 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,155 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:42,161 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:42,161 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:42,163 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:42,164 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.5ms
2025-11-18 14:43:42,165 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:42,166 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,166 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,166 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,166 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,167 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,167 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,167 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,167 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:42,171 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:42,171 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:42,172 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:42,173 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.5ms
2025-11-18 14:43:42,349 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:42,349 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,349 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,350 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,350 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,350 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,350 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,350 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,350 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:42,353 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:42,353 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:42,361 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2163
2025-11-18 14:43:42,362 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2163
2025-11-18 14:43:42,363 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:42,364 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.8ms
2025-11-18 14:43:42,369 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:42,370 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,370 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,370 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,371 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,371 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,371 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:42,373 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:42,373 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:42,376 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:42,377 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:42,377 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.9ms
2025-11-18 14:43:42,388 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:42,389 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,390 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,391 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,391 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,391 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,391 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:42,396 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:42,396 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:42,397 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:42,398 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.4ms
2025-11-18 14:43:42,400 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:42,400 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,400 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,400 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,400 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,401 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,401 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,401 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,401 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:42,405 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:42,405 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:42,406 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:42,407 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.6ms
2025-11-18 14:43:42,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:42,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,579 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,579 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,579 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,580 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,580 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:42,582 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:42,583 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:42,585 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2163
2025-11-18 14:43:42,585 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2163
2025-11-18 14:43:42,586 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:42,586 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.5ms
2025-11-18 14:43:42,593 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:42,594 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,594 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,594 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,595 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,595 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,595 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,595 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,596 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:42,598 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:42,598 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:42,600 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:42,600 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:42,601 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.6ms
2025-11-18 14:43:42,615 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:42,616 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,616 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,616 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,616 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,616 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,617 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,617 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,617 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:42,621 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:42,621 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:42,622 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:42,623 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.2ms
2025-11-18 14:43:42,625 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:42,626 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,626 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,626 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,626 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,627 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,627 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,627 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,627 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:42,632 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:42,632 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:42,633 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:42,633 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.1ms
2025-11-18 14:43:42,856 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:42,857 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,857 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,857 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,857 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,858 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,858 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,858 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,858 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:42,861 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:42,863 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:42,865 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2163
2025-11-18 14:43:42,865 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2163
2025-11-18 14:43:42,865 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:42,866 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.9ms
2025-11-18 14:43:42,872 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:42,872 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,873 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,873 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,874 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,874 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,874 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:42,876 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:42,876 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:42,879 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:42,879 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:42,880 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.3ms
2025-11-18 14:43:42,894 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:42,896 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,896 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,897 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,897 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,898 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,898 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:42,904 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:42,904 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:42,905 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:42,906 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.5ms
2025-11-18 14:43:42,908 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:42,909 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:42,909 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:42,909 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:42,909 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:42,910 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:42,910 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:42,910 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:42,910 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:42,914 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:42,915 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:42,916 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:42,916 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.8ms
2025-11-18 14:43:43,105 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:43,105 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,106 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,106 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,106 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,106 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,106 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,107 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,107 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:43,110 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:43,111 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:43,113 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:43,114 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2164, Rotación: True
2025-11-18 14:43:43,116 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:43,116 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:43,116 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:43,117 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2164
2025-11-18 14:43:43,117 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:43,117 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.5ms
2025-11-18 14:43:43,122 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:43,124 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,124 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,124 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,125 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,125 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,125 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,125 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,125 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:43,127 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:43,127 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:43,131 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:43,131 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:43,132 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.7ms
2025-11-18 14:43:43,146 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:43,146 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,146 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,146 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,147 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,147 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,147 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,147 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,147 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:43,151 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:43,151 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:43,152 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:43,152 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.5ms
2025-11-18 14:43:43,154 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:43,154 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,155 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,155 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,155 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,155 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,155 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,156 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,156 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:43,161 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:43,161 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:43,162 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:43,163 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.9ms
2025-11-18 14:43:43,373 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:43,374 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,374 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,374 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,375 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,375 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,375 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,375 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,375 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:43,379 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:43,380 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:43,381 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2164
2025-11-18 14:43:43,382 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2164
2025-11-18 14:43:43,382 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:43,383 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.1ms
2025-11-18 14:43:43,389 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:43,390 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,390 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,391 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,391 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,391 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,391 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,391 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:43,394 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:43,394 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:43,397 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:43,397 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:43,398 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.4ms
2025-11-18 14:43:43,411 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:43,411 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,411 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,411 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,412 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,412 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,412 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,412 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:43,416 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:43,417 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:43,418 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:43,418 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 14:43:43,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:43,420 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,420 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,421 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,421 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,421 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,421 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,421 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,421 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:43,427 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:43,427 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:43,428 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:43,429 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.7ms
2025-11-18 14:43:43,622 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:43,623 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,623 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,623 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,623 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,624 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,624 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,624 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,624 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:43,627 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:43,629 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:43,631 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2164
2025-11-18 14:43:43,632 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2164
2025-11-18 14:43:43,632 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:43,633 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.7ms
2025-11-18 14:43:43,638 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:43,638 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,638 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,639 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,639 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,639 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,639 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,640 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,640 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:43,642 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:43,642 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:43,645 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:43,645 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:43,646 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.5ms
2025-11-18 14:43:43,659 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:43,660 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,660 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,661 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,661 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,661 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,661 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,661 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,661 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:43,666 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:43,667 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:43,668 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:43,668 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.2ms
2025-11-18 14:43:43,670 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:43,671 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,671 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,671 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,671 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,671 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,671 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,672 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,672 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:43,677 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:43,677 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:43,678 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:43,679 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.5ms
2025-11-18 14:43:43,898 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:43,898 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,898 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,899 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,899 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,899 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,899 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,899 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:43,902 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:43,903 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:43,904 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2164
2025-11-18 14:43:43,904 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2164
2025-11-18 14:43:43,904 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:43,905 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 7.4ms
2025-11-18 14:43:43,912 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:43,912 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,913 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,913 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,913 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,914 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,914 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:43,916 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:43,916 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:43,919 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:43,919 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:43,919 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.5ms
2025-11-18 14:43:43,933 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:43,933 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,933 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,934 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,934 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,934 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,934 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:43,938 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:43,938 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:43,939 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:43,940 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.8ms
2025-11-18 14:43:43,942 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:43,942 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:43,943 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:43,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:43,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:43,943 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:43,943 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:43,944 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:43,944 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:43,948 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:43,948 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:43,949 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:43,949 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.2ms
2025-11-18 14:43:44,108 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:44,108 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,108 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,109 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,109 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,109 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,109 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:44,112 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:44,112 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:44,114 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:44,115 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2165, Rotación: True
2025-11-18 14:43:44,116 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:44,116 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:44,116 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:44,117 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2165
2025-11-18 14:43:44,117 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:44,117 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.8ms
2025-11-18 14:43:44,128 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:44,129 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,129 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,130 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,130 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,130 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,130 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,131 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:44,133 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:44,133 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:44,136 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:44,136 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:44,137 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.5ms
2025-11-18 14:43:44,152 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:44,153 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,153 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,153 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,153 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,154 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,154 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:44,158 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:44,158 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:44,160 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:44,160 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.3ms
2025-11-18 14:43:44,163 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:44,164 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,164 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,164 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,164 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,165 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,165 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,165 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,165 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:44,169 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:44,169 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:44,171 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:44,171 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 14:43:44,389 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:44,389 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,389 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,390 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,390 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,390 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,391 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:44,394 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:44,395 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:44,400 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2165
2025-11-18 14:43:44,401 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2165
2025-11-18 14:43:44,402 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:44,402 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.7ms
2025-11-18 14:43:44,411 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:44,412 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,412 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,412 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,413 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,413 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,413 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,413 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:44,415 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:44,415 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:44,418 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:44,418 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:44,419 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.9ms
2025-11-18 14:43:44,432 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:44,432 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,432 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,432 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,432 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,433 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,433 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,433 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,433 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:44,437 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:44,437 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:44,438 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:44,439 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.0ms
2025-11-18 14:43:44,441 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:44,441 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,441 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,442 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,442 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,442 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,442 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,442 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,443 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:44,447 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:44,447 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:44,448 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:44,449 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 14:43:44,638 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:44,638 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,639 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,639 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,639 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,639 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,639 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,639 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,640 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:44,643 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:44,644 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:44,645 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2165
2025-11-18 14:43:44,646 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2165
2025-11-18 14:43:44,646 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:44,647 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.0ms
2025-11-18 14:43:44,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:44,653 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,653 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,653 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,654 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,654 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,654 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:44,656 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:44,656 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:44,660 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:44,661 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:44,661 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.5ms
2025-11-18 14:43:44,676 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:44,677 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,677 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,677 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,678 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,678 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,678 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,678 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,678 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:44,682 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:44,682 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:44,683 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:44,684 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.6ms
2025-11-18 14:43:44,686 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:44,686 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,686 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,686 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,687 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,687 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,687 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,687 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,687 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:44,692 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:44,693 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:44,694 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:44,695 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.1ms
2025-11-18 14:43:44,897 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:44,898 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,898 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,899 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,899 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,899 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,899 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:44,902 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:44,903 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:44,904 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2165
2025-11-18 14:43:44,905 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2165
2025-11-18 14:43:44,905 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:44,906 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.2ms
2025-11-18 14:43:44,912 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:44,913 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,913 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,914 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,914 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,914 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,914 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:44,916 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:44,917 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:44,920 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:44,920 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:44,921 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.7ms
2025-11-18 14:43:44,937 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:44,937 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,937 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,938 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,938 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,938 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,938 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,938 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,938 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:44,944 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:44,944 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:44,945 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:44,945 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.7ms
2025-11-18 14:43:44,947 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:44,948 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:44,948 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:44,948 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:44,948 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:44,948 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:44,949 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:44,949 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:44,949 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:44,953 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:44,953 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:44,954 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:44,955 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.3ms
2025-11-18 14:43:45,105 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:45,106 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:45,106 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:45,106 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:45,106 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:45,107 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:45,107 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:45,107 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:45,107 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:45,112 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:45,114 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:45,120 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:45,121 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2166, Rotación: True
2025-11-18 14:43:45,122 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:43:45,123 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:43:45,123 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:43:45,124 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2166
2025-11-18 14:43:45,124 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:45,125 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 19.9ms
2025-11-18 14:43:45,134 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:45,134 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:45,134 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:45,135 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:45,135 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:45,135 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:45,135 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:45,135 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:45,135 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:45,137 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:45,137 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:45,139 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:45,140 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:45,140 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.5ms
2025-11-18 14:43:45,153 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:45,154 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:45,154 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:45,154 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:45,154 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:45,154 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:45,155 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:45,155 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:45,155 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:45,159 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:45,160 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:45,161 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:45,162 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.4ms
2025-11-18 14:43:45,164 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:45,164 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:45,165 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:45,165 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:45,165 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:45,165 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:45,166 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:45,166 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:45,166 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:45,170 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:45,170 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:45,171 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:45,172 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.6ms
2025-11-18 14:43:45,316 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:45,317 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:45,317 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:45,317 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:45,317 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:45,318 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:45,318 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:45,318 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:45,318 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:45,321 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:43:45,322 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:43:45,324 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2166
2025-11-18 14:43:45,325 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2166
2025-11-18 14:43:45,326 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:43:45,328 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 11.8ms
2025-11-18 14:43:45,336 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:43:45,337 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:45,337 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:45,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:45,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:45,338 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:45,338 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:45,338 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:45,338 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:43:45,340 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:43:45,340 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:43:45,345 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:43:45,346 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:43:45,347 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.2ms
2025-11-18 14:43:45,366 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:45,366 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:45,366 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:45,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:45,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:45,367 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:45,367 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:45,367 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:45,367 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:45,371 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:45,372 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:45,373 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:45,381 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.1ms
2025-11-18 14:43:45,441 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:45,445 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:45,445 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:43:45,445 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:43:45,445 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:45,446 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:43:45,446 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:43:45,446 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:45,446 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:45,451 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:43:45,451 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:43:45,452 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:43:45,453 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 12.4ms
2025-11-18 14:43:54,534 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 14:43:54,535 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.4ms
2025-11-18 14:43:54,846 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 14:43:54,846 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:54,847 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:43:54,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:43:54,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:54,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:43:54,848 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:43:54,848 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 14:43:54,849 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 4: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 14:43:54,849 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 4, usando Single-DB como fallback
2025-11-18 14:43:54,849 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:54,849 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 14:43:54,852 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-18 14:43:54,852 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-18 14:43:54,852 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-18 14:43:55,078 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 14:43:55,078 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-18 14:43:55,080 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:43:55,081 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2167, Rotación: False
2025-11-18 14:43:55,081 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado en BD - ID: 2167
2025-11-18 14:43:55,081 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-18 14:43:55,082 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 235.5ms
2025-11-18 14:43:55,111 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 14:43:55,111 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.7ms
2025-11-18 14:43:55,113 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 14:43:55,114 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.8ms
2025-11-18 14:43:55,115 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:55,116 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:55,116 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:43:55,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:43:55,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:55,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:43:55,118 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:43:55,118 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:55,119 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:55,119 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 14:43:55,124 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 14:43:55,125 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 14:43:55,126 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 14:43:55,127 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 7.9ms
2025-11-18 14:43:55,127 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 14:43:55,127 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:55,128 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:43:55,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:43:55,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:55,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:43:55,129 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:43:55,129 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:55,130 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 14:43:55,130 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 14:43:55,130 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.4ms
2025-11-18 14:43:55,137 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 14:43:55,139 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 9.0ms
2025-11-18 14:43:55,140 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 12.7ms
2025-11-18 14:43:55,142 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:43:55,143 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:55,143 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:43:55,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:43:55,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:55,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:43:55,145 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:43:55,145 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:55,145 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:43:55,149 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 14:43:55,149 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 14:43:55,151 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 14:43:55,152 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 14:43:55,152 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:55,153 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:43:55,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:43:55,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:55,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:43:55,154 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:43:55,154 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:55,155 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 14:43:55,160 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 14:43:55,161 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.6ms
2025-11-18 14:43:55,162 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 10.0ms
2025-11-18 14:43:56,876 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 14:43:56,876 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-18 14:43:56,878 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:56,878 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:56,879 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:43:56,879 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:43:56,879 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:56,879 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:43:56,880 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:43:56,880 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:56,880 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:56,882 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 14:43:56,882 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.2ms
2025-11-18 14:43:57,941 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:57,942 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:57,942 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:43:57,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:43:57,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:57,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:43:57,944 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:43:57,944 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:57,944 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:57,946 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 14:43:57,946 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.8ms
2025-11-18 14:43:58,172 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:58,173 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:58,173 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:43:58,173 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:43:58,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:58,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:43:58,175 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:43:58,176 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:58,176 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:58,177 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 14:43:58,177 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.0ms
2025-11-18 14:43:58,378 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:58,378 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:58,378 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:43:58,378 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:43:58,379 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:58,379 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:43:58,380 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:43:58,380 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:58,381 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:58,382 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 14:43:58,382 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.0ms
2025-11-18 14:43:58,605 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:43:58,606 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:43:58,606 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host extraído de 'origin': techcorp.midominio.com:5173
2025-11-18 14:43:58,606 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.midominio.com'
2025-11-18 14:43:58,606 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:43:58,607 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 14:43:58,608 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 14:43:58,608 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:43:58,608 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:43:58,610 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 14:43:58,611 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.9ms
2025-11-18 14:44:00,988 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:00,988 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:00,989 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:00,989 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:00,989 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:00,989 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:00,989 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:00,990 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:00,990 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:00,993 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:00,994 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:00,998 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:44:00,998 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2168, Rotación: True
2025-11-18 14:44:01,000 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:44:01,000 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:44:01,001 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:44:01,001 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2168
2025-11-18 14:44:01,001 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:01,002 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.9ms
2025-11-18 14:44:01,011 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:01,011 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,011 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,011 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,012 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,012 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,012 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,012 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,013 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:01,014 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:01,015 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:01,017 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:01,018 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:01,018 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.8ms
2025-11-18 14:44:01,032 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:01,032 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,032 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,032 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,033 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,033 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,033 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,033 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,033 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:01,037 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:01,037 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:01,038 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:01,039 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.1ms
2025-11-18 14:44:01,042 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:01,042 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,042 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,042 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,043 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,043 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,043 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,043 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:01,048 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:01,049 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:01,050 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:01,050 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.9ms
2025-11-18 14:44:01,186 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:01,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,186 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,187 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,187 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,187 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,188 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:01,190 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:01,192 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:01,195 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:44:01,196 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2169, Rotación: True
2025-11-18 14:44:01,197 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:44:01,198 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:44:01,198 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:44:01,198 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2169
2025-11-18 14:44:01,198 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:01,199 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.4ms
2025-11-18 14:44:01,207 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:01,208 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,209 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,209 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,209 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,209 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,210 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,210 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,210 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:01,212 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:01,212 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:01,215 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:01,216 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:01,216 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.3ms
2025-11-18 14:44:01,233 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:01,233 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,233 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,233 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,234 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,234 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,234 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,234 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,234 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:01,238 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:01,238 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:01,240 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:01,242 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.0ms
2025-11-18 14:44:01,244 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:01,244 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,245 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,245 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,245 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,245 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,245 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,246 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,246 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:01,250 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:01,251 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:01,252 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:01,252 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.2ms
2025-11-18 14:44:01,379 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:01,379 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,380 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,380 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,380 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,380 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,380 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,381 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,381 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:01,383 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:01,385 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:01,387 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2169
2025-11-18 14:44:01,387 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2169
2025-11-18 14:44:01,387 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:01,388 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.1ms
2025-11-18 14:44:01,395 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:01,395 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,395 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,395 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,395 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,396 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,396 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,396 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,396 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:01,398 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:01,398 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:01,400 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:01,400 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:01,401 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.5ms
2025-11-18 14:44:01,417 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:01,418 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,418 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,418 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,418 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,418 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,419 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,419 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,419 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:01,422 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:01,423 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:01,424 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:01,425 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.7ms
2025-11-18 14:44:01,427 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:01,428 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,428 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,428 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,428 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,429 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,429 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,429 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,429 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:01,433 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:01,433 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:01,435 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:01,435 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.7ms
2025-11-18 14:44:01,558 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:01,559 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,559 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,559 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,559 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,560 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,560 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,560 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,560 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:01,562 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:01,563 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:01,565 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2169
2025-11-18 14:44:01,565 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2169
2025-11-18 14:44:01,566 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:01,566 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.2ms
2025-11-18 14:44:01,571 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:01,572 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,572 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,572 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,573 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,573 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,573 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,573 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,574 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:01,576 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:01,576 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:01,579 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:01,579 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:01,579 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.1ms
2025-11-18 14:44:01,593 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:01,593 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,594 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,594 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,594 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,594 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,595 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,595 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,595 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:01,598 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:01,599 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:01,600 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:01,600 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.1ms
2025-11-18 14:44:01,602 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:01,602 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:01,602 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:01,603 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:01,603 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:01,603 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:01,603 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:01,603 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:01,603 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:01,609 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:01,609 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:01,611 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:01,612 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.6ms
2025-11-18 14:44:02,110 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:02,110 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:02,110 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:02,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:02,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:02,111 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:02,111 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:02,111 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:02,112 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:02,114 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:02,115 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:02,118 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:44:02,118 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2170, Rotación: True
2025-11-18 14:44:02,120 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:44:02,121 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:44:02,121 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:44:02,121 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2170
2025-11-18 14:44:02,121 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:02,122 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.1ms
2025-11-18 14:44:02,129 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:02,130 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:02,130 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:02,130 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:02,130 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:02,131 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:02,131 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:02,131 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:02,131 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:02,133 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:02,133 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:02,135 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:02,135 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:02,136 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.2ms
2025-11-18 14:44:02,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:02,151 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:02,152 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:02,152 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:02,152 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:02,152 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:02,152 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:02,153 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:02,153 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:02,157 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:02,157 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:02,158 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:02,159 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.0ms
2025-11-18 14:44:02,161 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:02,162 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:02,162 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:02,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:02,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:02,162 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:02,162 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:02,162 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:02,163 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:02,166 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:02,166 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:02,167 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:02,168 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.3ms
2025-11-18 14:44:02,568 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:02,569 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:02,569 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:02,570 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:02,570 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:02,570 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:02,570 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:02,570 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:02,570 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:02,573 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:02,575 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:02,577 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2170
2025-11-18 14:44:02,578 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2170
2025-11-18 14:44:02,578 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:02,579 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.2ms
2025-11-18 14:44:02,584 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:02,585 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:02,585 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:02,586 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:02,586 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:02,586 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:02,586 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:02,586 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:02,587 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:02,588 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:02,588 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:02,591 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:02,591 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:02,592 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.5ms
2025-11-18 14:44:02,603 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:02,603 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:02,603 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:02,604 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:02,604 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:02,604 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:02,604 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:02,604 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:02,604 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:02,610 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:02,610 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:02,611 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:02,612 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.9ms
2025-11-18 14:44:02,614 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:02,614 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:02,614 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:02,614 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:02,614 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:02,615 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:02,615 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:02,615 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:02,615 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:02,618 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:02,619 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:02,620 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:02,620 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.4ms
2025-11-18 14:44:02,985 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:02,986 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:02,986 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:02,986 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:02,987 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:02,987 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:02,987 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:02,987 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:02,987 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:02,990 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:02,994 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:02,996 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2170
2025-11-18 14:44:02,996 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2170
2025-11-18 14:44:02,997 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:02,997 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.1ms
2025-11-18 14:44:03,004 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:03,005 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,005 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,005 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,005 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,006 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,006 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,006 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,006 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:03,009 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:03,009 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:03,012 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:03,012 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:03,013 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.3ms
2025-11-18 14:44:03,024 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:03,025 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,025 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,025 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,025 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,025 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,026 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,026 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,026 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:03,030 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:03,030 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:03,031 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:03,032 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.9ms
2025-11-18 14:44:03,034 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:03,034 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,034 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,034 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,034 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,035 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,035 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,035 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,035 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:03,039 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:03,039 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:03,041 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:03,042 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.2ms
2025-11-18 14:44:03,305 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:03,305 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,306 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,306 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,306 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,306 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,307 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,307 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,307 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:03,310 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:03,312 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:03,314 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 14:44:03,315 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2171, Rotación: True
2025-11-18 14:44:03,316 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 14:44:03,317 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 14:44:03,317 - app.api.v1.endpoints.auth - INFO - [REFRESH] Token antiguo revocado después de rotación exitosa
2025-11-18 14:44:03,317 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2171
2025-11-18 14:44:03,318 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:03,318 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.5ms
2025-11-18 14:44:03,323 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:03,323 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,323 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,324 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,324 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,324 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,325 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,325 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,325 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:03,327 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:03,328 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:03,330 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:03,331 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:03,331 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.2ms
2025-11-18 14:44:03,344 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:03,344 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,345 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,345 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,345 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,345 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,346 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:03,349 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:03,349 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:03,350 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:03,351 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.9ms
2025-11-18 14:44:03,352 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:03,353 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,353 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,353 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,353 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,353 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,354 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,354 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,354 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:03,358 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:03,358 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:03,359 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:03,360 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.7ms
2025-11-18 14:44:03,586 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:03,587 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,587 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,587 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,588 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,588 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,588 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:03,590 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:03,591 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:03,593 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2171
2025-11-18 14:44:03,593 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2171
2025-11-18 14:44:03,594 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:03,595 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.2ms
2025-11-18 14:44:03,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:03,601 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,601 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,601 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,602 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,602 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,602 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:03,604 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:03,604 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:03,607 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:03,607 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:03,608 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.5ms
2025-11-18 14:44:03,620 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:03,621 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,621 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,621 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,621 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,621 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,621 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,622 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,622 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:03,625 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:03,625 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:03,626 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:03,627 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.4ms
2025-11-18 14:44:03,630 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:03,630 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,630 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,630 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,630 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,631 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,631 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,631 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,631 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:03,634 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:03,634 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:03,635 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:03,636 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.3ms
2025-11-18 14:44:03,878 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 14:44:03,878 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,878 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,879 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,879 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,879 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,879 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,879 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,879 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 14:44:03,882 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 14:44:03,883 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 1, Type: user)
2025-11-18 14:44:03,884 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2171
2025-11-18 14:44:03,885 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado - ID: 2171
2025-11-18 14:44:03,885 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado para usuario: superadmin
2025-11-18 14:44:03,886 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 7.9ms
2025-11-18 14:44:03,892 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 14:44:03,892 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,893 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,893 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,894 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,894 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,894 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 14:44:03,896 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 14:44:03,896 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 14:44:03,900 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 14:44:03,900 - app.api.v1.endpoints.auth - INFO - Datos completos del usuario superadmin recuperados (tipo: user, roles: 1)
2025-11-18 14:44:03,901 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.9ms
2025-11-18 14:44:03,914 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:03,915 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer
2025-11-18 14:44:03,915 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer host real de origin/referer, usando: localhost:8000
2025-11-18 14:44:03,915 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'localhost'
2025-11-18 14:44:03,915 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'midominio.com'
2025-11-18 14:44:03,915 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: 'localhost'. Verifica BASE_DOMAIN='midominio.com'
2025-11-18 14:44:03,916 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: localhost:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 14:44:03,916 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 14:44:03,916 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 14:44:03,920 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 14:44:03,920 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 14:44:03,921 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 14:44:03,922 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.1ms
2025-11-18 14:44:03,923 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 14:44:03,924 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host es localhost, buscando host real en origin/referer

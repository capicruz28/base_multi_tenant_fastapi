2025-11-24 18:52:15,534 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 18:52:15,541 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 18:52:15,541 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 18:52:15,542 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 18:52:15,810 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 18:52:15,811 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-24 18:52:15,811 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-24 18:52:15,813 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 18:52:15,826 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 18:52:15,827 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11351, Rotación: False
2025-11-24 18:52:15,827 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11351
2025-11-24 18:52:15,828 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-24 18:52:15,829 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 297.1ms
2025-11-24 18:52:15,859 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 18:52:15,861 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.2ms
2025-11-24 18:52:15,863 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 18:52:15,863 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-24 18:52:15,865 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:52:15,866 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:15,866 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:52:15,866 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:52:15,866 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:15,867 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:52:15,867 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:52:15,867 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:52:15,867 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:52:15,890 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:52:15,890 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:52:15,949 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:52:15,950 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 85.3ms
2025-11-24 18:52:15,952 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:52:15,952 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:15,953 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:52:15,953 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:52:15,953 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:15,953 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:52:15,953 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:52:15,953 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:52:15,954 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:52:15,962 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:52:15,962 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:52:15,964 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:52:15,965 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 12.7ms
2025-11-24 18:52:17,796 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 18:52:17,796 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-24 18:52:17,797 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 18:52:17,798 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.0ms
2025-11-24 18:52:17,800 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:52:17,800 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:17,800 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:52:17,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:52:17,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:17,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:52:17,801 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:52:17,802 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:52:17,802 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:52:17,807 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:52:17,808 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:52:17,816 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:52:17,817 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 17.3ms
2025-11-24 18:52:17,819 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:52:17,820 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:17,820 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:52:17,820 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:52:17,820 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:17,820 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:52:17,821 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:52:17,821 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:52:17,821 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:52:17,826 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:52:17,826 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:52:17,829 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:52:17,830 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.9ms
2025-11-24 18:52:19,002 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-24 18:52:19,002 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.6ms
2025-11-24 18:52:19,004 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-24 18:52:19,004 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.5ms
2025-11-24 18:52:19,005 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-24 18:52:19,006 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:19,006 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:52:19,006 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:52:19,006 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:19,007 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:52:19,007 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:52:19,007 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:52:19,007 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-24 18:52:19,014 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-24 18:52:19,014 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-24 18:52:19,018 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-24 18:52:19,021 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-24 18:52:19,022 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 16.4ms
2025-11-24 18:52:19,024 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-24 18:52:19,024 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:19,025 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:52:19,025 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:52:19,025 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:19,025 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:52:19,025 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:52:19,026 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:52:19,026 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-24 18:52:19,031 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-24 18:52:19,031 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-24 18:52:19,032 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-24 18:52:19,033 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-24 18:52:19,034 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.0ms
2025-11-24 18:52:28,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:52:28,262 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:28,262 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:52:28,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:52:28,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:28,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:52:28,263 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:52:28,263 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:52:28,263 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:52:28,268 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:52:28,268 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:52:28,273 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:52:28,274 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.1ms
2025-11-24 18:52:28,278 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:52:28,279 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:28,279 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:52:28,279 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:52:28,279 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:28,279 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:52:28,280 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:52:28,280 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:52:28,280 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:52:28,285 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:52:28,286 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:52:28,289 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:52:28,290 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 12.2ms
2025-11-24 18:52:43,578 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 18:52:43,579 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-11-24 18:52:43,581 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 18:52:43,581 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:43,581 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:52:43,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:52:43,582 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:43,582 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:52:43,582 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:52:43,582 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:52:43,582 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-24 18:52:43,592 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 18:52:43,593 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 18:52:43,593 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-24 18:52:43,594 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 13.0ms
2025-11-24 18:52:45,152 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 18:52:45,153 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-24 18:52:45,156 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:52:45,156 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:45,156 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 18:52:45,157 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 18:52:45,157 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:45,157 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 18:52:45,161 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 18:52:45,164 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_sistema
2025-11-24 18:52:45,164 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 18:52:45,164 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 18:52:45,166 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-24 18:52:45,167 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 11.0ms
2025-11-24 18:52:49,961 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 18:52:49,961 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:49,961 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:52:49,961 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:52:49,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:49,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:52:49,964 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:52:49,964 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:52:49,965 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 18:52:49,965 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:52:49,973 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] No se proporcionó refresh token - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 18:52:49,974 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 13.0ms
2025-11-24 18:52:52,557 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 18:52:52,558 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-24 18:52:52,560 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:52:52,561 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:52:52,562 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': innova.app.local:5173
2025-11-24 18:52:52,562 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-11-24 18:52:52,562 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:52:52,562 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-24 18:52:52,566 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-24 18:52:52,567 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 3: multi - bd_cliente_innova
2025-11-24 18:52:52,567 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-24 18:52:52,568 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/refresh/
2025-11-24 18:52:52,570 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-24 18:52:52,571 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 10.2ms
2025-11-24 18:53:09,834 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 18:53:09,835 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-24 18:53:09,838 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:53:09,838 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:09,839 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': global.app.local:5173
2025-11-24 18:53:09,839 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-24 18:53:09,839 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:09,839 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-24 18:53:09,844 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', Código='GLOBAL004', ID=5
2025-11-24 18:53:09,847 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 5: single - bd_sistema
2025-11-24 18:53:09,848 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 18:53:09,848 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 18:53:09,849 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-24 18:53:09,850 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 12.5ms
2025-11-24 18:53:16,303 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 18:53:16,303 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.9ms
2025-11-24 18:53:16,306 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:53:16,307 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:16,307 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:16,307 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:16,307 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:16,308 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:16,311 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:16,311 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:16,311 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 18:53:16,314 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-24 18:53:16,315 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 8.3ms
2025-11-24 18:53:27,219 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 18:53:27,220 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-24 18:53:27,222 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 18:53:27,222 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:27,223 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:27,223 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:27,223 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:27,223 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:27,224 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:27,224 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:27,225 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 18:53:27,229 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 18:53:27,230 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 18:53:27,230 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 18:53:27,230 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,464 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,471 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,478 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 18:53:27,478 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 18:53:27,478 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,482 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,483 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 18:53:27,484 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,486 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 18:53:27,487 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 16, Rotación: False
2025-11-24 18:53:27,487 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 16
2025-11-24 18:53:27,487 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 18:53:27,488 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 266.1ms
2025-11-24 18:53:27,507 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 18:53:27,509 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.8ms
2025-11-24 18:53:27,509 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:53:27,511 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:27,512 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:27,512 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:27,512 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:27,512 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:27,514 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:27,514 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:27,515 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:53:27,516 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,517 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,519 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,520 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,521 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,522 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,524 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:53:27,524 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:53:27,524 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:53:27,524 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,527 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:53:27,528 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,533 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:53:27,533 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:27,533 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:27,534 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:27,534 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:53:27,534 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:53:27,535 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 18:53:27,535 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.8ms
2025-11-24 18:53:27,537 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:53:27,537 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 27.9ms
2025-11-24 18:53:27,537 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:27,538 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:27,538 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:27,538 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:27,538 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:27,539 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:27,539 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:27,539 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 18:53:27,541 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,542 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,543 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,544 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,545 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 18:53:27,545 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:53:27,546 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,625 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 18:53:27,625 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 18:53:27,627 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 90.5ms
2025-11-24 18:53:27,627 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:53:27,629 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:27,629 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:27,629 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:27,629 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:27,629 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:27,630 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:27,631 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:27,631 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:53:27,632 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,633 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,634 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,635 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,636 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,637 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,638 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:53:27,638 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:53:27,638 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:53:27,638 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,640 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:53:27,640 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,642 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:53:27,642 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:27,642 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:27,642 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:27,642 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:53:27,643 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:53:27,644 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:53:27,644 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:27,644 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:27,645 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:27,645 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:27,645 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:27,647 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:27,647 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:27,647 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 18:53:27,649 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,650 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,651 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,652 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,653 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 18:53:27,653 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:53:27,653 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:27,655 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 18:53:27,655 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 18:53:27,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 28.1ms
2025-11-24 18:53:27,657 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 13.0ms
2025-11-24 18:53:30,212 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 18:53:30,213 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:30,213 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:30,213 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:30,214 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:30,214 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:30,216 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:30,216 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:30,216 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 18:53:30,217 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,219 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,220 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,221 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,223 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,224 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,226 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 18:53:30,226 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 18:53:30,226 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,229 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,241 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 18:53:30,242 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 18:53:30,243 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 30.1ms
2025-11-24 18:53:30,251 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 18:53:30,253 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:30,253 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:30,254 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:30,254 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:30,255 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:30,256 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:30,257 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:30,257 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 18:53:30,258 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,260 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,261 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,263 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,267 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,270 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,272 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 18:53:30,272 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 18:53:30,272 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,275 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,277 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 18:53:30,277 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 18:53:30,278 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 27.3ms
2025-11-24 18:53:30,773 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 18:53:30,774 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:30,775 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:30,775 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:30,775 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:30,775 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:30,777 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:30,777 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:30,777 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 18:53:30,778 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,780 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,783 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,784 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,786 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,787 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,789 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:53:30,789 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:53:30,789 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,792 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,803 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:30,804 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:30,804 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:30,804 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 18:53:30,804 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 18:53:30,805 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 18:53:30,805 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 18:53:30,806 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:30,806 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:30,806 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:30,806 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:30,806 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:30,808 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:30,808 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:30,808 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 18:53:30,809 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,810 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,811 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,812 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,813 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,814 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,815 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:53:30,816 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,817 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 18:53:30,817 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 18:53:30,818 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 44.4ms
2025-11-24 18:53:30,819 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 13.6ms
2025-11-24 18:53:30,820 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 18:53:30,822 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:30,822 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:30,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:30,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:30,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:30,823 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:30,824 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:30,824 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 18:53:30,825 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,826 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,827 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,828 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,829 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,830 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,831 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:53:30,831 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:53:30,831 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,834 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,837 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:30,837 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:30,838 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:30,838 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 18:53:30,838 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 18:53:30,838 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 18:53:30,839 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 18:53:30,839 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:30,840 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:30,840 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:30,840 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:30,840 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:30,841 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:30,841 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:30,841 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 18:53:30,842 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,843 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,844 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,845 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,846 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,848 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,849 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:53:30,849 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:30,851 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 18:53:30,851 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 18:53:30,852 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 31.2ms
2025-11-24 18:53:30,853 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 13.9ms
2025-11-24 18:53:47,852 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:53:47,852 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:47,853 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:47,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:47,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:47,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:47,855 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:47,855 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:47,855 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:53:47,856 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,858 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,860 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,861 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,862 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,865 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,866 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:53:47,867 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:53:47,867 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:53:47,867 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,869 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:53:47,870 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,872 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:53:47,872 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:47,872 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:47,872 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:47,872 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:53:47,873 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:53:47,873 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 21.4ms
2025-11-24 18:53:47,875 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:53:47,876 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:47,876 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:47,876 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:47,877 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:47,877 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:47,878 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:47,878 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:47,878 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:53:47,879 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,881 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,883 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,884 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,885 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,886 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,887 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:53:47,887 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:53:47,887 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:53:47,888 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,889 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:53:47,889 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:47,891 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:53:47,891 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:47,892 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:47,892 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:47,892 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:53:47,892 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:53:47,893 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.6ms
2025-11-24 18:53:49,704 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 18:53:49,705 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:49,705 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:49,705 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:49,706 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:49,706 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:49,707 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:49,707 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:49,707 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 18:53:49,708 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,709 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,711 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,713 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,715 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,717 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,719 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:53:49,719 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:53:49,720 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,722 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,726 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:49,726 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:49,727 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:49,727 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 18:53:49,727 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 18:53:49,727 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 18:53:49,729 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 18:53:49,729 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.8ms
2025-11-24 18:53:49,730 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:49,730 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:49,730 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:49,730 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:49,730 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:49,732 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:49,732 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:49,732 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 18:53:49,734 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,736 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,737 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,738 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,739 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,740 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,741 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:53:49,741 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,742 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 18:53:49,742 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 18:53:49,744 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 15.4ms
2025-11-24 18:53:49,744 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 18:53:49,745 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:49,746 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:49,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:49,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:49,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:49,748 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:49,748 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:49,748 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 18:53:49,749 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,751 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,752 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,753 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,755 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,756 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,757 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:53:49,757 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:53:49,758 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,760 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,764 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:49,764 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:49,764 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:49,764 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 18:53:49,765 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 18:53:49,765 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 18:53:49,767 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 18:53:49,768 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:49,769 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:49,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:49,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:49,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:49,771 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:49,771 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:49,771 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 18:53:49,772 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,773 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,774 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,775 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,776 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,777 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,778 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 18:53:49,778 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:49,779 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 18:53:49,779 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 18:53:49,780 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 35.6ms
2025-11-24 18:53:49,781 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 14.6ms
2025-11-24 18:53:50,444 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:53:50,445 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:50,445 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:50,446 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:50,446 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:50,446 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:50,447 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:50,448 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:50,448 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:53:50,449 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,450 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,452 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,454 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,455 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,457 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,458 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:53:50,459 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:53:50,459 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:53:50,459 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,462 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:53:50,462 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,464 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:53:50,464 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:50,464 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:50,465 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:50,465 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:53:50,465 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:53:50,466 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 21.5ms
2025-11-24 18:53:50,469 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 18:53:50,469 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:53:50,470 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:53:50,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:53:50,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:53:50,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:53:50,472 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:53:50,472 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:53:50,472 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 18:53:50,473 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,474 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,475 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,476 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,477 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,478 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,479 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 18:53:50,479 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 18:53:50,479 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 18:53:50,479 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,481 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 18:53:50,481 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:53:50,484 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 18:53:50,484 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:50,484 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:50,485 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 18:53:50,485 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 18:53:50,485 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 18:53:50,486 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.0ms
2025-11-24 18:56:10,493 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 18:56:10,494 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:56:10,494 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:56:10,494 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:56:10,494 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:56:10,494 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:56:10,508 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:56:10,510 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 18:56:10,510 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:56:10,510 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 18:56:10,511 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:56:10,522 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:56:10,528 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 18:56:10,529 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 18:56:10,529 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 18:56:10,530 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 36.7ms
2025-11-24 18:56:19,725 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 18:56:19,726 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:56:19,726 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:56:19,726 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:56:19,726 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:56:19,727 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:56:19,727 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:56:19,727 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:56:19,727 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 18:56:19,733 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 18:56:19,733 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 18:56:19,734 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 18:56:19,989 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 18:56:19,989 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-24 18:56:19,989 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-24 18:56:19,991 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 18:56:19,998 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 18:56:19,998 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11352, Rotación: False
2025-11-24 18:56:19,998 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11352
2025-11-24 18:56:19,999 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-24 18:56:19,999 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 274.4ms
2025-11-24 18:56:20,020 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:56:20,021 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:56:20,022 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:56:20,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:56:20,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:56:20,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:56:20,023 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:56:20,024 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:56:20,024 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:56:20,054 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:56:20,054 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:56:20,125 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:56:20,126 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 106.3ms
2025-11-24 18:56:20,128 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:56:20,129 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:56:20,129 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:56:20,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:56:20,130 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:56:20,130 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:56:20,130 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:56:20,130 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:56:20,131 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:56:20,157 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:56:20,158 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:56:20,220 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:56:20,220 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 92.0ms
2025-11-24 18:56:21,382 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:56:21,383 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:56:21,383 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:56:21,384 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:56:21,384 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:56:21,384 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:56:21,384 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:56:21,385 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:56:21,385 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:56:21,412 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:56:21,412 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:56:21,418 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:56:21,419 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 37.1ms
2025-11-24 18:56:21,421 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:56:21,422 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:56:21,422 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:56:21,422 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:56:21,423 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:56:21,423 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:56:21,423 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:56:21,423 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:56:21,423 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:56:21,428 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:56:21,429 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:56:21,431 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:56:21,432 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.5ms
2025-11-24 18:57:25,559 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:57:25,560 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:57:25,560 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:25,560 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:25,560 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:25,561 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:25,561 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:25,561 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:25,561 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:25,561 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:57:25,595 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:57:25,595 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:57:25,653 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:57:25,653 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:25,654 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:25,654 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:25,654 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:25,654 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:25,654 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:25,654 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:25,655 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:57:25,679 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:57:25,679 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:57:25,688 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:57:25,689 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 129.5ms
2025-11-24 18:57:25,689 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 129.3ms
2025-11-24 18:57:25,691 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:57:25,692 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:25,692 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:25,692 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:25,692 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:25,693 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:25,693 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:25,693 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:25,693 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:57:25,723 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:57:25,723 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:57:25,771 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:57:25,772 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:57:25,773 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:25,773 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:25,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:25,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:25,774 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:25,774 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:25,774 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:25,774 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:57:25,796 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:57:25,796 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:57:25,806 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:57:25,807 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 115.8ms
2025-11-24 18:57:25,808 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 36.1ms
2025-11-24 18:57:34,182 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:57:34,183 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:34,183 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:34,183 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:34,183 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:34,184 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:34,184 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:34,184 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:34,184 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:57:34,208 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:57:34,208 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:57:34,256 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:57:34,257 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 74.6ms
2025-11-24 18:57:37,869 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 18:57:37,873 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 3.4ms
2025-11-24 18:57:37,879 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:57:37,880 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:37,883 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:37,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:37,886 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:37,886 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:37,886 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:37,886 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:37,886 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 18:57:37,893 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 18:57:37,897 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 18:57:37,913 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 18:57:37,935 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 18:57:37,935 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11353, Rotación: True
2025-11-24 18:57:37,943 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 18:57:37,944 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 18:57:37,944 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 18:57:37,944 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11353
2025-11-24 18:57:37,945 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 18:57:37,945 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 66.2ms
2025-11-24 18:57:37,960 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 18:57:37,961 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.7ms
2025-11-24 18:57:37,967 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 18:57:37,970 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:37,971 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:37,971 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:37,972 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:37,972 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:37,973 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:37,973 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:37,973 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-24 18:57:37,977 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-24 18:57:37,977 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-24 18:57:37,977 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-24 18:57:38,011 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 18:57:38,011 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-24 18:57:38,012 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 44.7ms
2025-11-24 18:57:38,062 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:57:38,062 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:38,063 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:38,063 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:38,063 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:38,064 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:38,066 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:38,067 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:38,068 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:57:38,091 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:57:38,091 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:57:38,093 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:57:38,096 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:57:38,103 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:38,103 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:38,103 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:38,104 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:38,104 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:38,104 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:38,104 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:38,105 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:57:38,123 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:57:38,123 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:57:38,163 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:57:38,168 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 106.4ms
2025-11-24 18:57:38,172 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 75.6ms
2025-11-24 18:57:38,180 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:57:38,187 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:38,189 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:38,190 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:38,190 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:38,192 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:38,194 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:38,199 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:38,203 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:57:38,240 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:57:38,240 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:57:38,243 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:57:38,243 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:57:38,244 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:38,244 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:38,244 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:38,244 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:38,245 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:38,245 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:38,245 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:38,245 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:57:38,256 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:57:38,256 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:57:38,260 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:57:38,261 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 80.8ms
2025-11-24 18:57:38,263 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 19.4ms
2025-11-24 18:57:38,613 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:57:38,614 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:38,614 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:57:38,614 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:57:38,614 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:38,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:57:38,623 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:57:38,624 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:57:38,624 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 18:57:38,626 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:57:38,645 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 2
2025-11-24 18:57:38,645 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 18:57:38,647 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 34.0ms
2025-11-24 18:57:38,785 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:57:38,791 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:38,792 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': global.app.local:5173
2025-11-24 18:57:38,792 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-24 18:57:38,793 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:38,793 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-24 18:57:38,806 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', Código='GLOBAL004', ID=5
2025-11-24 18:57:38,807 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 18:57:38,807 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 18:57:38,820 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 5
2025-11-24 18:57:38,820 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 18:57:38,821 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 35.9ms
2025-11-24 18:57:38,857 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:57:38,858 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:38,858 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 18:57:38,858 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 18:57:38,858 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:38,858 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 18:57:38,862 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 18:57:38,862 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 18:57:38,862 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 18:57:38,874 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-24 18:57:38,874 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 18:57:38,875 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:57:38,876 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:38,876 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': innova.app.local:5173
2025-11-24 18:57:38,876 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-11-24 18:57:38,876 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:38,876 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-24 18:57:38,879 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-24 18:57:38,880 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-24 18:57:38,880 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/refresh/
2025-11-24 18:57:38,880 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 23.5ms
2025-11-24 18:57:38,889 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-24 18:57:39,018 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 3
2025-11-24 18:57:39,018 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 18:57:39,020 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 144.4ms
2025-11-24 18:57:54,378 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:57:54,379 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:54,379 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:54,379 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:54,379 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:54,379 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:54,380 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:54,380 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:54,380 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:57:54,385 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:57:54,385 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:57:54,386 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:57:54,387 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.0ms
2025-11-24 18:57:58,707 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:57:58,709 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:58,709 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:58,709 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:58,709 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:58,710 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:58,710 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:58,710 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:58,711 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 18:57:58,731 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 18:57:58,739 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 18:57:58,741 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 18:57:58,756 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 18:57:58,760 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11354, Rotación: True
2025-11-24 18:57:58,776 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 18:57:58,777 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 18:57:58,778 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 18:57:58,778 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11354
2025-11-24 18:57:58,778 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 18:57:58,779 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 71.8ms
2025-11-24 18:57:58,803 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 18:57:58,804 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:58,805 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:58,805 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:58,805 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:58,805 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:58,806 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:58,806 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:58,806 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-24 18:57:58,809 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-24 18:57:58,809 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-24 18:57:58,809 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-24 18:57:58,822 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 18:57:58,823 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-24 18:57:58,824 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 21.5ms
2025-11-24 18:57:58,870 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:57:58,872 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:58,874 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:58,874 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:58,874 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:58,874 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:58,874 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:58,875 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:58,875 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:57:58,880 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:57:58,880 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:57:58,886 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:57:58,891 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:57:58,892 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 22.3ms
2025-11-24 18:57:58,893 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:58,894 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:58,895 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:58,895 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:58,895 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:58,895 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:58,895 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:58,896 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:57:58,911 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:57:58,912 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:57:58,915 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:57:58,918 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 26.4ms
2025-11-24 18:57:58,919 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:57:58,921 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:58,928 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:58,928 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:58,928 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:58,928 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:58,928 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:58,929 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:58,929 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:57:58,944 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:57:58,944 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:57:58,946 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:57:58,948 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 18:57:58,948 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:58,949 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:57:58,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:57:58,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:58,950 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:57:58,950 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:57:58,952 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:57:58,952 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 18:57:58,966 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 18:57:58,966 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 18:57:58,977 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 18:57:58,978 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 59.2ms
2025-11-24 18:57:58,979 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 31.7ms
2025-11-24 18:57:59,155 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:57:59,156 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:59,156 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 18:57:59,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 18:57:59,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:59,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 18:57:59,158 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 18:57:59,160 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_sistema
2025-11-24 18:57:59,160 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 18:57:59,161 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 18:57:59,164 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-24 18:57:59,165 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 18:57:59,166 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:57:59,166 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:59,167 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': global.app.local:5173
2025-11-24 18:57:59,167 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-24 18:57:59,167 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:59,167 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-24 18:57:59,170 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', Código='GLOBAL004', ID=5
2025-11-24 18:57:59,171 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 18:57:59,171 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 18:57:59,171 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 16.4ms
2025-11-24 18:57:59,172 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:57:59,173 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:59,173 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': innova.app.local:5173
2025-11-24 18:57:59,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-11-24 18:57:59,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:59,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-24 18:57:59,175 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-24 18:57:59,177 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 3: multi - bd_cliente_innova
2025-11-24 18:57:59,178 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-24 18:57:59,178 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/refresh/
2025-11-24 18:57:59,182 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 5
2025-11-24 18:57:59,183 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 18:57:59,184 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-24 18:57:59,186 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 3
2025-11-24 18:57:59,187 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 18:57:59,188 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 22.3ms
2025-11-24 18:57:59,189 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 17.2ms
2025-11-24 18:57:59,195 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 18:57:59,196 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:57:59,196 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 18:57:59,196 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 18:57:59,197 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:57:59,197 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 18:57:59,198 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 18:57:59,198 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 18:57:59,199 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 18:57:59,202 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 18:57:59,205 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 2
2025-11-24 18:57:59,205 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 18:57:59,206 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 10.5ms
2025-11-24 18:58:10,768 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:58:10,769 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:58:10,769 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:58:10,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:58:10,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:58:10,770 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:58:10,770 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:58:10,770 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:58:10,770 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:58:10,778 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:58:10,778 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:58:10,780 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:58:10,780 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 12.2ms
2025-11-24 18:58:25,152 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 18:58:25,153 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 18:58:25,153 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 18:58:25,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 18:58:25,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 18:58:25,154 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 18:58:25,154 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 18:58:25,154 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 18:58:25,154 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 18:58:25,158 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 18:58:25,158 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 18:58:25,161 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 18:58:25,161 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.2ms
2025-11-24 19:00:32,083 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'backend', 'api', 'www', 'static', 'cdn', 'admin', 'assets'}
2025-11-24 19:02:38,246 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 19:02:38,247 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-24 19:02:38,250 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 19:02:38,250 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:02:38,251 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:02:38,251 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:02:38,251 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:02:38,251 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:02:38,337 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:02:38,341 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 19:02:38,341 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:02:38,342 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 19:02:38,347 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:02:38,397 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 2
2025-11-24 19:02:38,397 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 19:02:38,398 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 147.9ms
2025-11-24 19:02:39,092 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 19:02:39,093 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:02:39,093 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:02:39,093 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:02:39,093 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:02:39,094 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:02:39,094 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:02:39,094 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:02:39,094 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 19:02:39,096 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 19:02:39,096 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:02:39,097 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': global.app.local:5173
2025-11-24 19:02:39,097 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-24 19:02:39,097 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:02:39,097 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-24 19:02:39,101 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', Código='GLOBAL004', ID=5
2025-11-24 19:02:39,102 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 5: single - bd_sistema
2025-11-24 19:02:39,103 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 19:02:39,103 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 19:02:39,104 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 19:02:39,105 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:02:39,105 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 19:02:39,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 19:02:39,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:02:39,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 19:02:39,107 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 19:02:39,108 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_sistema
2025-11-24 19:02:39,108 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 19:02:39,108 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 19:02:39,113 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 19:02:39,115 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 19:02:39,123 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 19:02:39,128 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:02:39,129 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11355, Rotación: True
2025-11-24 19:02:39,135 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 19:02:39,135 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 19:02:39,135 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 19:02:39,136 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11355
2025-11-24 19:02:39,136 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 19:02:39,137 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 19:02:39,138 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:02:39,138 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': innova.app.local:5173
2025-11-24 19:02:39,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-11-24 19:02:39,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:02:39,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-24 19:02:39,140 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-24 19:02:39,141 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 3: multi - bd_cliente_innova
2025-11-24 19:02:39,141 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-24 19:02:39,141 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/refresh/
2025-11-24 19:02:39,142 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 50.2ms
2025-11-24 19:02:39,144 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 5
2025-11-24 19:02:39,144 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 19:02:39,147 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-24 19:02:39,148 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 19:02:39,149 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 53.3ms
2025-11-24 19:02:39,153 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-24 19:02:39,192 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 3
2025-11-24 19:02:39,192 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 19:02:39,192 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 88.6ms
2025-11-24 19:02:39,194 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 19:02:39,195 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:02:39,195 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:02:39,195 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:02:39,195 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:02:39,195 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:02:39,196 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:02:39,196 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:02:39,196 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-24 19:02:39,197 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 59.7ms
2025-11-24 19:02:39,201 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-24 19:02:39,202 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-24 19:02:39,202 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-24 19:02:39,217 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 19:02:39,217 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-24 19:02:39,220 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 26.0ms
2025-11-24 19:02:39,259 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:02:39,259 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.7ms
2025-11-24 19:02:39,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 19:02:39,262 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:02:39,262 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 19:02:39,263 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.8ms
2025-11-24 19:02:39,263 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:02:39,264 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.6ms
2025-11-24 19:02:39,264 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.5ms
2025-11-24 19:02:39,264 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:02:39,264 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:02:39,264 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:02:39,265 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:02:39,265 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:02:39,265 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:02:39,265 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:02:39,265 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:02:39,285 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 19:02:39,286 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:02:39,342 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 19:02:39,344 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 19:02:39,345 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:02:39,345 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:02:39,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:02:39,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:02:39,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:02:39,345 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:02:39,346 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:02:39,346 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 19:02:39,351 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 19:02:39,351 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 19:02:39,356 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 19:02:39,357 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 94.1ms
2025-11-24 19:02:39,358 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.3ms
2025-11-24 19:02:39,360 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:02:39,361 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:02:39,361 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:02:39,361 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:02:39,361 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:02:39,362 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:02:39,362 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:02:39,362 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:02:39,362 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:02:39,362 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 19:02:39,367 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 19:02:39,368 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:02:39,369 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 19:02:39,370 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:02:39,370 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:02:39,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:02:39,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:02:39,370 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:02:39,370 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:02:39,371 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:02:39,371 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 19:02:39,375 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 19:02:39,375 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 19:02:39,378 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 19:02:39,379 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.6ms
2025-11-24 19:02:39,379 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 16.8ms
2025-11-24 19:03:05,380 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 19:03:05,381 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-24 19:03:05,385 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 19:03:05,386 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:05,386 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:05,386 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:05,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:05,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:05,393 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:05,393 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:05,394 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 19:03:05,396 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:05,403 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 2
2025-11-24 19:03:05,403 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 19:03:05,404 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 18.8ms
2025-11-24 19:03:20,514 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 19:03:20,515 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-24 19:03:20,517 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 19:03:20,517 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:20,517 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:20,517 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:20,517 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:20,518 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:20,519 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:20,519 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:20,519 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 19:03:20,528 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 19:03:20,528 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 19:03:20,528 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 19:03:20,528 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,792 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,796 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,803 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:03:20,803 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 19:03:20,803 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,808 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,809 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:03:20,809 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,813 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:03:20,813 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 17, Rotación: False
2025-11-24 19:03:20,813 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 17
2025-11-24 19:03:20,813 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 19:03:20,814 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 297.5ms
2025-11-24 19:03:20,849 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:03:20,850 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.6ms
2025-11-24 19:03:20,854 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:03:20,856 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.6ms
2025-11-24 19:03:20,857 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:03:20,859 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:03:20,863 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:03:20,863 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 6.9ms
2025-11-24 19:03:20,864 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:20,864 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:20,864 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:20,865 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:20,865 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:20,866 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:20,866 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:20,867 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:03:20,868 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,870 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,872 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,874 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,876 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:03:20,876 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:03:20,876 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,883 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:03:20,883 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:03:20,884 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 21.3ms
2025-11-24 19:03:20,886 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:03:20,887 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:20,887 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:20,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:20,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:20,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:20,889 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:20,890 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:20,890 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:03:20,891 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 31.5ms
2025-11-24 19:03:20,891 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,893 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,894 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,895 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,896 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,897 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,899 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:03:20,899 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:03:20,899 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:03:20,900 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,904 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:03:20,904 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,909 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:03:20,909 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:20,909 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:20,909 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:20,910 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:03:20,910 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:03:20,912 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:03:20,913 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:03:20,913 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:20,914 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:20,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:20,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:20,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:20,916 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:20,916 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:20,916 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:03:20,917 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 31.0ms
2025-11-24 19:03:20,918 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,919 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,920 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,921 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,923 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:03:20,924 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:03:20,924 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,926 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:03:20,926 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:03:20,926 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:20,926 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:20,927 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:20,927 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:20,927 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:20,928 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:20,929 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:20,929 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:03:20,930 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,932 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,934 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,935 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,937 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,938 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,939 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:03:20,939 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:03:20,940 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:03:20,940 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,942 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:03:20,942 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:20,945 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:03:20,945 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:20,945 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:20,946 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:20,946 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:03:20,946 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:03:20,948 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 36.2ms
2025-11-24 19:03:20,949 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 36.2ms
2025-11-24 19:03:24,871 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 19:03:24,872 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.5ms
2025-11-24 19:03:24,873 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 19:03:24,875 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 2.0ms
2025-11-24 19:03:24,891 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 19:03:24,897 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:24,898 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:24,899 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:24,899 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:24,900 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:24,902 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:24,902 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:24,903 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 19:03:24,905 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,907 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,908 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,910 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,912 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,914 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,915 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 19:03:24,916 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 19:03:24,916 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,918 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,922 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 19:03:24,922 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 19:03:24,923 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 19:03:24,924 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:24,924 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:24,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:24,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:24,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:24,926 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:24,926 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:24,926 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 19:03:24,927 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,929 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,930 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,931 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,932 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,933 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,935 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 19:03:24,935 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 19:03:24,935 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,937 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:24,939 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 19:03:24,940 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 19:03:24,940 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 48.9ms
2025-11-24 19:03:24,941 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 18.3ms
2025-11-24 19:03:25,811 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:03:25,812 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.6ms
2025-11-24 19:03:25,813 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:03:25,814 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.7ms
2025-11-24 19:03:25,815 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:03:25,816 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:25,817 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:25,817 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:25,817 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:25,818 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:25,819 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:25,819 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:25,820 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:03:25,821 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,823 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,824 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,825 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,826 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,827 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,829 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:03:25,829 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:03:25,829 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:03:25,829 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,832 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:03:25,832 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,834 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:03:25,834 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:25,835 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:25,835 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:25,835 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:03:25,835 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:03:25,836 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:03:25,836 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:25,836 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:25,837 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:25,837 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:25,837 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:25,838 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:25,838 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:25,838 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:03:25,839 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,841 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,843 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,847 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,849 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,851 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,852 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:03:25,853 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:03:25,853 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:03:25,853 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,855 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:03:25,855 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:25,857 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:03:25,857 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:25,858 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:25,858 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:25,858 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:03:25,858 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:03:25,859 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 43.5ms
2025-11-24 19:03:25,859 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 23.7ms
2025-11-24 19:03:29,134 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 19:03:29,136 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.4ms
2025-11-24 19:03:29,139 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 19:03:29,140 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:29,140 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:29,140 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:29,140 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:29,141 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:29,142 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:29,142 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:29,143 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 19:03:29,145 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,147 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 2, Usuario 1, Tipo: web
2025-11-24 19:03:29,148 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,153 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: 2, Level: 4, Type: tenant_admin)
2025-11-24 19:03:29,153 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,154 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:03:29,155 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,156 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,158 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:03:29,159 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 18, Rotación: True
2025-11-24 19:03:29,159 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,167 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 19:03:29,168 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 19:03:29,168 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 19:03:29,168 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 18
2025-11-24 19:03:29,168 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-11-24 19:03:29,169 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 30.0ms
2025-11-24 19:03:29,177 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 19:03:29,177 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.6ms
2025-11-24 19:03:29,184 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 19:03:29,185 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:29,185 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:29,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:29,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:29,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:29,187 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:29,188 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:29,188 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/me/
2025-11-24 19:03:29,189 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,193 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-11-24 19:03:29,194 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-24 19:03:29,194 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 2
2025-11-24 19:03:29,194 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,202 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,208 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,214 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 19:03:29,214 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-24 19:03:29,215 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 31.3ms
2025-11-24 19:03:29,270 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:03:29,273 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 3.3ms
2025-11-24 19:03:29,275 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:03:29,277 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.6ms
2025-11-24 19:03:29,278 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:03:29,279 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:03:29,290 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 12.1ms
2025-11-24 19:03:29,296 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 16.2ms
2025-11-24 19:03:29,308 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:03:29,312 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:29,312 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:29,313 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:29,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:29,320 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:29,323 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:29,323 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:29,324 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:03:29,324 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:03:29,326 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,328 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,329 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,331 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,335 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:03:29,335 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:03:29,335 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,337 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:03:29,337 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:03:29,338 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:29,338 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:29,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:29,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:29,339 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:29,340 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:29,340 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:29,340 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:03:29,341 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,342 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,343 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,344 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,345 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,345 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,346 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:03:29,346 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:03:29,347 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:03:29,347 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,350 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:03:29,350 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,352 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:03:29,353 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:29,353 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:29,353 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:29,353 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:03:29,353 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:03:29,354 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:03:29,355 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:29,356 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:29,356 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:29,356 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:29,356 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:29,357 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:29,357 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:29,357 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:03:29,358 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:03:29,358 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 50.5ms
2025-11-24 19:03:29,359 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,360 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,361 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,362 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,372 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,374 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,375 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:03:29,376 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:03:29,376 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:03:29,376 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,379 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:03:29,379 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,382 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:03:29,382 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:29,382 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:29,383 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:29,383 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:03:29,383 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:03:29,384 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:29,384 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:29,384 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:29,384 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:29,385 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:29,386 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:29,386 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:29,386 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:03:29,387 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 62.4ms
2025-11-24 19:03:29,387 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,389 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,390 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,391 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,392 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:03:29,392 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:03:29,392 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:29,393 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:03:29,394 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:03:29,396 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 41.6ms
2025-11-24 19:03:29,397 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 39.6ms
2025-11-24 19:03:36,844 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 19:03:36,845 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 0.6ms
2025-11-24 19:03:36,848 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 19:03:36,849 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:36,849 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:36,850 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:36,850 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:36,850 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:36,852 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:36,853 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:36,853 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 19:03:36,856 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,858 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,859 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,861 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,862 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,864 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,865 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:03:36,865 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:03:36,866 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,868 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,880 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:36,880 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:36,881 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:36,881 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 19:03:36,881 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 19:03:36,881 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 19:03:36,883 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 19:03:36,884 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.2ms
2025-11-24 19:03:36,884 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 19:03:36,885 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 19:03:36,885 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 37.3ms
2025-11-24 19:03:36,886 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.1ms
2025-11-24 19:03:36,887 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.1ms
2025-11-24 19:03:36,891 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 19:03:36,893 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:36,893 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:36,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:36,894 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:36,894 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:36,895 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:36,896 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:36,896 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 19:03:36,896 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 19:03:36,897 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,899 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,900 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,901 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,902 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,903 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,904 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 19:03:36,904 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,906 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 19:03:36,906 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 19:03:36,907 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:36,907 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:36,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:36,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:36,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:36,909 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:36,909 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:36,909 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 19:03:36,911 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,912 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,913 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,914 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,915 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,916 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,916 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 19:03:36,917 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,918 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 19:03:36,918 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 19:03:36,918 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 19:03:36,919 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:36,919 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:36,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:36,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:36,920 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:36,921 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:36,922 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:36,922 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 19:03:36,922 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 31.2ms
2025-11-24 19:03:36,923 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,924 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,926 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,927 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,928 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,929 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,930 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:03:36,930 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:03:36,931 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,933 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:36,936 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:36,936 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:36,936 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:36,937 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 19:03:36,937 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 19:03:36,937 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 19:03:36,939 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 42.8ms
2025-11-24 19:03:36,941 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 23.2ms
2025-11-24 19:03:38,118 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:03:38,120 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.5ms
2025-11-24 19:03:38,121 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:03:38,124 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 3.0ms
2025-11-24 19:03:38,127 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:03:38,129 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:38,129 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:38,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:38,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:38,130 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:38,131 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:38,132 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:38,132 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:03:38,132 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:03:38,133 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,135 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,136 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,138 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,139 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,140 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,142 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:03:38,143 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:03:38,143 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:03:38,143 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,145 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:03:38,146 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,148 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:03:38,148 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:38,148 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:38,148 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:38,148 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:03:38,149 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:03:38,149 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:38,149 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:38,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:38,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:38,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:38,151 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:38,151 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:38,152 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:03:38,152 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,153 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,154 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,156 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,157 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,158 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,160 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:03:38,160 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:03:38,160 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:03:38,160 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,162 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:03:38,162 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:38,164 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:03:38,165 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:38,165 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:38,165 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:38,165 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:03:38,165 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:03:38,166 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 38.5ms
2025-11-24 19:03:38,167 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 34.6ms
2025-11-24 19:03:41,235 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 19:03:41,236 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 19:03:41,237 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 2.9ms
2025-11-24 19:03:41,239 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 3.0ms
2025-11-24 19:03:41,244 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 19:03:41,245 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:41,245 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:41,245 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:41,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:41,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:41,251 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:41,251 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:41,251 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 19:03:41,252 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,257 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,259 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,261 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,263 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,264 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,266 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 19:03:41,266 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 19:03:41,266 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,268 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,271 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 19:03:41,271 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 19:03:41,272 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 19:03:41,272 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:41,273 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:41,273 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:41,273 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:41,273 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:41,274 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:41,275 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:41,275 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 19:03:41,276 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,278 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,279 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,280 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,281 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,282 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,283 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 19:03:41,283 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 19:03:41,283 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,285 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,287 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 19:03:41,287 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 19:03:41,288 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 44.0ms
2025-11-24 19:03:41,289 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.9ms
2025-11-24 19:03:41,957 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:03:41,959 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:03:41,960 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.7ms
2025-11-24 19:03:41,960 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.3ms
2025-11-24 19:03:41,964 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:03:41,965 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:03:41,965 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:41,966 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:41,966 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:41,966 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:41,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:41,968 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:41,968 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:41,969 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:03:41,969 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,971 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,972 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,973 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,974 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,975 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,977 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:03:41,977 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:03:41,978 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:03:41,978 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,980 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:03:41,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,983 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:03:41,983 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:41,983 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:41,984 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:41,984 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:03:41,984 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:03:41,984 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:03:41,985 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:03:41,985 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:03:41,985 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:03:41,985 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:03:41,986 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:03:41,986 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:03:41,986 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:03:41,987 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,988 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,989 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,990 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,991 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,992 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,993 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:03:41,994 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:03:41,994 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:03:41,994 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,996 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:03:41,997 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:03:41,999 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:03:41,999 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:41,999 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:41,999 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:03:41,999 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:03:42,000 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:03:42,000 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 36.3ms
2025-11-24 19:03:42,001 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 36.0ms
2025-11-24 19:07:38,150 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 19:07:38,150 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:07:38,151 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 19:07:38,151 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 19:07:38,151 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:07:38,151 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 19:07:38,151 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 19:07:38,151 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:07:38,152 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 19:07:38,167 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 19:07:38,167 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=1
2025-11-24 19:07:38,167 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=1
2025-11-24 19:07:38,182 - app.core.auth - WARNING - [AUTH] Usuario NO ENCONTRADO: username='admin_tech', cliente_id_buscado=1
2025-11-24 19:07:38,183 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 33.4ms
2025-11-24 19:07:49,756 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:07:49,757 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:07:49,757 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 19:07:49,757 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 19:07:49,757 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:07:49,758 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 19:07:49,758 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 19:07:49,758 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:07:49,758 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 19:07:49,759 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 401 2.8ms
2025-11-24 19:11:03,092 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:11:03,093 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:11:03,094 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:03,094 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:03,094 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:03,094 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:03,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:03,111 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:03,119 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 19:11:03,119 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:03,120 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:11:03,121 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:03,121 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:03,121 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:03,121 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:03,122 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:03,123 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:03,123 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:03,123 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:11:03,125 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 19:11:03,126 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 401 33.5ms
2025-11-24 19:11:03,127 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 401 33.8ms
2025-11-24 19:11:03,127 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:03,128 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:11:03,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:11:03,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:03,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:11:03,128 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:11:03,129 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:11:03,129 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 19:11:03,132 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 401 6.5ms
2025-11-24 19:11:03,134 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:11:03,135 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:11:03,136 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:03,136 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:03,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:03,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:03,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:03,138 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:03,138 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:03,138 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:11:03,138 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:03,139 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:03,139 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:03,139 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:03,139 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:03,140 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:03,141 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:03,141 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:11:03,142 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,151 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,154 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,155 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,156 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,158 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,159 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:11:03,159 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:11:03,159 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:11:03,159 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,164 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:11:03,164 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,169 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:11:03,170 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:03,170 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:03,170 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:03,170 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:11:03,170 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:11:03,171 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,173 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,174 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,175 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,176 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:11:03,177 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:11:03,177 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:03,183 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:11:03,183 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:11:03,184 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 19:11:03,185 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:03,185 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:11:03,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:11:03,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:03,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:11:03,186 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:11:03,186 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:11:03,187 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 19:11:03,229 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 19:11:03,229 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 19:11:03,235 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 19:11:03,237 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 102.7ms
2025-11-24 19:11:03,237 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 102.6ms
2025-11-24 19:11:03,239 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 55.0ms
2025-11-24 19:11:03,240 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:11:03,241 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:03,242 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:11:03,242 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:11:03,242 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:03,242 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:11:03,242 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:11:03,242 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:11:03,243 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:11:03,244 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 401 3.8ms
2025-11-24 19:11:03,246 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:11:03,247 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:03,247 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:11:03,248 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:11:03,248 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:03,248 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:11:03,248 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:11:03,248 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:11:03,249 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:11:03,254 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 19:11:03,255 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:11:03,339 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 19:11:03,341 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 94.9ms
2025-11-24 19:11:10,416 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 19:11:10,417 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.8ms
2025-11-24 19:11:10,419 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 19:11:10,420 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:10,420 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:10,420 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:10,420 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:10,421 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:10,422 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:10,422 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:10,422 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 19:11:10,423 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:10,427 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:10,431 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 19:11:10,432 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 19:11:10,432 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 19:11:10,433 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 13.5ms
2025-11-24 19:11:19,244 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 19:11:19,245 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:19,245 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:19,245 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:19,245 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:19,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:19,247 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:19,247 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:19,247 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 19:11:19,251 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 19:11:19,251 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 19:11:19,252 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 19:11:19,252 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,493 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,496 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,502 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:11:19,502 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 19:11:19,502 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,506 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,507 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:11:19,508 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,511 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:11:19,512 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 19, Rotación: False
2025-11-24 19:11:19,512 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 19
2025-11-24 19:11:19,512 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 19:11:19,513 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 268.7ms
2025-11-24 19:11:19,530 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:11:19,531 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:19,532 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:19,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:19,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:19,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:19,534 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:19,534 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:19,534 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:11:19,535 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,537 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,539 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,540 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,542 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:11:19,542 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:11:19,543 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,545 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:11:19,545 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:11:19,547 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:11:19,547 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 16.9ms
2025-11-24 19:11:19,548 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:19,548 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:19,548 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:19,548 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:19,549 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:19,550 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:19,550 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:19,551 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:11:19,552 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,554 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,555 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,556 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,557 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,558 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,559 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:11:19,559 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:11:19,559 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:11:19,560 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,563 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:11:19,563 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,565 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:11:19,566 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:19,566 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:19,566 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:19,566 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:11:19,566 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:11:19,568 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 21.4ms
2025-11-24 19:11:19,568 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:11:19,569 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:19,570 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:19,570 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:19,570 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:19,570 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:19,571 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:19,571 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:19,572 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:11:19,573 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,574 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,575 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,576 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,578 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:11:19,578 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:11:19,578 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,580 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:11:19,580 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:11:19,581 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:11:19,582 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:19,582 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:19,582 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:19,582 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:19,583 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:19,584 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:19,584 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:19,584 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:11:19,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,588 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,589 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,591 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:11:19,591 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:11:19,592 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:11:19,592 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,595 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:11:19,595 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:19,597 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:11:19,597 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:19,597 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:19,598 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:19,598 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:11:19,598 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:11:19,599 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.3ms
2025-11-24 19:11:19,600 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.4ms
2025-11-24 19:11:26,076 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 19:11:26,076 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:26,076 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:26,077 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:26,077 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:26,077 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:26,079 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:26,079 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:26,079 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 19:11:26,080 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,082 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,084 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,086 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,088 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,089 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,091 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 19:11:26,091 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 19:11:26,092 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,094 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,100 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 19:11:26,100 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 19:11:26,102 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 25.8ms
2025-11-24 19:11:26,104 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 19:11:26,105 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:26,105 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:26,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:26,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:26,106 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:26,107 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:26,107 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:26,107 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 19:11:26,108 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,110 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,111 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,112 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,113 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,114 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,115 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 19:11:26,115 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 19:11:26,116 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,118 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,121 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 19:11:26,121 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 19:11:26,122 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 17.7ms
2025-11-24 19:11:26,959 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:11:26,959 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:26,959 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:26,960 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:26,960 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:26,960 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:26,962 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:26,962 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:26,962 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:11:26,963 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,965 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,967 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,969 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,970 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,971 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,973 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:11:26,973 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:11:26,973 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:11:26,973 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,975 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:11:26,976 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,978 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:11:26,978 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:26,978 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:26,978 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:26,978 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:11:26,979 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:11:26,979 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 20.7ms
2025-11-24 19:11:26,981 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:11:26,981 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:26,982 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:26,982 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:26,982 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:26,982 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:26,984 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:26,985 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:26,985 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:11:26,986 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,987 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,989 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,990 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,991 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,992 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,993 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:11:26,993 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:11:26,993 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:11:26,993 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,995 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:11:26,995 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:26,997 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:11:26,997 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:26,997 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:26,997 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:26,998 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:11:26,998 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:11:26,998 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.3ms
2025-11-24 19:11:37,554 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:11:37,556 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:37,556 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:37,557 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:37,557 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:37,557 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:37,559 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:37,559 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:37,559 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:11:37,560 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:11:37,561 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,563 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,565 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,566 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,567 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:11:37,567 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:11:37,568 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,569 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:11:37,570 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:11:37,570 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:37,570 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:37,571 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:37,571 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:37,571 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:37,572 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:37,572 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:37,572 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:11:37,573 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,574 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,575 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,577 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,580 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,583 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:11:37,583 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:11:37,584 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:11:37,584 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,590 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:11:37,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,598 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:11:37,598 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:37,599 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:37,599 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:37,599 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:11:37,600 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:11:37,600 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 46.0ms
2025-11-24 19:11:37,602 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 41.8ms
2025-11-24 19:11:37,606 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:11:37,609 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:37,610 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:37,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:37,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:37,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:37,612 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:37,613 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:37,613 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:11:37,614 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,616 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,617 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,619 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,621 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:11:37,621 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:11:37,621 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,623 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:11:37,623 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:11:37,624 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:11:37,625 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:37,625 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:11:37,625 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:11:37,625 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:37,626 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:11:37,627 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:11:37,628 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:11:37,628 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:11:37,629 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,633 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,634 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,636 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,637 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,638 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,639 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:11:37,639 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:11:37,639 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:11:37,639 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,641 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:11:37,642 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:11:37,645 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:11:37,646 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:37,646 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:37,646 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:11:37,646 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:11:37,647 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:11:37,647 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 40.8ms
2025-11-24 19:11:37,648 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 24.4ms
2025-11-24 19:11:38,078 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:11:38,078 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 19:11:38,079 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:38,079 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:11:38,079 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:11:38,079 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:38,079 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:11:38,080 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:11:38,080 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:11:38,080 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:11:38,084 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 19:11:38,084 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:11:38,085 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 19:11:38,086 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:38,086 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:11:38,086 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:11:38,086 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:38,087 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:11:38,087 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:11:38,087 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:11:38,087 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 19:11:38,092 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 19:11:38,092 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 19:11:38,094 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 19:11:38,096 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.5ms
2025-11-24 19:11:38,097 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 18.8ms
2025-11-24 19:11:38,100 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:11:38,101 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:38,102 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:11:38,102 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:11:38,102 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:38,102 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:11:38,102 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:11:38,103 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:11:38,103 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:11:38,103 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 19:11:38,108 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 19:11:38,109 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:11:38,110 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 19:11:38,111 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:11:38,111 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:11:38,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:11:38,112 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:11:38,112 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:11:38,112 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:11:38,112 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:11:38,113 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 19:11:38,117 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 19:11:38,118 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 19:11:38,120 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 19:11:38,121 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.9ms
2025-11-24 19:11:38,122 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 19.1ms
2025-11-24 19:14:56,099 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:14:56,100 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:14:56,101 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.3ms
2025-11-24 19:14:56,101 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-11-24 19:14:56,107 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:14:56,108 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:14:56,108 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:14:56,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:14:56,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:14:56,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:14:56,109 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:14:56,109 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:14:56,110 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:14:56,111 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 401 3.4ms
2025-11-24 19:14:56,113 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:14:56,116 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:14:56,116 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:14:56,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:14:56,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:14:56,117 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:14:56,117 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:14:56,117 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:14:56,118 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:14:56,169 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 19:14:56,169 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:14:56,234 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 19:14:56,235 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 121.9ms
2025-11-24 19:14:56,302 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:14:56,303 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.0ms
2025-11-24 19:14:56,305 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:14:56,306 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:14:56,306 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:14:56,308 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 3.3ms
2025-11-24 19:14:56,308 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:14:56,309 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.5ms
2025-11-24 19:14:56,309 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.4ms
2025-11-24 19:14:56,310 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:14:56,310 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:14:56,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:14:56,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:14:56,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:14:56,336 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:14:56,340 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:14:56,342 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:14:56,346 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,370 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,380 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,387 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,402 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:14:56,402 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:14:56,402 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,409 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:14:56,410 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:14:56,412 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:14:56,417 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 109.0ms
2025-11-24 19:14:56,418 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:14:56,418 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:14:56,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:14:56,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:14:56,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:14:56,423 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:14:56,423 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:14:56,423 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:14:56,425 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,427 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,429 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,429 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,431 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,433 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,434 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:14:56,434 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:14:56,434 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:14:56,434 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,437 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:14:56,437 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,441 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:14:56,442 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:14:56,442 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:14:56,442 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:14:56,442 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:14:56,442 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:14:56,444 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 31.6ms
2025-11-24 19:14:56,444 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:14:56,445 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:14:56,445 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:14:56,446 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:14:56,446 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:14:56,446 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:14:56,448 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:14:56,448 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:14:56,448 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:14:56,449 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,451 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,453 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,461 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,470 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:14:56,471 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:14:56,471 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,473 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:14:56,474 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:14:56,475 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:14:56,476 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:14:56,476 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:14:56,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:14:56,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:14:56,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:14:56,478 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:14:56,478 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:14:56,479 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:14:56,480 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,485 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,487 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,488 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,489 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,491 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,493 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:14:56,493 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:14:56,493 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:14:56,493 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,495 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:14:56,496 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:14:56,500 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:14:56,500 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:14:56,501 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:14:56,501 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:14:56,501 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:14:56,501 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:14:56,502 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 57.7ms
2025-11-24 19:14:56,504 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 28.8ms
2025-11-24 19:14:57,087 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 19:14:57,089 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.7ms
2025-11-24 19:14:57,121 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 19:14:57,122 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:14:57,122 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:14:57,122 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:14:57,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:14:57,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:14:57,123 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:14:57,123 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:14:57,123 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 19:14:57,132 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 19:14:57,134 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 19:14:57,142 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 19:14:57,143 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 21.7ms
2025-11-24 19:15:09,080 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:15:09,081 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:15:09,081 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:15:09,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:15:09,082 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:15:09,082 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:15:09,082 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:15:09,082 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:15:09,082 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:15:09,083 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 401 2.6ms
2025-11-24 19:15:09,085 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:15:09,085 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:15:09,085 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:15:09,086 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:15:09,086 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:15:09,086 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:15:09,086 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:15:09,086 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:15:09,087 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:15:09,112 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 19:15:09,113 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:15:09,173 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 19:15:09,174 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 88.7ms
2025-11-24 19:15:09,412 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:15:09,413 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:15:09,414 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:15:09,414 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:15:09,414 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:15:09,414 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:15:09,417 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:15:09,418 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:15:09,418 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:15:09,418 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:15:09,419 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,421 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,423 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,424 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,425 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:15:09,425 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:15:09,425 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,429 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:15:09,430 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:15:09,430 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:15:09,430 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:15:09,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:15:09,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:15:09,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:15:09,432 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:15:09,432 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:15:09,432 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:15:09,433 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,434 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,435 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,436 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,437 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,438 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,439 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:15:09,439 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:15:09,439 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:15:09,440 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,441 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:15:09,442 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,447 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:15:09,447 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:15:09,447 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:15:09,447 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:15:09,448 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:15:09,448 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:15:09,448 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 36.1ms
2025-11-24 19:15:09,449 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 30.7ms
2025-11-24 19:15:09,451 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:15:09,451 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:15:09,452 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:15:09,452 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:15:09,452 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:15:09,452 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:15:09,453 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:15:09,454 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:15:09,454 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:15:09,455 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,456 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,457 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,458 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,459 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:15:09,459 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:15:09,459 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,462 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:15:09,462 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:15:09,463 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:15:09,464 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:15:09,464 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:15:09,464 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:15:09,464 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:15:09,464 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:15:09,465 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:15:09,466 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:15:09,466 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:15:09,467 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,468 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,469 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,470 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,471 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,472 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,473 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:15:09,474 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:15:09,474 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:15:09,474 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,476 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:15:09,476 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:15:09,479 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:15:09,479 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:15:09,479 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:15:09,479 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:15:09,480 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:15:09,480 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:15:09,480 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 29.8ms
2025-11-24 19:15:09,481 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 18.3ms
2025-11-24 19:15:10,073 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 19:15:10,073 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:15:10,073 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:15:10,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:15:10,074 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:15:10,074 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:15:10,074 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:15:10,074 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:15:10,074 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 19:15:10,079 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 19:15:10,079 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 19:15:10,084 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 19:15:10,085 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 12.7ms
2025-11-24 19:16:14,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 19:16:14,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.1ms
2025-11-24 19:16:14,265 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 19:16:14,266 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:16:14,268 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:16:14,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:16:14,271 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:16:14,274 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:16:14,295 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:16:14,297 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 19:16:14,297 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:16:14,298 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 19:16:14,300 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,314 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 2, Usuario 1, Tipo: web
2025-11-24 19:16:14,315 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,318 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: 2, Level: 4, Type: tenant_admin)
2025-11-24 19:16:14,318 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,328 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:16:14,328 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,330 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,343 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:16:14,344 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 20, Rotación: True
2025-11-24 19:16:14,344 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,352 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 19:16:14,352 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 19:16:14,353 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 19:16:14,353 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 20
2025-11-24 19:16:14,353 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-11-24 19:16:14,354 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 88.4ms
2025-11-24 19:16:14,361 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 19:16:14,362 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.7ms
2025-11-24 19:16:14,364 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 19:16:14,365 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:16:14,365 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:16:14,365 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:16:14,365 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:16:14,365 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:16:14,367 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:16:14,367 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:16:14,367 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/me/
2025-11-24 19:16:14,368 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,371 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-11-24 19:16:14,371 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-24 19:16:14,372 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 2
2025-11-24 19:16:14,372 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,378 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,384 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,389 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 19:16:14,389 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-24 19:16:14,390 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 25.9ms
2025-11-24 19:16:14,417 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:16:14,418 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.3ms
2025-11-24 19:16:14,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:16:14,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:16:14,421 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:16:14,423 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 3.4ms
2025-11-24 19:16:14,424 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 3.8ms
2025-11-24 19:16:14,425 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:16:14,426 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 5.1ms
2025-11-24 19:16:14,426 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:16:14,427 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:16:14,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:16:14,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:16:14,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:16:14,442 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:16:14,442 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:16:14,443 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:16:14,444 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,445 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,446 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,447 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,449 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:16:14,449 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:16:14,449 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,452 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:16:14,452 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:16:14,456 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:16:14,457 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:16:14,458 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 32.9ms
2025-11-24 19:16:14,458 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:16:14,459 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:16:14,459 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:16:14,459 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:16:14,459 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:16:14,461 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:16:14,461 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:16:14,461 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:16:14,461 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:16:14,461 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:16:14,462 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:16:14,462 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:16:14,462 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:16:14,463 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:16:14,463 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:16:14,463 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:16:14,465 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,467 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,468 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,469 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,470 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,471 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,472 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:16:14,472 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:16:14,473 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:16:14,473 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,476 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:16:14,476 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,480 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:16:14,480 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:16:14,480 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:16:14,480 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:16:14,480 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:16:14,481 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:16:14,481 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,483 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,484 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,485 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,485 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:16:14,486 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:16:14,486 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,487 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:16:14,487 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:16:14,488 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:16:14,489 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:16:14,491 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:16:14,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:16:14,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:16:14,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:16:14,493 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:16:14,494 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:16:14,494 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:16:14,495 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,496 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,497 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,498 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,499 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,500 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,501 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:16:14,501 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:16:14,501 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:16:14,502 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,504 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:16:14,504 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:14,507 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:16:14,508 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:16:14,508 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:16:14,508 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:16:14,508 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:16:14,508 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:16:14,509 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 53.1ms
2025-11-24 19:16:14,510 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 52.6ms
2025-11-24 19:16:14,512 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 23.4ms
2025-11-24 19:16:17,488 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 19:16:17,489 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-11-24 19:16:17,491 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 19:16:17,492 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:16:17,492 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:16:17,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:16:17,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:16:17,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:16:17,494 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:16:17,494 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:16:17,494 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 19:16:17,495 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:17,497 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:17,498 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 19:16:17,499 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 19:16:17,499 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 19:16:17,500 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 9.1ms
2025-11-24 19:16:38,230 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 19:16:38,231 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.7ms
2025-11-24 19:16:38,233 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 19:16:38,234 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:16:38,234 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:16:38,234 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:16:38,234 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:16:38,234 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:16:38,235 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:16:38,236 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:16:38,236 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 19:16:38,240 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 19:16:38,240 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 19:16:38,240 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 19:16:38,241 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,477 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,481 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,482 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:16:38,482 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 19:16:38,482 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,486 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,487 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:16:38,488 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,489 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:16:38,489 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 21, Rotación: False
2025-11-24 19:16:38,489 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 21
2025-11-24 19:16:38,489 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 19:16:38,490 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 256.6ms
2025-11-24 19:16:38,518 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:16:38,520 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.2ms
2025-11-24 19:16:38,523 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:16:38,523 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:16:38,525 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:16:38,526 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.9ms
2025-11-24 19:16:38,526 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.8ms
2025-11-24 19:16:38,526 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:16:38,530 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 4.9ms
2025-11-24 19:16:38,531 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:16:38,531 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:16:38,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:16:38,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:16:38,532 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:16:38,534 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:16:38,534 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:16:38,534 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:16:38,535 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,537 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,539 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,540 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,541 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:16:38,541 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:16:38,541 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,543 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:16:38,544 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:16:38,547 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:16:38,548 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:16:38,548 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 21.8ms
2025-11-24 19:16:38,549 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:16:38,549 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:16:38,549 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:16:38,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:16:38,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:16:38,551 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:16:38,551 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:16:38,552 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:16:38,552 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:16:38,552 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:16:38,552 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:16:38,552 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:16:38,552 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:16:38,553 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:16:38,553 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:16:38,554 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:16:38,555 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,556 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,557 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,558 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,559 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,560 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,560 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:16:38,561 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:16:38,561 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:16:38,561 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,564 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:16:38,564 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,566 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:16:38,567 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:16:38,567 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:16:38,567 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:16:38,567 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:16:38,567 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:16:38,568 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,569 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,570 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,571 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,572 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:16:38,572 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:16:38,573 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,575 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:16:38,575 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:16:38,576 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:16:38,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:16:38,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:16:38,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:16:38,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:16:38,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:16:38,580 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:16:38,580 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:16:38,581 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:16:38,581 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 34.1ms
2025-11-24 19:16:38,582 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 33.9ms
2025-11-24 19:16:38,582 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,584 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,588 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,590 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:16:38,590 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:16:38,590 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:16:38,591 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,593 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:16:38,593 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:16:38,596 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:16:38,596 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:16:38,596 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:16:38,597 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:16:38,597 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:16:38,597 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:16:38,600 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 23.3ms
2025-11-24 19:19:25,569 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:19:25,570 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:19:25,570 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.5ms
2025-11-24 19:19:25,571 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.0ms
2025-11-24 19:19:25,573 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:19:25,575 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.6ms
2025-11-24 19:19:25,583 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:19:25,585 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:19:25,587 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:25,588 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:19:25,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:19:25,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:25,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:19:25,606 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:19:25,607 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:19:25,607 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:19:25,608 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 23.2ms
2025-11-24 19:19:25,608 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:19:25,610 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:25,610 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:19:25,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:19:25,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:25,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:19:25,612 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:19:25,612 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:19:25,612 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:19:25,615 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:19:25,616 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 401 32.8ms
2025-11-24 19:19:25,616 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:25,616 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:19:25,616 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:19:25,616 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:25,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:19:25,618 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:19:25,618 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:19:25,618 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:19:25,619 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,630 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,633 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,634 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,635 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:19:25,636 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:19:25,636 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,641 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:19:25,641 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:19:25,643 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:19:25,643 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 401 34.5ms
2025-11-24 19:19:25,644 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:25,644 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:19:25,644 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:19:25,644 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:25,644 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:19:25,646 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:19:25,646 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:19:25,646 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:19:25,647 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,649 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,649 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,650 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,651 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,652 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,653 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:19:25,653 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:19:25,654 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:19:25,654 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,657 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:19:25,657 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:25,663 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:19:25,664 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:19:25,664 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:19:25,664 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:19:25,664 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:19:25,664 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:19:25,665 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 50.3ms
2025-11-24 19:19:25,667 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 24.0ms
2025-11-24 19:19:26,114 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:19:26,115 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:26,115 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:19:26,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:19:26,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:26,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:19:26,115 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:19:26,116 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:19:26,116 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:19:26,117 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 401 2.8ms
2025-11-24 19:19:26,118 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 19:19:26,119 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:26,119 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:19:26,119 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:19:26,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:26,121 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:19:26,121 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:19:26,122 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:19:26,122 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 19:19:26,123 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:19:26,124 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:26,125 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:19:26,125 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:19:26,125 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:26,125 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:19:26,125 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:19:26,126 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:19:26,126 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:19:26,127 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 19:19:26,127 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 401 8.9ms
2025-11-24 19:19:26,129 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 401 5.3ms
2025-11-24 19:19:26,131 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 19:19:26,132 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:26,132 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:19:26,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:19:26,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:26,133 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:19:26,133 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:19:26,133 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:19:26,133 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 19:19:26,134 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 19:19:26,135 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 401 4.4ms
2025-11-24 19:19:26,135 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 19:19:26,137 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.4ms
2025-11-24 19:19:26,141 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 19:19:26,142 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:26,142 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:19:26,142 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:19:26,142 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:26,142 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:19:26,143 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:19:26,143 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:19:26,143 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 19:19:26,151 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 1
2025-11-24 19:19:26,151 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: admin_acme
2025-11-24 19:19:26,152 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 11.4ms
2025-11-24 19:19:27,099 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:19:27,100 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-11-24 19:19:27,101 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:19:27,101 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:27,102 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:19:27,102 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:19:27,102 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:27,102 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:19:27,106 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:19:27,106 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:19:27,106 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 19:19:27,107 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:27,109 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:27,111 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:27,112 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:27,113 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-24 19:19:27,114 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-24 19:19:27,114 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:27,126 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:19:27,126 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:19:27,129 - app.services.base_service - ERROR - DatabaseError en get_branding_by_cliente: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:19:27,130 - app.api.v1.endpoints.clientes - ERROR - Error inesperado en obtener_branding_tenant: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\clientes.py", line 512, in obtener_branding_tenant
    branding = await ClienteService.get_branding_by_cliente(cliente_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:19:27,132 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 31.0ms
2025-11-24 19:19:40,599 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:19:40,599 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.8ms
2025-11-24 19:19:40,612 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:19:40,613 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:40,613 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:19:40,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:19:40,614 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:40,614 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:19:40,620 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:19:40,621 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:19:40,622 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 19:19:40,623 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 401 10.9ms
2025-11-24 19:19:41,100 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:19:41,101 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 1.1ms
2025-11-24 19:19:41,103 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:19:41,103 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:19:41,105 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.0ms
2025-11-24 19:19:41,105 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.1ms
2025-11-24 19:19:41,106 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:19:41,106 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:19:41,106 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:19:41,108 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:41,109 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:19:41,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:19:41,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:41,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:19:41,110 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:19:41,111 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:19:41,111 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 19:19:41,112 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,113 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,115 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,115 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,116 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-24 19:19:41,116 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-24 19:19:41,117 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,118 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:19:41,118 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:19:41,119 - app.services.base_service - ERROR - DatabaseError en get_branding_by_cliente: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:19:41,121 - app.api.v1.endpoints.clientes - ERROR - Error inesperado en obtener_branding_tenant: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\clientes.py", line 512, in obtener_branding_tenant
    branding = await ClienteService.get_branding_by_cliente(cliente_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:19:41,122 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 15.9ms
2025-11-24 19:19:41,122 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 15.9ms
2025-11-24 19:19:41,125 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:19:41,125 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:19:41,126 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 20.1ms
2025-11-24 19:19:41,126 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:41,126 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:19:41,127 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:19:41,127 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:41,127 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:19:41,128 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:19:41,128 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:19:41,128 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:19:41,128 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:41,129 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:19:41,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:19:41,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:41,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:19:41,130 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:19:41,130 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:19:41,130 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:19:41,131 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,132 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,133 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,134 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,134 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,136 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,137 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:19:41,137 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:19:41,137 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:19:41,137 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,139 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:19:41,139 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,143 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:19:41,143 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:19:41,143 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:19:41,143 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:19:41,143 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:19:41,143 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:19:41,144 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,145 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,146 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,146 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,147 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:19:41,147 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:19:41,147 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,150 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:19:41,150 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:19:41,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:19:41,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:19:41,152 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:41,153 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:19:41,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:19:41,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:41,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:19:41,154 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:19:41,155 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:19:41,155 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:19:41,155 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:19:41,155 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:19:41,155 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:19:41,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:19:41,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:19:41,157 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:19:41,157 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:19:41,157 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:19:41,158 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,159 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,160 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,160 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,161 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:19:41,161 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:19:41,161 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,163 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:19:41,163 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:19:41,163 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,164 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,165 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,166 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,166 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,167 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,168 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:19:41,169 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:19:41,169 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:19:41,169 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,171 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:19:41,171 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:19:41,173 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:19:41,173 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:19:41,173 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:19:41,173 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:19:41,173 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:19:41,173 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:19:41,174 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 48.9ms
2025-11-24 19:19:41,174 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 48.8ms
2025-11-24 19:19:41,176 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 24.6ms
2025-11-24 19:19:41,176 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 24.5ms
2025-11-24 19:20:42,087 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 19:20:42,088 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.4ms
2025-11-24 19:20:42,089 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 19:20:42,090 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:20:42,090 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:20:42,090 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:20:42,090 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:20:42,090 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:20:42,094 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:20:42,095 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:20:42,095 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 19:20:42,096 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:42,099 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:42,102 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 19:20:42,103 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 19:20:42,103 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 19:20:42,104 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 14.2ms
2025-11-24 19:20:53,656 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 19:20:53,657 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-24 19:20:53,659 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 19:20:53,659 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:20:53,659 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:20:53,660 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:20:53,660 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:20:53,660 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:20:53,661 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:20:53,661 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:20:53,661 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 19:20:53,664 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 19:20:53,664 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 19:20:53,664 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 19:20:53,665 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,886 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,889 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,896 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:20:53,896 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 19:20:53,896 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,900 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,901 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:20:53,901 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,907 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:20:53,908 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 22, Rotación: False
2025-11-24 19:20:53,908 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 22
2025-11-24 19:20:53,908 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 19:20:53,909 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 249.9ms
2025-11-24 19:20:53,919 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:20:53,920 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 1.1ms
2025-11-24 19:20:53,923 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:20:53,923 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:20:53,924 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:20:53,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:20:53,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:20:53,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:20:53,925 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:20:53,926 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:20:53,926 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 19:20:53,927 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,929 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,932 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,934 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,935 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-24 19:20:53,936 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-24 19:20:53,937 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,939 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:20:53,939 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:20:53,940 - app.services.base_service - ERROR - DatabaseError en get_branding_by_cliente: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:20:53,942 - app.api.v1.endpoints.clientes - ERROR - Error inesperado en obtener_branding_tenant: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\clientes.py", line 512, in obtener_branding_tenant
    branding = await ClienteService.get_branding_by_cliente(cliente_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:20:53,944 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:20:53,945 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 22.5ms
2025-11-24 19:20:53,946 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.8ms
2025-11-24 19:20:53,946 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:20:53,946 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:20:53,946 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:20:53,948 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.1ms
2025-11-24 19:20:53,948 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.1ms
2025-11-24 19:20:53,948 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.2ms
2025-11-24 19:20:53,959 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:20:53,961 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:20:53,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:20:53,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:20:53,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:20:53,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:20:53,965 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:20:53,965 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:20:53,965 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:20:53,966 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,968 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,969 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,973 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,975 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:20:53,975 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:20:53,975 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,979 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:20:53,979 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:20:53,979 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:20:53,980 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:20:53,981 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:20:53,981 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:20:53,981 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:20:53,981 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:20:53,983 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:20:53,983 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:20:53,983 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:20:53,984 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,985 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,989 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,990 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,992 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,993 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,995 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:20:53,995 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:20:53,995 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:20:53,995 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:53,997 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:20:53,998 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,001 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:20:54,002 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:20:54,002 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:20:54,002 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:20:54,003 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:20:54,003 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:20:54,004 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:20:54,006 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:20:54,007 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:20:54,007 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:20:54,007 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:20:54,007 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:20:54,007 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:20:54,008 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:20:54,009 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:20:54,009 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:20:54,009 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:20:54,009 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:20:54,009 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:20:54,010 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:20:54,010 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:20:54,011 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:20:54,011 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:20:54,011 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:20:54,012 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 52.4ms
2025-11-24 19:20:54,012 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,013 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,014 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,015 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,016 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:20:54,016 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:20:54,016 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,017 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:20:54,018 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:20:54,018 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,019 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,020 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,022 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,023 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,024 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,025 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:20:54,025 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:20:54,025 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:20:54,025 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,027 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:20:54,028 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:20:54,030 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:20:54,030 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:20:54,030 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:20:54,031 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:20:54,031 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:20:54,031 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:20:54,032 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 53.0ms
2025-11-24 19:20:54,034 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 29.7ms
2025-11-24 19:20:54,034 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 28.4ms
2025-11-24 19:21:06,303 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 19:21:06,304 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.4ms
2025-11-24 19:21:06,306 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 19:21:06,307 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:06,307 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:06,307 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:06,307 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:06,307 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:06,308 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:06,308 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:06,309 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 19:21:06,309 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:06,310 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:06,311 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 19:21:06,312 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 19:21:06,312 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 19:21:06,312 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 6.2ms
2025-11-24 19:21:15,305 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 19:21:15,306 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-24 19:21:15,308 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 19:21:15,308 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:15,308 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:15,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:15,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:15,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:15,310 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:15,311 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 19:21:15,312 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:15,312 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 19:21:15,314 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 19:21:15,314 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 19:21:15,315 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 19:21:15,315 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,528 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,529 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,530 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:21:15,530 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 19:21:15,530 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,531 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,531 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:21:15,532 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,532 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:21:15,533 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 23, Rotación: False
2025-11-24 19:21:15,533 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 23
2025-11-24 19:21:15,533 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 19:21:15,534 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 225.7ms
2025-11-24 19:21:15,544 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:21:15,544 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-11-24 19:21:15,547 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:21:15,547 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:15,547 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:15,548 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:15,548 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:15,548 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:15,549 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:15,549 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:15,550 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 19:21:15,550 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,552 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,554 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,557 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,559 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-24 19:21:15,559 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-24 19:21:15,559 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,560 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:21:15,561 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:21:15,562 - app.services.base_service - ERROR - DatabaseError en get_branding_by_cliente: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:21:15,563 - app.api.v1.endpoints.clientes - ERROR - Error inesperado en obtener_branding_tenant: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\clientes.py", line 512, in obtener_branding_tenant
    branding = await ClienteService.get_branding_by_cliente(cliente_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:21:15,566 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:21:15,567 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 19.9ms
2025-11-24 19:21:15,567 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.5ms
2025-11-24 19:21:15,567 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:21:15,568 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:21:15,568 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:21:15,569 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.7ms
2025-11-24 19:21:15,569 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.7ms
2025-11-24 19:21:15,569 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.6ms
2025-11-24 19:21:15,574 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:21:15,575 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:21:15,576 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:15,576 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:15,577 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:15,577 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:15,577 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:15,578 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:15,578 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:15,578 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:21:15,580 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,582 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,583 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,584 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:21:15,585 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:21:15,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,586 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:21:15,586 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:21:15,587 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:15,587 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:15,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:15,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:15,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:15,588 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:15,588 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:15,588 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:21:15,589 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:21:15,589 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:21:15,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,591 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,592 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,593 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,594 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:21:15,594 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:21:15,594 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,595 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:21:15,595 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:21:15,596 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:15,596 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:15,596 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:15,597 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:15,597 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:15,598 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:15,598 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:15,598 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:21:15,598 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:15,598 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:15,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:15,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:15,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:15,600 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:15,600 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:15,600 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:21:15,601 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,602 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,603 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,603 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,604 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,605 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,606 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:21:15,606 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:21:15,606 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:21:15,606 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,609 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:21:15,609 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,612 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:21:15,612 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:15,612 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:15,612 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:15,612 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:21:15,612 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:21:15,613 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,614 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,615 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,616 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,617 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,618 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,619 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:21:15,619 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:21:15,619 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:21:15,620 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,621 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:21:15,622 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:15,624 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:21:15,625 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:15,625 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:15,625 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:15,625 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:21:15,625 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:21:15,626 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 52.3ms
2025-11-24 19:21:15,627 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 51.8ms
2025-11-24 19:21:15,628 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 39.3ms
2025-11-24 19:21:15,628 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 39.3ms
2025-11-24 19:21:50,135 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:21:50,138 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 3.1ms
2025-11-24 19:21:50,164 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:21:50,169 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:50,169 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:50,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:50,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:50,170 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:50,178 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:50,178 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:50,178 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 19:21:50,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 401 15.4ms
2025-11-24 19:21:50,919 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:21:50,921 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.3ms
2025-11-24 19:21:50,922 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:21:50,922 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:21:50,924 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:21:50,924 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.3ms
2025-11-24 19:21:50,925 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.3ms
2025-11-24 19:21:50,928 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 4.1ms
2025-11-24 19:21:50,928 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:21:50,930 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:50,930 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:50,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:50,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:50,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:50,932 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:50,932 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:50,932 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:21:50,933 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,934 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,936 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,937 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,938 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:21:50,939 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:21:50,939 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,943 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:21:50,943 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:21:50,945 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:21:50,946 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:21:50,946 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:21:50,946 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.0ms
2025-11-24 19:21:50,947 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:50,947 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:50,947 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:50,947 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:50,947 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:50,948 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:50,948 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:50,948 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:21:50,949 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:50,949 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:50,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:50,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:50,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:50,950 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:50,950 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:50,951 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:21:50,951 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:50,951 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:50,951 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:50,951 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:50,952 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:50,953 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:50,953 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:50,953 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:21:50,954 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,955 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,956 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,957 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,962 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:21:50,962 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:21:50,962 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,964 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:21:50,964 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:21:50,965 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,966 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,967 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,968 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,969 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,970 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,971 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:21:50,972 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:21:50,972 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:21:50,972 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,976 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:21:50,976 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,981 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:21:50,981 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:50,982 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:50,982 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:50,982 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:21:50,982 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:21:50,984 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,985 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,986 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,986 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,987 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,988 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,989 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:21:50,989 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:21:50,989 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:21:50,990 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,992 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:21:50,992 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:50,994 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:21:50,994 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:50,995 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:50,995 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:50,995 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:21:50,995 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:21:50,996 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 51.1ms
2025-11-24 19:21:50,996 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 51.0ms
2025-11-24 19:21:50,997 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 51.0ms
2025-11-24 19:21:54,292 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:21:54,293 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.9ms
2025-11-24 19:21:54,303 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:21:54,305 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:54,307 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:54,308 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:54,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:54,309 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:54,314 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:54,314 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:54,315 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 19:21:54,316 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 401 13.8ms
2025-11-24 19:21:54,799 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:21:54,801 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.2ms
2025-11-24 19:21:54,801 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:21:54,801 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:21:54,802 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:21:54,803 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.3ms
2025-11-24 19:21:54,804 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.2ms
2025-11-24 19:21:54,804 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.2ms
2025-11-24 19:21:54,808 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:21:54,809 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:54,809 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:54,809 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:54,809 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:54,809 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:54,811 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:54,811 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:54,811 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:21:54,812 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,814 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,815 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,816 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,817 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:21:54,818 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:21:54,818 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,819 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:21:54,819 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:21:54,819 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:21:54,820 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:54,820 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:54,821 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:54,821 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:54,821 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:54,822 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:54,822 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:54,823 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:21:54,823 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:21:54,823 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:21:54,824 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,825 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,826 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,827 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,829 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:21:54,829 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:21:54,829 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,831 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:21:54,831 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:21:54,832 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:54,832 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:54,832 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:54,832 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:54,832 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:54,833 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:54,833 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:54,834 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:21:54,834 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:54,834 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:54,834 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:54,834 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:54,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:54,836 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:54,836 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:54,836 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:21:54,837 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,838 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,839 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,840 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,841 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,842 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,844 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:21:54,844 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:21:54,844 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:21:54,844 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,847 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:21:54,847 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,849 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:21:54,849 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:54,849 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:54,849 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:54,849 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:21:54,850 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:21:54,850 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,851 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,852 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,853 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,854 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,855 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,855 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:21:54,856 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:21:54,856 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:21:54,856 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,858 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:21:54,858 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:54,860 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:21:54,860 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:54,860 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:54,860 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:21:54,861 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:21:54,861 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:21:54,862 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 54.0ms
2025-11-24 19:21:54,863 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 43.3ms
2025-11-24 19:21:54,864 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 41.2ms
2025-11-24 19:21:54,864 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 41.1ms
2025-11-24 19:21:55,381 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:21:55,382 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:21:55,382 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 1.3ms
2025-11-24 19:21:55,383 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-11-24 19:21:55,385 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:21:55,386 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:55,386 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:55,386 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:55,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:55,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:55,388 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:55,388 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:55,388 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 19:21:55,389 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:21:55,389 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:55,390 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:55,391 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:55,392 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:55,393 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-24 19:21:55,393 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-24 19:21:55,393 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:55,394 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:21:55,394 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:21:55,396 - app.services.base_service - ERROR - DatabaseError en get_branding_by_cliente: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:21:55,397 - app.api.v1.endpoints.clientes - ERROR - Error inesperado en obtener_branding_tenant: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\clientes.py", line 512, in obtener_branding_tenant
    branding = await ClienteService.get_branding_by_cliente(cliente_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:21:55,399 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:21:55,399 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:21:55,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:21:55,400 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:21:55,400 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:21:55,401 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:21:55,401 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:21:55,401 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:21:55,402 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:55,403 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:55,404 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:55,405 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:55,406 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:21:55,406 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:21:55,406 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:21:55,407 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:21:55,408 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:21:55,408 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 23.1ms
2025-11-24 19:21:55,409 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.5ms
2025-11-24 19:53:39,268 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 19:53:39,269 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-24 19:53:39,271 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 19:53:39,272 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:39,272 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:39,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:39,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:39,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:39,298 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:39,301 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 19:53:39,301 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:39,301 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 19:53:39,303 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,323 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 2, Usuario 1, Tipo: web
2025-11-24 19:53:39,323 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,327 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_acme (Cliente: 2, Level: 4, Type: tenant_admin)
2025-11-24 19:53:39,327 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,340 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:53:39,340 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,342 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,359 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:53:39,359 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 24, Rotación: True
2025-11-24 19:53:39,359 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,365 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 19:53:39,366 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 19:53:39,367 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 19:53:39,367 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 24
2025-11-24 19:53:39,367 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_acme
2025-11-24 19:53:39,368 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 97.0ms
2025-11-24 19:53:39,374 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 19:53:39,374 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-24 19:53:39,394 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 19:53:39,395 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:39,395 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:39,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:39,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:39,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:39,397 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:39,398 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:39,398 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/me/
2025-11-24 19:53:39,398 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,402 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_acme
2025-11-24 19:53:39,402 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-24 19:53:39,403 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 2
2025-11-24 19:53:39,403 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,409 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,414 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,419 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 19:53:39,420 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_acme, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-24 19:53:39,420 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 26.0ms
2025-11-24 19:53:39,434 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:53:39,435 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.6ms
2025-11-24 19:53:39,440 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:53:39,441 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:39,441 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:39,441 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:39,441 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:39,441 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:39,443 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:39,443 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:39,443 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 19:53:39,444 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,445 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,447 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,448 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,450 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-24 19:53:39,450 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-24 19:53:39,450 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,452 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:53:39,452 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:53:39,454 - app.services.base_service - ERROR - DatabaseError en get_branding_by_cliente: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:53:39,455 - app.api.v1.endpoints.clientes - ERROR - Error inesperado en obtener_branding_tenant: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\clientes.py", line 512, in obtener_branding_tenant
    branding = await ClienteService.get_branding_by_cliente(cliente_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:53:39,457 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 17.2ms
2025-11-24 19:53:39,459 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:53:39,459 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.8ms
2025-11-24 19:53:39,461 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:53:39,462 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.5ms
2025-11-24 19:53:39,465 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:53:39,466 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:53:39,469 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 4.1ms
2025-11-24 19:53:39,470 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 3.5ms
2025-11-24 19:53:39,471 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:53:39,474 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:39,474 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:39,475 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:39,475 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:39,475 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:39,476 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:39,476 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:39,476 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:53:39,477 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,479 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,480 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,481 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,482 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:53:39,483 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:53:39,483 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,499 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:53:39,500 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:53:39,501 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:53:39,502 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:53:39,502 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:39,503 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:39,503 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:39,503 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:39,503 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:39,504 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:39,504 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:39,504 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:53:39,504 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:39,505 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:39,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:39,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:39,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:39,506 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:39,506 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:39,506 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:53:39,506 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:53:39,507 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 35.8ms
2025-11-24 19:53:39,507 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,508 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,509 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,509 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,510 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,511 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,513 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:53:39,513 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:53:39,513 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:53:39,513 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,517 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:53:39,517 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,521 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:53:39,521 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:53:39,521 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:53:39,521 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:53:39,521 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:53:39,521 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:53:39,522 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,523 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,524 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,525 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,526 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,526 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,527 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:53:39,528 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:53:39,528 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:53:39,528 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,530 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:53:39,530 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,532 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:53:39,532 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:53:39,532 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:53:39,532 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:53:39,532 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:53:39,532 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:53:39,533 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:39,533 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:39,534 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:39,534 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:39,534 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:39,535 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:39,535 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:39,535 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:53:39,537 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,538 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,539 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,540 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,541 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:53:39,541 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:53:39,541 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:39,543 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:53:39,543 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:53:39,544 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 42.2ms
2025-11-24 19:53:39,544 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 42.3ms
2025-11-24 19:53:39,545 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 39.1ms
2025-11-24 19:53:43,029 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 19:53:43,030 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-11-24 19:53:43,031 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 19:53:43,032 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:43,032 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:43,032 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:43,032 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:43,032 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:43,033 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:43,034 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:43,034 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 19:53:43,034 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:43,036 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:43,037 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 19:53:43,038 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 19:53:43,038 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 19:53:43,039 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 7.4ms
2025-11-24 19:53:51,710 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 19:53:51,710 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-24 19:53:51,713 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 19:53:51,713 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:51,714 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:51,714 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:51,714 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:51,714 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:51,715 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:51,716 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:51,716 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 19:53:51,720 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 19:53:51,720 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 19:53:51,720 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 19:53:51,720 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:51,942 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:51,946 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:51,947 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:53:51,947 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 19:53:51,947 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:51,950 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:51,951 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:53:51,952 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:51,952 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:53:51,953 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 25, Rotación: False
2025-11-24 19:53:51,953 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 25
2025-11-24 19:53:51,953 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 19:53:51,954 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 241.0ms
2025-11-24 19:53:51,965 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:53:51,965 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.7ms
2025-11-24 19:53:51,968 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:53:51,968 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:51,968 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:51,969 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:51,969 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:51,969 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:51,970 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:51,970 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:51,971 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 19:53:51,971 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:51,973 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:51,974 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:51,977 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:51,979 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-24 19:53:51,980 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-24 19:53:51,980 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:51,982 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:53:51,982 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:53:51,984 - app.services.base_service - ERROR - DatabaseError en get_branding_by_cliente: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:53:51,985 - app.api.v1.endpoints.clientes - ERROR - Error inesperado en obtener_branding_tenant: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\clientes.py", line 512, in obtener_branding_tenant
    branding = await ClienteService.get_branding_by_cliente(cliente_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:53:51,988 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:53:51,989 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 21.7ms
2025-11-24 19:53:51,990 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.7ms
2025-11-24 19:53:51,990 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:53:51,990 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:53:51,991 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:53:51,993 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.8ms
2025-11-24 19:53:51,993 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.9ms
2025-11-24 19:53:51,993 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.8ms
2025-11-24 19:53:52,000 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:53:52,001 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:53:52,002 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:52,002 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:52,002 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:52,002 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:52,002 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:52,004 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:52,004 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:52,004 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:53:52,004 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:52,005 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:52,005 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:52,005 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:52,005 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:52,006 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:52,007 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:52,007 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:53:52,008 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,010 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,012 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,013 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,014 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:53:52,014 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:53:52,015 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,016 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:53:52,016 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:53:52,017 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,018 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,019 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,020 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,021 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:53:52,021 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:53:52,022 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,023 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:53:52,023 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:53:52,024 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:53:52,024 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:53:52,025 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:52,025 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:52,025 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:52,025 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:52,025 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:52,027 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:52,027 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:52,027 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:53:52,028 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:53:52,028 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:53:52,028 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:53:52,029 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:53:52,029 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:53:52,030 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:53:52,030 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:53:52,030 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:53:52,031 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,032 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,033 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,034 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,035 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,036 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,037 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:53:52,037 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:53:52,037 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:53:52,037 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,039 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:53:52,040 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,041 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:53:52,042 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:53:52,042 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:53:52,042 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:53:52,042 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:53:52,042 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:53:52,043 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,044 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,045 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,046 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,047 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,048 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,049 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:53:52,049 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:53:52,049 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:53:52,050 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,051 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:53:52,051 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:53:52,053 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:53:52,053 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:53:52,053 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:53:52,053 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:53:52,054 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:53:52,054 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:53:52,055 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 54.9ms
2025-11-24 19:53:52,055 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 54.3ms
2025-11-24 19:53:52,056 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 32.5ms
2025-11-24 19:53:52,057 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 32.4ms
2025-11-24 19:55:54,973 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-24 19:55:54,973 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:55:54,973 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 19:55:54,973 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 19:55:54,974 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:55:54,974 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 19:55:54,974 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 19:55:54,974 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:55:54,974 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-24 19:55:54,975 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.0ms
2025-11-24 19:55:55,056 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-24 19:55:55,057 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:55:55,057 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 19:55:55,057 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 19:55:55,058 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:55:55,058 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 19:55:55,058 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 19:55:55,058 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:55:55,058 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-24 19:55:55,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 205.6ms
2025-11-24 19:56:25,012 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:56:25,012 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:56:25,013 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-24 19:56:25,013 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-24 19:56:25,013 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:56:25,013 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-24 19:56:25,013 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-24 19:56:25,013 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:56:25,014 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 19:56:25,014 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 401 2.4ms
2025-11-24 19:57:05,584 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 19:57:05,584 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.4ms
2025-11-24 19:57:05,586 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 19:57:05,586 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:57:05,587 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:57:05,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:57:05,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:57:05,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:57:05,605 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:57:05,605 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:57:05,606 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 19:57:05,606 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:05,617 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:05,630 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 19:57:05,630 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 19:57:05,631 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 19:57:05,631 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 45.0ms
2025-11-24 19:57:15,601 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 19:57:15,601 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-24 19:57:15,603 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 19:57:15,604 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:57:15,604 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:57:15,604 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:57:15,604 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:57:15,604 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:57:15,606 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:57:15,606 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:57:15,606 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 19:57:15,610 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 19:57:15,610 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 19:57:15,610 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 19:57:15,610 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,828 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,831 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,835 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:57:15,836 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 19:57:15,836 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,840 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,841 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 19:57:15,842 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,844 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:57:15,845 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 26, Rotación: False
2025-11-24 19:57:15,845 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 26
2025-11-24 19:57:15,845 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 19:57:15,846 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 242.3ms
2025-11-24 19:57:15,856 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:57:15,857 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.8ms
2025-11-24 19:57:15,859 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:57:15,860 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:57:15,860 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:57:15,860 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:57:15,860 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:57:15,861 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:57:15,862 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:57:15,862 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:57:15,862 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 19:57:15,863 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,865 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,867 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,869 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,871 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-24 19:57:15,873 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-24 19:57:15,873 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,875 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:57:15,876 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:57:15,878 - app.services.base_service - ERROR - DatabaseError en get_branding_by_cliente: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:57:15,879 - app.api.v1.endpoints.clientes - ERROR - Error inesperado en obtener_branding_tenant: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\clientes.py", line 512, in obtener_branding_tenant
    branding = await ClienteService.get_branding_by_cliente(cliente_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 19:57:15,882 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:57:15,883 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 24.1ms
2025-11-24 19:57:15,884 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.9ms
2025-11-24 19:57:15,884 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:57:15,884 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:57:15,885 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 19:57:15,886 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.0ms
2025-11-24 19:57:15,886 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.0ms
2025-11-24 19:57:15,887 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.9ms
2025-11-24 19:57:15,894 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:57:15,895 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:57:15,895 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:57:15,895 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:57:15,895 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:57:15,896 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:57:15,897 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:57:15,897 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:57:15,898 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:57:15,899 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,900 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,905 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,920 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,924 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:57:15,924 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:57:15,925 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,932 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:57:15,932 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:57:15,933 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:57:15,934 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:57:15,934 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:57:15,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:57:15,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:57:15,935 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:57:15,936 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:57:15,936 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:57:15,936 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 19:57:15,937 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,939 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,940 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,941 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,942 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 19:57:15,943 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:57:15,943 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,944 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 19:57:15,945 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 19:57:15,945 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:57:15,945 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 19:57:15,946 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:57:15,946 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:57:15,947 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:57:15,947 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:57:15,947 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:57:15,948 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:57:15,948 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:57:15,948 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:57:15,949 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:57:15,949 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:57:15,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:57:15,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:57:15,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:57:15,950 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:57:15,950 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:57:15,951 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 19:57:15,951 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 57.4ms
2025-11-24 19:57:15,952 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,953 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,955 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,956 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,957 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,958 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,960 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:57:15,960 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:57:15,960 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:57:15,960 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,964 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:57:15,964 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,968 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:57:15,969 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:57:15,969 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:57:15,969 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:57:15,969 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:57:15,969 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:57:15,970 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,971 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,973 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,974 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,975 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,976 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,977 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 19:57:15,977 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 19:57:15,977 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 19:57:15,977 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,979 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 19:57:15,979 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:57:15,981 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 19:57:15,982 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:57:15,982 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:57:15,982 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 19:57:15,982 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 19:57:15,982 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 19:57:15,983 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 50.3ms
2025-11-24 19:57:15,985 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 39.6ms
2025-11-24 19:57:15,985 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 39.6ms
2025-11-24 19:58:30,165 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 19:58:30,165 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-24 19:58:30,167 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 19:58:30,167 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:58:30,168 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 19:58:30,168 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 19:58:30,168 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:58:30,168 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 19:58:30,195 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 19:58:30,196 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 19:58:30,196 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 19:58:30,197 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:58:30,208 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 19:58:30,219 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 19:58:30,219 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 19:58:30,219 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 19:58:30,220 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 53.1ms
2025-11-24 19:58:39,618 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 19:58:39,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-24 19:58:39,621 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 19:58:39,621 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:58:39,621 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:58:39,621 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:58:39,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:58:39,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:58:39,622 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:58:39,622 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:58:39,622 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 19:58:39,625 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 19:58:39,625 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 19:58:39,625 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 19:58:39,884 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 19:58:39,885 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-24 19:58:39,885 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-24 19:58:39,886 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 19:58:39,895 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:58:39,896 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11356, Rotación: False
2025-11-24 19:58:39,896 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11356
2025-11-24 19:58:39,896 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-24 19:58:39,897 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 275.9ms
2025-11-24 19:58:53,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 19:58:53,565 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-24 19:58:53,568 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 19:58:53,568 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:58:53,568 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:58:53,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:58:53,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:58:53,569 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:58:53,569 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:58:53,569 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:58:53,569 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 19:58:53,571 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 19:58:53,571 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 19:58:53,571 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 19:58:53,785 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 19:58:53,785 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-24 19:58:53,785 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-24 19:58:53,786 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 19:58:53,787 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:58:53,788 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11357, Rotación: False
2025-11-24 19:58:53,788 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11357
2025-11-24 19:58:53,788 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-24 19:58:53,789 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 221.0ms
2025-11-24 19:59:17,801 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 19:59:17,801 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.4ms
2025-11-24 19:59:17,803 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 19:59:17,803 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:59:17,803 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:59:17,804 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:59:17,804 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:59:17,804 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:59:17,804 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:59:17,804 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:59:17,805 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 19:59:17,811 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 19:59:17,811 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 19:59:17,811 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 19:59:18,036 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 19:59:18,037 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-24 19:59:18,037 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-24 19:59:18,038 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 19:59:18,041 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:59:18,041 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11358, Rotación: False
2025-11-24 19:59:18,041 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11358
2025-11-24 19:59:18,042 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-24 19:59:18,042 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 239.4ms
2025-11-24 19:59:31,787 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'admin', 'assets', 'cdn', 'static', 'www', 'api', 'backend'}
2025-11-24 19:59:38,171 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 19:59:38,172 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.2ms
2025-11-24 19:59:38,176 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 19:59:38,177 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:59:38,177 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:59:38,177 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:59:38,177 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:59:38,178 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:59:38,178 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:59:38,178 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:59:38,178 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 19:59:38,285 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 19:59:38,287 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 19:59:38,287 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 19:59:38,288 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:59:38,289 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11359, Rotación: True
2025-11-24 19:59:38,293 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 19:59:38,294 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 19:59:38,294 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 19:59:38,294 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11359
2025-11-24 19:59:38,294 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 19:59:38,295 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 19:59:38,295 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 119.5ms
2025-11-24 19:59:38,296 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-24 19:59:38,298 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 19:59:38,298 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:59:38,298 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': innova.app.local:5173
2025-11-24 19:59:38,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-11-24 19:59:38,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:59:38,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-24 19:59:38,301 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-24 19:59:38,304 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 3: multi - bd_cliente_innova
2025-11-24 19:59:38,304 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-24 19:59:38,305 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/refresh/
2025-11-24 19:59:38,305 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 19:59:38,306 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.7ms
2025-11-24 19:59:38,308 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-24 19:59:38,334 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 3
2025-11-24 19:59:38,334 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 19:59:38,335 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 37.6ms
2025-11-24 19:59:38,335 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 19:59:38,336 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:59:38,336 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:59:38,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:59:38,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:59:38,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:59:38,337 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:59:38,337 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:59:38,337 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-24 19:59:38,340 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-24 19:59:38,340 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-24 19:59:38,340 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-24 19:59:38,351 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 19:59:38,351 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-24 19:59:38,352 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 17.1ms
2025-11-24 19:59:38,361 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:59:38,362 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-11-24 19:59:38,365 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:59:38,365 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:59:38,365 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:59:38,365 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:59:38,365 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:59:38,366 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:59:38,366 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:59:38,366 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:59:38,366 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 19:59:38,382 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 19:59:38,382 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 19:59:38,383 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 19:59:38,383 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 18.8ms
2025-11-24 19:59:47,917 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 19:59:47,918 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-24 19:59:47,920 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 19:59:47,920 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:59:47,920 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:59:47,920 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:59:47,920 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:59:47,920 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:59:47,921 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:59:47,921 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:59:47,921 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 19:59:47,926 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 19:59:47,926 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 19:59:47,927 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 19:59:48,163 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 19:59:48,163 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-24 19:59:48,163 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-24 19:59:48,164 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 19:59:48,166 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 19:59:48,166 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11360, Rotación: False
2025-11-24 19:59:48,166 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11360
2025-11-24 19:59:48,166 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-24 19:59:48,167 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 247.3ms
2025-11-24 19:59:48,179 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 19:59:48,179 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.6ms
2025-11-24 19:59:48,182 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 19:59:48,182 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:59:48,182 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:59:48,183 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:59:48,183 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:59:48,183 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:59:48,183 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:59:48,184 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:59:48,184 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 19:59:48,189 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 19:59:48,190 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 19:59:48,191 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 19:59:48,192 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 10.3ms
2025-11-24 19:59:48,207 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:59:48,208 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.8ms
2025-11-24 19:59:48,210 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 19:59:48,211 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.7ms
2025-11-24 19:59:48,212 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:59:48,212 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:59:48,213 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:59:48,213 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:59:48,213 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:59:48,213 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:59:48,213 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:59:48,214 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:59:48,214 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:59:48,219 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 19:59:48,220 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:59:48,269 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 19:59:48,270 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 19:59:48,271 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 59.1ms
2025-11-24 19:59:48,271 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 19:59:48,271 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 19:59:48,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 19:59:48,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 19:59:48,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 19:59:48,272 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 19:59:48,272 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 19:59:48,272 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 19:59:48,276 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 19:59:48,276 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 19:59:48,277 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 19:59:48,278 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.6ms
2025-11-24 20:00:04,504 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 20:00:04,504 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-24 20:00:04,506 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 20:00:04,506 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:00:04,507 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 20:00:04,507 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 20:00:04,507 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:00:04,507 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 20:00:04,507 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 20:00:04,507 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 20:00:04,507 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-24 20:00:04,522 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 20:00:04,523 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 20:00:04,523 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-24 20:00:04,524 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 17.8ms
2025-11-24 20:00:06,332 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 20:00:06,333 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-24 20:00:06,335 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 20:00:06,336 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:00:06,336 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:00:06,336 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:00:06,336 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:00:06,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:00:06,341 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:00:06,344 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 20:00:06,344 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:00:06,345 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 20:00:06,347 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-24 20:00:06,348 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 12.5ms
2025-11-24 20:00:14,688 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 20:00:14,689 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-24 20:00:14,693 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 20:00:14,694 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:00:14,694 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:00:14,695 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:00:14,695 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:00:14,695 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:00:14,700 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:00:14,701 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:00:14,701 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 20:00:14,705 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 20:00:14,706 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 20:00:14,706 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 20:00:14,706 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,014 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,017 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,022 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 20:00:15,022 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 20:00:15,022 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,027 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,028 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 20:00:15,029 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,032 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 20:00:15,032 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 27, Rotación: False
2025-11-24 20:00:15,033 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 27
2025-11-24 20:00:15,033 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 20:00:15,033 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 340.6ms
2025-11-24 20:00:15,046 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 20:00:15,046 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.6ms
2025-11-24 20:00:15,049 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 20:00:15,050 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:00:15,050 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:00:15,050 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:00:15,050 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:00:15,051 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:00:15,052 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:00:15,052 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:00:15,053 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 20:00:15,054 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,058 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,061 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,062 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,064 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-24 20:00:15,064 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-24 20:00:15,065 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,066 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 20:00:15,071 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 20:00:15,113 - app.services.base_service - ERROR - DatabaseError en get_branding_by_cliente: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 20:00:15,137 - app.api.v1.endpoints.clientes - ERROR - Error inesperado en obtener_branding_tenant: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\clientes.py", line 512, in obtener_branding_tenant
    branding = await ClienteService.get_branding_by_cliente(cliente_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 20:00:15,152 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 20:00:15,154 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 104.5ms
2025-11-24 20:00:15,154 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.5ms
2025-11-24 20:00:15,154 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 20:00:15,154 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 20:00:15,154 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 20:00:15,156 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.6ms
2025-11-24 20:00:15,156 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.6ms
2025-11-24 20:00:15,156 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.5ms
2025-11-24 20:00:15,160 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 20:00:15,161 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 20:00:15,162 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:00:15,162 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:00:15,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:00:15,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:00:15,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:00:15,164 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:00:15,164 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:00:15,164 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 20:00:15,165 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,166 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,167 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,168 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,169 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 20:00:15,169 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 20:00:15,169 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,173 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 20:00:15,173 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 20:00:15,173 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:00:15,174 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:00:15,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:00:15,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:00:15,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:00:15,175 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:00:15,176 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:00:15,176 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 20:00:15,177 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,179 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,180 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,181 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,182 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 20:00:15,182 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 20:00:15,183 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,184 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 20:00:15,184 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 20:00:15,186 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:00:15,187 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:00:15,187 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:00:15,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:00:15,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:00:15,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:00:15,188 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:00:15,188 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:00:15,188 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:00:15,189 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:00:15,189 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 28.9ms
2025-11-24 20:00:15,190 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,191 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,192 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,194 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,195 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,196 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,197 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:00:15,197 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:00:15,197 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:00:15,197 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,200 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:00:15,200 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,204 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:00:15,204 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:00:15,204 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:00:15,204 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:00:15,205 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:00:15,205 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:00:15,205 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 44.4ms
2025-11-24 20:00:15,206 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:00:15,206 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:00:15,206 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:00:15,206 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:00:15,206 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:00:15,207 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:00:15,208 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:00:15,208 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:00:15,209 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,211 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,212 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,213 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,214 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,214 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,215 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:00:15,215 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:00:15,215 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:00:15,215 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,217 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:00:15,217 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:15,219 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:00:15,219 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:00:15,219 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:00:15,219 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:00:15,219 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:00:15,219 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:00:15,221 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 35.1ms
2025-11-24 20:00:15,222 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 33.1ms
2025-11-24 20:00:21,498 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 20:00:21,498 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-24 20:00:21,513 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 20:00:21,513 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:00:21,513 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:00:21,514 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:00:21,514 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:00:21,514 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:00:21,515 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:00:21,515 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:00:21,515 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 20:00:21,516 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:21,518 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:00:21,523 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 20:00:21,523 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 20:00:21,523 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 20:00:21,524 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 11.4ms
2025-11-24 20:01:14,093 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 20:01:14,093 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.4ms
2025-11-24 20:01:14,095 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 20:01:14,096 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:01:14,096 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:01:14,096 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:01:14,096 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:01:14,096 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:01:14,102 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:01:14,102 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:01:14,102 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 20:01:14,106 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 20:01:14,106 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 20:01:14,106 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 20:01:14,107 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,329 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,332 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,337 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 20:01:14,338 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 20:01:14,338 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,341 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,342 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 20:01:14,343 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,345 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 20:01:14,346 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 28, Rotación: False
2025-11-24 20:01:14,346 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 28
2025-11-24 20:01:14,346 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 20:01:14,347 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 252.0ms
2025-11-24 20:01:14,361 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 20:01:14,362 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.9ms
2025-11-24 20:01:14,365 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 20:01:14,366 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:01:14,366 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:01:14,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:01:14,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:01:14,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:01:14,368 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:01:14,369 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:01:14,369 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 20:01:14,370 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,372 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,380 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,382 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,384 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-24 20:01:14,384 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-24 20:01:14,384 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,386 - app.db.queries - ERROR - Error en execute_query: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 20:01:14,386 - app.db.connection - ERROR - Error general en la gestión de conexión: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\connection.py", line 63, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 20:01:14,388 - app.services.base_service - ERROR - DatabaseError en get_branding_by_cliente: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 20:01:14,389 - app.api.v1.endpoints.clientes - ERROR - Error inesperado en obtener_branding_tenant: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 18, in execute_query
    cursor.execute(query, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
pyodbc.ProgrammingError: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\v1\endpoints\clientes.py", line 512, in obtener_branding_tenant
    branding = await ClienteService.get_branding_by_cliente(cliente_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\base_service.py", line 36, in wrapper
    return await func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\services\cliente_service.py", line 658, in get_branding_by_cliente
    resultado = execute_query(query, (cliente_id,))
  File "D:\base_multi_tenant_fastapi\app\db\queries.py", line 23, in execute_query
    raise DatabaseError(
    ...<2 lines>...
    )
app.core.exceptions.DatabaseError: Error en la consulta: ('42S02', "[42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid object name 'cliente'. (208) (SQLExecDirectW); [42S02] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-24 20:01:14,392 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 20:01:14,393 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 27.6ms
2025-11-24 20:01:14,393 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.3ms
2025-11-24 20:01:14,393 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 20:01:14,394 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 20:01:14,394 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 20:01:14,396 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.7ms
2025-11-24 20:01:14,396 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.5ms
2025-11-24 20:01:14,397 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.5ms
2025-11-24 20:01:14,411 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 20:01:14,417 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 20:01:14,420 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:01:14,423 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:01:14,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:01:14,430 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:01:14,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:01:14,438 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:01:14,439 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:01:14,439 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 20:01:14,440 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:01:14,440 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:01:14,441 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:01:14,441 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:01:14,441 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:01:14,444 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:01:14,445 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:01:14,445 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 20:01:14,446 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,449 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,451 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,452 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,454 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 20:01:14,454 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 20:01:14,454 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,461 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 20:01:14,462 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 20:01:14,465 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,467 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,468 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,469 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,470 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 20:01:14,470 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 20:01:14,470 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,472 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 20:01:14,472 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 20:01:14,472 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:01:14,473 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:01:14,473 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:01:14,473 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:01:14,473 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:01:14,474 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:01:14,475 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:01:14,475 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:01:14,476 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:01:14,476 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:01:14,477 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,479 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,480 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,482 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,483 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,484 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,486 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:01:14,486 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:01:14,486 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:01:14,486 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,490 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:01:14,490 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,494 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:01:14,495 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:01:14,495 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:01:14,495 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:01:14,495 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:01:14,496 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:01:14,496 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:01:14,497 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:01:14,497 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:01:14,497 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:01:14,497 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:01:14,499 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:01:14,499 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:01:14,499 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:01:14,500 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 88.7ms
2025-11-24 20:01:14,501 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,502 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,508 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,511 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,517 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,519 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,520 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:01:14,520 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:01:14,521 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:01:14,521 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,523 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:01:14,524 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:01:14,527 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:01:14,527 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:01:14,527 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:01:14,527 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:01:14,527 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:01:14,528 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:01:14,528 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 111.0ms
2025-11-24 20:01:14,529 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 57.2ms
2025-11-24 20:01:14,531 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 55.2ms
2025-11-24 20:02:12,299 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'assets', 'admin', 'cdn', 'www', 'static', 'backend'}
2025-11-24 20:02:43,477 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 20:02:43,478 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 20:02:43,479 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 2.4ms
2025-11-24 20:02:43,480 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.3ms
2025-11-24 20:02:43,485 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:02:43,487 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:02:43,487 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:02:43,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:02:43,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:02:43,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:02:43,691 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:02:43,695 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 20:02:43,696 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:02:43,696 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 20:02:43,699 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,729 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,731 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,733 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,735 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,736 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,737 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:02:43,737 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 20:02:43,737 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,740 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,744 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 20:02:43,744 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 20:02:43,745 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:02:43,746 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:02:43,746 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:02:43,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:02:43,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:02:43,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:02:43,747 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:02:43,748 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:02:43,748 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 20:02:43,749 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,750 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,751 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,753 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,754 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,755 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,756 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:02:43,756 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 20:02:43,756 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,758 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:43,760 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 20:02:43,760 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 20:02:43,761 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 275.1ms
2025-11-24 20:02:43,762 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.5ms
2025-11-24 20:02:44,414 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 20:02:44,415 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 20:02:44,415 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.1ms
2025-11-24 20:02:44,416 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.3ms
2025-11-24 20:02:44,418 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:02:44,419 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:02:44,419 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:02:44,420 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:02:44,420 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:02:44,420 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:02:44,422 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:02:44,422 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:02:44,422 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:02:44,423 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,425 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,426 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,427 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,429 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,430 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,431 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:02:44,431 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:02:44,431 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:02:44,432 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,435 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:02:44,435 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,439 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:02:44,439 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:02:44,440 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:02:44,440 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:02:44,440 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:02:44,440 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:02:44,441 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:02:44,441 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:02:44,441 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:02:44,441 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:02:44,441 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:02:44,442 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:02:44,442 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:02:44,443 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:02:44,443 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:02:44,443 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,444 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,445 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,446 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,447 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,447 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,448 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:02:44,448 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:02:44,449 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:02:44,449 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,451 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:02:44,451 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:44,453 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:02:44,454 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:02:44,454 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:02:44,454 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:02:44,454 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:02:44,454 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:02:44,455 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 36.5ms
2025-11-24 20:02:44,456 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.2ms
2025-11-24 20:02:47,229 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 20:02:47,230 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.7ms
2025-11-24 20:02:47,232 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 20:02:47,232 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:02:47,232 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:02:47,232 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:02:47,233 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:02:47,233 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:02:47,234 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:02:47,234 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:02:47,234 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 20:02:47,235 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:47,238 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:02:47,242 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 20:02:47,243 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 20:02:47,243 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 20:02:47,243 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 11.8ms
2025-11-24 20:02:55,777 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'backend', 'admin', 'static', 'cdn', 'assets', 'www'}
2025-11-24 20:03:07,182 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 20:03:07,183 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.8ms
2025-11-24 20:03:07,185 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 20:03:07,185 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:07,185 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:07,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:07,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:07,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:07,210 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:07,213 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 20:03:07,213 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:07,214 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-24 20:03:07,221 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-24 20:03:07,221 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-24 20:03:07,221 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-24 20:03:07,222 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,472 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,475 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,480 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 20:03:07,480 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 20:03:07,480 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,483 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,484 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-24 20:03:07,486 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,490 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 20:03:07,490 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 29, Rotación: False
2025-11-24 20:03:07,490 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 29
2025-11-24 20:03:07,491 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-24 20:03:07,492 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 306.8ms
2025-11-24 20:03:07,503 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 20:03:07,504 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.9ms
2025-11-24 20:03:07,506 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 20:03:07,507 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:07,507 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:07,507 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:07,508 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:07,508 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:07,509 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:07,509 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:07,510 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-24 20:03:07,511 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,513 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,515 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,517 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,518 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-24 20:03:07,519 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-24 20:03:07,521 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=2
2025-11-24 20:03:07,523 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 20:03:07,524 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 17.1ms
2025-11-24 20:03:07,524 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.3ms
2025-11-24 20:03:07,524 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 20:03:07,525 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 20:03:07,525 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 20:03:07,526 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.2ms
2025-11-24 20:03:07,527 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 2.1ms
2025-11-24 20:03:07,527 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.0ms
2025-11-24 20:03:07,530 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 20:03:07,530 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:07,531 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:07,531 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:07,531 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:07,531 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:07,532 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:07,533 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:07,533 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 20:03:07,534 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,537 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,545 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,547 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,548 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 20:03:07,549 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 20:03:07,549 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,551 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 20:03:07,552 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 20:03:07,553 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 20:03:07,554 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:03:07,555 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:03:07,556 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:07,556 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:07,556 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:07,556 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:07,557 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:07,558 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:07,558 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:07,558 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-24 20:03:07,559 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:07,559 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:07,559 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:07,559 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:07,559 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:07,560 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:07,560 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:07,560 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:03:07,561 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 31.6ms
2025-11-24 20:03:07,562 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,563 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,563 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,564 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,565 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-24 20:03:07,565 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 20:03:07,565 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,566 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-24 20:03:07,566 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-24 20:03:07,567 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,568 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,569 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,570 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,570 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,571 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,572 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:07,573 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:07,573 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:03:07,573 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,575 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:03:07,575 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,576 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:03:07,576 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:07,577 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:07,577 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:07,577 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:03:07,577 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:03:07,577 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:07,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:07,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:07,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:07,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:07,579 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:07,579 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:07,579 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:03:07,580 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,582 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,583 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,584 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,585 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:07,585 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:07,585 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:03:07,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,586 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:03:07,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:07,589 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:03:07,589 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:07,589 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:07,589 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:07,590 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:03:07,590 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:03:07,591 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 37.6ms
2025-11-24 20:03:07,591 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 37.3ms
2025-11-24 20:03:07,592 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 36.1ms
2025-11-24 20:03:13,034 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 20:03:13,034 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.7ms
2025-11-24 20:03:13,036 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 20:03:13,036 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.7ms
2025-11-24 20:03:13,039 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:03:13,040 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:13,040 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:13,041 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:13,041 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:13,041 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:13,042 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:13,043 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:13,043 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 20:03:13,044 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,046 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,047 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,048 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,049 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,050 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,051 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:03:13,052 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 20:03:13,052 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,054 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,056 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 20:03:13,056 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 20:03:13,057 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:03:13,058 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:13,058 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:13,058 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:13,058 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:13,058 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:13,060 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:13,060 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:13,060 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 20:03:13,061 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,062 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,063 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,064 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,065 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,066 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,067 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:03:13,067 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 20:03:13,067 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,069 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:13,071 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 20:03:13,072 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 20:03:13,072 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 33.6ms
2025-11-24 20:03:13,073 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.6ms
2025-11-24 20:03:14,142 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 20:03:14,143 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.1ms
2025-11-24 20:03:14,143 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/list/
2025-11-24 20:03:14,145 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/list/ 200 1.5ms
2025-11-24 20:03:14,147 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 20:03:14,147 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:14,148 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:14,148 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:14,148 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:14,148 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:14,150 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:14,150 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:14,150 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 20:03:14,151 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,152 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,153 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,155 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,156 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,157 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,158 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 20:03:14,158 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 20:03:14,159 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,160 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 20:03:14,160 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 20:03:14,160 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/list/
2025-11-24 20:03:14,161 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:14,161 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:14,161 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:14,161 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:14,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:14,163 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:14,163 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:14,164 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/list/
2025-11-24 20:03:14,164 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,165 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,166 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,167 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,168 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,169 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,170 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/list/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 20:03:14,170 - app.services.area_service - INFO - Obteniendo lista simple de áreas activas para cliente 2
2025-11-24 20:03:14,171 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:14,172 - app.services.area_service - INFO - Lista simple obtenida para cliente 2: 2 áreas activas
2025-11-24 20:03:14,172 - app.api.v1.endpoints.areas - INFO - Lista simple de áreas recuperada para cliente 2 - Total: 2 áreas activas
2025-11-24 20:03:14,173 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 26.2ms
2025-11-24 20:03:14,174 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/list/ 200 13.2ms
2025-11-24 20:03:19,345 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:03:19,346 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:19,346 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:19,347 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:19,347 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:19,347 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:19,348 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:19,348 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:19,348 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 20:03:19,349 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,350 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,352 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,353 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,355 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,356 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,357 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:03:19,357 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 20:03:19,357 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,359 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,361 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 20:03:19,361 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 20:03:19,362 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.6ms
2025-11-24 20:03:19,364 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:03:19,364 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:19,365 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:19,365 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:19,365 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:19,365 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:19,366 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:19,367 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:19,367 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 20:03:19,367 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,369 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,370 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,371 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,372 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,373 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,373 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:03:19,374 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 20:03:19,374 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,376 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:19,377 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 20:03:19,377 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 20:03:19,378 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.7ms
2025-11-24 20:03:20,155 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:03:20,155 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:20,156 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:20,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:20,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:20,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:20,157 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:20,158 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:20,158 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:03:20,159 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,160 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,162 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,163 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,164 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,165 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,166 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:20,166 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:20,166 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:03:20,167 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,169 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:03:20,169 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,171 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:03:20,171 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:20,171 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:20,171 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:20,172 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:03:20,172 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:03:20,173 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.7ms
2025-11-24 20:03:20,174 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:03:20,175 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:20,175 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:20,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:20,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:20,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:20,176 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:20,176 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:20,177 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:03:20,177 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,178 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,179 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,180 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,181 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,182 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,183 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:20,183 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:20,183 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:03:20,184 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,186 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:03:20,186 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:20,188 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:03:20,188 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:20,188 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:20,188 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:20,188 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:03:20,189 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:03:20,189 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.0ms
2025-11-24 20:03:21,027 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 20:03:21,028 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.1ms
2025-11-24 20:03:21,030 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 20:03:21,030 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 20:03:21,030 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 20:03:21,031 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.2ms
2025-11-24 20:03:21,031 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.2ms
2025-11-24 20:03:21,031 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.1ms
2025-11-24 20:03:21,032 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 20:03:21,034 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:21,035 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:21,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:21,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:21,036 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:21,037 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:21,037 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:21,038 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 20:03:21,039 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,040 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,041 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,042 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,043 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,044 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,045 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:21,046 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:21,046 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,048 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,057 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:21,057 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:21,057 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:21,058 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 20:03:21,058 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 20:03:21,058 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 20:03:21,059 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 20:03:21,060 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 27.7ms
2025-11-24 20:03:21,060 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:21,060 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:21,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:21,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:21,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:21,061 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:21,061 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:21,061 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 20:03:21,062 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,063 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,064 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,065 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,066 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,067 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,068 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 20:03:21,068 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,070 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 20:03:21,070 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 20:03:21,072 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.7ms
2025-11-24 20:03:21,072 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 20:03:21,073 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:21,073 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:21,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:21,074 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:21,074 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:21,075 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:21,075 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:21,075 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 20:03:21,076 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,077 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,078 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,078 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,079 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,080 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,081 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:21,081 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:21,081 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,083 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,086 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:21,086 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:21,086 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:21,087 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 20:03:21,087 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 20:03:21,087 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 20:03:21,088 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 20:03:21,088 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:21,088 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:21,089 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:21,089 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:21,089 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:21,090 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:21,090 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:21,090 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 20:03:21,091 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,092 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,093 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,093 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,094 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,095 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,095 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 20:03:21,096 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:21,096 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 20:03:21,096 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 20:03:21,097 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.6ms
2025-11-24 20:03:21,098 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.0ms
2025-11-24 20:03:27,844 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:03:27,845 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:27,845 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:27,845 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:27,845 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:27,846 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:27,849 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:27,849 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:27,850 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:03:27,850 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,852 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,853 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,854 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,855 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,856 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,857 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:27,857 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:27,858 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:03:27,858 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,861 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:03:27,861 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,865 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:03:27,865 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:27,866 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:27,866 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:27,866 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:03:27,866 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:03:27,867 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 22.5ms
2025-11-24 20:03:27,868 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:03:27,869 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:27,869 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:27,869 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:27,869 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:27,869 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:27,870 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:27,870 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:27,871 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:03:27,871 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,872 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,873 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,874 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,875 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,876 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,877 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:27,877 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:27,877 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:03:27,877 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,879 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:03:27,879 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:27,881 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:03:27,881 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:27,881 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:27,881 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:27,881 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:03:27,881 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:03:27,882 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.5ms
2025-11-24 20:03:28,577 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:03:28,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:28,578 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:28,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:28,578 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:28,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:28,580 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:28,580 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:28,580 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 20:03:28,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,582 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,583 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,588 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:03:28,588 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 20:03:28,588 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,595 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 20:03:28,595 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 20:03:28,596 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 18.9ms
2025-11-24 20:03:28,598 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:03:28,598 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:28,599 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:28,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:28,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:28,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:28,600 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:28,600 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:28,600 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 20:03:28,601 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,603 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,604 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,605 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,606 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,607 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,608 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:03:28,608 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 20:03:28,609 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,611 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:28,613 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 20:03:28,613 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 20:03:28,614 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.1ms
2025-11-24 20:03:35,598 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:03:35,599 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:35,599 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:35,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:35,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:35,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:35,601 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:35,601 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:35,601 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:03:35,602 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,604 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,605 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,606 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,607 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,608 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,608 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:35,609 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:35,609 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:03:35,609 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,611 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:03:35,611 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,613 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:03:35,614 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:35,614 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:35,614 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:35,614 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:03:35,614 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:03:35,615 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 16.7ms
2025-11-24 20:03:35,617 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:03:35,618 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:35,618 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:35,618 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:35,618 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:35,619 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:35,620 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:35,620 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:35,620 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:03:35,621 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,622 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,623 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,624 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,624 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,625 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,626 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:35,626 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:35,626 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:03:35,627 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,628 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:03:35,628 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:35,630 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:03:35,630 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:35,630 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:35,630 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:35,631 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:03:35,631 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:03:35,632 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.3ms
2025-11-24 20:03:36,524 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 20:03:36,525 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:36,525 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:36,526 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:36,526 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:36,526 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:36,527 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:36,527 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:36,527 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 20:03:36,528 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,529 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,531 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,532 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,533 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,535 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,536 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:36,536 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:36,536 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,539 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,547 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:36,548 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:36,548 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:36,548 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 20:03:36,548 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 20:03:36,549 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 20:03:36,550 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 20:03:36,551 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 26.6ms
2025-11-24 20:03:36,551 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:36,551 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:36,552 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:36,552 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:36,552 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:36,553 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:36,553 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:36,553 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 20:03:36,554 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,555 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,556 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,556 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,557 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,558 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,559 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 20:03:36,559 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,560 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 20:03:36,560 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 20:03:36,561 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.1ms
2025-11-24 20:03:36,562 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 20:03:36,563 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:36,563 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:36,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:36,564 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:36,564 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:36,565 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:36,565 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:36,565 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-24 20:03:36,566 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,568 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,569 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,570 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,571 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,571 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,572 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:36,572 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:36,573 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,574 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,577 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:36,577 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:36,577 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:36,577 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-24 20:03:36,578 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 20:03:36,578 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-24 20:03:36,579 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 20:03:36,579 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:36,579 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:36,579 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:36,580 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:36,580 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:36,580 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:36,581 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:36,581 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-24 20:03:36,581 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,583 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,584 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,588 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-24 20:03:36,588 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:36,589 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-24 20:03:36,589 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-24 20:03:36,589 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 27.0ms
2025-11-24 20:03:36,590 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.0ms
2025-11-24 20:03:37,603 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:03:37,604 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:37,604 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:37,604 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:37,605 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:37,605 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:37,612 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:37,612 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:37,613 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:03:37,614 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,615 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,617 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,619 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,620 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,621 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,622 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:37,622 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:37,623 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:03:37,623 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,625 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:03:37,625 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,626 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:03:37,626 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:37,627 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:37,627 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:37,627 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:03:37,627 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:03:37,628 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 24.5ms
2025-11-24 20:03:37,629 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:03:37,630 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:37,630 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:37,630 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:37,630 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:37,631 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:37,632 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:37,632 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:37,632 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-24 20:03:37,633 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,634 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,635 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,636 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,637 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,638 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,639 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:37,639 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-24 20:03:37,639 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-24 20:03:37,639 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,640 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-24 20:03:37,641 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:37,642 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-24 20:03:37,643 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:37,643 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:37,643 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-24 20:03:37,643 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-24 20:03:37,643 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-24 20:03:37,644 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.2ms
2025-11-24 20:03:38,081 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:03:38,082 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:38,082 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:38,082 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:38,082 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:38,082 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:38,084 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:38,084 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:38,084 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 20:03:38,085 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,086 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,087 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,088 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,090 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,091 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,092 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:03:38,092 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 20:03:38,092 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,094 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,096 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 20:03:38,096 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 20:03:38,097 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 15.8ms
2025-11-24 20:03:38,099 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:03:38,099 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:38,099 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:38,099 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:38,100 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:38,100 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:38,101 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:38,101 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:38,101 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-24 20:03:38,103 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,104 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,104 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,105 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,106 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,106 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,107 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:03:38,107 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-24 20:03:38,107 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,109 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:38,111 - app.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-24 20:03:38,111 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-24 20:03:38,111 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.6ms
2025-11-24 20:03:39,359 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 20:03:39,359 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:39,359 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 20:03:39,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 20:03:39,360 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:39,360 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 20:03:39,361 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 20:03:39,361 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 20:03:39,361 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-24 20:03:39,362 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:39,364 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 20:03:39,368 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 20:03:39,368 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-24 20:03:39,368 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-24 20:03:39,369 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 10.3ms
2025-11-24 20:03:47,171 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 20:03:47,172 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-24 20:03:47,174 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 20:03:47,174 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:47,175 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': global.app.local:5173
2025-11-24 20:03:47,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-24 20:03:47,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:47,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-24 20:03:47,178 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', Código='GLOBAL004', ID=5
2025-11-24 20:03:47,180 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 5: single - bd_sistema
2025-11-24 20:03:47,181 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:47,181 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 20:03:47,184 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-24 20:03:47,185 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 11.3ms
2025-11-24 20:03:49,539 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 20:03:49,540 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-24 20:03:49,542 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 20:03:49,542 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:49,543 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:49,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:49,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:49,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:49,546 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:49,548 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_sistema
2025-11-24 20:03:49,548 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:49,548 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 20:03:49,550 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-24 20:03:49,551 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 9.1ms
2025-11-24 20:03:56,938 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 20:03:56,939 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.7ms
2025-11-24 20:03:56,941 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 20:03:56,941 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:56,941 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:56,941 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:56,941 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:56,942 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:56,943 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:56,943 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:56,943 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/login/
2025-11-24 20:03:56,946 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-24 20:03:56,946 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-24 20:03:56,946 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-24 20:03:57,178 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-24 20:03:57,179 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-24 20:03:57,183 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-24 20:03:57,189 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 20:03:57,189 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 11361, Rotación: False
2025-11-24 20:03:57,189 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11361
2025-11-24 20:03:57,190 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-24 20:03:57,190 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 249.8ms
2025-11-24 20:03:57,200 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 20:03:57,200 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.7ms
2025-11-24 20:03:57,203 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 20:03:57,203 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:57,203 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:57,203 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:57,204 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:57,204 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:57,205 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:57,205 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:57,205 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/clientes/tenant/branding
2025-11-24 20:03:57,226 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=4 por usuario: admin_tech
2025-11-24 20:03:57,226 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=4
2025-11-24 20:03:57,228 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=4
2025-11-24 20:03:57,230 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 20:03:57,231 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 28.6ms
2025-11-24 20:03:57,232 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.7ms
2025-11-24 20:03:57,232 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 20:03:57,232 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-24 20:03:57,233 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 20:03:57,233 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 20:03:57,233 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-24 20:03:57,235 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 3.0ms
2025-11-24 20:03:57,235 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.9ms
2025-11-24 20:03:57,235 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.2ms
2025-11-24 20:03:57,235 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.3ms
2025-11-24 20:03:57,236 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.3ms
2025-11-24 20:03:57,240 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 20:03:57,240 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 20:03:57,241 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:57,241 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:57,241 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:57,242 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:57,242 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:57,243 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:57,243 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:57,243 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/menus/getmenu/
2025-11-24 20:03:57,244 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:57,244 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:57,244 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:57,244 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:57,244 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:57,245 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:57,245 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:57,246 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 20:03:57,249 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-24 20:03:57,249 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-24 20:03:57,315 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-24 20:03:57,324 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:57,324 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:03:57,334 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 2 usuarios únicos de 2 filas crudas
2025-11-24 20:03:57,335 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 20:03:57,335 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 20:03:57,336 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 20:03:57,337 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:57,337 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:57,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:57,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:57,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:57,339 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:57,339 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:57,339 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 20:03:57,344 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 20:03:57,347 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 20:03:57,347 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 20:03:57,348 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 107.8ms
2025-11-24 20:03:57,348 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 107.5ms
2025-11-24 20:03:57,349 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 12.6ms
2025-11-24 20:03:57,352 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 20:03:57,352 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 20:03:57,353 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 20:03:57,353 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:57,354 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:57,354 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:57,354 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:57,354 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:57,355 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:57,355 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:57,355 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 20:03:57,356 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:57,356 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:57,356 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:57,356 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:57,356 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:57,358 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:57,358 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:57,358 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 20:03:57,359 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:57,359 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:57,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:57,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:57,359 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:57,361 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:57,361 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:57,361 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/menus/getmenu/
2025-11-24 20:03:57,366 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:57,366 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:03:57,371 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 2 usuarios únicos de 2 filas crudas
2025-11-24 20:03:57,371 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 20:03:57,371 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 20:03:57,376 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 20:03:57,377 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 20:03:57,377 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 20:03:57,380 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-24 20:03:57,381 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-24 20:03:57,381 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-24 20:03:57,382 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 30.7ms
2025-11-24 20:03:57,383 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 30.4ms
2025-11-24 20:03:57,383 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.2ms
2025-11-24 20:03:59,148 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 20:03:59,148 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-24 20:03:59,149 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.1ms
2025-11-24 20:03:59,149 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.8ms
2025-11-24 20:03:59,152 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:03:59,152 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:59,152 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:59,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:59,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:59,153 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:59,155 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:59,155 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:59,155 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 20:03:59,162 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:59,162 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:03:59,162 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 20:03:59,166 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 20:03:59,170 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 20:03:59,170 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 20:03:59,170 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 20:03:59,171 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 19.3ms
2025-11-24 20:03:59,173 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:03:59,173 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:59,174 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:59,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:59,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:59,174 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:59,175 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:59,175 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:59,175 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 20:03:59,180 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:03:59,180 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:03:59,180 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 20:03:59,182 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 20:03:59,184 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 20:03:59,184 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 20:03:59,184 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 20:03:59,185 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 11.9ms
2025-11-24 20:03:59,780 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 20:03:59,781 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-24 20:03:59,781 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.2ms
2025-11-24 20:03:59,782 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.4ms
2025-11-24 20:03:59,783 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:03:59,784 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:59,784 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:59,784 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:59,785 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:59,785 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:59,786 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:59,786 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:59,787 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 20:03:59,793 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:03:59,794 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 20:03:59,797 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 20:03:59,797 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 20:03:59,797 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 14.0ms
2025-11-24 20:03:59,799 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:03:59,800 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:03:59,800 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:03:59,800 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:03:59,800 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:03:59,800 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:03:59,801 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:03:59,801 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:03:59,802 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 20:03:59,807 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:03:59,807 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 20:03:59,808 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 20:03:59,809 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 20:03:59,809 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 10.0ms
2025-11-24 20:04:00,853 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:04:00,854 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:00,854 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:00,854 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:00,854 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:00,854 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:00,856 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:00,856 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:00,856 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 20:04:00,863 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:04:00,863 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:04:00,863 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 20:04:00,865 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 20:04:00,867 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 20:04:00,867 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 20:04:00,867 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 20:04:00,868 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.9ms
2025-11-24 20:04:00,870 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:04:00,870 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:00,871 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:00,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:00,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:00,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:00,873 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:00,873 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:00,873 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 20:04:00,878 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:04:00,879 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:04:00,879 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 20:04:00,880 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 20:04:00,882 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 20:04:00,882 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 20:04:00,882 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 20:04:00,883 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.3ms
2025-11-24 20:04:01,317 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 20:04:01,318 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:01,318 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:01,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:01,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:01,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:01,320 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:01,320 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:01,320 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 20:04:01,327 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:04:01,327 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:04:01,332 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 2 usuarios únicos de 2 filas crudas
2025-11-24 20:04:01,332 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 20:04:01,332 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 20:04:01,333 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 20:04:01,333 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:01,334 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:01,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:01,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:01,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:01,335 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:01,335 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:01,336 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 20:04:01,340 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 20:04:01,341 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 20:04:01,342 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 20:04:01,342 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.7ms
2025-11-24 20:04:01,343 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.2ms
2025-11-24 20:04:01,344 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 20:04:01,345 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:01,345 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:01,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:01,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:01,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:01,346 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:01,347 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:01,347 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 20:04:01,351 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:04:01,351 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:04:01,355 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 2 usuarios únicos de 2 filas crudas
2025-11-24 20:04:01,356 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 20:04:01,356 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 20:04:01,356 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 20:04:01,357 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:01,357 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:01,357 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:01,357 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:01,357 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:01,359 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:01,359 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:01,359 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 20:04:01,363 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 20:04:01,364 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 20:04:01,364 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 20:04:01,364 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 20.2ms
2025-11-24 20:04:01,365 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.0ms
2025-11-24 20:04:15,408 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:04:15,409 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:15,409 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:15,410 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:15,410 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:15,410 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:15,411 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:15,411 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:15,412 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 20:04:15,417 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:04:15,417 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:04:15,418 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 20:04:15,421 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 20:04:15,424 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 20:04:15,424 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 20:04:15,424 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 20:04:15,425 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 16.2ms
2025-11-24 20:04:15,426 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:04:15,427 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:15,427 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:15,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:15,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:15,427 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:15,429 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:15,429 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:15,429 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 20:04:15,434 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:04:15,434 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:04:15,434 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 20:04:15,436 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 20:04:15,438 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 20:04:15,439 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 20:04:15,439 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 20:04:15,440 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.2ms
2025-11-24 20:04:16,168 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:04:16,169 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:16,169 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:16,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:16,169 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:16,170 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:16,171 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:16,171 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:16,171 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 20:04:16,176 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:04:16,176 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 20:04:16,178 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 20:04:16,179 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 20:04:16,179 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 11.0ms
2025-11-24 20:04:16,181 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:04:16,181 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:16,181 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:16,182 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:16,182 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:16,182 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:16,183 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:16,183 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:16,183 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 20:04:16,189 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:04:16,189 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 20:04:16,190 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 20:04:16,190 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 20:04:16,191 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 10.2ms
2025-11-24 20:04:16,794 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:04:16,794 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:16,794 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:16,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:16,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:16,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:16,796 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:16,796 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:16,796 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 20:04:16,803 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:04:16,803 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:04:16,803 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 20:04:16,806 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 20:04:16,808 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 20:04:16,809 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 20:04:16,809 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 20:04:16,809 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.7ms
2025-11-24 20:04:16,811 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:04:16,812 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:16,812 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:16,812 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:16,813 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:16,813 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:16,814 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:16,814 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:16,814 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 20:04:16,819 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:04:16,819 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:04:16,819 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 20:04:16,821 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 20:04:16,823 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 20:04:16,824 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 20:04:16,824 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 20:04:16,824 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 13.0ms
2025-11-24 20:04:17,245 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 20:04:17,245 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:17,245 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:17,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:17,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:17,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:17,247 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:17,248 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:17,248 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 20:04:17,258 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:04:17,258 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:04:17,263 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 2 usuarios únicos de 2 filas crudas
2025-11-24 20:04:17,263 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 20:04:17,263 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 20:04:17,264 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 20:04:17,265 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 20.2ms
2025-11-24 20:04:17,265 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:17,265 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:17,266 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:17,266 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:17,266 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:17,267 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:17,267 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:17,267 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 20:04:17,273 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 20:04:17,274 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 20:04:17,274 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 20:04:17,276 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.2ms
2025-11-24 20:04:17,277 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 20:04:17,277 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:17,277 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:17,278 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:17,278 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:17,278 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:17,279 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:17,279 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:17,279 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 20:04:17,285 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:04:17,285 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:04:17,289 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 2 usuarios únicos de 2 filas crudas
2025-11-24 20:04:17,290 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 20:04:17,290 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 20:04:17,291 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 20:04:17,291 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 14.6ms
2025-11-24 20:04:17,292 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:04:17,292 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:04:17,292 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:04:17,292 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:04:17,292 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:04:17,293 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:04:17,294 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:04:17,294 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 20:04:17,299 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 20:04:17,300 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 20:04:17,300 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 20:04:17,301 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.6ms
2025-11-24 20:05:03,676 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:05:03,677 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:05:03,677 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:05:03,677 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:05:03,677 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:05:03,677 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:05:03,682 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:05:03,683 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:05:03,683 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 20:05:03,715 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:05:03,716 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:05:03,716 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 20:05:03,721 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 20:05:03,726 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 20:05:03,726 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 20:05:03,726 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 20:05:03,727 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 50.7ms
2025-11-24 20:05:03,729 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:05:03,730 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:05:03,730 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:05:03,730 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:05:03,730 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:05:03,730 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:05:03,733 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:05:03,733 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:05:03,733 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 20:05:03,739 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:05:03,740 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:05:03,740 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 20:05:03,742 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 20:05:03,744 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 20:05:03,744 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 20:05:03,744 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 20:05:03,745 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.9ms
2025-11-24 20:05:04,292 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:05:04,293 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:05:04,293 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:05:04,294 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:05:04,294 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:05:04,294 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:05:04,295 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:05:04,295 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:05:04,295 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 20:05:04,303 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:05:04,304 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 20:05:04,306 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 20:05:04,306 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 20:05:04,307 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 14.5ms
2025-11-24 20:05:04,309 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-24 20:05:04,309 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:05:04,309 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:05:04,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:05:04,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:05:04,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:05:04,311 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:05:04,311 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:05:04,311 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/areas/
2025-11-24 20:05:04,318 - app.api.v1.endpoints.areas - INFO - Solicitud GET /areas/ recibida por usuario 2 del cliente 4 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-24 20:05:04,318 - app.services.area_service - INFO - Obteniendo áreas paginadas para cliente 4: skip=0, limit=10, search='None'
2025-11-24 20:05:04,319 - app.services.area_service - INFO - Paginación completada para cliente 4: 0 áreas de 0 totales
2025-11-24 20:05:04,320 - app.api.v1.endpoints.areas - INFO - Lista paginada de áreas recuperada para cliente 4 - Total: 0, Página: 1
2025-11-24 20:05:04,320 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 11.3ms
2025-11-24 20:05:04,907 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:05:04,908 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:05:04,908 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:05:04,908 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:05:04,908 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:05:04,908 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:05:04,909 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:05:04,910 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:05:04,910 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 20:05:04,916 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:05:04,917 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:05:04,917 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 20:05:04,919 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 20:05:04,921 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 20:05:04,921 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 20:05:04,922 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 20:05:04,922 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.3ms
2025-11-24 20:05:04,924 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-24 20:05:04,925 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:05:04,925 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:05:04,925 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:05:04,925 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:05:04,925 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:05:04,926 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:05:04,927 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:05:04,927 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/
2025-11-24 20:05:04,932 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:05:04,932 - app.services.rol_service - INFO - Obteniendo roles paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:05:04,933 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=4, page=1, limit=10, search='None'
2025-11-24 20:05:04,935 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 4: 4
2025-11-24 20:05:04,937 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 4 roles para la página 1 de 4 totales
2025-11-24 20:05:04,937 - app.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 4, Total: 4, Página: 1/1, Resultados: 4
2025-11-24 20:05:04,937 - app.api.v1.endpoints.roles - INFO - Respuesta exitosa para GET /roles/ - Cliente: 4, Total roles: 4
2025-11-24 20:05:04,938 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 14.0ms
2025-11-24 20:05:05,392 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 20:05:05,392 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:05:05,392 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:05:05,393 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:05:05,393 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:05:05,393 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:05:05,394 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:05:05,394 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:05:05,394 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 20:05:05,402 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:05:05,402 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:05:05,415 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 2 usuarios únicos de 2 filas crudas
2025-11-24 20:05:05,415 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 20:05:05,415 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 20:05:05,417 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 20:05:05,418 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:05:05,418 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:05:05,418 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:05:05,418 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:05:05,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:05:05,420 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:05:05,420 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:05:05,420 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 20:05:05,420 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 28.7ms
2025-11-24 20:05:05,424 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 20:05:05,427 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 20:05:05,427 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 20:05:05,428 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.8ms
2025-11-24 20:05:05,429 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-24 20:05:05,430 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:05:05,430 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:05:05,430 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:05:05,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:05:05,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:05:05,432 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:05:05,432 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:05:05,432 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/usuarios/
2025-11-24 20:05:05,437 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 2 del cliente 4 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-24 20:05:05,438 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 4: page=1, limit=10, search='None'
2025-11-24 20:05:05,442 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 2 usuarios únicos de 2 filas crudas
2025-11-24 20:05:05,442 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-24 20:05:05,442 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 4 - Total: 2, Página: 1
2025-11-24 20:05:05,443 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-24 20:05:05,443 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:05:05,444 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:05:05,444 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:05:05,444 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:05:05,444 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:05:05,445 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:05:05,445 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:05:05,445 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/roles/all-active/
2025-11-24 20:05:05,446 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.1ms
2025-11-24 20:05:05,450 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 2 del cliente 4 para lista simple
2025-11-24 20:05:05,451 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 4
2025-11-24 20:05:05,451 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 4 - Total: 0
2025-11-24 20:05:05,453 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 9.9ms
2025-11-24 20:45:26,809 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-24 20:45:26,810 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-11-24 20:45:26,812 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 20:45:26,812 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:45:26,812 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:45:26,812 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:45:26,813 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:45:26,813 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:45:26,831 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:45:26,833 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_sistema
2025-11-24 20:45:26,834 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:45:26,834 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/logout/
2025-11-24 20:45:26,834 - app.core.auth - ERROR - Error decodificando token: Signature has expired.
2025-11-24 20:45:26,835 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 401 23.1ms
2025-11-24 20:45:26,839 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 20:45:26,840 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-24 20:45:26,842 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 20:45:26,842 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:45:26,842 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:45:26,842 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:45:26,843 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:45:26,843 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:45:26,844 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:45:26,844 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:45:26,844 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 20:45:26,849 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 4, Usuario 2, Tipo: web
2025-11-24 20:45:26,859 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_tech (Cliente: 4, Level: 4, Type: tenant_admin)
2025-11-24 20:45:26,868 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-24 20:45:26,876 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 20:45:26,876 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 11362, Rotación: True
2025-11-24 20:45:26,881 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 20:45:26,882 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 4, Usuario 2
2025-11-24 20:45:26,882 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 20:45:26,882 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11362
2025-11-24 20:45:26,882 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_tech
2025-11-24 20:45:26,883 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 41.3ms
2025-11-24 20:45:26,887 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-24 20:45:26,887 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:45:26,887 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 20:45:26,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 20:45:26,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:45:26,888 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 20:45:26,889 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 20:45:26,889 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 20:45:26,889 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/logout/
2025-11-24 20:45:26,893 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 20:45:26,893 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 4, Usuario 2
2025-11-24 20:45:26,894 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 4, Usuario: 2 (admin_tech)
2025-11-24 20:45:26,894 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 7.4ms
2025-11-24 20:45:36,730 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-24 20:45:36,731 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.8ms
2025-11-24 20:45:36,733 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-24 20:45:36,734 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:45:36,734 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 20:45:36,734 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 20:45:36,734 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:45:36,734 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 20:45:36,734 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 20:45:36,735 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 20:45:36,735 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-24 20:45:36,738 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-24 20:45:36,738 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-24 20:45:36,739 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-24 20:45:36,978 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 20:45:36,978 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-24 20:45:36,978 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-24 20:45:36,979 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 20:45:36,981 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 20:45:36,981 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11363, Rotación: False
2025-11-24 20:45:36,981 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 11363
2025-11-24 20:45:36,982 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-24 20:45:36,982 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 249.1ms
2025-11-24 20:45:36,991 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 20:45:36,991 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.7ms
2025-11-24 20:45:36,993 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 20:45:36,994 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:45:36,994 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 20:45:36,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 20:45:36,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:45:36,995 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 20:45:36,995 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 20:45:36,995 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 20:45:36,995 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 20:45:37,017 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 20:45:37,017 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 20:45:37,019 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 20:45:37,021 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 20:45:37,022 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 28.4ms
2025-11-24 20:45:37,022 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.2ms
2025-11-24 20:45:37,022 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 20:45:37,024 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.4ms
2025-11-24 20:45:37,027 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 20:45:37,027 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:45:37,027 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 20:45:37,028 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 20:45:37,028 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:45:37,028 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 20:45:37,028 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 20:45:37,028 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 20:45:37,028 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 20:45:37,033 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 20:45:37,034 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 20:45:37,081 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 20:45:37,081 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 54.9ms
2025-11-24 20:45:37,083 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 20:45:37,084 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:45:37,084 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 20:45:37,084 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 20:45:37,084 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:45:37,084 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 20:45:37,084 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 20:45:37,085 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 20:45:37,085 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 20:45:37,088 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 20:45:37,088 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 20:45:37,089 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 20:45:37,090 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.4ms
2025-11-24 20:45:41,043 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 20:45:41,044 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.7ms
2025-11-24 20:45:41,045 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 20:45:41,046 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-24 20:45:41,047 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 20:45:41,048 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:45:41,048 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 20:45:41,048 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 20:45:41,048 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:45:41,049 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 20:45:41,049 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 20:45:41,049 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 20:45:41,049 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 20:45:41,056 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 20:45:41,057 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 20:45:41,063 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 20:45:41,064 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 16.7ms
2025-11-24 20:45:41,066 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 20:45:41,066 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 20:45:41,066 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 20:45:41,067 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 20:45:41,067 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 20:45:41,067 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 20:45:41,067 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 20:45:41,067 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 20:45:41,068 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 20:45:41,073 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 20:45:41,073 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 20:45:41,076 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 20:45:41,077 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.9ms
2025-11-24 21:00:46,898 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-24 21:00:46,900 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-24 21:00:46,901 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 2.5ms
2025-11-24 21:00:46,901 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.3ms
2025-11-24 21:00:46,908 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-24 21:00:46,908 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 21:00:46,909 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 21:00:46,909 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 21:00:46,909 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 21:00:46,909 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 21:00:46,910 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 21:00:46,910 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 21:00:46,910 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-24 21:00:46,911 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 21:00:46,912 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 401 4.5ms
2025-11-24 21:00:46,915 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-24 21:00:46,916 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 21:00:46,916 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 21:00:46,916 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 21:00:46,917 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 21:00:46,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 21:00:46,918 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 21:00:46,919 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 21:00:46,919 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-24 21:00:46,920 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 21:00:46,922 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 21:00:46,924 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 2.0ms
2025-11-24 21:00:46,925 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 401 9.5ms
2025-11-24 21:00:46,928 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 21:00:46,929 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 21:00:46,930 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 21:00:46,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 21:00:46,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 21:00:46,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 21:00:46,930 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 21:00:46,931 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 21:00:46,931 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 21:00:46,957 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 21:00:46,961 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 21:00:46,970 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 21:00:46,977 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 21:00:46,978 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11364, Rotación: True
2025-11-24 21:00:46,986 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 21:00:46,986 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 21:00:46,987 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 21:00:46,987 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11364
2025-11-24 21:00:46,988 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 21:00:46,989 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 60.2ms
2025-11-24 21:00:46,995 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-24 21:00:46,995 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 21:00:46,995 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 21:00:46,995 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 21:00:46,996 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 21:00:46,996 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 21:00:46,996 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 21:00:46,996 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 21:00:46,997 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-24 21:00:47,019 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-24 21:00:47,020 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-24 21:00:47,027 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-24 21:00:47,030 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-24 21:00:47,031 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 36.4ms
2025-11-24 21:00:47,034 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-24 21:00:47,034 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 21:00:47,034 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 21:00:47,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 21:00:47,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 21:00:47,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 21:00:47,035 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 21:00:47,035 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 21:00:47,036 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-24 21:00:47,042 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-24 21:00:47,042 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-24 21:00:47,044 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-24 21:00:47,045 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-24 21:00:47,046 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 12.5ms
2025-11-24 21:01:01,081 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 21:01:01,083 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.8ms
2025-11-24 21:01:01,085 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 21:01:01,087 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.7ms
2025-11-24 21:01:01,094 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 21:01:01,095 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 21:01:01,095 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 21:01:01,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 21:01:01,096 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 21:01:01,096 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 21:01:01,096 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 21:01:01,096 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 21:01:01,096 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 21:01:01,102 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 21:01:01,102 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 21:01:01,111 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 21:01:01,112 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 18.8ms
2025-11-24 21:01:01,114 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 21:01:01,115 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 21:01:01,116 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 21:01:01,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 21:01:01,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 21:01:01,116 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 21:01:01,116 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 21:01:01,117 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 21:01:01,117 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 21:01:01,125 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 21:01:01,125 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 21:01:01,128 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 21:01:01,129 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.3ms
2025-11-24 22:13:55,140 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 22:13:55,147 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 22:13:55,149 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 9.4ms
2025-11-24 22:13:55,149 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 2.7ms
2025-11-24 22:13:55,155 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 22:13:55,156 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 22:13:55,157 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:13:55,157 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:13:55,157 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:13:55,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:13:55,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:13:55,158 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:13:55,158 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:13:55,159 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 22:13:55,165 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 22:13:55,167 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:13:55,167 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:13:55,167 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:13:55,168 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:13:55,168 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:13:55,168 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:13:55,168 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:13:55,168 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 22:13:55,169 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 22:13:55,170 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 401 15.0ms
2025-11-24 22:13:55,171 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 401 14.7ms
2025-11-24 22:13:55,181 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 22:13:55,181 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-24 22:13:55,186 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:13:55,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:13:55,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:13:55,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:13:55,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:13:55,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:13:55,187 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:13:55,187 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:13:55,188 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 22:13:55,282 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 22:13:55,295 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 22:13:55,311 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 22:13:55,330 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 22:13:55,330 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11365, Rotación: True
2025-11-24 22:13:55,342 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 22:13:55,343 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 22:13:55,343 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 22:13:55,344 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11365
2025-11-24 22:13:55,344 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 22:13:55,345 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 159.3ms
2025-11-24 22:13:55,353 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 22:13:55,354 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 22:13:55,354 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:13:55,354 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:13:55,354 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:13:55,355 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:13:55,355 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:13:55,355 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:13:55,355 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:13:55,355 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 22:13:55,379 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 22:13:55,379 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 22:13:55,384 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 22:13:55,385 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:13:55,385 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:13:55,385 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:13:55,385 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:13:55,386 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:13:55,386 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:13:55,386 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:13:55,386 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 22:13:55,390 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 22:13:55,391 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 22:13:55,478 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 22:13:55,479 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 126.4ms
2025-11-24 22:13:55,480 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 126.0ms
2025-11-24 22:52:20,120 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 22:52:20,121 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 22:52:20,122 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.4ms
2025-11-24 22:52:20,123 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 1.7ms
2025-11-24 22:52:20,129 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 22:52:20,130 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 22:52:20,131 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:52:20,131 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:52:20,131 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:52:20,131 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:52:20,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:52:20,132 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:52:20,133 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:52:20,134 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 22:52:20,137 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 22:52:20,138 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:52:20,138 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:52:20,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:52:20,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:52:20,139 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:52:20,139 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:52:20,139 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:52:20,139 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 22:52:20,141 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-24 22:52:20,141 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 401 11.8ms
2025-11-24 22:52:20,142 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 401 11.3ms
2025-11-24 22:52:20,149 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 22:52:20,150 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.2ms
2025-11-24 22:52:20,153 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:52:20,153 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:52:20,154 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:52:20,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:52:20,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:52:20,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:52:20,157 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:52:20,157 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:52:20,157 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 22:52:20,198 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 22:52:20,210 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 22:52:20,222 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 22:52:20,234 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 22:52:20,234 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11366, Rotación: True
2025-11-24 22:52:20,251 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 22:52:20,252 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 22:52:20,252 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 22:52:20,252 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11366
2025-11-24 22:52:20,253 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 22:52:20,254 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 100.8ms
2025-11-24 22:52:20,260 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 22:52:20,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 22:52:20,261 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:52:20,262 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:52:20,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:52:20,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:52:20,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:52:20,262 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:52:20,262 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:52:20,263 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 22:52:20,286 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 22:52:20,286 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 22:52:20,289 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 22:52:20,289 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:52:20,290 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:52:20,290 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:52:20,290 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:52:20,290 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:52:20,291 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:52:20,291 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:52:20,291 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 22:52:20,296 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 22:52:20,297 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 22:52:20,365 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 22:52:20,367 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 106.8ms
2025-11-24 22:52:20,367 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 106.2ms
2025-11-24 22:52:24,172 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 22:52:24,173 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:52:24,173 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:52:24,173 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:52:24,173 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:52:24,173 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:52:24,174 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:52:24,174 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:52:24,174 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 22:52:24,186 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 22:52:24,186 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 22:52:24,190 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 22:52:24,191 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 22:52:24,192 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:52:24,192 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:52:24,192 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:52:24,192 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:52:24,192 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:52:24,193 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:52:24,193 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:52:24,194 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 22:52:24,201 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 22:52:24,202 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 22:52:24,203 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 22:52:24,204 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 31.8ms
2025-11-24 22:52:24,210 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.5ms
2025-11-24 22:53:10,507 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 22:53:10,510 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 2.8ms
2025-11-24 22:53:10,519 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:10,520 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:10,520 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': global.app.local:5173
2025-11-24 22:53:10,521 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-24 22:53:10,521 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:10,521 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-24 22:53:10,572 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', Código='GLOBAL004', ID=5
2025-11-24 22:53:10,587 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 5: single - bd_sistema
2025-11-24 22:53:10,587 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 22:53:10,587 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 22:53:10,610 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 5
2025-11-24 22:53:10,611 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 22:53:10,612 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 22:53:10,613 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 93.7ms
2025-11-24 22:53:10,615 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 3.3ms
2025-11-24 22:53:10,629 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:10,629 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:10,630 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 22:53:10,631 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 22:53:10,633 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:10,636 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 22:53:10,641 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 22:53:10,645 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_sistema
2025-11-24 22:53:10,645 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 22:53:10,645 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 22:53:10,653 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-24 22:53:10,653 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 22:53:10,654 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 25.7ms
2025-11-24 22:53:10,676 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:10,677 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:10,677 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:10,678 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:10,678 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:10,678 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:10,678 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:10,684 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:10,684 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 22:53:10,702 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 22:53:10,720 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 22:53:10,776 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 22:53:10,984 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 22:53:11,047 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11367, Rotación: True
2025-11-24 22:53:11,070 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 22:53:11,077 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 22:53:11,088 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 22:53:11,089 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11367
2025-11-24 22:53:11,090 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 22:53:11,091 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 22:53:11,091 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 415.2ms
2025-11-24 22:53:11,092 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.9ms
2025-11-24 22:53:11,098 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:11,100 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:11,102 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': innova.app.local:5173
2025-11-24 22:53:11,106 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-11-24 22:53:11,107 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:11,107 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-24 22:53:11,113 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-24 22:53:11,120 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 3: multi - bd_cliente_innova
2025-11-24 22:53:11,120 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-24 22:53:11,121 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/refresh/
2025-11-24 22:53:11,122 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 22:53:11,123 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.9ms
2025-11-24 22:53:11,130 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-24 22:53:11,455 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 3
2025-11-24 22:53:11,459 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 22:53:11,464 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 365.1ms
2025-11-24 22:53:11,471 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 22:53:11,477 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:11,486 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:11,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:11,508 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:11,511 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:11,521 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:11,524 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:11,526 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-24 22:53:11,578 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-24 22:53:11,578 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-24 22:53:11,579 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-24 22:53:11,630 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 22:53:11,630 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-24 22:53:11,635 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 164.7ms
2025-11-24 22:53:11,677 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 22:53:11,678 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:11,678 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:11,679 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:11,679 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:11,679 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:11,680 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:11,680 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:11,681 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 22:53:11,747 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 22:53:11,752 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 22:53:11,757 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 22:53:11,759 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 81.9ms
2025-11-24 22:53:11,813 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 22:53:11,819 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:11,821 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:11,821 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:11,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:11,822 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:11,822 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:11,822 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:11,823 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 22:53:11,823 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 22:53:11,837 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 22:53:11,838 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 22:53:11,840 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 22:53:11,841 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 22:53:11,844 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 20.7ms
2025-11-24 22:53:11,845 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:11,852 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:11,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:11,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:11,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:11,853 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:11,853 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:11,855 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 22:53:11,876 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 22:53:11,877 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 22:53:11,990 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 22:53:11,993 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 22:53:11,994 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 180.2ms
2025-11-24 22:53:11,997 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 4.0ms
2025-11-24 22:53:12,001 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 159.8ms
2025-11-24 22:53:12,004 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 22:53:12,009 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 4.6ms
2025-11-24 22:53:12,010 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 22:53:12,018 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:12,019 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:12,020 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:12,020 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:12,020 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:12,020 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:12,021 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:12,021 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 22:53:12,032 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 22:53:12,033 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 22:53:12,051 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 22:53:12,054 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 22:53:12,056 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:12,057 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:12,057 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:12,057 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:12,061 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:12,062 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:12,063 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:12,070 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 22:53:12,079 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 22:53:12,079 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 22:53:12,081 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 22:53:12,082 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:12,085 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:12,086 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 22:53:12,087 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 22:53:12,087 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:12,087 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 22:53:12,091 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 22:53:12,092 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 22:53:12,093 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 22:53:12,093 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 22:53:12,094 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 84.1ms
2025-11-24 22:53:12,096 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 42.2ms
2025-11-24 22:53:12,107 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 22:53:12,108 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 22:53:12,170 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 2
2025-11-24 22:53:12,170 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 22:53:12,171 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:12,171 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:12,172 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:12,172 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:12,172 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:12,172 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:12,173 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:12,173 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 22:53:12,179 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 22:53:12,179 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 22:53:12,187 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 22:53:12,188 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 106.4ms
2025-11-24 22:53:12,190 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 83.1ms
2025-11-24 22:53:36,099 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:36,100 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:36,100 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': innova.app.local:5173
2025-11-24 22:53:36,101 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-11-24 22:53:36,101 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:36,101 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-24 22:53:36,103 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-24 22:53:36,103 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-24 22:53:36,103 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/refresh/
2025-11-24 22:53:36,106 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:36,108 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:36,109 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': global.app.local:5173
2025-11-24 22:53:36,110 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-24 22:53:36,110 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:36,110 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-24 22:53:36,112 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', Código='GLOBAL004', ID=5
2025-11-24 22:53:36,112 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 22:53:36,113 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 22:53:36,113 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:36,113 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:36,116 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:36,116 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 22:53:36,117 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 22:53:36,117 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:36,117 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 22:53:36,119 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 22:53:36,119 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 22:53:36,119 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 22:53:36,120 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:36,120 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 22:53:36,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 22:53:36,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:36,121 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 22:53:36,122 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 22:53:36,123 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 22:53:36,123 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 22:53:36,127 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-24 22:53:36,129 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 3
2025-11-24 22:53:36,129 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 22:53:36,131 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:36,132 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:36,132 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:36,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:36,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:36,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:36,132 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:36,133 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:36,133 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 22:53:36,133 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 34.2ms
2025-11-24 22:53:36,136 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 5
2025-11-24 22:53:36,136 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 22:53:36,139 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 22:53:36,141 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 2
2025-11-24 22:53:36,141 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 22:53:36,143 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-24 22:53:36,143 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 22:53:36,145 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 39.4ms
2025-11-24 22:53:36,147 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 33.8ms
2025-11-24 22:53:36,147 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 33.8ms
2025-11-24 22:53:36,154 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 22:53:36,156 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 22:53:36,158 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 22:53:36,160 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 22:53:36,161 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11368, Rotación: True
2025-11-24 22:53:36,164 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 22:53:36,165 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 22:53:36,165 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 22:53:36,165 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11368
2025-11-24 22:53:36,166 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 22:53:36,168 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 37.5ms
2025-11-24 22:53:36,175 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 22:53:36,177 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:36,178 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:36,178 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:36,178 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:36,179 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:36,179 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:36,179 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:36,180 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-24 22:53:36,182 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-24 22:53:36,183 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-24 22:53:36,183 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-24 22:53:36,187 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 22:53:36,188 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-24 22:53:36,189 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 13.3ms
2025-11-24 22:53:36,200 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 22:53:36,200 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:36,201 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:36,201 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:36,202 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:36,202 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:36,202 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:36,202 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:36,202 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 22:53:36,211 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 22:53:36,212 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 22:53:36,213 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 22:53:36,214 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 14.4ms
2025-11-24 22:53:36,242 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 22:53:36,244 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 22:53:36,245 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:36,245 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:36,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:36,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:36,246 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:36,246 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:36,247 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:36,247 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 22:53:36,253 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 22:53:36,253 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 22:53:36,255 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 22:53:36,255 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:36,256 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:36,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:36,257 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:36,257 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:36,257 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:36,257 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:36,258 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 22:53:36,265 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 22:53:36,265 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 22:53:36,267 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 22:53:36,268 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 22:53:36,268 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:36,269 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:36,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:36,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:36,269 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:36,269 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:36,269 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:36,270 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 22:53:36,281 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 22:53:36,282 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 22:53:36,285 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 22:53:36,286 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 43.7ms
2025-11-24 22:53:36,287 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 42.7ms
2025-11-24 22:53:36,289 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 21.2ms
2025-11-24 22:53:36,292 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 22:53:36,294 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:36,295 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:36,295 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:36,295 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:36,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:36,296 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:36,296 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:36,297 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 22:53:36,297 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 22:53:36,305 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 22:53:36,306 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 22:53:36,309 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 22:53:36,311 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:36,311 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:36,312 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:36,312 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:36,312 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:36,313 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:36,313 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:36,314 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 22:53:36,322 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 22:53:36,322 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 22:53:36,325 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 22:53:36,327 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 35.5ms
2025-11-24 22:53:36,329 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 31.7ms
2025-11-24 22:53:54,196 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:54,202 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:54,203 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': global.app.local:5173
2025-11-24 22:53:54,206 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-24 22:53:54,212 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:54,213 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-24 22:53:54,249 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', Código='GLOBAL004', ID=5
2025-11-24 22:53:54,249 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 22:53:54,250 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 22:53:54,251 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:54,255 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:54,255 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:54,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:54,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:54,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:54,256 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:54,257 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:54,257 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 22:53:54,268 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 5
2025-11-24 22:53:54,274 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 22:53:54,276 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 80.2ms
2025-11-24 22:53:54,279 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:54,300 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 22:53:54,315 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 22:53:54,333 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 22:53:54,364 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 22:53:54,367 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11369, Rotación: True
2025-11-24 22:53:54,383 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 22:53:54,386 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 22:53:54,387 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 22:53:54,387 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11369
2025-11-24 22:53:54,387 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 22:53:54,388 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:54,388 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 22:53:54,395 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 22:53:54,395 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:54,395 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 22:53:54,400 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 22:53:54,401 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 22:53:54,401 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 22:53:54,404 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 152.3ms
2025-11-24 22:53:54,427 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-24 22:53:54,428 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 22:53:54,430 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 150.8ms
2025-11-24 22:53:54,485 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 22:53:54,486 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:54,487 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:54,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:54,499 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:54,500 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:54,500 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:54,500 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:54,501 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-24 22:53:54,510 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-24 22:53:54,518 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-24 22:53:54,518 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-24 22:53:54,554 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 22:53:54,556 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-24 22:53:54,557 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:54,558 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 22:53:54,559 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:54,559 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 22:53:54,559 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 22:53:54,559 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:54,560 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 22:53:54,568 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 22:53:54,573 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 22:53:54,573 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 22:53:54,574 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:54,574 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': innova.app.local:5173
2025-11-24 22:53:54,574 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-11-24 22:53:54,575 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:54,575 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-24 22:53:54,577 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-24 22:53:54,578 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-24 22:53:54,578 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/refresh/
2025-11-24 22:53:54,578 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 93.8ms
2025-11-24 22:53:54,584 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 22:53:54,613 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 2
2025-11-24 22:53:54,615 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 22:53:54,616 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-24 22:53:54,660 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 3
2025-11-24 22:53:54,661 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 22:53:54,663 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 22:53:54,667 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:54,667 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:54,667 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:54,668 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:54,668 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:54,668 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:54,668 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:54,668 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 22:53:54,669 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 111.9ms
2025-11-24 22:53:54,670 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 111.7ms
2025-11-24 22:53:54,704 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 22:53:54,704 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 22:53:54,708 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 22:53:54,709 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 22:53:54,711 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 22:53:54,713 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:54,713 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:54,715 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:54,715 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:54,716 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:54,716 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:54,716 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:54,717 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 22:53:54,718 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:54,718 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:54,719 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:54,719 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:54,719 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:54,719 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:54,719 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:54,720 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 22:53:54,728 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 22:53:54,729 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 22:53:54,739 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 22:53:54,746 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 22:53:54,746 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 22:53:54,836 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 22:53:54,838 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 175.2ms
2025-11-24 22:53:54,842 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 133.3ms
2025-11-24 22:53:54,844 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 132.7ms
2025-11-24 22:53:54,852 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 22:53:54,853 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:54,853 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:54,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:54,854 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:54,854 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:54,854 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:54,854 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:54,855 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 22:53:54,857 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 22:53:54,866 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 22:53:54,866 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 22:53:54,870 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 22:53:54,871 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 22:53:54,872 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 22:53:54,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 22:53:54,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 22:53:54,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 22:53:54,874 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 22:53:54,874 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 22:53:54,874 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 22:53:54,882 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 22:53:54,883 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 22:53:54,884 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 22:53:54,885 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 33.5ms
2025-11-24 22:53:54,887 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.1ms
2025-11-24 23:04:01,795 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 23:04:01,795 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-24 23:04:01,801 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 23:04:01,804 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:01,805 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 23:04:01,805 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 23:04:01,808 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:01,808 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-24 23:04:01,878 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-24 23:04:01,902 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_sistema
2025-11-24 23:04:01,902 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 23:04:01,902 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 23:04:01,903 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 23:04:01,905 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.4ms
2025-11-24 23:04:01,935 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-24 23:04:01,935 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 23:04:01,940 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 138.2ms
2025-11-24 23:04:01,940 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 23:04:01,942 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:01,943 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:04:01,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:04:01,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:01,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:04:01,943 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:04:01,944 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:04:01,944 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 23:04:01,961 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 23:04:01,969 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 23:04:01,990 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 23:04:02,008 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 23:04:02,009 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11370, Rotación: True
2025-11-24 23:04:02,028 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 23:04:02,028 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 23:04:02,029 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 23:04:02,029 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11370
2025-11-24 23:04:02,030 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 23:04:02,034 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 23:04:02,036 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 95.6ms
2025-11-24 23:04:02,036 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 2.1ms
2025-11-24 23:04:02,037 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 23:04:02,040 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 2.7ms
2025-11-24 23:04:02,042 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 23:04:02,043 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 23:04:02,043 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:02,044 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-24 23:04:02,044 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-24 23:04:02,044 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:02,044 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-24 23:04:02,052 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-24 23:04:02,054 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-24 23:04:02,055 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-24 23:04:02,056 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-24 23:04:02,058 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:02,058 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': global.app.local:5173
2025-11-24 23:04:02,058 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-24 23:04:02,059 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:02,059 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-24 23:04:02,062 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', Código='GLOBAL004', ID=5
2025-11-24 23:04:02,069 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 5: single - bd_sistema
2025-11-24 23:04:02,070 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 23:04:02,070 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 23:04:02,071 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-24 23:04:02,075 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-24 23:04:02,077 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 6.2ms
2025-11-24 23:04:02,079 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 3.9ms
2025-11-24 23:04:02,090 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-24 23:04:02,135 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 2
2025-11-24 23:04:02,135 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 23:04:02,140 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 5
2025-11-24 23:04:02,141 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 23:04:02,143 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 23:04:02,143 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-24 23:04:02,144 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 101.6ms
2025-11-24 23:04:02,144 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:02,144 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': innova.app.local:5173
2025-11-24 23:04:02,145 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-11-24 23:04:02,145 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:02,146 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-24 23:04:02,148 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', Código='INNOVA002', ID=3
2025-11-24 23:04:02,150 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 3: multi - bd_cliente_innova
2025-11-24 23:04:02,152 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-24 23:04:02,152 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/refresh/
2025-11-24 23:04:02,153 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:02,154 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:04:02,156 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:04:02,157 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:02,157 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:04:02,157 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:04:02,157 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:04:02,157 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-24 23:04:02,158 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 115.1ms
2025-11-24 23:04:02,166 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-24 23:04:02,166 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-24 23:04:02,167 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-24 23:04:02,210 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-24 23:04:02,210 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-24 23:04:02,221 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 77.5ms
2025-11-24 23:04:02,238 - app.core.multi_db - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-24 23:04:02,303 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 3
2025-11-24 23:04:02,304 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 23:04:02,312 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 168.9ms
2025-11-24 23:04:02,345 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-24 23:04:02,347 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 1.6ms
2025-11-24 23:04:02,352 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 23:04:02,354 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:02,355 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:04:02,355 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:04:02,356 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:02,356 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:04:02,356 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:04:02,356 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:04:02,357 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 23:04:02,431 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 23:04:02,432 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 23:04:02,441 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 23:04:02,445 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 23:04:02,445 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 23:04:02,449 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 96.8ms
2025-11-24 23:04:02,450 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 4.8ms
2025-11-24 23:04:02,450 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 4.6ms
2025-11-24 23:04:02,451 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-24 23:04:02,454 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-24 23:04:02,459 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 8.0ms
2025-11-24 23:04:02,462 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 7.7ms
2025-11-24 23:04:02,472 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 23:04:02,474 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:02,474 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:04:02,474 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:04:02,475 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:02,475 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:04:02,475 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:04:02,475 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:04:02,476 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 23:04:02,476 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 23:04:02,493 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 23:04:02,494 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 23:04:02,517 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 23:04:02,519 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:02,520 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:04:02,521 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:04:02,525 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:02,525 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:04:02,525 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:04:02,526 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:04:02,526 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 23:04:02,543 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 23:04:02,544 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 23:04:02,683 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 23:04:02,684 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 212.6ms
2025-11-24 23:04:02,686 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 209.5ms
2025-11-24 23:04:02,689 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 23:04:02,690 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:02,690 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:04:02,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:04:02,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:02,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:04:02,691 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:04:02,695 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:04:02,697 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 23:04:02,903 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 23:04:02,905 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 23:04:02,988 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 23:04:02,991 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 23:04:02,992 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:03,009 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:04:03,016 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:04:03,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:03,023 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:04:03,025 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:04:03,035 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:04:03,037 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 23:04:03,049 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 23:04:03,050 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 23:04:03,051 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 23:04:03,052 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 363.4ms
2025-11-24 23:04:03,054 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 62.6ms
2025-11-24 23:04:11,124 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 23:04:11,127 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:11,128 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:04:11,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:04:11,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:11,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:04:11,129 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:04:11,129 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:04:11,130 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 23:04:11,139 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 23:04:11,139 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 23:04:11,144 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 23:04:11,145 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 23:04:11,147 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:11,147 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:04:11,147 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:04:11,147 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:11,148 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:04:11,148 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:04:11,148 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:04:11,148 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 23:04:11,158 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 23:04:11,159 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 23:04:11,161 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 23:04:11,164 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 39.7ms
2025-11-24 23:04:11,165 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.4ms
2025-11-24 23:04:24,075 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 23:04:24,076 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:04:24,076 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:04:24,076 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:04:24,076 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:04:24,077 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:04:24,077 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:04:24,077 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:04:24,077 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 23:04:24,082 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 23:04:24,083 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 23:04:24,084 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 23:04:24,085 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 10.0ms
2025-11-24 23:08:20,096 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 23:08:20,096 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:08:20,098 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:08:20,098 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:08:20,098 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:08:20,098 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:08:20,099 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:08:20,099 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:08:20,099 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 23:08:20,178 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 23:08:20,178 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 23:08:20,188 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 23:08:20,189 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 93.1ms
2025-11-24 23:08:25,090 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 23:08:25,091 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:08:25,092 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:08:25,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:08:25,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:08:25,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:08:25,092 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:08:25,093 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:08:25,093 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 23:08:25,102 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 23:08:25,103 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 23:08:25,105 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 23:08:25,107 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 16.6ms
2025-11-24 23:08:31,089 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 23:08:31,090 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:08:31,090 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:08:31,090 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:08:31,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:08:31,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:08:31,091 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:08:31,092 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:08:31,093 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 23:08:31,099 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 23:08:31,099 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 23:08:31,105 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 23:08:31,106 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 16.5ms
2025-11-24 23:08:37,082 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 23:08:37,083 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:08:37,083 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:08:37,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:08:37,084 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:08:37,084 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:08:37,084 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:08:37,084 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:08:37,084 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 23:08:37,093 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 23:08:37,094 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 23:08:37,097 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 23:08:37,099 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 16.2ms
2025-11-24 23:08:43,086 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-24 23:08:43,087 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:08:43,087 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:08:43,087 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:08:43,088 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:08:43,088 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:08:43,088 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:08:43,088 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:08:43,088 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-24 23:08:43,094 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-24 23:08:43,095 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-24 23:08:43,099 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-24 23:08:43,101 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.3ms
2025-11-24 23:10:31,093 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-24 23:10:31,094 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-24 23:10:31,094 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:10:31,094 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:10:31,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:10:31,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:10:31,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:10:31,095 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:10:31,095 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:10:31,095 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-24 23:10:31,096 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:10:31,096 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:10:31,096 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:10:31,097 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:10:31,097 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:10:31,097 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:10:31,097 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:10:31,097 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-24 23:10:31,167 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-24 23:10:31,168 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-24 23:10:31,234 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-24 23:10:31,239 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-24 23:10:31,239 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-24 23:10:31,243 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-24 23:10:31,244 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 151.0ms
2025-11-24 23:10:31,245 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 151.1ms
2025-11-24 23:10:38,385 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 23:10:38,386 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:10:38,386 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': global.app.local:5173
2025-11-24 23:10:38,386 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-24 23:10:38,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:10:38,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-24 23:10:38,398 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', Código='GLOBAL004', ID=5
2025-11-24 23:10:38,416 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 5: single - bd_sistema
2025-11-24 23:10:38,417 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-24 23:10:38,417 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-24 23:10:38,419 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 23:10:38,428 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:10:38,429 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-24 23:10:38,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-24 23:10:38,430 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:10:38,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-24 23:10:38,433 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-24 23:10:38,434 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-24 23:10:38,434 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-24 23:10:38,495 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 5
2025-11-24 23:10:38,495 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-24 23:10:38,498 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 113.5ms
2025-11-24 23:10:38,499 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-24 23:10:38,505 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-24 23:10:38,511 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-24 23:10:38,525 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-24 23:10:38,544 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-24 23:10:38,549 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 11371, Rotación: True
2025-11-24 23:10:38,560 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-24 23:10:38,562 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-24 23:10:38,563 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-24 23:10:38,563 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 11371
2025-11-24 23:10:38,564 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-24 23:10:38,564 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-24 23:10:38,565 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-24 23:10:38,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-24 23:10:38,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-24 23:10:38,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'

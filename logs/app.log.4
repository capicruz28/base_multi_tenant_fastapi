2025-11-18 21:29:56,326 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk2LCJpYXQiOjE3NjM1MTkzOTYsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.4Gc1ZOe1yO8cBmvDmjEfZPJZRJCW9dCZBPJOeifMYQg', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk2LCJpYXQiOjE3NjM1MTkzOTYsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.9hjTMgJcls0gH0kJ8aY2o6Mj5UxvOLrl84fu60dKISU'}
2025-11-18 21:29:56,329 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:56,329 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:56,330 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:56,330 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:56,331 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:56,332 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.6ms
2025-11-18 21:29:56,333 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.4ms
2025-11-18 21:29:57,540 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:29:57,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:57,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:57,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:57,541 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:57,541 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:57,542 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:29:57,544 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:29:57,545 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:29:57,547 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:29:57,550 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:29:57,550 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2262, Rotación: True
2025-11-18 21:29:57,552 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:29:57,553 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:29:57,553 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:29:57,553 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2262
2025-11-18 21:29:57,554 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:29:57,554 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.2ms
2025-11-18 21:29:57,561 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:29:57,562 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:57,562 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:57,562 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:57,562 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:57,562 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:57,563 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:29:57,565 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:29:57,565 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:29:57,565 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:29:57,569 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:29:57,569 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:29:57,570 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.8ms
2025-11-18 21:29:57,587 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:57,589 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:57,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:57,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:57,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:57,590 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:57,590 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:57,590 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:57,594 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:57,594 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:57,595 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:57,595 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:57,595 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:57,595 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:57,596 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:57,596 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:57,596 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:57,599 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:57,599 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk3LCJpYXQiOjE3NjM1MTkzOTcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.HFQxKcrxnl9PBFrUvPd2PMnRE9rC-2idsFU8A5oAsJg', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk3LCJpYXQiOjE3NjM1MTkzOTcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.JA4rkpQuI03x2WJTn_WwPNnuQcEuTIU6w5SZkvOj2p4'}
2025-11-18 21:29:57,599 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:57,599 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:57,600 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:57,600 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:57,601 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:57,602 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 14.7ms
2025-11-18 21:29:57,602 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.6ms
2025-11-18 21:29:57,604 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:57,605 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:57,605 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:57,605 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:57,606 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:57,606 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:57,606 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:57,609 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:57,609 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:57,610 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:57,611 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:57,611 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:57,611 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:57,612 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:57,612 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:57,612 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:57,612 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:57,615 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:57,616 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk3LCJpYXQiOjE3NjM1MTkzOTcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.HFQxKcrxnl9PBFrUvPd2PMnRE9rC-2idsFU8A5oAsJg', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk3LCJpYXQiOjE3NjM1MTkzOTcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.JA4rkpQuI03x2WJTn_WwPNnuQcEuTIU6w5SZkvOj2p4'}
2025-11-18 21:29:57,616 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:57,616 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:57,616 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:57,616 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:57,617 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:57,618 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 13.9ms
2025-11-18 21:29:57,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.1ms
2025-11-18 21:29:58,255 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:29:58,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,256 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,256 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,257 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,257 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:29:58,260 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:29:58,261 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:29:58,262 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:29:58,265 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:29:58,266 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2263, Rotación: True
2025-11-18 21:29:58,267 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:29:58,268 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:29:58,268 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:29:58,269 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2263
2025-11-18 21:29:58,270 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:29:58,270 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.4ms
2025-11-18 21:29:58,276 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:29:58,277 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,277 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,277 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,278 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,278 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,278 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:29:58,280 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:29:58,280 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:29:58,280 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:29:58,283 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:29:58,283 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:29:58,284 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.5ms
2025-11-18 21:29:58,302 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:58,302 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:58,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,303 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,304 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,304 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:58,309 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:58,309 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:58,310 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:58,311 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,311 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,311 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,311 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,311 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,312 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:58,315 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:58,315 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.VnqH2eIsHh7MdB7yjj4EHLlmvstiBIDxhkYKt6zWF1M', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.lhZ3m8Nx1POF0INYzdv4UOSB0GqS4AddfzgnBh-nuv4'}
2025-11-18 21:29:58,316 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:58,316 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:58,316 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:58,316 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:58,317 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:58,318 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 16.3ms
2025-11-18 21:29:58,318 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 15.8ms
2025-11-18 21:29:58,322 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:58,323 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,323 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,324 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,324 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,324 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,324 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:58,324 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:58,328 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:58,329 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:58,330 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:58,331 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,331 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,331 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,331 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,331 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,331 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:58,335 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:58,336 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.VnqH2eIsHh7MdB7yjj4EHLlmvstiBIDxhkYKt6zWF1M', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.lhZ3m8Nx1POF0INYzdv4UOSB0GqS4AddfzgnBh-nuv4'}
2025-11-18 21:29:58,336 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:58,337 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:58,337 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:58,337 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:58,339 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:58,340 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.2ms
2025-11-18 21:29:58,341 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 16.5ms
2025-11-18 21:29:58,496 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:29:58,497 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,497 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,497 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,497 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,497 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,497 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:29:58,505 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:29:58,507 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:29:58,509 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:29:58,510 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2263
2025-11-18 21:29:58,510 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2263
2025-11-18 21:29:58,511 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:29:58,511 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.1ms
2025-11-18 21:29:58,515 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:29:58,516 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,516 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,516 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,516 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,516 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,516 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:29:58,518 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:29:58,518 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:29:58,519 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:29:58,521 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:29:58,522 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:29:58,523 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.4ms
2025-11-18 21:29:58,537 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:58,538 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:58,538 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,539 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,539 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,539 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,539 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,539 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:58,544 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:58,544 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:58,545 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:58,545 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,545 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,545 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,545 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,546 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,546 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:58,549 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:58,549 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.VnqH2eIsHh7MdB7yjj4EHLlmvstiBIDxhkYKt6zWF1M', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.lhZ3m8Nx1POF0INYzdv4UOSB0GqS4AddfzgnBh-nuv4'}
2025-11-18 21:29:58,549 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:58,549 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:58,549 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:58,550 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:58,551 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:58,551 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 13.8ms
2025-11-18 21:29:58,551 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.4ms
2025-11-18 21:29:58,554 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:58,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,556 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,556 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,556 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:58,556 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:58,560 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:58,560 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:58,561 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:58,561 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,562 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,562 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,562 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,562 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,562 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:58,565 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:58,565 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.VnqH2eIsHh7MdB7yjj4EHLlmvstiBIDxhkYKt6zWF1M', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.lhZ3m8Nx1POF0INYzdv4UOSB0GqS4AddfzgnBh-nuv4'}
2025-11-18 21:29:58,565 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:58,566 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:58,566 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:58,566 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:58,567 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:58,567 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 13.9ms
2025-11-18 21:29:58,568 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 12.2ms
2025-11-18 21:29:58,707 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:29:58,708 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,708 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,708 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,708 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,708 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,709 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:29:58,711 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:29:58,712 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:29:58,713 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:29:58,715 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2263
2025-11-18 21:29:58,715 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2263
2025-11-18 21:29:58,716 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:29:58,716 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.0ms
2025-11-18 21:29:58,722 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:29:58,723 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,723 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,723 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,724 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,724 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,724 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:29:58,725 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:29:58,726 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:29:58,726 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:29:58,728 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:29:58,728 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:29:58,729 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.5ms
2025-11-18 21:29:58,745 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:58,745 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:58,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,746 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,746 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,746 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:58,750 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:58,750 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:58,751 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:58,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,752 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,752 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,752 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,752 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:58,756 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:58,756 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.VnqH2eIsHh7MdB7yjj4EHLlmvstiBIDxhkYKt6zWF1M', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.lhZ3m8Nx1POF0INYzdv4UOSB0GqS4AddfzgnBh-nuv4'}
2025-11-18 21:29:58,757 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:58,757 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:58,757 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:58,757 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:58,758 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:58,759 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 14.0ms
2025-11-18 21:29:58,759 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.8ms
2025-11-18 21:29:58,761 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:58,761 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,762 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,762 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,762 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,762 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,762 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:58,762 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:58,766 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:58,766 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:58,767 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:58,768 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,768 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,768 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,768 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,768 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,768 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:58,773 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:58,773 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.VnqH2eIsHh7MdB7yjj4EHLlmvstiBIDxhkYKt6zWF1M', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.lhZ3m8Nx1POF0INYzdv4UOSB0GqS4AddfzgnBh-nuv4'}
2025-11-18 21:29:58,773 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:58,773 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:58,773 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:58,774 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:58,775 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:58,776 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.0ms
2025-11-18 21:29:58,777 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.2ms
2025-11-18 21:29:58,918 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:29:58,918 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,919 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,919 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,919 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:29:58,922 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:29:58,924 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:29:58,925 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:29:58,927 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2263
2025-11-18 21:29:58,927 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2263
2025-11-18 21:29:58,927 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:29:58,928 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 10.1ms
2025-11-18 21:29:58,933 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:29:58,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,935 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,935 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,935 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:29:58,937 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:29:58,938 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:29:58,938 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:29:58,941 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:29:58,941 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:29:58,942 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.2ms
2025-11-18 21:29:58,960 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:58,961 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:58,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,962 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,962 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,962 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:58,966 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:58,966 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:58,967 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:58,968 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,968 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,968 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,968 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,968 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,969 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:58,973 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:58,974 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.VnqH2eIsHh7MdB7yjj4EHLlmvstiBIDxhkYKt6zWF1M', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.lhZ3m8Nx1POF0INYzdv4UOSB0GqS4AddfzgnBh-nuv4'}
2025-11-18 21:29:58,974 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:58,974 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:58,974 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:58,975 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:58,976 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:58,977 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 16.3ms
2025-11-18 21:29:58,977 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 16.0ms
2025-11-18 21:29:58,979 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:58,980 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,980 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,980 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,981 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,981 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,981 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:58,981 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:58,985 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:58,985 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:58,987 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:58,988 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:58,988 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:58,988 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:58,988 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:58,988 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:58,988 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:58,993 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:58,993 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.VnqH2eIsHh7MdB7yjj4EHLlmvstiBIDxhkYKt6zWF1M', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk4LCJpYXQiOjE3NjM1MTkzOTgsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.lhZ3m8Nx1POF0INYzdv4UOSB0GqS4AddfzgnBh-nuv4'}
2025-11-18 21:29:58,993 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:58,993 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:58,994 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:58,994 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:58,995 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:58,996 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 16.6ms
2025-11-18 21:29:58,997 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 15.1ms
2025-11-18 21:29:59,119 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:29:59,119 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,120 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,120 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,120 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,120 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:29:59,123 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:29:59,124 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:29:59,125 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:29:59,127 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:29:59,128 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2264, Rotación: True
2025-11-18 21:29:59,129 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:29:59,130 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:29:59,130 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:29:59,130 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2264
2025-11-18 21:29:59,131 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:29:59,131 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.4ms
2025-11-18 21:29:59,136 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:29:59,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,136 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,137 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,137 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,137 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,137 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:29:59,139 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:29:59,139 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:29:59,140 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:29:59,141 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:29:59,142 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:29:59,142 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.8ms
2025-11-18 21:29:59,157 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:59,157 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:59,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,158 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,158 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,159 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:59,163 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:59,163 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:59,164 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:59,165 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,165 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,165 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,165 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,165 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,165 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:59,168 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:59,168 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.Elnws53d9RUCgL1XlmaKSjG6VgD0UUPr6QERCNVzf-k', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.OdyIkNkZ6JdkMAtcUFTcHvNVTAzpbdSRm0I1AulYAjM'}
2025-11-18 21:29:59,169 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:59,169 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:59,169 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:59,169 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:59,171 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:59,172 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 14.7ms
2025-11-18 21:29:59,173 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 15.8ms
2025-11-18 21:29:59,177 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:59,178 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,178 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,178 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,178 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,179 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,179 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:59,184 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:59,184 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:59,186 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:59,187 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:59,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,188 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,188 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,188 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:59,193 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:59,194 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.Elnws53d9RUCgL1XlmaKSjG6VgD0UUPr6QERCNVzf-k', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.OdyIkNkZ6JdkMAtcUFTcHvNVTAzpbdSRm0I1AulYAjM'}
2025-11-18 21:29:59,194 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:59,194 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:59,194 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:59,195 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:59,196 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:59,196 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.6ms
2025-11-18 21:29:59,197 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.4ms
2025-11-18 21:29:59,343 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:29:59,344 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,344 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,344 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,344 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,345 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,345 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:29:59,347 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:29:59,348 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:29:59,349 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:29:59,351 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2264
2025-11-18 21:29:59,351 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2264
2025-11-18 21:29:59,352 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:29:59,352 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.9ms
2025-11-18 21:29:59,358 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:29:59,358 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,358 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,358 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,358 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,359 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,359 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:29:59,360 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:29:59,361 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:29:59,361 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:29:59,363 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:29:59,363 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:29:59,364 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.4ms
2025-11-18 21:29:59,381 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:59,381 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:59,381 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,382 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,382 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,382 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,382 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,382 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:59,386 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:59,386 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:59,387 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:59,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,387 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,388 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,388 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,388 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,388 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:59,392 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:59,392 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.Elnws53d9RUCgL1XlmaKSjG6VgD0UUPr6QERCNVzf-k', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.OdyIkNkZ6JdkMAtcUFTcHvNVTAzpbdSRm0I1AulYAjM'}
2025-11-18 21:29:59,392 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:59,392 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:59,392 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:59,392 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:59,394 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:59,394 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 13.5ms
2025-11-18 21:29:59,395 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.3ms
2025-11-18 21:29:59,396 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:59,397 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,397 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,397 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,397 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,397 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,398 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:59,398 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:59,401 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:59,402 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:59,403 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:59,403 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,403 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,403 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,404 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,404 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,404 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:59,408 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:59,408 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.Elnws53d9RUCgL1XlmaKSjG6VgD0UUPr6QERCNVzf-k', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.OdyIkNkZ6JdkMAtcUFTcHvNVTAzpbdSRm0I1AulYAjM'}
2025-11-18 21:29:59,409 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:59,409 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:59,409 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:59,409 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:59,411 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:59,411 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.0ms
2025-11-18 21:29:59,412 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.9ms
2025-11-18 21:29:59,548 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:29:59,549 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,549 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,549 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,549 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,549 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,549 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:29:59,552 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:29:59,553 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:29:59,554 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:29:59,555 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2264
2025-11-18 21:29:59,556 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2264
2025-11-18 21:29:59,556 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:29:59,557 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 8.9ms
2025-11-18 21:29:59,563 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:29:59,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,563 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,564 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,564 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,564 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,564 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:29:59,566 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:29:59,566 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:29:59,566 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:29:59,569 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:29:59,569 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:29:59,570 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.3ms
2025-11-18 21:29:59,586 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:59,587 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:59,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,588 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,588 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,588 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,588 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,588 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:59,593 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:59,594 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:59,595 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:59,595 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,595 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,596 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,596 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,596 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,596 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:59,599 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:59,599 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.Elnws53d9RUCgL1XlmaKSjG6VgD0UUPr6QERCNVzf-k', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.OdyIkNkZ6JdkMAtcUFTcHvNVTAzpbdSRm0I1AulYAjM'}
2025-11-18 21:29:59,599 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:59,600 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:59,600 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:59,600 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:59,601 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:59,602 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.4ms
2025-11-18 21:29:59,602 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 15.0ms
2025-11-18 21:29:59,604 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:59,606 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,606 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,606 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,606 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,606 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,607 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:59,611 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:59,611 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:59,612 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:59,613 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:59,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,613 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,614 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,614 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:59,617 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:59,617 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.Elnws53d9RUCgL1XlmaKSjG6VgD0UUPr6QERCNVzf-k', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.OdyIkNkZ6JdkMAtcUFTcHvNVTAzpbdSRm0I1AulYAjM'}
2025-11-18 21:29:59,617 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:59,617 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:59,617 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:59,617 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:59,619 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:59,620 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.6ms
2025-11-18 21:29:59,620 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.9ms
2025-11-18 21:29:59,777 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:29:59,778 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,778 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,778 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,778 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,778 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,778 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:29:59,781 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:29:59,783 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:29:59,786 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:29:59,789 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2264
2025-11-18 21:29:59,789 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2264
2025-11-18 21:29:59,789 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:29:59,790 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.1ms
2025-11-18 21:29:59,795 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:29:59,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,795 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,796 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,796 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,796 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,796 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:29:59,798 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:29:59,798 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:29:59,798 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:29:59,801 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:29:59,801 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:29:59,801 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.7ms
2025-11-18 21:29:59,817 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:59,817 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:59,818 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,818 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,818 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,818 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,818 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,818 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:59,823 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:59,823 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:59,824 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:59,825 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,825 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,825 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,825 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,825 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,826 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:59,829 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:59,829 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.Elnws53d9RUCgL1XlmaKSjG6VgD0UUPr6QERCNVzf-k', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.OdyIkNkZ6JdkMAtcUFTcHvNVTAzpbdSRm0I1AulYAjM'}
2025-11-18 21:29:59,830 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:59,830 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:59,830 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:59,830 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:59,831 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:59,832 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.2ms
2025-11-18 21:29:59,832 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 15.1ms
2025-11-18 21:29:59,834 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:29:59,834 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,835 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,835 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,835 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:29:59,836 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:29:59,840 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:29:59,840 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:29:59,841 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:29:59,842 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:29:59,842 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:29:59,842 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:29:59,842 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:29:59,843 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:29:59,843 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:29:59,847 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:29:59,847 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMjk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.Elnws53d9RUCgL1XlmaKSjG6VgD0UUPr6QERCNVzf-k', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MTk5LCJpYXQiOjE3NjM1MTkzOTksInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.OdyIkNkZ6JdkMAtcUFTcHvNVTAzpbdSRm0I1AulYAjM'}
2025-11-18 21:29:59,847 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:29:59,848 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:29:59,848 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:29:59,848 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:29:59,849 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:29:59,850 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 16.0ms
2025-11-18 21:29:59,851 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 15.0ms
2025-11-18 21:30:00,035 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:30:00,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:30:00,036 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:30:00,036 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:30:00,036 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:30:00,036 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:30:00,036 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:30:00,040 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:30:00,041 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:30:00,043 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:30:00,046 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:30:00,046 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2265, Rotación: True
2025-11-18 21:30:00,050 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:30:00,051 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:30:00,051 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:30:00,051 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2265
2025-11-18 21:30:00,052 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:30:00,053 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 17.7ms
2025-11-18 21:30:00,059 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:30:00,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:30:00,060 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:30:00,061 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:30:00,061 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:30:00,061 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:30:00,061 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:30:00,063 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:30:00,063 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:30:00,064 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:30:00,066 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:30:00,066 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:30:00,067 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.6ms
2025-11-18 21:30:00,083 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:30:00,084 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:30:00,085 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:30:00,085 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:30:00,085 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:30:00,085 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:30:00,085 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:30:00,085 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:30:00,090 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:30:00,090 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:30:00,091 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:30:00,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:30:00,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:30:00,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:30:00,092 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:30:00,092 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:30:00,092 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:30:00,096 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:30:00,096 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMzAwLCJpYXQiOjE3NjM1MTk0MDAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.y0nudvyeYXBRp4jjydnLZ1Px31R5SwRb2aLgeAwgCVY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MjAwLCJpYXQiOjE3NjM1MTk0MDAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.TwHiaD-08U2lN40Zqf7JDzSfO6rCcFXzUxRqNUJcDmM'}
2025-11-18 21:30:00,096 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:30:00,096 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:30:00,097 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:30:00,097 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:30:00,098 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:30:00,098 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 14.8ms
2025-11-18 21:30:00,099 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.4ms
2025-11-18 21:30:00,100 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:30:00,101 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:30:00,101 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:30:00,101 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:30:00,101 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:30:00,102 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:30:00,102 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:30:00,102 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:30:00,106 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:30:00,107 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:30:00,108 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:30:00,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:30:00,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:30:00,109 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:30:00,109 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:30:00,109 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:30:00,109 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:30:00,112 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:30:00,113 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIwMzAwLCJpYXQiOjE3NjM1MTk0MDAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.y0nudvyeYXBRp4jjydnLZ1Px31R5SwRb2aLgeAwgCVY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI0MjAwLCJpYXQiOjE3NjM1MTk0MDAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.TwHiaD-08U2lN40Zqf7JDzSfO6rCcFXzUxRqNUJcDmM'}
2025-11-18 21:30:00,113 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:30:00,113 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:30:00,113 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:30:00,113 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:30:00,114 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:30:00,115 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 14.8ms
2025-11-18 21:30:00,116 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.6ms
2025-11-18 21:30:06,231 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-18 21:30:06,232 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-18 21:30:06,234 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-18 21:30:06,234 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:30:06,234 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:30:06,235 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:30:06,235 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:30:06,235 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:30:06,235 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-18 21:30:06,237 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:30:06,238 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:30:06,238 - app.api.v1.endpoints.auth - WARNING - [LOGOUT-WEB] Token no encontrado en BD - Cliente: 1, Usuario: 1 (superadmin)
2025-11-18 21:30:06,239 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 4.7ms
2025-11-18 21:30:07,996 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:30:07,997 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:30:07,997 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:30:07,997 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:30:07,997 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:30:07,998 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:30:07,998 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:30:07,999 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 21:30:08,000 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.6ms
2025-11-18 21:45:03,772 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'backend', 'www', 'admin', 'cdn', 'static', 'assets', 'api'}
2025-11-18 21:45:15,901 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'static', 'api', 'assets', 'admin', 'www', 'backend', 'cdn'}
2025-11-18 21:45:21,500 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 21:45:21,501 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.9ms
2025-11-18 21:45:21,504 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:45:21,505 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:45:21,505 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:45:21,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:45:21,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:45:21,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:45:21,640 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:45:21,646 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 21:45:21,646 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 4: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 21:45:21,647 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 4, usando Single-DB como fallback
2025-11-18 21:45:21,647 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:45:21,647 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:45:21,649 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 21:45:21,650 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.9ms
2025-11-18 21:45:21,650 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 21:45:21,652 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.2ms
2025-11-18 21:45:21,653 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 21:45:21,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 151.0ms
2025-11-18 21:45:21,655 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:45:21,656 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:45:21,657 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:45:21,657 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:45:21,657 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:45:21,657 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:45:21,686 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:45:21,686 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:45:21,688 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:45:21,689 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:45:21,689 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-18 21:45:21,689 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-18 21:45:21,689 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:45:21,690 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-18 21:45:21,690 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-18 21:45:21,690 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:45:21,690 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:45:21,692 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 21:45:21,693 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 21:45:21,694 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 38.2ms
2025-11-18 21:45:21,695 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 7.0ms
2025-11-18 21:45:26,539 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 21:45:26,540 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-18 21:45:26,542 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:45:26,542 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:45:26,543 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:45:26,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:45:26,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:45:26,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:45:26,545 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:45:26,545 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:45:26,545 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:45:26,547 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-18 21:45:26,547 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 5.5ms
2025-11-18 21:46:49,485 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 21:46:49,485 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-18 21:46:49,487 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 21:46:49,487 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:46:49,487 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:46:49,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:46:49,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:46:49,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:46:49,507 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:46:49,508 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:46:49,508 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 21:46:49,515 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-18 21:46:49,515 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-18 21:46:49,515 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-18 21:46:49,761 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 21:46:49,761 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-18 21:46:49,768 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 21:46:49,782 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:46:49,783 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2266, Rotación: False
2025-11-18 21:46:49,783 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2266
2025-11-18 21:46:49,783 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-18 21:46:49,784 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 297.4ms
2025-11-18 21:46:49,825 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 21:46:49,827 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.6ms
2025-11-18 21:46:49,830 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 21:46:49,831 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 21:46:49,832 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:46:49,832 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 21:46:49,834 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 4.2ms
2025-11-18 21:46:49,835 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 3.9ms
2025-11-18 21:46:49,835 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:46:49,835 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:46:49,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:46:49,836 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:46:49,836 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:46:49,837 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:46:49,838 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:46:49,838 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:46:49,866 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 21:46:49,866 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 21:46:49,932 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 21:46:49,933 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 100.6ms
2025-11-18 21:46:49,935 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 103.4ms
2025-11-18 21:46:49,935 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 21:46:49,937 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:46:49,937 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:46:49,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:46:49,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:46:49,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:46:49,938 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:46:49,939 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:46:49,939 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 21:46:49,952 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 21:46:49,953 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:46:49,954 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:46:49,954 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:46:49,955 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:46:49,955 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:46:49,955 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:46:49,956 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:46:49,956 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:46:49,956 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:46:49,957 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 21:46:49,962 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 21:46:49,962 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 21:46:49,963 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 21:46:49,964 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:46:49,964 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:46:49,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:46:49,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:46:49,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:46:49,966 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:46:49,966 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:46:49,967 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 21:46:49,972 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 21:46:49,972 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 36.8ms
2025-11-18 21:46:49,973 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.0ms
2025-11-18 21:46:49,974 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 17.1ms
2025-11-18 21:46:57,880 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 21:46:57,880 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-18 21:46:57,883 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:46:57,884 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:46:57,884 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:46:57,884 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:46:57,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:46:57,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:46:57,894 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:46:57,894 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:46:57,895 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:46:57,899 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 4, Usuario 2, Tipo: web
2025-11-18 21:46:57,902 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_tech (Cliente: 4, Level: 4, Type: tenant_admin)
2025-11-18 21:46:57,906 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 21:46:57,917 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:46:57,918 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2267, Rotación: True
2025-11-18 21:46:57,925 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:46:57,925 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 4, Usuario 2
2025-11-18 21:46:57,926 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:46:57,926 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2267
2025-11-18 21:46:57,926 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_tech
2025-11-18 21:46:57,927 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 43.6ms
2025-11-18 21:46:57,932 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 21:46:57,933 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.7ms
2025-11-18 21:46:57,936 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:46:57,936 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:46:57,936 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:46:57,936 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:46:57,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:46:57,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:46:57,938 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:46:57,938 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:46:57,938 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:46:57,940 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_tech
2025-11-18 21:46:57,940 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-18 21:46:57,940 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 4 para cliente 2
2025-11-18 21:46:57,941 - app.services.usuario_service - WARNING - Usuario ID 4 no encontrado en cliente 2 o está eliminado
2025-11-18 21:46:57,941 - app.api.v1.endpoints.auth - ERROR - Usuario 2 no encontrado en cliente 4
2025-11-18 21:46:57,941 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 404 5.7ms
2025-11-18 21:47:11,563 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:47:11,564 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:11,564 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:11,564 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:11,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:11,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:11,568 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:11,569 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:47:11,572 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 1
2025-11-18 21:47:11,572 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: admin_tech
2025-11-18 21:47:11,573 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 9.7ms
2025-11-18 21:47:21,530 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 21:47:21,530 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-18 21:47:21,532 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 21:47:21,532 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:21,533 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:21,533 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:21,533 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:21,533 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:21,535 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:21,535 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 21:47:21,540 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 21:47:21,541 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 21:47:21,541 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 21:47:21,753 - app.core.auth - WARNING - [AUTH] Contraseña incorrecta para: username='superadmin', usuario_id=1
2025-11-18 21:47:21,754 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 401 222.3ms
2025-11-18 21:47:32,060 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 21:47:32,060 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:32,061 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:32,061 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:32,061 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:32,061 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:32,063 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:32,063 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 21:47:32,066 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 21:47:32,066 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 21:47:32,066 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 21:47:32,283 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:47:32,283 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 21:47:32,284 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 21:47:32,284 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:47:32,287 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:47:32,288 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2268, Rotación: False
2025-11-18 21:47:32,288 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2268
2025-11-18 21:47:32,288 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 21:47:32,288 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 228.7ms
2025-11-18 21:47:32,312 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 21:47:32,313 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-18 21:47:32,315 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 21:47:32,315 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 21:47:32,315 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 21:47:32,318 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 3.0ms
2025-11-18 21:47:32,318 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 3.1ms
2025-11-18 21:47:32,318 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 3.1ms
2025-11-18 21:47:32,319 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:47:32,320 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 21:47:32,320 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 21:47:32,322 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:32,322 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:32,322 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:32,322 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:32,322 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:32,325 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:32,325 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:47:32,341 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:47:32,341 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:47:32,385 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:47:32,386 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 66.4ms
2025-11-18 21:47:32,386 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 66.1ms
2025-11-18 21:47:32,388 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:47:32,389 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:47:32,389 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 70.1ms
2025-11-18 21:47:32,389 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:32,389 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:32,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:32,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:32,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:32,392 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:32,393 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:47:32,393 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:32,393 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:32,393 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:32,393 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:32,393 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:32,396 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:32,396 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:47:32,406 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:47:32,409 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:47:32,409 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:47:32,416 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:47:32,416 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:47:32,427 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:47:32,427 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:47:32,429 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 40.5ms
2025-11-18 21:47:32,429 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 40.5ms
2025-11-18 21:47:32,429 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:47:32,430 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:32,431 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:32,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:32,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:32,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:32,434 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:32,435 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:47:32,439 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:47:32,439 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:47:32,440 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:47:32,442 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:47:32,442 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:32,442 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:32,443 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:32,443 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:32,443 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:32,445 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:32,445 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:47:32,451 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:47:32,452 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:47:32,452 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:47:32,453 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:47:32,453 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 23.5ms
2025-11-18 21:47:32,453 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:32,453 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:32,454 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:32,454 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:32,454 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:32,456 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:32,456 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:47:32,462 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:47:32,462 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:47:32,465 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:47:32,465 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:47:32,466 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 24.5ms
2025-11-18 21:47:32,467 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 14.8ms
2025-11-18 21:47:33,977 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:47:33,977 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:33,978 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:33,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:33,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:33,978 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:33,981 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:33,981 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:47:33,984 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:47:33,986 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:47:33,987 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:47:33,990 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:47:33,991 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2269, Rotación: True
2025-11-18 21:47:33,995 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:47:33,996 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:47:33,996 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:47:33,996 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2269
2025-11-18 21:47:33,997 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:47:33,997 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 20.6ms
2025-11-18 21:47:34,003 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 21:47:34,004 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.8ms
2025-11-18 21:47:34,006 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:47:34,007 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,007 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,007 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,007 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,007 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,010 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,010 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:47:34,012 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:47:34,012 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:47:34,012 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:47:34,015 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:47:34,015 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:47:34,016 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.4ms
2025-11-18 21:47:34,032 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:47:34,033 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:47:34,033 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:47:34,034 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,034 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,034 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,034 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,038 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,038 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:47:34,042 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:47:34,042 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:47:34,043 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:47:34,044 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,044 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,044 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,044 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,044 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,047 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,047 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:47:34,047 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,047 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,047 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,048 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,048 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,050 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,051 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:47:34,057 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:47:34,058 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:47:34,058 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:47:34,063 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:47:34,063 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:47:34,067 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:47:34,068 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:47:34,069 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 36.1ms
2025-11-18 21:47:34,069 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 35.8ms
2025-11-18 21:47:34,069 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 35.7ms
2025-11-18 21:47:34,072 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:47:34,073 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:47:34,073 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,074 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,074 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,074 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,074 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,077 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,077 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:47:34,081 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:47:34,082 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:47:34,083 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:47:34,083 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,083 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,084 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,087 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,087 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:47:34,093 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:47:34,093 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:47:34,094 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:47:34,094 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:47:34,095 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,095 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,098 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,098 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:47:34,104 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:47:34,104 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:47:34,108 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:47:34,108 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:47:34,109 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 36.8ms
2025-11-18 21:47:34,109 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 36.5ms
2025-11-18 21:47:34,110 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 16.3ms
2025-11-18 21:47:34,621 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:47:34,622 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,622 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,625 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,626 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:47:34,630 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:47:34,631 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:47:34,633 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:47:34,637 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:47:34,639 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2270, Rotación: True
2025-11-18 21:47:34,640 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:47:34,641 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:47:34,641 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:47:34,641 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2270
2025-11-18 21:47:34,641 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:47:34,642 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 20.7ms
2025-11-18 21:47:34,750 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:47:34,750 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,751 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,751 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,754 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,754 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:47:34,757 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:47:34,759 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:47:34,760 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:47:34,762 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2270
2025-11-18 21:47:34,762 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2270
2025-11-18 21:47:34,762 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:47:34,762 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.7ms
2025-11-18 21:47:34,767 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:47:34,768 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,768 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,768 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,768 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,772 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,772 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:47:34,774 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:47:34,774 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:47:34,774 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:47:34,776 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:47:34,776 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:47:34,777 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.6ms
2025-11-18 21:47:34,883 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:47:34,883 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,883 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,883 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,884 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,884 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,887 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,887 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:47:34,891 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:47:34,892 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:47:34,893 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:47:34,895 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2270
2025-11-18 21:47:34,895 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2270
2025-11-18 21:47:34,895 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:47:34,896 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.1ms
2025-11-18 21:47:34,899 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:47:34,900 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,900 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,900 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,900 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,900 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,903 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,904 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:47:34,906 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:47:34,906 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:47:34,906 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:47:34,908 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:47:34,908 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:47:34,909 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.7ms
2025-11-18 21:47:34,923 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:47:34,924 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:47:34,924 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:47:34,925 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,925 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,925 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,926 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,926 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,929 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,929 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:47:34,933 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:47:34,933 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:47:34,934 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:47:34,934 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,934 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,935 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,938 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,938 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:47:34,939 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,939 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,939 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,939 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,939 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,942 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,942 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:47:34,947 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:47:34,948 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:47:34,951 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:47:34,952 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:47:34,958 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:47:34,959 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:47:34,959 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:47:34,961 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:47:34,961 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 38.1ms
2025-11-18 21:47:34,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:34,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:34,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:34,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:34,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:34,965 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:34,965 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:47:34,966 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 41.9ms
2025-11-18 21:47:34,966 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 41.9ms
2025-11-18 21:47:34,972 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:47:34,972 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:47:34,974 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:47:34,975 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 14.5ms
2025-11-18 21:47:35,047 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:47:35,048 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:35,048 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:35,049 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:35,049 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:35,049 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:35,052 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:35,052 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:47:35,055 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:47:35,056 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:47:35,058 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:47:35,060 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:47:35,061 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2271, Rotación: True
2025-11-18 21:47:35,062 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:47:35,062 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:47:35,062 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:47:35,063 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2271
2025-11-18 21:47:35,063 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:47:35,064 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.1ms
2025-11-18 21:47:35,067 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:47:35,068 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:35,068 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:35,068 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:35,069 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:35,069 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:35,072 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:35,072 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:47:35,074 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:47:35,074 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:47:35,074 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:47:35,076 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:47:35,076 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:47:35,077 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.6ms
2025-11-18 21:47:35,093 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:47:35,094 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:35,094 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:35,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:35,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:35,095 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:35,097 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:35,098 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:47:35,098 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:47:35,098 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:47:35,101 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:47:35,101 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:47:35,102 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:47:35,103 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:35,103 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:35,103 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:35,104 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:35,104 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:35,106 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:35,106 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:47:35,107 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:35,107 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:35,107 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:35,107 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:35,107 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:35,109 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:35,110 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:47:35,114 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:47:35,115 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:47:35,115 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:47:35,119 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:47:35,120 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:47:35,125 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:47:35,125 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:47:35,126 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 32.3ms
2025-11-18 21:47:35,126 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 28.5ms
2025-11-18 21:47:35,127 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 28.4ms
2025-11-18 21:47:35,129 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:47:35,130 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:47:35,131 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:35,131 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:35,131 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:35,131 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:35,131 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:35,134 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:35,134 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:47:35,135 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:35,135 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:35,135 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:35,135 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:35,135 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:35,139 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:35,139 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:47:35,139 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:47:35,143 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:47:35,144 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:47:35,144 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:47:35,147 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:47:35,147 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:47:35,148 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:47:35,149 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:47:35,149 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:47:35,149 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:47:35,149 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:47:35,149 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:47:35,152 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:47:35,152 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:47:35,158 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:47:35,158 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:47:35,162 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:47:35,162 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:47:35,163 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 33.5ms
2025-11-18 21:47:35,163 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 33.0ms
2025-11-18 21:47:35,164 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.5ms
2025-11-18 21:49:21,363 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:49:21,364 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:49:21,364 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:49:21,364 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:49:21,365 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:49:21,365 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:49:21,368 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:49:21,368 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:49:21,384 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:49:21,385 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:49:21,388 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:49:21,396 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:49:21,396 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2272, Rotación: True
2025-11-18 21:49:21,401 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:49:21,402 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:49:21,402 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:49:21,402 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2272
2025-11-18 21:49:21,402 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:49:21,403 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 39.6ms
2025-11-18 21:49:21,407 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:49:21,408 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:49:21,408 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:49:21,408 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:49:21,408 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:49:21,408 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:49:21,411 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:49:21,411 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:49:21,413 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:49:21,413 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:49:21,413 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:49:21,415 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:49:21,416 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:49:21,416 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.3ms
2025-11-18 21:49:21,431 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:49:21,431 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:49:21,432 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:49:21,432 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:49:21,432 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:49:21,432 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:49:21,434 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:49:21,435 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:49:21,435 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:49:21,435 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:49:21,455 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:49:21,456 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:49:21,511 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:49:21,512 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:49:21,512 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:49:21,512 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:49:21,513 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:49:21,513 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:49:21,515 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:49:21,515 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:49:21,515 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:49:21,515 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:49:21,516 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:49:21,516 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:49:21,516 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:49:21,518 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:49:21,518 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:49:21,529 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:49:21,529 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:49:21,540 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:49:21,541 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:49:21,546 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:49:21,548 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:49:21,549 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:49:21,549 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 118.6ms
2025-11-18 21:49:21,550 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 115.0ms
2025-11-18 21:49:21,550 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 115.0ms
2025-11-18 21:49:21,553 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:49:21,554 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:49:21,555 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:49:21,556 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:49:21,556 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:49:21,556 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:49:21,556 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:49:21,559 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:49:21,559 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:49:21,561 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:49:21,561 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:49:21,561 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:49:21,561 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:49:21,561 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:49:21,564 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:49:21,564 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:49:21,565 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:49:21,571 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:49:21,571 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:49:21,575 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:49:21,576 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:49:21,579 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:49:21,579 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:49:21,580 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:49:21,581 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:49:21,581 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:49:21,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:49:21,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:49:21,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:49:21,584 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:49:21,584 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:49:21,590 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:49:21,591 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:49:21,591 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:49:21,592 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 38.5ms
2025-11-18 21:49:21,592 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 38.1ms
2025-11-18 21:49:21,593 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 28.5ms
2025-11-18 21:53:48,258 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:53:48,258 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:48,259 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:48,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:48,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:48,259 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:48,263 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:48,263 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:53:48,283 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:53:48,284 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:53:48,286 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:53:48,296 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:53:48,297 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2273, Rotación: True
2025-11-18 21:53:48,302 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:53:48,303 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:53:48,303 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:53:48,303 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2273
2025-11-18 21:53:48,303 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:53:48,304 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 46.4ms
2025-11-18 21:53:48,310 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:53:48,310 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:48,311 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:48,311 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:48,311 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:48,311 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:48,314 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:48,314 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:53:48,316 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:53:48,316 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:53:48,316 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:53:48,319 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:53:48,319 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:53:48,320 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.2ms
2025-11-18 21:53:48,336 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:53:48,337 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:48,337 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:48,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:48,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:48,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:48,341 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:48,341 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:53:48,362 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:53:48,362 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:53:48,427 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:53:48,428 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:53:48,428 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:53:48,429 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:48,429 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:48,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:48,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:48,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:48,432 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:48,432 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:53:48,432 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:48,433 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:48,433 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:48,433 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:48,433 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:48,435 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:48,435 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:53:48,436 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 99.9ms
2025-11-18 21:53:48,446 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:53:48,449 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:53:48,449 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:53:48,455 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:53:48,455 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:53:48,468 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:53:48,468 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:53:48,469 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 41.4ms
2025-11-18 21:53:48,469 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 41.2ms
2025-11-18 21:53:48,471 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:53:48,472 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:48,472 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:48,473 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:48,473 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:48,473 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:48,476 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:48,476 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:53:48,480 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:53:48,480 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:53:48,481 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:53:48,482 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:53:48,482 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:53:48,483 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:48,483 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:48,483 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:48,483 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:48,483 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:48,486 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:48,486 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:53:48,486 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:48,486 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:48,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:48,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:48,487 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:48,489 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:48,490 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:53:48,490 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.9ms
2025-11-18 21:53:48,495 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:53:48,496 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:53:48,496 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:53:48,500 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:53:48,500 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:53:48,504 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:53:48,504 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:53:48,505 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 23.1ms
2025-11-18 21:53:48,506 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 23.2ms
2025-11-18 21:53:55,831 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:53:55,831 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:55,832 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:55,832 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:55,832 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:55,832 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:55,835 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:55,835 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:53:55,838 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:53:55,840 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:53:55,841 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:53:55,844 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:53:55,844 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2274, Rotación: True
2025-11-18 21:53:55,845 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:53:55,846 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:53:55,846 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:53:55,846 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2274
2025-11-18 21:53:55,846 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:53:55,847 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.0ms
2025-11-18 21:53:55,852 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:53:55,853 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:55,853 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:55,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:55,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:55,853 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:55,856 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:55,856 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:53:55,857 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:53:55,857 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:53:55,858 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:53:55,860 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:53:55,860 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:53:55,860 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.2ms
2025-11-18 21:53:55,876 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:53:55,877 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:55,877 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:55,877 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:55,877 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:55,878 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:55,880 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:55,881 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:53:55,881 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:53:55,881 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:53:55,885 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:53:55,885 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:53:55,886 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:53:55,887 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:55,887 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:55,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:55,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:55,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:55,889 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:55,890 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:53:55,890 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:55,890 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:55,890 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:55,890 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:55,890 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:55,892 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:55,893 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:53:55,898 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:53:55,899 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:53:55,903 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:53:55,903 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:53:55,907 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:53:55,908 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:53:55,908 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:53:55,909 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 32.6ms
2025-11-18 21:53:55,909 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 28.5ms
2025-11-18 21:53:55,910 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 28.4ms
2025-11-18 21:53:55,913 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:53:55,913 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:53:55,915 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:55,915 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:55,915 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:55,915 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:55,915 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:55,918 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:55,918 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:53:55,919 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:55,919 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:55,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:55,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:55,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:55,922 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:55,922 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:53:55,922 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:53:55,927 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:53:55,927 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:53:55,932 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:53:55,932 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:53:55,936 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:53:55,936 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:53:55,937 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:53:55,937 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:53:55,937 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:53:55,937 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:53:55,938 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:53:55,938 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:53:55,940 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:53:55,940 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:53:55,945 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:53:55,946 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:53:55,946 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:53:55,947 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 33.9ms
2025-11-18 21:53:55,947 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 33.3ms
2025-11-18 21:53:55,948 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 25.9ms
2025-11-18 21:54:00,444 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:00,445 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:00,445 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:00,445 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:00,445 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:00,446 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:00,448 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:00,448 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:00,451 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:00,453 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:00,454 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:00,457 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:54:00,457 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2275, Rotación: True
2025-11-18 21:54:00,458 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:54:00,459 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:54:00,459 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:54:00,459 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2275
2025-11-18 21:54:00,459 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:00,460 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.5ms
2025-11-18 21:54:00,469 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:00,470 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:00,470 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:00,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:00,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:00,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:00,473 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:00,473 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:00,474 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:00,474 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:00,474 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:00,476 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:00,477 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:00,477 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.8ms
2025-11-18 21:54:00,492 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:00,492 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:54:00,493 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:54:00,493 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:00,493 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:00,493 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:00,493 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:00,494 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:00,496 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:00,496 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:00,500 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:00,500 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:00,501 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:00,501 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:00,502 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:00,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:00,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:00,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:00,505 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:00,505 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:54:00,505 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:00,505 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:00,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:00,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:00,505 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:00,508 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:00,508 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:54:00,512 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:54:00,513 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:54:00,516 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:54:00,516 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:54:00,521 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:54:00,522 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:54:00,522 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:54:00,522 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.5ms
2025-11-18 21:54:00,523 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 30.2ms
2025-11-18 21:54:00,523 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 30.0ms
2025-11-18 21:54:00,525 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:00,525 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:00,525 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:00,526 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:00,526 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:00,526 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:00,529 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:00,529 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:00,529 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 21:54:00,532 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:00,533 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:00,534 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:00,534 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:00,535 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:00,535 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:00,535 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:00,535 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:00,538 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:00,538 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 21:54:00,538 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 21:54:00,543 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 21:54:00,543 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 21:54:00,546 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 21:54:00,546 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 21:54:00,547 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:00,547 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:00,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:00,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:00,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:00,550 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:00,550 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 21:54:00,555 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 21:54:00,556 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 21:54:00,556 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 21:54:00,557 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 32.0ms
2025-11-18 21:54:00,557 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 28.1ms
2025-11-18 21:54:00,558 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 19.6ms
2025-11-18 21:54:03,317 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 21:54:03,318 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-18 21:54:03,318 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 21:54:03,319 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-18 21:54:03,321 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:03,321 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:03,321 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:03,321 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:03,322 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:03,322 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:03,325 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:03,325 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:03,330 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:03,330 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzQwLCJpYXQiOjE3NjM1MjA4NDAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.SG9nw7C8o6eHoqweSdgOigxvyObSAa-eXHTrSujfa8A', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjQwLCJpYXQiOjE3NjM1MjA4NDAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.EjRxBbnhQSOhbim0l4fqk4q0COS_HbCqy_vUYUhd0RI'}
2025-11-18 21:54:03,330 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:03,330 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:03,331 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:03,331 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:03,334 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:03,335 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.3ms
2025-11-18 21:54:03,336 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:03,337 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:03,337 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:03,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:03,337 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:03,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:03,341 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:03,341 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:03,344 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:03,345 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzQwLCJpYXQiOjE3NjM1MjA4NDAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.SG9nw7C8o6eHoqweSdgOigxvyObSAa-eXHTrSujfa8A', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjQwLCJpYXQiOjE3NjM1MjA4NDAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.EjRxBbnhQSOhbim0l4fqk4q0COS_HbCqy_vUYUhd0RI'}
2025-11-18 21:54:03,345 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:03,345 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:03,345 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:03,345 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:03,346 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:03,347 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.5ms
2025-11-18 21:54:04,616 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 21:54:04,617 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.7ms
2025-11-18 21:54:04,618 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 21:54:04,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.9ms
2025-11-18 21:54:04,620 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:04,620 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:04,620 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:04,620 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:04,621 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:04,621 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:04,623 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:04,623 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:04,629 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:04,629 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:04,635 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:04,635 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 15.9ms
2025-11-18 21:54:04,637 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:04,638 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:04,638 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:04,638 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:04,639 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:04,639 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:04,642 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:04,642 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:04,646 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:04,646 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:04,647 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:04,648 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.2ms
2025-11-18 21:54:05,440 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 21:54:05,441 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.6ms
2025-11-18 21:54:05,442 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 21:54:05,443 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.1ms
2025-11-18 21:54:05,444 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:05,445 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-18 21:54:05,446 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-18 21:54:05,450 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,450 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,450 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,450 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,451 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,453 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,454 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:05,459 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:05,459 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzQwLCJpYXQiOjE3NjM1MjA4NDAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.SG9nw7C8o6eHoqweSdgOigxvyObSAa-eXHTrSujfa8A', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjQwLCJpYXQiOjE3NjM1MjA4NDAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.EjRxBbnhQSOhbim0l4fqk4q0COS_HbCqy_vUYUhd0RI'}
2025-11-18 21:54:05,460 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:05,460 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:05,460 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:05,460 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:05,461 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:05,462 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 16.8ms
2025-11-18 21:54:05,462 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 16.6ms
2025-11-18 21:54:05,463 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:05,464 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,464 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,464 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,464 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,464 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,466 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,467 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:05,470 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:05,470 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:05,471 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:05,472 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 27.7ms
2025-11-18 21:54:05,473 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.5ms
2025-11-18 21:54:05,475 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:05,475 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:05,476 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,476 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,479 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,479 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:05,483 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:05,483 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzQwLCJpYXQiOjE3NjM1MjA4NDAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.SG9nw7C8o6eHoqweSdgOigxvyObSAa-eXHTrSujfa8A', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjQwLCJpYXQiOjE3NjM1MjA4NDAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.EjRxBbnhQSOhbim0l4fqk4q0COS_HbCqy_vUYUhd0RI'}
2025-11-18 21:54:05,484 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:05,484 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:05,484 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:05,484 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:05,485 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:05,486 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,486 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,486 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,486 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,486 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,489 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,490 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:05,493 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:05,494 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:05,495 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:05,495 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/conexiones/clientes/2
2025-11-18 21:54:05,496 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/conexiones/clientes/2
2025-11-18 21:54:05,496 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 21.5ms
2025-11-18 21:54:05,497 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/conexiones/clientes/2 200 1.3ms
2025-11-18 21:54:05,497 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/conexiones/clientes/2 200 1.1ms
2025-11-18 21:54:05,497 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 21.7ms
2025-11-18 21:54:05,500 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:05,500 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:05,501 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,501 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,501 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,501 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,504 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,505 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:05,509 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:05,509 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzQwLCJpYXQiOjE3NjM1MjA4NDAsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.SG9nw7C8o6eHoqweSdgOigxvyObSAa-eXHTrSujfa8A', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjQwLCJpYXQiOjE3NjM1MjA4NDAsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.EjRxBbnhQSOhbim0l4fqk4q0COS_HbCqy_vUYUhd0RI'}
2025-11-18 21:54:05,509 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:05,509 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:05,510 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:05,510 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:05,511 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:05,511 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,512 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,512 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,512 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,512 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,514 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,515 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:05,515 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:05,518 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:05,519 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:05,521 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:05,522 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,522 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,522 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,525 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,526 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:05,529 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:05,530 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:05,530 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:05,531 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 31.2ms
2025-11-18 21:54:05,531 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 30.9ms
2025-11-18 21:54:05,532 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 17.3ms
2025-11-18 21:54:05,534 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:05,534 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,534 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,535 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,535 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,535 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,538 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,538 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:05,542 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:05,542 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:05,543 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:05,544 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 10.6ms
2025-11-18 21:54:05,546 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:05,546 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,547 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,547 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,550 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,550 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:05,553 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:05,554 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:05,555 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:05,555 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 9.7ms
2025-11-18 21:54:05,558 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:05,558 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,559 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,559 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,559 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,559 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,562 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,562 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:05,566 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:05,566 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:05,567 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:05,567 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 9.7ms
2025-11-18 21:54:05,904 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:05,905 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,905 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,905 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,905 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,905 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,908 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,909 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:05,911 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:05,912 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:05,914 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:05,916 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:54:05,917 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2276, Rotación: True
2025-11-18 21:54:05,918 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:54:05,919 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:54:05,919 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:54:05,919 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2276
2025-11-18 21:54:05,919 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:05,920 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.1ms
2025-11-18 21:54:05,926 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:05,926 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,926 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,926 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,927 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,927 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,929 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,930 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:05,931 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:05,931 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:05,931 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:05,934 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:05,934 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:05,934 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.6ms
2025-11-18 21:54:05,951 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:05,952 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:05,952 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:05,952 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,952 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,952 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,953 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,953 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,955 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,955 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:05,960 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:05,960 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:05,961 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:05,961 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,964 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,964 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:05,965 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,965 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,968 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,968 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:05,978 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:05,978 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzQ1LCJpYXQiOjE3NjM1MjA4NDUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.A36Nfb08U3Yc8XndifrmNNQFrhI7lqwdzhCTqYz4x90', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjQ1LCJpYXQiOjE3NjM1MjA4NDUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.8PSaPho5Qj28mUOW6s2ZhtOZYs297ngVtN_W61NFw-Q'}
2025-11-18 21:54:05,978 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:05,978 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:05,978 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:05,979 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:05,980 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:05,984 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:05,985 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:05,986 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:05,987 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 35.8ms
2025-11-18 21:54:05,987 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 35.3ms
2025-11-18 21:54:05,987 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 35.3ms
2025-11-18 21:54:05,992 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:05,993 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:05,993 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:05,993 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:05,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:05,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:05,998 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:05,998 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:06,003 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:06,003 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:06,004 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:06,005 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:06,006 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:06,006 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:06,006 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:06,006 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:06,006 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:06,007 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:06,010 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:06,010 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:06,010 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:06,011 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:06,011 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:06,011 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:06,011 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:06,014 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:06,014 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:06,020 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:06,021 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzQ1LCJpYXQiOjE3NjM1MjA4NDUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.A36Nfb08U3Yc8XndifrmNNQFrhI7lqwdzhCTqYz4x90', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjQ1LCJpYXQiOjE3NjM1MjA4NDUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.8PSaPho5Qj28mUOW6s2ZhtOZYs297ngVtN_W61NFw-Q'}
2025-11-18 21:54:06,021 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:06,021 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:06,021 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:06,021 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:06,023 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:06,027 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:06,027 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:06,028 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:06,028 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 35.9ms
2025-11-18 21:54:06,030 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:06,030 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:06,030 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:06,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:06,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:06,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:06,033 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:06,033 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:06,034 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 28.1ms
2025-11-18 21:54:06,034 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 28.1ms
2025-11-18 21:54:06,037 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:06,037 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:06,038 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:06,040 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 10.1ms
2025-11-18 21:54:06,041 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:06,042 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:06,042 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:06,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:06,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:06,043 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:06,046 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:06,046 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:06,046 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:06,050 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:06,050 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzQ1LCJpYXQiOjE3NjM1MjA4NDUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.A36Nfb08U3Yc8XndifrmNNQFrhI7lqwdzhCTqYz4x90', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjQ1LCJpYXQiOjE3NjM1MjA4NDUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.8PSaPho5Qj28mUOW6s2ZhtOZYs297ngVtN_W61NFw-Q'}
2025-11-18 21:54:06,050 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:06,050 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:06,050 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:06,050 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:06,051 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:06,052 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:06,052 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:06,052 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:06,052 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:06,053 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:06,055 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:06,055 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:06,060 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:06,060 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:06,061 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:06,062 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:06,062 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:06,062 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:06,063 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:06,063 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:06,063 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:06,065 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:06,065 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:06,066 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 24.4ms
2025-11-18 21:54:06,069 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:06,069 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:06,070 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:06,071 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 24.4ms
2025-11-18 21:54:06,072 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 10.1ms
2025-11-18 21:54:06,080 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:06,081 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:06,081 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:06,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:06,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:06,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:06,084 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:06,084 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:06,088 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:06,088 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:06,089 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:06,090 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 9.6ms
2025-11-18 21:54:09,487 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:09,488 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:09,488 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:09,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:09,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:09,489 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:09,492 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:09,492 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:09,496 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:09,497 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:09,498 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:09,499 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 11.4ms
2025-11-18 21:54:09,501 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:09,501 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:09,501 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:09,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:09,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:09,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:09,505 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:09,505 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:09,510 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:09,510 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:09,512 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:09,513 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 11.7ms
2025-11-18 21:54:10,209 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:10,209 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:10,209 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:10,209 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:10,210 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:10,210 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:10,212 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:10,213 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:10,215 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:10,217 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:10,218 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:10,221 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:54:10,221 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2277, Rotación: True
2025-11-18 21:54:10,222 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:54:10,222 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:54:10,223 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:54:10,223 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2277
2025-11-18 21:54:10,223 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:10,224 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.9ms
2025-11-18 21:54:10,229 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:10,229 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:10,230 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:10,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:10,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:10,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:10,233 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:10,233 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:10,234 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:10,234 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:10,235 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:10,237 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:10,237 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:10,237 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.6ms
2025-11-18 21:54:10,253 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:10,254 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:10,254 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:10,254 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:10,254 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:10,255 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:10,255 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:10,257 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:10,257 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:10,261 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:10,261 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:10,262 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:10,263 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:10,263 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:10,263 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:10,263 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:10,263 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:10,266 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:10,266 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:10,270 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:10,270 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:10,271 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:10,272 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.1ms
2025-11-18 21:54:10,272 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 17.9ms
2025-11-18 21:54:10,273 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:10,274 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:10,274 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:10,274 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:10,275 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:10,275 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:10,277 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:10,278 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:10,281 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:10,282 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:10,283 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:10,283 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:10,283 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:10,284 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:10,284 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:10,284 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:10,284 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:10,286 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:10,287 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:10,290 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:10,290 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:10,291 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:10,292 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.0ms
2025-11-18 21:54:10,292 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.3ms
2025-11-18 21:54:10,727 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:10,727 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:10,728 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:10,728 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:10,728 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:10,728 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:10,731 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:10,732 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:10,735 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:10,736 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:10,737 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:10,738 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2277
2025-11-18 21:54:10,739 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2277
2025-11-18 21:54:10,739 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:10,739 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.8ms
2025-11-18 21:54:10,748 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:10,749 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:10,749 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:10,749 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:10,749 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:10,749 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:10,752 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:10,752 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:10,753 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:10,753 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:10,754 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:10,756 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:10,756 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:10,757 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.7ms
2025-11-18 21:54:10,772 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:10,773 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:10,773 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:10,773 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:10,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:10,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:10,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:10,776 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:10,776 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:10,780 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:10,780 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:10,781 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:10,781 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:10,782 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:10,782 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:10,782 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:10,782 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:10,784 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:10,785 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:10,787 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:10,788 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:10,788 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:10,789 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 16.8ms
2025-11-18 21:54:10,789 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 16.7ms
2025-11-18 21:54:10,791 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:10,792 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:10,792 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:10,792 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:10,792 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:10,792 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:10,795 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:10,795 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:10,795 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:10,799 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:10,799 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:10,800 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:10,801 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:10,801 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:10,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:10,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:10,801 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:10,803 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:10,804 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:10,807 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:10,807 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:10,808 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:10,809 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 17.6ms
2025-11-18 21:54:10,809 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 13.8ms
2025-11-18 21:54:11,070 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:11,071 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,071 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,071 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,071 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,074 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,074 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:11,077 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:11,078 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:11,080 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:11,082 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:54:11,083 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2278, Rotación: True
2025-11-18 21:54:11,084 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:54:11,084 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:54:11,084 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:54:11,084 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2278
2025-11-18 21:54:11,085 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:11,085 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.9ms
2025-11-18 21:54:11,090 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:11,090 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,090 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,090 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,094 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,094 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:11,096 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:11,096 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:11,096 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:11,098 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:11,099 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:11,099 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.7ms
2025-11-18 21:54:11,114 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:11,114 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:11,115 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,115 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,118 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,118 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:11,121 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:11,121 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:11,122 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:11,123 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,123 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,126 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,126 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:11,129 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:11,130 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:11,131 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:11,131 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 17.8ms
2025-11-18 21:54:11,132 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 17.6ms
2025-11-18 21:54:11,133 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:11,134 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,134 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,137 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,137 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:11,140 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:11,140 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:11,141 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:11,142 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:11,142 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,142 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,142 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,146 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,146 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:11,150 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:11,150 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:11,151 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:11,152 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.3ms
2025-11-18 21:54:11,153 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.7ms
2025-11-18 21:54:11,333 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:11,334 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,334 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,335 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,337 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,337 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:11,340 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:11,341 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:11,343 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:11,344 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2278
2025-11-18 21:54:11,345 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2278
2025-11-18 21:54:11,345 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:11,346 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.2ms
2025-11-18 21:54:11,351 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:11,351 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,352 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,352 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,352 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,352 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,355 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,355 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:11,356 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:11,357 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:11,357 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:11,359 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:11,359 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:11,360 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.7ms
2025-11-18 21:54:11,375 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:11,376 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:11,376 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,376 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,380 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,380 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:11,384 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:11,384 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:11,385 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:11,386 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,386 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,386 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,386 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,386 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,389 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,389 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:11,392 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:11,392 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:11,393 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:11,394 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.8ms
2025-11-18 21:54:11,395 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 18.6ms
2025-11-18 21:54:11,397 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:11,398 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,398 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,399 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,402 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,402 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:11,402 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:11,406 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:11,406 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:11,407 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:11,408 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,408 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,408 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,409 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,409 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,411 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,412 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:11,416 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:11,416 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:11,417 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:11,418 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 21.2ms
2025-11-18 21:54:11,419 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 16.5ms
2025-11-18 21:54:11,572 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:11,573 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,573 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,573 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,573 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,573 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,576 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,576 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:11,579 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:11,580 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:11,582 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:11,584 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2278
2025-11-18 21:54:11,584 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2278
2025-11-18 21:54:11,585 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:11,585 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.3ms
2025-11-18 21:54:11,589 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:11,590 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,590 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,593 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,594 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:11,596 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:11,596 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:11,596 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:11,599 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:11,600 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:11,600 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.8ms
2025-11-18 21:54:11,616 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:11,616 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:11,617 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,617 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,617 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,620 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,620 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:11,623 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:11,623 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:11,624 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:11,624 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,625 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,625 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,625 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,625 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,627 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,628 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:11,632 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:11,632 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:11,633 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:11,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.1ms
2025-11-18 21:54:11,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 17.7ms
2025-11-18 21:54:11,635 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:11,636 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,636 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,640 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,640 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:11,640 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:11,643 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:11,644 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:11,644 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:11,645 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,645 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,646 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,646 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,646 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,649 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,649 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:11,653 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:11,653 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:11,653 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:11,654 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.6ms
2025-11-18 21:54:11,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 14.5ms
2025-11-18 21:54:11,896 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:11,897 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,897 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,897 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,900 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,900 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:11,903 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:11,905 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:11,907 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:11,908 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2278
2025-11-18 21:54:11,908 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2278
2025-11-18 21:54:11,909 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:11,910 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.6ms
2025-11-18 21:54:11,916 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:11,916 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,916 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,917 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,917 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,917 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,919 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,920 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:11,921 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:11,921 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:11,922 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:11,924 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:11,924 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:11,925 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.4ms
2025-11-18 21:54:11,942 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:11,943 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:11,943 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,943 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,943 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,946 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,947 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:11,950 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:11,950 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:11,951 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:11,952 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,952 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,952 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,952 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,953 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,955 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,955 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:11,959 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:11,959 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:11,960 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:11,960 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.5ms
2025-11-18 21:54:11,961 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 18.2ms
2025-11-18 21:54:11,963 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:11,964 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,964 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,965 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,968 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,968 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:11,972 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:11,972 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:11,973 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:11,974 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:11,975 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:11,975 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:11,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:11,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:11,975 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:11,978 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:11,978 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:11,982 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:11,983 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:11,983 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:11,984 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.8ms
2025-11-18 21:54:11,985 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.7ms
2025-11-18 21:54:12,190 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:12,190 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,191 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,191 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,191 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,191 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,194 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,194 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:12,197 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:12,199 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:12,200 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:12,203 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:54:12,203 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2279, Rotación: True
2025-11-18 21:54:12,204 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:54:12,205 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:54:12,205 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:54:12,205 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2279
2025-11-18 21:54:12,205 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:12,206 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.2ms
2025-11-18 21:54:12,210 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:12,211 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,211 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,211 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,212 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,212 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,215 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,215 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:12,216 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:12,217 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:12,217 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:12,219 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:12,219 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:12,219 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.0ms
2025-11-18 21:54:12,235 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:12,236 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:12,236 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,236 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,236 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,237 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,237 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,239 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,239 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:12,242 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:12,243 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:12,243 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:12,244 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,244 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,244 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,244 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,244 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,247 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,247 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:12,251 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:12,251 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:12,252 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:12,252 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 17.3ms
2025-11-18 21:54:12,253 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 17.1ms
2025-11-18 21:54:12,254 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:12,255 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,255 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,255 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,255 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,255 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,258 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,258 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:12,261 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:12,261 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:12,262 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:12,263 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:12,264 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,264 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,264 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,264 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,264 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,267 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,267 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:12,271 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:12,271 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:12,272 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:12,273 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.7ms
2025-11-18 21:54:12,274 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.7ms
2025-11-18 21:54:12,483 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:12,483 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,483 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,484 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,484 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,484 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,487 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,487 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:12,490 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:12,492 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:12,493 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:12,495 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2279
2025-11-18 21:54:12,495 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2279
2025-11-18 21:54:12,495 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:12,496 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.4ms
2025-11-18 21:54:12,501 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:12,502 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,502 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,502 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,505 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,505 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:12,507 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:12,507 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:12,507 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:12,509 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:12,509 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:12,510 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.8ms
2025-11-18 21:54:12,526 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:12,527 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:12,527 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,527 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,528 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,532 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,532 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:12,535 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:12,536 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:12,536 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:12,537 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,537 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,537 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,537 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,537 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,540 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,540 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:12,543 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:12,544 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:12,544 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:12,545 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.2ms
2025-11-18 21:54:12,545 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 18.6ms
2025-11-18 21:54:12,548 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:12,549 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,549 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,549 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,549 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,550 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,552 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,552 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:12,556 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:12,556 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:12,557 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:12,558 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:12,558 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,558 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,558 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,558 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,559 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,561 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,561 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:12,566 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:12,566 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:12,567 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:12,567 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.3ms
2025-11-18 21:54:12,568 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.4ms
2025-11-18 21:54:12,726 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:12,727 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,727 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,727 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,727 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,727 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,730 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,731 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:12,733 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:12,735 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:12,736 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:12,738 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2279
2025-11-18 21:54:12,738 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2279
2025-11-18 21:54:12,739 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:12,739 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.2ms
2025-11-18 21:54:12,743 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:12,744 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,744 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,744 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,744 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,745 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,748 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,748 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:12,749 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:12,749 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:12,750 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:12,752 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:12,752 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:12,752 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.9ms
2025-11-18 21:54:12,768 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:12,769 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:12,769 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,769 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,769 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,772 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,772 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:12,775 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:12,775 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:12,776 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:12,776 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,776 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,776 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,777 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,777 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,779 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,779 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:12,783 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:12,784 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:12,784 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:12,785 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 16.7ms
2025-11-18 21:54:12,785 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 16.4ms
2025-11-18 21:54:12,787 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:12,787 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,788 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,788 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,788 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,788 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,791 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,791 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:12,791 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:12,794 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:12,794 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:12,795 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:12,796 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:12,796 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:12,796 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:12,796 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:12,797 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:12,799 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:12,800 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:12,803 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:12,803 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:12,804 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:12,805 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.1ms
2025-11-18 21:54:12,805 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 14.5ms
2025-11-18 21:54:13,072 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:13,073 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:13,073 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:13,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:13,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:13,073 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:13,076 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:13,076 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:13,079 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:13,080 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:13,081 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:13,084 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:54:13,084 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2280, Rotación: True
2025-11-18 21:54:13,086 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:54:13,086 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:54:13,086 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:54:13,086 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2280
2025-11-18 21:54:13,087 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:13,087 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.0ms
2025-11-18 21:54:13,092 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:13,092 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:13,092 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:13,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:13,093 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:13,093 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:13,096 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:13,096 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:13,098 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:13,098 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:13,098 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:13,101 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:13,101 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:13,102 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.0ms
2025-11-18 21:54:13,117 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:13,117 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:13,118 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:13,118 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:13,118 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:13,118 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:13,118 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:13,121 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:13,121 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:13,124 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:13,125 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:13,126 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:13,126 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:13,126 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:13,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:13,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:13,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:13,129 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:13,129 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:13,133 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:13,133 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:13,134 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:13,135 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.0ms
2025-11-18 21:54:13,135 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 17.5ms
2025-11-18 21:54:13,136 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:13,137 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:13,138 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:13,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:13,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:13,138 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:13,141 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:13,141 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:13,144 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:13,144 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:13,145 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:13,145 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:13,146 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:13,146 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:13,146 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:13,146 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:13,146 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:13,150 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:13,150 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:13,153 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-18 21:54:13,153 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-18 21:54:13,154 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:13,155 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.4ms
2025-11-18 21:54:13,156 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 11.0ms
2025-11-18 21:54:13,906 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:13,906 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:13,907 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:13,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:13,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:13,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:13,910 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:13,910 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:13,914 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:13,915 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzUzLCJpYXQiOjE3NjM1MjA4NTMsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.PLXxjxS7keBogI5lf3UzRp4_Odaqruw97Ejxie8mi0g', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjUzLCJpYXQiOjE3NjM1MjA4NTMsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.HDP2kepv_6Fz4idJXsHK5dW9-Bx25D25i5T-IhA1AP8'}
2025-11-18 21:54:13,915 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:13,915 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:13,915 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:13,916 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:13,917 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:13,918 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 12.5ms
2025-11-18 21:54:13,921 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:13,921 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:13,921 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:13,922 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:13,922 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:13,922 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:13,925 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:13,925 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:13,930 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:13,930 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzUzLCJpYXQiOjE3NjM1MjA4NTMsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.PLXxjxS7keBogI5lf3UzRp4_Odaqruw97Ejxie8mi0g', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjUzLCJpYXQiOjE3NjM1MjA4NTMsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.HDP2kepv_6Fz4idJXsHK5dW9-Bx25D25i5T-IhA1AP8'}
2025-11-18 21:54:13,930 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:13,930 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:13,931 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:13,931 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:13,932 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:13,933 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 12.5ms
2025-11-18 21:54:14,541 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:14,542 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:14,542 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:14,542 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:14,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:14,543 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:14,545 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:14,545 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:14,549 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:14,550 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:14,551 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:14,558 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:54:14,559 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2281, Rotación: True
2025-11-18 21:54:14,560 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:54:14,560 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:54:14,560 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:54:14,560 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2281
2025-11-18 21:54:14,561 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:14,561 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 19.9ms
2025-11-18 21:54:14,566 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:14,567 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:14,567 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:14,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:14,567 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:14,568 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:14,570 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:14,570 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:14,572 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:14,572 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:14,572 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:14,575 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:14,575 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:14,575 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.0ms
2025-11-18 21:54:14,590 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:14,591 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:14,591 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:14,591 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:14,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:14,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:14,592 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:14,594 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:14,594 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:14,598 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:14,598 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:14,599 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:14,600 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:14,600 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:14,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:14,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:14,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:14,603 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:14,603 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:14,607 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:14,607 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU0LCJpYXQiOjE3NjM1MjA4NTQsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.8Vv6uNVuarLWIY-mTOrSZQkYyggqHX33xxyXLe7dDWg', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU0LCJpYXQiOjE3NjM1MjA4NTQsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.L_WhBPI3T0HhvallyH2GBs4fXJk0CkUGovsW09fk5sY'}
2025-11-18 21:54:14,607 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:14,607 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:14,607 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:14,607 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:14,608 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:14,609 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.9ms
2025-11-18 21:54:14,609 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 18.5ms
2025-11-18 21:54:14,611 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:14,612 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:14,612 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:14,612 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:14,612 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:14,612 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:14,615 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:14,615 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:14,616 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:14,620 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:14,620 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:14,622 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:14,622 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:14,622 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:14,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:14,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:14,623 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:14,625 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:14,625 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:14,629 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:14,629 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU0LCJpYXQiOjE3NjM1MjA4NTQsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.8Vv6uNVuarLWIY-mTOrSZQkYyggqHX33xxyXLe7dDWg', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU0LCJpYXQiOjE3NjM1MjA4NTQsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.L_WhBPI3T0HhvallyH2GBs4fXJk0CkUGovsW09fk5sY'}
2025-11-18 21:54:14,629 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:14,629 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:14,629 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:14,630 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:14,631 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:14,632 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.7ms
2025-11-18 21:54:14,632 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 16.8ms
2025-11-18 21:54:14,819 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:14,819 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:14,820 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:14,820 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:14,820 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:14,820 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:14,823 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:14,823 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:14,831 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:14,833 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:14,834 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:14,840 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2281
2025-11-18 21:54:14,840 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2281
2025-11-18 21:54:14,841 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:14,841 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 22.1ms
2025-11-18 21:54:14,845 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:14,846 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:14,846 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:14,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:14,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:14,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:14,850 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:14,851 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:14,852 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:14,853 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:14,853 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:14,855 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:14,855 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:14,856 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.1ms
2025-11-18 21:54:14,874 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:14,875 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:14,875 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:14,875 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:14,875 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:14,875 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:14,876 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:14,878 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:14,878 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:14,882 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:14,883 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:14,884 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:14,884 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:14,885 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:14,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:14,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:14,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:14,888 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:14,888 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:14,892 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:14,892 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU0LCJpYXQiOjE3NjM1MjA4NTQsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.8Vv6uNVuarLWIY-mTOrSZQkYyggqHX33xxyXLe7dDWg', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU0LCJpYXQiOjE3NjM1MjA4NTQsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.L_WhBPI3T0HhvallyH2GBs4fXJk0CkUGovsW09fk5sY'}
2025-11-18 21:54:14,893 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:14,893 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:14,893 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:14,893 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:14,894 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:14,895 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 21.0ms
2025-11-18 21:54:14,895 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 20.6ms
2025-11-18 21:54:14,897 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:14,897 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:14,898 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:14,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:14,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:14,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:14,901 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:14,902 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:14,902 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:14,906 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:14,906 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:14,907 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:14,907 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:14,908 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:14,908 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:14,908 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:14,908 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:14,911 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:14,911 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:14,916 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:14,916 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU0LCJpYXQiOjE3NjM1MjA4NTQsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.8Vv6uNVuarLWIY-mTOrSZQkYyggqHX33xxyXLe7dDWg', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU0LCJpYXQiOjE3NjM1MjA4NTQsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.L_WhBPI3T0HhvallyH2GBs4fXJk0CkUGovsW09fk5sY'}
2025-11-18 21:54:14,916 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:14,917 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:14,917 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:14,917 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:14,919 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:14,920 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 22.8ms
2025-11-18 21:54:14,920 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 18.1ms
2025-11-18 21:54:15,051 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:15,051 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,052 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,052 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,052 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,052 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,055 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,055 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:15,062 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:15,063 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:15,065 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:15,067 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:54:15,067 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2282, Rotación: True
2025-11-18 21:54:15,072 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:54:15,072 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:54:15,072 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:54:15,072 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2282
2025-11-18 21:54:15,073 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:15,073 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 22.1ms
2025-11-18 21:54:15,077 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:15,077 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,078 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,078 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,078 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,078 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,081 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,081 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:15,083 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:15,083 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:15,083 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:15,086 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:15,086 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:15,087 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.8ms
2025-11-18 21:54:15,102 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:15,102 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:15,102 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,103 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,103 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,103 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,103 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,106 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,106 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:15,110 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:15,110 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:15,111 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:15,111 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,111 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,112 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,112 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,114 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,114 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:15,120 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:15,120 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.OZYT-A8X05IA-oeIe_l6NUb9VJpOTLaIU1gstftjdUA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.GGyDhEIK4oS5Mwgp7D30mP1lQF8-NoG7XZr0E5iWtGo'}
2025-11-18 21:54:15,120 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:15,120 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:15,120 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:15,120 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:15,122 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:15,122 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.6ms
2025-11-18 21:54:15,123 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 20.4ms
2025-11-18 21:54:15,124 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:15,125 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,125 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,128 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,129 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:15,133 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:15,134 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:15,135 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:15,135 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:15,136 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,136 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,137 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,137 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,137 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,139 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,140 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:15,143 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:15,144 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.OZYT-A8X05IA-oeIe_l6NUb9VJpOTLaIU1gstftjdUA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.GGyDhEIK4oS5Mwgp7D30mP1lQF8-NoG7XZr0E5iWtGo'}
2025-11-18 21:54:15,144 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:15,144 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:15,144 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:15,144 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:15,146 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:15,146 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 22.1ms
2025-11-18 21:54:15,147 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 11.8ms
2025-11-18 21:54:15,251 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:15,252 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,252 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,252 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,252 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,253 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,255 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,255 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:15,259 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:15,260 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:15,262 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:15,264 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2282
2025-11-18 21:54:15,264 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2282
2025-11-18 21:54:15,264 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:15,265 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.7ms
2025-11-18 21:54:15,271 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:15,272 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,272 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,272 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,273 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,273 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,275 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,276 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:15,277 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:15,278 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:15,278 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:15,280 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:15,281 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:15,281 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.2ms
2025-11-18 21:54:15,296 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:15,297 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:15,297 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,297 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,301 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,301 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:15,305 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:15,305 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:15,306 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:15,306 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,306 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,306 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,306 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,306 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,309 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,309 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:15,312 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:15,312 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.OZYT-A8X05IA-oeIe_l6NUb9VJpOTLaIU1gstftjdUA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.GGyDhEIK4oS5Mwgp7D30mP1lQF8-NoG7XZr0E5iWtGo'}
2025-11-18 21:54:15,312 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:15,313 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:15,313 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:15,313 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:15,314 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:15,315 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.5ms
2025-11-18 21:54:15,315 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 18.3ms
2025-11-18 21:54:15,317 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:15,318 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,318 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,318 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,318 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,318 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,321 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,321 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:15,324 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:15,324 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:15,325 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:15,326 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:15,326 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,326 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,326 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,329 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,329 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:15,334 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:15,334 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.OZYT-A8X05IA-oeIe_l6NUb9VJpOTLaIU1gstftjdUA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.GGyDhEIK4oS5Mwgp7D30mP1lQF8-NoG7XZr0E5iWtGo'}
2025-11-18 21:54:15,334 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:15,334 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:15,334 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:15,335 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:15,336 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:15,337 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.6ms
2025-11-18 21:54:15,337 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 11.6ms
2025-11-18 21:54:15,513 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:15,514 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,514 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,514 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,517 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,518 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:15,520 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:15,521 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:15,523 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:15,525 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2282
2025-11-18 21:54:15,525 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2282
2025-11-18 21:54:15,525 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:15,526 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.3ms
2025-11-18 21:54:15,530 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:15,531 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,531 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,531 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,531 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,531 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,535 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,535 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:15,537 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:15,537 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:15,537 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:15,539 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:15,540 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:15,540 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.3ms
2025-11-18 21:54:15,557 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:15,557 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:15,557 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,558 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,558 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,558 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,558 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,561 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,561 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:15,564 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:15,564 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:15,565 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:15,565 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,565 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,566 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,573 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,573 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:15,577 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:15,578 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.OZYT-A8X05IA-oeIe_l6NUb9VJpOTLaIU1gstftjdUA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.GGyDhEIK4oS5Mwgp7D30mP1lQF8-NoG7XZr0E5iWtGo'}
2025-11-18 21:54:15,578 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:15,578 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:15,578 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:15,578 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:15,580 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:15,581 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 24.1ms
2025-11-18 21:54:15,581 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 24.3ms
2025-11-18 21:54:15,587 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:15,587 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:15,588 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,588 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,588 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,588 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,588 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,591 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,592 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:15,596 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:15,597 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.OZYT-A8X05IA-oeIe_l6NUb9VJpOTLaIU1gstftjdUA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.GGyDhEIK4oS5Mwgp7D30mP1lQF8-NoG7XZr0E5iWtGo'}
2025-11-18 21:54:15,597 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-18 21:54:15,597 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-18 21:54:15,597 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:15,597 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-18 21:54:15,601 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:15,602 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:15,602 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:15,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:15,603 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:15,603 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:15,606 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:15,606 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:15,610 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:15,610 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:15,611 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:15,611 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 24.7ms
2025-11-18 21:54:15,612 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 24.4ms
2025-11-18 21:54:16,260 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:16,261 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,261 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,265 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,265 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:16,265 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:16,270 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:16,270 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.OZYT-A8X05IA-oeIe_l6NUb9VJpOTLaIU1gstftjdUA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.GGyDhEIK4oS5Mwgp7D30mP1lQF8-NoG7XZr0E5iWtGo'}
2025-11-18 21:54:16,270 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:16,271 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:16,271 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:16,271 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:16,272 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:16,273 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,273 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,273 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,273 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,274 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,276 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,276 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:16,280 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:16,280 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:16,281 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:16,282 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 21.6ms
2025-11-18 21:54:16,283 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 17.3ms
2025-11-18 21:54:16,284 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:16,285 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,285 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,286 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,286 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,286 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,289 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,289 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:16,293 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:16,293 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.OZYT-A8X05IA-oeIe_l6NUb9VJpOTLaIU1gstftjdUA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.GGyDhEIK4oS5Mwgp7D30mP1lQF8-NoG7XZr0E5iWtGo'}
2025-11-18 21:54:16,293 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:16,293 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:16,294 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:16,294 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:16,295 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:16,295 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:16,296 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,296 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,296 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,299 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,299 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:16,303 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:16,303 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:16,304 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:16,305 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:16,305 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,306 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,306 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,306 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,306 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,308 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,309 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:16,309 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 24.7ms
2025-11-18 21:54:16,312 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:16,312 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:16,313 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:16,313 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 18.3ms
2025-11-18 21:54:16,314 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 9.6ms
2025-11-18 21:54:16,316 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:16,317 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:16,318 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,318 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,319 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,322 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,322 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:16,326 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:16,326 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.OZYT-A8X05IA-oeIe_l6NUb9VJpOTLaIU1gstftjdUA', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU1LCJpYXQiOjE3NjM1MjA4NTUsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.GGyDhEIK4oS5Mwgp7D30mP1lQF8-NoG7XZr0E5iWtGo'}
2025-11-18 21:54:16,326 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:16,326 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:16,326 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:16,327 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:16,328 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:16,328 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,328 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,329 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,329 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,329 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,331 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,332 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:16,332 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:16,336 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:16,336 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:16,337 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:16,338 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,338 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,341 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,341 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:16,344 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:16,344 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:16,345 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:16,345 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 29.0ms
2025-11-18 21:54:16,346 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 28.5ms
2025-11-18 21:54:16,347 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 14.8ms
2025-11-18 21:54:16,349 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:16,349 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,350 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,350 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,350 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,350 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,353 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,353 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:16,356 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:16,356 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:16,357 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:16,358 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 9.3ms
2025-11-18 21:54:16,360 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:16,360 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,360 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,361 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,361 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,361 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,363 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,364 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:16,367 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:16,368 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:16,369 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:16,369 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 9.5ms
2025-11-18 21:54:16,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:16,601 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,601 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,605 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,605 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:16,607 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:16,609 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:16,610 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:16,612 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:54:16,613 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2283, Rotación: True
2025-11-18 21:54:16,614 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:54:16,614 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:54:16,614 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:54:16,615 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2283
2025-11-18 21:54:16,615 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:16,616 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.1ms
2025-11-18 21:54:16,621 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:16,621 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,622 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,622 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,624 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,624 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:16,626 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:16,626 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:16,626 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:16,629 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:16,629 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:16,630 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.9ms
2025-11-18 21:54:16,647 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:16,647 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:16,648 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,648 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,652 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,653 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:16,653 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:16,657 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:16,657 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:16,658 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:16,658 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,658 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,659 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,659 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,659 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,661 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,662 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:16,665 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:16,665 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU2LCJpYXQiOjE3NjM1MjA4NTYsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.nemmeJSNBjOTAf_YYC27NZbzQXiwNVzdIzI13SZhYac', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU2LCJpYXQiOjE3NjM1MjA4NTYsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.QgPiwO42kFkUVJ93VdiThsd2anSWXPEkStco6nlv2ws'}
2025-11-18 21:54:16,665 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:16,665 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:16,665 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:16,665 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:16,667 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:16,667 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,667 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,668 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,668 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,668 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,670 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,670 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:16,674 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:16,674 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:16,675 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:16,675 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 28.6ms
2025-11-18 21:54:16,676 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 28.1ms
2025-11-18 21:54:16,676 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 23.1ms
2025-11-18 21:54:16,678 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:16,679 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,680 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,680 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,680 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,680 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,682 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,683 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:16,687 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:16,687 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:16,688 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:16,689 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:16,690 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:16,690 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,690 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,690 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,690 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,693 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,693 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:16,694 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,694 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,694 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,694 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,694 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,696 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,697 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:16,701 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:16,701 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU2LCJpYXQiOjE3NjM1MjA4NTYsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.nemmeJSNBjOTAf_YYC27NZbzQXiwNVzdIzI13SZhYac', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU2LCJpYXQiOjE3NjM1MjA4NTYsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.QgPiwO42kFkUVJ93VdiThsd2anSWXPEkStco6nlv2ws'}
2025-11-18 21:54:16,701 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:16,702 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:16,702 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:16,702 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:16,704 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:16,707 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:16,708 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:16,709 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:16,709 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 31.4ms
2025-11-18 21:54:16,710 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:16,710 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,710 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,711 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,711 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,711 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,713 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,713 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:16,718 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:16,718 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:16,720 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:16,720 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 31.2ms
2025-11-18 21:54:16,720 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 31.0ms
2025-11-18 21:54:16,722 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 12.2ms
2025-11-18 21:54:16,723 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:16,723 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:16,724 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,724 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,724 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,724 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,724 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,727 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,727 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:16,732 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:16,733 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU2LCJpYXQiOjE3NjM1MjA4NTYsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.nemmeJSNBjOTAf_YYC27NZbzQXiwNVzdIzI13SZhYac', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU2LCJpYXQiOjE3NjM1MjA4NTYsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.QgPiwO42kFkUVJ93VdiThsd2anSWXPEkStco6nlv2ws'}
2025-11-18 21:54:16,733 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:16,733 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:16,733 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:16,733 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:16,735 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:16,736 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,736 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,736 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,736 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,737 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,740 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,740 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:16,743 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:16,744 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:16,745 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:16,746 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 23.0ms
2025-11-18 21:54:16,746 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 22.9ms
2025-11-18 21:54:16,833 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:16,834 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,834 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,834 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,835 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,838 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,838 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:16,841 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:16,842 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:16,843 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:16,845 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2283
2025-11-18 21:54:16,845 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2283
2025-11-18 21:54:16,845 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:16,846 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.3ms
2025-11-18 21:54:16,851 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:16,851 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,852 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,852 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,852 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,852 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,855 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,855 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:16,856 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:16,857 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:16,857 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:16,859 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:16,859 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:16,860 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.4ms
2025-11-18 21:54:16,878 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:16,879 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:16,879 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:16,879 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,880 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,883 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,883 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:16,887 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:16,887 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU2LCJpYXQiOjE3NjM1MjA4NTYsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.nemmeJSNBjOTAf_YYC27NZbzQXiwNVzdIzI13SZhYac', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU2LCJpYXQiOjE3NjM1MjA4NTYsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.QgPiwO42kFkUVJ93VdiThsd2anSWXPEkStco6nlv2ws'}
2025-11-18 21:54:16,887 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:16,888 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:16,888 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:16,888 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:16,889 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:16,889 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,890 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,890 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,890 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,890 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,892 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,893 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:16,893 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,893 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,894 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,896 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,897 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:16,900 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:16,900 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:16,902 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:16,905 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:16,905 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:16,906 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:16,906 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 28.3ms
2025-11-18 21:54:16,907 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 28.0ms
2025-11-18 21:54:16,907 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 28.0ms
2025-11-18 21:54:16,910 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:16,911 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,911 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,911 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,911 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,912 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,914 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,914 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:16,919 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:16,919 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU2LCJpYXQiOjE3NjM1MjA4NTYsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.nemmeJSNBjOTAf_YYC27NZbzQXiwNVzdIzI13SZhYac', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU2LCJpYXQiOjE3NjM1MjA4NTYsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.QgPiwO42kFkUVJ93VdiThsd2anSWXPEkStco6nlv2ws'}
2025-11-18 21:54:16,920 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:16,920 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:16,920 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:16,920 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:16,922 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:16,922 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:16,922 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:16,923 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,923 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,923 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,923 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,926 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,927 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:16,927 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,927 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,927 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,927 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,927 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,930 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,930 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:16,934 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:16,935 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:16,936 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:16,940 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:16,940 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:16,941 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:16,942 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:16,943 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 33.1ms
2025-11-18 21:54:16,944 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,944 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,944 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,944 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,945 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,947 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,947 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:16,953 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:16,953 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:16,954 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:16,955 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 33.0ms
2025-11-18 21:54:16,955 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 33.1ms
2025-11-18 21:54:16,956 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:16,956 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:16,957 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,957 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,957 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,957 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,958 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,961 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,961 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:16,961 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:16,961 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:16,961 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:16,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:16,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:16,964 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:16,964 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:16,970 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:16,970 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:16,972 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:16,977 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:16,978 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU2LCJpYXQiOjE3NjM1MjA4NTYsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.nemmeJSNBjOTAf_YYC27NZbzQXiwNVzdIzI13SZhYac', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU2LCJpYXQiOjE3NjM1MjA4NTYsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.QgPiwO42kFkUVJ93VdiThsd2anSWXPEkStco6nlv2ws'}
2025-11-18 21:54:16,978 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:16,978 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:16,978 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:16,978 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:16,980 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:16,981 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 38.5ms
2025-11-18 21:54:16,982 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 26.0ms
2025-11-18 21:54:16,982 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 26.1ms
2025-11-18 21:54:17,049 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:17,050 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,050 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,050 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,051 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,051 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,053 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,054 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:17,057 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:17,058 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:17,059 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:17,062 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:54:17,062 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2284, Rotación: True
2025-11-18 21:54:17,064 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:54:17,064 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 21:54:17,065 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:54:17,065 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2284
2025-11-18 21:54:17,065 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:17,066 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.4ms
2025-11-18 21:54:17,071 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:17,072 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,072 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,072 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,075 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,075 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:17,076 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:17,077 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:17,077 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:17,079 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:17,080 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:17,080 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.0ms
2025-11-18 21:54:17,096 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:17,097 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,098 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,098 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,098 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,098 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,101 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,101 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:17,105 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:17,105 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:17,106 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:17,107 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:17,107 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:17,108 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,108 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,111 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,111 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:17,111 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,111 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,112 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,114 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,114 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:17,119 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:17,119 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:17,120 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:17,123 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:17,124 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU3LCJpYXQiOjE3NjM1MjA4NTcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.HjjxakA_ueQcflSTjxbuEQ49Fe5qTjHVYy6EzqFVvbY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU3LCJpYXQiOjE3NjM1MjA4NTcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.KKA8f0JbrCHBIqc8BItlmM8Hpi7gvsdyvMK_IrPUcw4'}
2025-11-18 21:54:17,124 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:17,124 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:17,124 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:17,124 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:17,126 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:17,126 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 29.8ms
2025-11-18 21:54:17,128 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 20.7ms
2025-11-18 21:54:17,128 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 20.7ms
2025-11-18 21:54:17,130 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:17,132 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,132 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,135 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,136 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:17,140 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:17,140 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:17,141 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:17,142 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:17,142 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:17,143 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,143 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,143 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,144 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,147 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,147 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:17,147 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,147 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,148 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,148 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,148 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,151 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,151 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:17,155 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:17,155 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU3LCJpYXQiOjE3NjM1MjA4NTcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.HjjxakA_ueQcflSTjxbuEQ49Fe5qTjHVYy6EzqFVvbY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU3LCJpYXQiOjE3NjM1MjA4NTcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.KKA8f0JbrCHBIqc8BItlmM8Hpi7gvsdyvMK_IrPUcw4'}
2025-11-18 21:54:17,156 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:17,156 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:17,156 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:17,156 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:17,158 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:17,162 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:17,162 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:17,163 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:17,164 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 33.5ms
2025-11-18 21:54:17,164 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 22.4ms
2025-11-18 21:54:17,164 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 22.1ms
2025-11-18 21:54:17,248 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:17,249 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,249 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,250 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,250 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,250 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,253 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,253 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:17,257 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:17,259 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:17,261 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:17,263 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2284
2025-11-18 21:54:17,263 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2284
2025-11-18 21:54:17,263 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:17,264 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.8ms
2025-11-18 21:54:17,272 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:17,272 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,273 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,273 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,273 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,273 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,276 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,276 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:17,277 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:17,277 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:17,277 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:17,280 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:17,280 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:17,281 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.0ms
2025-11-18 21:54:17,297 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:17,297 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:17,298 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,298 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,298 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,302 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,302 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:17,303 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,303 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,303 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,306 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,307 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:17,307 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:17,311 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:17,311 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU3LCJpYXQiOjE3NjM1MjA4NTcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.HjjxakA_ueQcflSTjxbuEQ49Fe5qTjHVYy6EzqFVvbY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU3LCJpYXQiOjE3NjM1MjA4NTcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.KKA8f0JbrCHBIqc8BItlmM8Hpi7gvsdyvMK_IrPUcw4'}
2025-11-18 21:54:17,312 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:17,312 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:17,312 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:17,312 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:17,313 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:17,319 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:17,319 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:17,320 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:17,321 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,321 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,321 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,321 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,321 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,325 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,325 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:17,329 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:17,329 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:17,330 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:17,331 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 34.5ms
2025-11-18 21:54:17,332 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 34.6ms
2025-11-18 21:54:17,332 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:17,333 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 25.9ms
2025-11-18 21:54:17,333 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,333 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,334 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,337 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,337 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:17,342 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:17,342 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:17,343 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:17,344 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 12.0ms
2025-11-18 21:54:17,428 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:17,428 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,429 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,432 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,432 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:17,434 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 21:54:17,436 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 21:54:17,437 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 21:54:17,439 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2284
2025-11-18 21:54:17,439 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2284
2025-11-18 21:54:17,440 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 21:54:17,440 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.5ms
2025-11-18 21:54:17,445 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:54:17,446 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,446 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,446 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,446 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,450 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,450 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:54:17,452 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 21:54:17,452 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 21:54:17,453 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 21:54:17,455 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 21:54:17,456 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 21:54:17,456 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.7ms
2025-11-18 21:54:17,476 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:17,477 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,477 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,480 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,480 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:17,480 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:17,480 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:17,485 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:17,485 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:17,487 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:17,488 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,488 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,488 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,491 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,491 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:17,491 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,491 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,492 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,494 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,494 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:17,498 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:17,498 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:17,499 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:17,503 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:17,503 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU3LCJpYXQiOjE3NjM1MjA4NTcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.HjjxakA_ueQcflSTjxbuEQ49Fe5qTjHVYy6EzqFVvbY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU3LCJpYXQiOjE3NjM1MjA4NTcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.KKA8f0JbrCHBIqc8BItlmM8Hpi7gvsdyvMK_IrPUcw4'}
2025-11-18 21:54:17,503 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:17,504 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:17,504 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:17,504 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:17,505 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:17,506 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.2ms
2025-11-18 21:54:17,507 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 26.4ms
2025-11-18 21:54:17,507 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 26.3ms
2025-11-18 21:54:17,510 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:17,510 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:54:17,511 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,511 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,511 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,512 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,512 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,514 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,514 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:17,515 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,515 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,515 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,519 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,519 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:54:17,520 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:17,524 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:17,524 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:17,525 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:17,529 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 21:54:17,529 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 21:54:17,530 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 21:54:17,530 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,530 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,530 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,531 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,531 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,533 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,533 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:17,538 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:17,538 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU3LCJpYXQiOjE3NjM1MjA4NTcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.HjjxakA_ueQcflSTjxbuEQ49Fe5qTjHVYy6EzqFVvbY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU3LCJpYXQiOjE3NjM1MjA4NTcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.KKA8f0JbrCHBIqc8BItlmM8Hpi7gvsdyvMK_IrPUcw4'}
2025-11-18 21:54:17,538 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:17,539 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:17,539 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:17,539 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:17,540 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:17,540 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:17,541 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,541 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,544 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,544 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:17,544 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 34.4ms
2025-11-18 21:54:17,544 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 34.2ms
2025-11-18 21:54:17,547 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:17,548 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:17,548 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:17,550 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 30.0ms
2025-11-18 21:54:17,551 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 11.0ms
2025-11-18 21:54:17,552 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-18 21:54:17,554 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,554 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,554 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,554 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,554 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,557 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,557 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-18 21:54:17,561 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-18 21:54:17,561 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-18 21:54:17,562 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-18 21:54:17,563 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-18 21:54:17,564 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:17,564 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,564 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,565 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,568 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,568 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-18 21:54:17,569 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,569 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,569 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,569 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,569 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,571 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,571 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:17,575 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-18 21:54:17,576 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTIxNzU3LCJpYXQiOjE3NjM1MjA4NTcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.HjjxakA_ueQcflSTjxbuEQ49Fe5qTjHVYy6EzqFVvbY', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTI1NjU3LCJpYXQiOjE3NjM1MjA4NTcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.KKA8f0JbrCHBIqc8BItlmM8Hpi7gvsdyvMK_IrPUcw4'}
2025-11-18 21:54:17,576 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-18 21:54:17,576 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-18 21:54:17,576 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-18 21:54:17,576 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-18 21:54:17,577 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-18 21:54:17,581 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:17,581 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:17,582 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:17,582 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 30.0ms
2025-11-18 21:54:17,583 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 19.8ms
2025-11-18 21:54:17,583 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 19.7ms
2025-11-18 21:54:17,590 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2
2025-11-18 21:54:17,591 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:17,591 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 21:54:17,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 21:54:17,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:17,591 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 21:54:17,594 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:17,594 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2
2025-11-18 21:54:17,598 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-18 21:54:17,598 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-18 21:54:17,599 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-18 21:54:17,599 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2 200 9.1ms
2025-11-18 21:54:27,472 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 21:54:27,472 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-18 21:54:27,475 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:27,475 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:27,476 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:54:27,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:54:27,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:27,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:54:27,481 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:54:27,485 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 21:54:27,486 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 4: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 21:54:27,487 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 4, usando Single-DB como fallback
2025-11-18 21:54:27,487 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:27,487 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:27,490 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-18 21:54:27,490 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 21:54:27,491 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 16.5ms
2025-11-18 21:54:54,996 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 21:54:54,997 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-18 21:54:55,000 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:54:55,000 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:54:55,000 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:54:55,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:54:55,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:54:55,001 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:54:55,009 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:54:55,009 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:54:55,010 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:54:55,013 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-18 21:54:55,014 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 21:54:55,014 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 14.6ms
2025-11-18 21:55:16,206 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 21:55:16,207 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-18 21:55:16,209 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 21:55:16,209 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:55:16,210 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:55:16,210 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:55:16,210 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:55:16,210 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:55:16,224 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:55:16,224 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:55:16,224 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 21:55:16,227 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-18 21:55:16,227 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-18 21:55:16,228 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-18 21:55:16,452 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 21:55:16,453 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-18 21:55:16,458 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 21:55:16,465 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:55:16,465 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2285, Rotación: False
2025-11-18 21:55:16,465 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2285
2025-11-18 21:55:16,466 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-18 21:55:16,466 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 257.3ms
2025-11-18 21:55:16,499 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 21:55:16,500 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-18 21:55:16,502 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 21:55:16,502 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 21:55:16,503 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.4ms
2025-11-18 21:55:16,503 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.4ms
2025-11-18 21:55:16,504 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 21:55:16,506 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:55:16,508 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 3.9ms
2025-11-18 21:55:16,509 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:55:16,509 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:55:16,509 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:55:16,509 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:55:16,510 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:55:16,511 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:55:16,511 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:55:16,511 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:55:16,527 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 21:55:16,527 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 21:55:16,579 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 21:55:16,582 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 21:55:16,582 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 21:55:16,583 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 77.0ms
2025-11-18 21:55:16,583 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:55:16,583 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:55:16,584 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:55:16,584 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:55:16,584 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:55:16,585 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:55:16,585 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:55:16,586 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 21:55:16,586 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:55:16,586 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:55:16,586 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:55:16,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:55:16,587 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:55:16,588 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:55:16,588 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:55:16,588 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 21:55:16,593 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 21:55:16,594 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 21:55:16,595 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 21:55:16,605 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 21:55:16,607 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 21:55:16,608 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:55:16,608 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:55:16,608 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:55:16,609 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:55:16,609 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:55:16,610 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:55:16,610 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:55:16,610 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 21:55:16,611 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 29.1ms
2025-11-18 21:55:16,611 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 29.0ms
2025-11-18 21:55:16,616 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 21:55:16,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 11.9ms
2025-11-18 21:57:15,929 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 21:57:15,930 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-18 21:57:15,932 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 21:57:15,933 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:57:15,933 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:57:15,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:57:15,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:57:15,934 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:57:15,960 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:57:15,960 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:57:15,960 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 21:57:15,966 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 4, Usuario 2, Tipo: web
2025-11-18 21:57:15,967 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_tech (Cliente: 4, Level: 4, Type: tenant_admin)
2025-11-18 21:57:15,971 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 21:57:15,979 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 21:57:15,979 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2286, Rotación: True
2025-11-18 21:57:15,983 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 21:57:15,984 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 4, Usuario 2
2025-11-18 21:57:15,984 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 21:57:15,984 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2286
2025-11-18 21:57:15,985 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_tech
2025-11-18 21:57:15,985 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 52.8ms
2025-11-18 21:57:15,991 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 21:57:15,991 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.6ms
2025-11-18 21:57:15,993 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 21:57:15,993 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 21:57:15,994 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 21:57:15,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 21:57:15,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 21:57:15,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 21:57:15,995 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 21:57:15,995 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 21:57:15,995 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 21:57:15,997 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_tech
2025-11-18 21:57:15,997 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-18 21:57:15,997 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 4 para cliente 2
2025-11-18 21:57:15,998 - app.services.usuario_service - WARNING - Usuario ID 4 no encontrado en cliente 2 o está eliminado
2025-11-18 21:57:15,999 - app.api.v1.endpoints.auth - ERROR - Usuario 2 no encontrado en cliente 4
2025-11-18 21:57:15,999 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 404 6.0ms
2025-11-18 22:37:47,822 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 22:37:47,823 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.8ms
2025-11-18 22:37:49,994 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'admin', 'assets', 'static', 'cdn', 'backend', 'www'}
2025-11-18 22:37:50,044 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:37:50,045 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:37:50,045 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:37:50,045 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:37:50,045 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:37:50,045 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:37:50,132 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:37:50,137 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-18 22:37:50,137 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 4: Credencial corrupta o clave de encriptación incorrecta
2025-11-18 22:37:50,138 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 4, usando Single-DB como fallback
2025-11-18 22:37:50,138 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:37:50,138 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:37:50,149 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 4, Usuario 2, Tipo: web
2025-11-18 22:37:50,151 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_tech (Cliente: 4, Level: 4, Type: tenant_admin)
2025-11-18 22:37:50,154 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 22:37:50,162 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 22:37:50,163 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2287, Rotación: True
2025-11-18 22:37:50,174 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 22:37:50,175 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 4, Usuario 2
2025-11-18 22:37:50,175 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 22:37:50,176 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2287
2025-11-18 22:37:50,176 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_tech
2025-11-18 22:37:50,177 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 132.5ms
2025-11-18 22:37:50,182 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 22:37:50,183 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-18 22:37:50,185 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:37:50,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:37:50,186 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:37:50,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:37:50,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:37:50,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:37:50,188 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:37:50,188 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:37:50,188 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:37:50,190 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_tech
2025-11-18 22:37:50,190 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-18 22:37:50,190 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 2 para cliente 4
2025-11-18 22:37:50,193 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 2 con 1 roles activos
2025-11-18 22:37:50,193 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_tech, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-18 22:37:50,194 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.9ms
2025-11-18 22:38:02,125 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 22:38:02,126 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.7ms
2025-11-18 22:38:02,128 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 22:38:02,129 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:02,129 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:02,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:02,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:02,129 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:02,130 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:02,130 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:02,131 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 22:38:02,138 - app.api.v1.endpoints.auth - INFO - Cliente 4 resuelto y validado para login.
2025-11-18 22:38:02,138 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_tech', cliente_id_destino=4
2025-11-18 22:38:02,139 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=4
2025-11-18 22:38:02,376 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 22:38:02,376 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_tech', usuario_id=2, cliente_origen=4, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-18 22:38:02,380 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 22:38:02,381 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 22:38:02,382 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2288, Rotación: False
2025-11-18 22:38:02,382 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2288
2025-11-18 22:38:02,382 - app.api.v1.endpoints.auth - INFO - Usuario admin_tech autenticado exitosamente (WEB) para cliente 4
2025-11-18 22:38:02,383 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 254.8ms
2025-11-18 22:38:02,415 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 22:38:02,416 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.2ms
2025-11-18 22:38:02,417 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 22:38:02,417 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 22:38:02,418 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.3ms
2025-11-18 22:38:02,419 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.2ms
2025-11-18 22:38:02,419 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 22:38:02,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:02,421 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 2.1ms
2025-11-18 22:38:02,421 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:02,422 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:02,422 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:02,422 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:02,422 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:02,423 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:02,424 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:02,424 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:02,443 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 22:38:02,443 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 22:38:02,494 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 22:38:02,496 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:02,496 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 22:38:02,497 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 22:38:02,497 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 76.5ms
2025-11-18 22:38:02,497 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:02,497 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:02,498 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:02,498 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:02,498 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:02,499 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:02,499 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:02,499 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:02,499 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:02,499 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:02,499 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:02,500 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:02,500 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:02,500 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:02,501 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:02,501 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 22:38:02,501 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:02,501 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:02,501 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:02,501 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:02,501 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:02,502 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:02,502 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:02,502 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 22:38:02,507 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 22:38:02,507 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 22:38:02,508 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 22:38:02,515 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 22:38:02,520 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 22:38:02,522 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 26.0ms
2025-11-18 22:38:02,522 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 25.9ms
2025-11-18 22:38:02,522 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 25.5ms
2025-11-18 22:38:06,079 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 22:38:06,079 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-18 22:38:06,081 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:06,082 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:06,082 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:06,082 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:06,082 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:06,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:06,084 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:06,085 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:06,085 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:06,088 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 4, Usuario 2, Tipo: web
2025-11-18 22:38:06,090 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_tech (Cliente: 4, Level: 4, Type: tenant_admin)
2025-11-18 22:38:06,091 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 22:38:06,101 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 22:38:06,101 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2289, Rotación: True
2025-11-18 22:38:06,108 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 22:38:06,110 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 4, Usuario 2
2025-11-18 22:38:06,110 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 22:38:06,111 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2289
2025-11-18 22:38:06,111 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_tech
2025-11-18 22:38:06,112 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 30.5ms
2025-11-18 22:38:06,120 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 22:38:06,121 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.9ms
2025-11-18 22:38:06,133 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:06,134 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:06,134 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:06,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:06,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:06,134 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:06,136 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:06,136 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:06,136 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:06,138 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_tech
2025-11-18 22:38:06,138 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-18 22:38:06,138 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 2 para cliente 4
2025-11-18 22:38:06,142 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 2 con 1 roles activos
2025-11-18 22:38:06,142 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_tech, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-18 22:38:06,143 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.1ms
2025-11-18 22:38:06,176 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 22:38:06,178 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.4ms
2025-11-18 22:38:06,178 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 22:38:06,178 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 22:38:06,179 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 22:38:06,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.9ms
2025-11-18 22:38:06,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.9ms
2025-11-18 22:38:06,181 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.7ms
2025-11-18 22:38:06,183 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:06,184 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:06,185 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:06,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:06,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:06,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:06,186 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:06,187 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:06,187 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:06,187 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:06,192 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 22:38:06,193 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 22:38:06,194 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 22:38:06,194 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 22:38:06,195 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 22:38:06,195 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:06,195 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:06,195 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:06,195 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:06,195 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:06,196 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:06,197 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:06,197 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:06,200 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 22:38:06,201 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 22:38:06,201 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 22:38:06,202 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:06,202 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:06,202 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:06,202 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:06,202 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:06,203 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:06,203 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:06,204 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 22:38:06,204 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:06,204 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:06,204 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:06,204 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:06,205 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:06,206 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:06,206 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:06,206 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 22:38:06,212 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 22:38:06,217 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 22:38:06,218 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 34.6ms
2025-11-18 22:38:06,219 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 31.6ms
2025-11-18 22:38:06,219 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 24.9ms
2025-11-18 22:38:06,219 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 24.9ms
2025-11-18 22:38:07,218 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 22:38:07,218 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-18 22:38:07,221 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:07,221 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:07,221 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:07,221 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:07,222 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:07,222 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:07,223 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:07,223 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:07,224 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:07,232 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 4, Usuario 2, Tipo: web
2025-11-18 22:38:07,234 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_tech (Cliente: 4, Level: 4, Type: tenant_admin)
2025-11-18 22:38:07,235 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 22:38:07,238 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 22:38:07,238 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2290, Rotación: True
2025-11-18 22:38:07,244 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 22:38:07,245 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 4, Usuario 2
2025-11-18 22:38:07,245 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 22:38:07,245 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2290
2025-11-18 22:38:07,246 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_tech
2025-11-18 22:38:07,246 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 25.8ms
2025-11-18 22:38:07,252 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 22:38:07,252 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-18 22:38:07,254 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:07,254 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:07,255 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:07,255 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:07,255 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:07,255 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:07,256 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:07,256 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:07,257 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:07,258 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_tech
2025-11-18 22:38:07,258 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-18 22:38:07,259 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 2 para cliente 4
2025-11-18 22:38:07,261 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 2 con 1 roles activos
2025-11-18 22:38:07,261 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_tech, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-18 22:38:07,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.8ms
2025-11-18 22:38:07,291 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 22:38:07,294 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 22:38:07,296 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 22:38:07,297 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 6.6ms
2025-11-18 22:38:07,298 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 22:38:07,302 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 8.4ms
2025-11-18 22:38:07,302 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 6.1ms
2025-11-18 22:38:07,303 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 5.0ms
2025-11-18 22:38:07,306 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:07,307 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:07,307 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:07,307 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:07,308 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:07,308 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:07,310 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:07,310 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:07,311 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:07,314 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 22:38:07,314 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 22:38:07,315 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 22:38:07,316 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:07,317 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:07,317 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:07,317 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:07,318 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:07,318 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:07,319 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:07,319 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:07,319 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:07,320 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 22:38:07,320 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 22:38:07,323 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 22:38:07,324 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 22:38:07,325 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 22:38:07,326 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:07,327 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:07,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:07,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:07,327 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:07,329 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:07,329 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:07,329 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 22:38:07,330 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:07,330 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:07,330 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:07,330 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:07,330 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:07,331 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:07,332 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:07,332 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 22:38:07,337 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 22:38:07,342 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 22:38:07,343 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 36.5ms
2025-11-18 22:38:07,344 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 27.8ms
2025-11-18 22:38:07,345 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 25.2ms
2025-11-18 22:38:07,345 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 25.1ms
2025-11-18 22:38:08,875 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 22:38:08,876 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.9ms
2025-11-18 22:38:08,879 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:08,879 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:08,879 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:08,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:08,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:08,880 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:08,882 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:08,882 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:08,882 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:08,886 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 4, Usuario 2, Tipo: web
2025-11-18 22:38:08,887 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: admin_tech (Cliente: 4, Level: 4, Type: tenant_admin)
2025-11-18 22:38:08,889 - app.core.auth - INFO - Niveles calculados - Usuario 2: level=4, super_admin=False, type=tenant_admin
2025-11-18 22:38:08,895 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 22:38:08,896 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 4, Usuario 2, Tipo: web, Token ID: 2291, Rotación: True
2025-11-18 22:38:08,898 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 22:38:08,899 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 4, Usuario 2
2025-11-18 22:38:08,899 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 22:38:08,899 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2291
2025-11-18 22:38:08,900 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: admin_tech
2025-11-18 22:38:08,900 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 21.7ms
2025-11-18 22:38:08,908 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 22:38:08,909 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.7ms
2025-11-18 22:38:08,913 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:08,914 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:08,914 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:08,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:08,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:08,915 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:08,916 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:08,916 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:08,916 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:08,918 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: admin_tech
2025-11-18 22:38:08,918 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 4, Super Admin: False, Type: tenant_admin
2025-11-18 22:38:08,919 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 2 para cliente 4
2025-11-18 22:38:08,922 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 2 con 1 roles activos
2025-11-18 22:38:08,922 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: admin_tech, Type: tenant_admin, Level: 4, Super Admin: False, Roles: 1
2025-11-18 22:38:08,923 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.4ms
2025-11-18 22:38:08,955 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 22:38:08,956 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 22:38:08,956 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.4ms
2025-11-18 22:38:08,956 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 22:38:08,956 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-18 22:38:08,957 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.7ms
2025-11-18 22:38:08,958 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.3ms
2025-11-18 22:38:08,958 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.4ms
2025-11-18 22:38:08,961 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:08,961 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:08,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:08,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:08,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:08,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:08,964 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:08,964 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:08,964 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:08,969 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 22:38:08,969 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 22:38:08,970 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 22:38:08,971 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 22:38:08,971 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:08,971 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-18 22:38:08,972 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:08,972 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:08,972 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:08,972 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:08,972 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:08,973 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:08,973 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:08,973 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 22:38:08,979 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 22:38:08,980 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:08,980 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:08,980 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:08,980 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:08,980 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:08,981 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:08,981 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:08,982 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:08,982 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:08,982 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:08,982 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:08,982 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:08,983 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:08,983 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:08,984 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:08,984 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/areas/
2025-11-18 22:38:08,988 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 2 del cliente 4
2025-11-18 22:38:08,988 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 2
2025-11-18 22:38:08,989 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 2.
2025-11-18 22:38:08,994 - app.api.deps - WARNING - Acceso denegado para usuario 'admin_tech'. Roles del usuario: ['Administrador']. Nivel Máximo: 4. Roles requeridos: ['Super Administrador']. Nivel Mínimo Requerido: 5
2025-11-18 22:38:08,995 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 33.8ms
2025-11-18 22:38:08,996 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 25.4ms
2025-11-18 22:38:08,996 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 25.3ms
2025-11-18 22:38:08,997 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 403 25.3ms
2025-11-18 22:38:11,910 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 22:38:11,910 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-18 22:38:11,913 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:11,913 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:11,914 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:11,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:11,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:11,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:11,971 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:11,972 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:11,974 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 1
2025-11-18 22:38:11,974 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: admin_tech
2025-11-18 22:38:11,974 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 61.4ms
2025-11-18 22:38:12,906 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:12,907 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:12,907 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:12,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:12,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:12,907 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:12,910 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:12,911 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:12,914 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 1
2025-11-18 22:38:12,914 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: admin_tech
2025-11-18 22:38:12,915 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 8.7ms
2025-11-18 22:38:30,958 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-18 22:38:30,959 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-18 22:38:30,961 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-18 22:38:30,961 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:30,961 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:30,961 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:30,961 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:30,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:30,964 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:30,965 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-18 22:38:30,967 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-18 22:38:30,967 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-18 22:38:30,968 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-18 22:38:31,181 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:31,181 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-18 22:38:31,181 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-18 22:38:31,182 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:31,183 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 22:38:31,183 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2292, Rotación: False
2025-11-18 22:38:31,183 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2292
2025-11-18 22:38:31,183 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-18 22:38:31,184 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 223.2ms
2025-11-18 22:38:31,206 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 22:38:31,208 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.2ms
2025-11-18 22:38:31,209 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 22:38:31,210 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 22:38:31,211 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.5ms
2025-11-18 22:38:31,211 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.4ms
2025-11-18 22:38:31,212 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-18 22:38:31,212 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-18 22:38:31,212 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:31,215 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:31,215 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:31,215 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:31,215 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:31,215 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:31,218 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:31,219 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:31,219 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-18 22:38:31,219 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 7.8ms
2025-11-18 22:38:31,219 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 7.7ms
2025-11-18 22:38:31,222 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:31,223 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:31,224 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:31,225 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 6.3ms
2025-11-18 22:38:31,227 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:31,227 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:31,227 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.1ms
2025-11-18 22:38:31,228 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:31,228 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:31,228 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:31,228 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:31,228 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:31,231 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:31,231 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:31,231 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:31,231 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:31,232 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:31,232 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:31,232 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:31,234 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:31,234 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:31,242 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:31,242 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:31,255 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:31,255 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:31,259 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:31,264 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:31,264 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:31,266 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 39.2ms
2025-11-18 22:38:31,266 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 39.3ms
2025-11-18 22:38:31,266 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:31,268 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:31,268 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:31,268 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:31,268 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:31,268 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:31,271 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:31,271 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:31,274 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:31,274 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:31,275 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:31,276 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:31,277 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:31,277 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:31,277 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:31,277 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:31,278 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:31,280 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:31,280 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:31,286 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:31,286 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:31,289 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:31,290 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:31,290 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:31,290 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 23.9ms
2025-11-18 22:38:31,291 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:31,291 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:31,291 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:31,291 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:31,291 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:31,293 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:31,293 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:31,298 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:31,299 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:31,300 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:31,301 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.3ms
2025-11-18 22:38:31,301 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 11.6ms
2025-11-18 22:38:32,552 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:32,552 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:32,553 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:32,553 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:32,553 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:32,553 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:32,556 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:32,556 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:32,559 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:32,560 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:32,562 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:32,564 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 22:38:32,565 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2293, Rotación: True
2025-11-18 22:38:32,566 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 22:38:32,567 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 22:38:32,567 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 22:38:32,567 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2293
2025-11-18 22:38:32,568 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:32,568 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.4ms
2025-11-18 22:38:32,572 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-18 22:38:32,573 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-18 22:38:32,575 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:32,575 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:32,575 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:32,576 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:32,576 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:32,576 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:32,579 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:32,579 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:32,580 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:32,581 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:32,581 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:32,583 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:32,584 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:32,584 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.6ms
2025-11-18 22:38:32,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:32,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:32,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:32,601 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:32,601 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:32,601 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:32,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:32,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:32,604 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:32,604 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:32,608 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:32,608 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:32,609 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:32,610 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:32,610 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:32,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:32,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:32,610 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:32,613 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:32,613 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:32,613 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:32,613 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:32,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:32,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:32,614 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:32,617 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:32,617 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:32,622 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:32,623 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:32,623 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:32,627 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:32,627 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:32,630 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:32,630 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:32,631 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 31.4ms
2025-11-18 22:38:32,631 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 31.2ms
2025-11-18 22:38:32,632 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 31.1ms
2025-11-18 22:38:32,635 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:32,636 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:32,637 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:32,637 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:32,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:32,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:32,637 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:32,640 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:32,640 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:32,644 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:32,644 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:32,645 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:32,646 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:32,646 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:32,646 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:32,646 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:32,646 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:32,649 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:32,650 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:32,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:32,657 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:32,658 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:32,658 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:32,659 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:32,659 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:32,659 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:32,659 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:32,659 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:32,661 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:32,662 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:32,667 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:32,667 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:32,671 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:32,671 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:32,672 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 37.1ms
2025-11-18 22:38:32,672 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 36.5ms
2025-11-18 22:38:32,674 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 21.5ms
2025-11-18 22:38:33,366 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:33,367 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,367 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,367 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,368 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,371 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,371 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:33,374 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:33,375 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:33,376 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:33,381 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 22:38:33,384 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2294, Rotación: True
2025-11-18 22:38:33,388 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 22:38:33,389 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 22:38:33,390 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 22:38:33,390 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2294
2025-11-18 22:38:33,390 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:33,391 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 25.1ms
2025-11-18 22:38:33,404 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:33,404 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,404 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,404 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,404 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,405 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,408 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,408 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:33,410 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:33,410 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:33,410 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:33,412 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:33,413 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:33,413 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.9ms
2025-11-18 22:38:33,434 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:33,435 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:33,435 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:33,435 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,436 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,436 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,436 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,436 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,438 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,439 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:33,442 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:33,442 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:33,443 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:33,443 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,443 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,443 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,444 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,444 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,446 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,446 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:33,446 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,446 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,449 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,450 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:33,454 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:33,454 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:33,458 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:33,458 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:33,462 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:33,463 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:33,463 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:33,464 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 29.8ms
2025-11-18 22:38:33,464 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 29.3ms
2025-11-18 22:38:33,464 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 29.1ms
2025-11-18 22:38:33,467 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:33,468 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,468 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,469 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,469 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,469 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,472 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,472 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:33,476 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:33,476 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:33,477 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:33,478 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:33,478 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:33,479 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,479 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,479 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,479 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,479 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,482 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,482 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:33,483 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,483 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,483 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,483 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,483 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,486 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,486 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:33,492 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:33,492 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:33,496 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:33,496 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:33,502 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:33,502 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:33,503 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:33,503 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 35.8ms
2025-11-18 22:38:33,504 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 26.0ms
2025-11-18 22:38:33,504 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 25.9ms
2025-11-18 22:38:33,855 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:33,856 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,856 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,856 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,856 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,857 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,859 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,859 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:33,861 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:33,862 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:33,863 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:33,864 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2294
2025-11-18 22:38:33,864 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2294
2025-11-18 22:38:33,864 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:33,864 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 9.0ms
2025-11-18 22:38:33,870 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:33,871 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,871 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,876 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,877 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:33,879 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:33,879 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:33,879 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:33,882 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:33,882 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:33,883 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 12.7ms
2025-11-18 22:38:33,898 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:33,899 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:33,900 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:33,900 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,900 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,900 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,901 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,901 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,904 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,904 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:33,908 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:33,909 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:33,910 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:33,910 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,910 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,911 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,913 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,913 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:33,913 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,914 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,914 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,917 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,917 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:33,923 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:33,924 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:33,924 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:33,928 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:33,929 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:33,933 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:33,933 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:33,934 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 35.5ms
2025-11-18 22:38:33,934 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 35.1ms
2025-11-18 22:38:33,935 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 35.0ms
2025-11-18 22:38:33,937 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:33,938 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:33,939 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,939 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,939 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,939 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,939 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,942 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,942 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:33,946 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:33,946 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:33,947 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:33,947 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,947 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,947 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,947 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,948 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,950 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,951 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:33,951 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:33,956 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:33,957 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:33,957 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:33,958 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:33,958 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:33,958 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:33,958 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:33,958 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:33,960 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:33,960 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:33,965 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:33,965 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:33,969 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:33,969 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:33,970 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 32.9ms
2025-11-18 22:38:33,970 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 32.0ms
2025-11-18 22:38:33,972 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 20.5ms
2025-11-18 22:38:34,130 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:34,130 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,131 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,131 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,131 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,131 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,134 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,134 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:34,137 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:34,139 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:34,141 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:34,143 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 22:38:34,143 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2295, Rotación: True
2025-11-18 22:38:34,145 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 22:38:34,145 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 22:38:34,145 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 22:38:34,145 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2295
2025-11-18 22:38:34,146 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:34,146 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.3ms
2025-11-18 22:38:34,150 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:34,151 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,151 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,151 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,152 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,152 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,154 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,154 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:34,156 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:34,156 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:34,156 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:34,158 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:34,158 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:34,159 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.6ms
2025-11-18 22:38:34,174 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:34,175 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:34,175 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:34,175 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,175 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,176 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,176 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,176 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,178 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,178 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:34,181 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:34,182 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:34,183 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:34,183 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,183 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,184 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,184 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,184 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,187 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,187 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:34,187 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,187 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,187 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,188 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,190 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,190 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:34,194 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:34,194 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:34,198 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:34,198 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:34,203 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:34,204 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:34,204 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:34,204 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.4ms
2025-11-18 22:38:34,205 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 30.1ms
2025-11-18 22:38:34,205 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 29.9ms
2025-11-18 22:38:34,207 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:34,208 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,208 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,208 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,208 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,208 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,211 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,211 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:34,214 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:34,214 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:34,215 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:34,216 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:34,216 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:34,217 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,217 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,217 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,217 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,220 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,220 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:34,221 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,221 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,221 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,221 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,221 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,223 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,223 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:34,228 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:34,228 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:34,231 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:34,231 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:34,236 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:34,237 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:34,237 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:34,237 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.7ms
2025-11-18 22:38:34,238 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 22.7ms
2025-11-18 22:38:34,238 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 22.3ms
2025-11-18 22:38:34,378 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:34,378 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,378 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,378 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,379 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,379 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,382 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,382 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:34,385 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:34,386 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:34,388 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:34,390 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2295
2025-11-18 22:38:34,390 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2295
2025-11-18 22:38:34,390 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:34,391 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 13.4ms
2025-11-18 22:38:34,395 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:34,396 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,396 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,399 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,399 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:34,401 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:34,401 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:34,402 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:34,404 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:34,405 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:34,405 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.8ms
2025-11-18 22:38:34,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:34,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:34,421 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:34,421 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,421 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,421 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,421 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,421 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,424 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,424 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:34,427 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:34,427 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:34,428 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:34,429 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,429 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,429 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,432 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,432 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:34,432 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,432 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,432 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,432 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,432 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,435 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,436 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:34,440 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:34,440 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:34,443 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:34,444 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:34,447 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:34,448 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:34,448 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:34,449 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 29.2ms
2025-11-18 22:38:34,450 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 29.3ms
2025-11-18 22:38:34,450 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 29.3ms
2025-11-18 22:38:34,452 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:34,454 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:34,455 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,455 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,455 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,455 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,455 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,458 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,458 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:34,461 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:34,461 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:34,462 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:34,462 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,463 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,463 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,463 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,463 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,465 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,465 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:34,466 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:34,471 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:34,472 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:34,476 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:34,476 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:34,477 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,477 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,480 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,480 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:34,485 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:34,486 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:34,486 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:34,487 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 34.7ms
2025-11-18 22:38:34,487 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 33.4ms
2025-11-18 22:38:34,488 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 22.4ms
2025-11-18 22:38:34,610 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:34,611 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,611 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,611 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,611 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,612 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,614 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,614 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:34,617 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:34,619 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:34,620 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:34,622 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2295
2025-11-18 22:38:34,622 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2295
2025-11-18 22:38:34,622 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:34,623 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.7ms
2025-11-18 22:38:34,627 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:34,628 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,628 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,628 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,628 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,628 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,631 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,631 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:34,633 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:34,633 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:34,633 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:34,636 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:34,636 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:34,637 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.9ms
2025-11-18 22:38:34,651 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:34,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:34,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:34,652 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,653 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,653 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,656 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,656 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:34,659 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:34,659 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:34,660 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:34,660 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,660 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,660 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,661 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,661 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,663 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,663 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:34,663 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,664 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,664 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,664 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,664 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,666 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,667 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:34,671 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:34,672 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:34,675 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:34,675 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:34,679 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:34,680 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:34,680 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:34,681 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.3ms
2025-11-18 22:38:34,681 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 29.7ms
2025-11-18 22:38:34,681 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 29.5ms
2025-11-18 22:38:34,684 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:34,685 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:34,685 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,686 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,686 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,686 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,686 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,689 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,689 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:34,692 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:34,692 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:34,693 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:34,694 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,694 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,694 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,694 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,694 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,697 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,697 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:34,703 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:34,703 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:34,707 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:34,707 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:34,708 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:34,708 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,709 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,709 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,709 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,709 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,712 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,712 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:34,717 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:34,719 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:34,719 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:34,719 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 35.5ms
2025-11-18 22:38:34,720 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 35.1ms
2025-11-18 22:38:34,721 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 13.0ms
2025-11-18 22:38:34,814 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:34,814 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,815 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,815 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,815 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,815 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,818 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,819 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:34,822 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:34,824 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:34,826 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:34,828 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2295
2025-11-18 22:38:34,828 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2295
2025-11-18 22:38:34,829 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:34,829 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.7ms
2025-11-18 22:38:34,837 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:34,838 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,838 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,838 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,838 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,838 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,841 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,841 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:34,843 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:34,843 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:34,844 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:34,846 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:34,846 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:34,847 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.1ms
2025-11-18 22:38:34,862 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:34,862 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:34,862 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:34,863 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,863 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,863 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,863 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,863 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,866 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,866 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:34,871 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:34,871 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:34,872 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:34,872 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,872 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,872 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,873 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,875 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,875 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:34,875 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,875 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,876 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,876 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,876 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,878 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,878 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:34,882 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:34,883 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:34,883 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:34,888 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:34,889 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:34,893 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:34,893 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:34,893 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 31.7ms
2025-11-18 22:38:34,894 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 31.5ms
2025-11-18 22:38:34,894 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 31.5ms
2025-11-18 22:38:34,897 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:34,898 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,898 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,898 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,902 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,902 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:34,902 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:34,902 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:34,906 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:34,906 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:34,908 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:34,908 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,908 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,908 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,909 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,909 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,911 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,912 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:34,912 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:34,912 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:34,912 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:34,912 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:34,913 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:34,915 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:34,916 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:34,921 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:34,922 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:34,923 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:34,928 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:34,928 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:34,933 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:34,933 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:34,934 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 37.4ms
2025-11-18 22:38:34,935 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 32.7ms
2025-11-18 22:38:34,935 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 32.8ms
2025-11-18 22:38:35,029 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:35,030 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,030 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,030 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,030 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,030 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,033 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,033 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:35,036 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:35,038 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:35,039 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:35,042 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 22:38:35,043 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2296, Rotación: True
2025-11-18 22:38:35,044 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 22:38:35,044 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 22:38:35,045 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 22:38:35,045 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2296
2025-11-18 22:38:35,045 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:35,046 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.9ms
2025-11-18 22:38:35,051 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:35,052 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,052 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,052 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,052 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,053 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,056 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,056 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:35,058 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:35,058 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:35,058 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:35,061 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:35,061 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:35,062 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.3ms
2025-11-18 22:38:35,080 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:35,080 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:35,081 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,081 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,081 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,084 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,085 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:35,085 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:35,090 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:35,090 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:35,091 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:35,091 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,091 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,092 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,094 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,094 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:35,099 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:35,099 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:35,104 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:35,104 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:35,105 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,105 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,105 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,108 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,108 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:35,113 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:35,114 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:35,114 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:35,115 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 35.2ms
2025-11-18 22:38:35,115 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 35.1ms
2025-11-18 22:38:35,116 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 31.3ms
2025-11-18 22:38:35,120 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:35,120 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:35,121 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,122 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,122 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,122 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,122 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,124 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,125 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:35,125 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,125 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,125 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,128 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,128 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:35,132 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:35,133 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:35,134 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:35,140 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:35,140 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:35,144 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:35,145 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:35,145 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 25.3ms
2025-11-18 22:38:35,146 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 25.4ms
2025-11-18 22:38:35,253 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:35,254 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,254 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,254 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,254 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,254 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,257 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,258 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:35,261 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:35,262 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:35,264 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:35,266 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2296
2025-11-18 22:38:35,266 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2296
2025-11-18 22:38:35,266 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:35,267 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.0ms
2025-11-18 22:38:35,273 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:35,273 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,273 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,274 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,274 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,274 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,276 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,277 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:35,278 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:35,278 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:35,278 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:35,281 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:35,281 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:35,282 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.1ms
2025-11-18 22:38:35,298 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:35,299 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:35,299 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,299 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,300 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,300 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,300 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,304 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,304 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:35,304 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:35,308 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:35,309 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:35,309 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:35,310 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,310 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,310 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,313 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,313 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:35,319 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:35,319 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:35,323 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:35,323 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:35,324 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,324 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,324 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,324 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,324 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,327 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,328 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:35,333 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:35,334 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:35,334 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:35,336 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 38.4ms
2025-11-18 22:38:35,337 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 38.0ms
2025-11-18 22:38:35,337 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:35,337 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 33.0ms
2025-11-18 22:38:35,338 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,338 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,338 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,339 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,339 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,342 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,342 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:35,346 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:35,347 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:35,347 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:35,349 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.6ms
2025-11-18 22:38:35,433 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:35,434 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,434 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,434 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,435 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,435 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,438 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,438 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:35,441 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:35,442 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:35,443 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:35,444 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2296
2025-11-18 22:38:35,445 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2296
2025-11-18 22:38:35,445 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:35,446 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.6ms
2025-11-18 22:38:35,451 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:35,452 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,452 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,452 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,453 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,453 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,456 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,456 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:35,458 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:35,458 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:35,458 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:35,461 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:35,461 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:35,461 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.0ms
2025-11-18 22:38:35,478 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:35,479 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,479 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,479 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,479 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,480 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,482 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,482 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:35,483 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:35,488 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:35,488 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:35,489 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:35,490 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,490 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,490 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,490 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,490 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,492 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,492 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:35,493 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:35,497 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:35,498 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:35,502 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:35,502 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:35,503 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,503 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,504 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,504 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,504 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,507 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,507 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:35,512 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:35,512 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:35,513 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:35,513 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 35.1ms
2025-11-18 22:38:35,514 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 31.0ms
2025-11-18 22:38:35,514 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 21.5ms
2025-11-18 22:38:35,516 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:35,517 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:35,517 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,518 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,518 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,518 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,518 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,521 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,521 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:35,522 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:35,522 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,522 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,523 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,526 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,526 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:35,530 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:35,530 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:35,531 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:35,537 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:35,538 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:35,538 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:35,539 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,539 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,539 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,539 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,539 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,542 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,542 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:35,547 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:35,548 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:35,552 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:35,552 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:35,553 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 37.2ms
2025-11-18 22:38:35,554 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 36.9ms
2025-11-18 22:38:35,554 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 32.1ms
2025-11-18 22:38:35,646 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:35,646 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,646 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,647 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,647 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,647 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,650 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,650 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:35,653 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:35,654 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:35,656 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:35,657 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2296
2025-11-18 22:38:35,657 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2296
2025-11-18 22:38:35,658 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:35,658 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.9ms
2025-11-18 22:38:35,663 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:35,664 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,664 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,665 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,665 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,665 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,668 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,668 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:35,670 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:35,670 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:35,670 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:35,672 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:35,672 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:35,673 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.6ms
2025-11-18 22:38:35,688 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:35,689 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:35,689 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,689 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,689 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,689 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,690 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,692 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,692 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:35,693 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:35,696 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:35,696 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:35,697 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:35,697 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,698 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,698 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,698 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,698 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,701 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,701 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:35,706 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:35,706 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:35,710 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:35,710 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:35,710 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,710 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,711 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,711 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,711 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,714 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,714 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:35,720 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:35,721 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:35,721 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:35,721 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 33.4ms
2025-11-18 22:38:35,722 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 33.2ms
2025-11-18 22:38:35,723 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 30.0ms
2025-11-18 22:38:35,726 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:35,726 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:35,727 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:35,727 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,727 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,727 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,728 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,728 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,730 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,730 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:35,731 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,731 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,731 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,732 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,732 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,734 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,735 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:35,740 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:35,741 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:35,745 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:35,745 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:35,745 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,746 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,746 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,749 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,749 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:35,753 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:35,754 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:35,755 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:35,760 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:35,761 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:35,761 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:35,762 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 36.7ms
2025-11-18 22:38:35,763 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 36.6ms
2025-11-18 22:38:35,763 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 36.2ms
2025-11-18 22:38:35,846 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:35,847 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,847 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,847 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,850 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,850 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:35,853 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:35,854 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:35,856 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:35,857 - app.services.refresh_token_service - INFO - [STORE-TOKEN-ROTATION] Token ya existe en BD (doble refresh detectado) - Cliente 1, Usuario 1, Token ID: 2296
2025-11-18 22:38:35,858 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2296
2025-11-18 22:38:35,858 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:35,859 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 12.8ms
2025-11-18 22:38:35,863 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:35,863 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,864 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,864 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,864 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,864 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,867 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,867 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:35,869 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:35,869 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:35,870 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:35,872 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:35,872 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:35,873 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.0ms
2025-11-18 22:38:35,888 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:35,888 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:35,889 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,889 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,889 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,889 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,889 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,892 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,892 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:35,892 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,892 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,892 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,895 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,895 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:35,896 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:35,899 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:35,899 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:35,900 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:35,905 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:35,905 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:35,909 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:35,909 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:35,909 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,909 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,910 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,912 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,913 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:35,917 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:35,918 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:35,919 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:35,919 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 31.8ms
2025-11-18 22:38:35,920 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 31.6ms
2025-11-18 22:38:35,921 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 25.1ms
2025-11-18 22:38:35,924 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:35,924 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:35,924 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:35,925 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,925 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,925 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,926 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,926 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,928 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,929 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:35,929 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,929 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,929 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,929 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,930 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,932 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,932 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:35,932 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:35,933 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:35,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:35,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:35,933 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:35,936 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:35,936 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:35,942 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:35,942 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:35,943 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:35,947 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:35,947 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:35,952 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:35,952 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:35,956 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:35,956 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:35,957 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:35,958 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 34.4ms
2025-11-18 22:38:35,958 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 34.2ms
2025-11-18 22:38:35,958 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 34.0ms
2025-11-18 22:38:36,064 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:36,065 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:36,065 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:36,065 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:36,065 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:36,065 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:36,068 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:36,069 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:36,072 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-18 22:38:36,073 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-18 22:38:36,074 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-18 22:38:36,077 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-18 22:38:36,077 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 2297, Rotación: True
2025-11-18 22:38:36,079 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-18 22:38:36,079 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-18 22:38:36,079 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-18 22:38:36,080 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 2297
2025-11-18 22:38:36,080 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-18 22:38:36,080 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.5ms
2025-11-18 22:38:36,085 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-18 22:38:36,086 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:36,086 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:36,086 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:36,086 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:36,087 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:36,090 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:36,090 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-18 22:38:36,091 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-18 22:38:36,091 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-18 22:38:36,092 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-18 22:38:36,093 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-18 22:38:36,093 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-18 22:38:36,094 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 9.1ms
2025-11-18 22:38:36,111 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:36,112 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:36,112 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:36,113 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:36,113 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:36,113 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:36,113 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:36,113 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:36,115 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:36,116 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:36,120 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:36,120 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:36,122 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:36,122 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:36,122 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:36,122 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:36,122 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:36,122 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:36,125 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:36,125 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:36,125 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:36,125 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:36,125 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:36,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:36,126 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:36,128 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:36,128 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:36,133 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:36,134 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:36,134 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:36,139 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:36,139 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:36,143 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:36,143 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:36,144 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 32.4ms
2025-11-18 22:38:36,144 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 31.9ms
2025-11-18 22:38:36,144 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 31.8ms
2025-11-18 22:38:36,146 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-18 22:38:36,147 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:36,147 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:36,147 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:36,147 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:36,147 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:36,150 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:36,150 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-18 22:38:36,154 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-18 22:38:36,154 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-18 22:38:36,156 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-18 22:38:36,156 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-18 22:38:36,157 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-18 22:38:36,157 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:36,157 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:36,157 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:36,157 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:36,158 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:36,160 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:36,160 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-18 22:38:36,165 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-18 22:38:36,166 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-18 22:38:36,166 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-18 22:38:36,167 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:36,167 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-18 22:38:36,167 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-18 22:38:36,167 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:36,167 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-18 22:38:36,170 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:36,170 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-18 22:38:36,175 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-18 22:38:36,175 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-18 22:38:36,178 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-18 22:38:36,178 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-18 22:38:36,179 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 32.9ms
2025-11-18 22:38:36,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 23.3ms
2025-11-18 22:38:36,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 23.1ms
2025-11-18 22:38:37,852 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-18 22:38:37,853 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-18 22:38:37,856 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-18 22:38:37,856 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-18 22:38:37,856 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-18 22:38:37,856 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-18 22:38:37,857 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-18 22:38:37,857 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-18 22:38:37,859 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-18 22:38:37,859 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-18 22:38:37,859 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-18 22:38:37,862 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-18 22:38:37,863 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-18 22:38:37,863 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 7.6ms
2025-11-19 07:12:27,962 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'assets', 'www', 'backend', 'cdn', 'admin', 'api', 'static'}
2025-11-19 07:12:45,694 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-19 07:12:45,695 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:12:45,695 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:12:45,695 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-19 07:12:45,696 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:12:45,696 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-19 07:12:45,696 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:12:45,696 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:12:45,696 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-19 07:12:45,777 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 83.0ms
2025-11-19 07:12:53,828 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-19 07:12:53,829 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:12:53,829 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:12:53,829 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-19 07:12:53,829 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:12:53,830 - app.middleware.tenant_middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-19 07:12:53,830 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:12:53,830 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:12:53,830 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-19 07:12:54,030 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 201.8ms
2025-11-19 07:12:56,024 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-19 07:12:56,025 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-19 07:12:56,028 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-19 07:12:56,028 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:12:56,028 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': techcorp.app.local:5173
2025-11-19 07:12:56,028 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-19 07:12:56,029 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:12:56,029 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-19 07:12:56,669 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', Código='TECH003', ID=4
2025-11-19 07:12:56,702 - app.core.encryption - ERROR - Token de encriptación inválido. Posibles causas: clave incorrecta o datos corruptos
2025-11-19 07:12:56,703 - app.core.multi_db - ERROR - [METADATA] Error al desencriptar credenciales para cliente 4: Credencial corrupta o clave de encriptación incorrecta
2025-11-19 07:12:56,703 - app.core.multi_db - WARNING - [METADATA] No se encontró configuración para cliente 4, usando Single-DB como fallback
2025-11-19 07:12:56,704 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:12:56,704 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-19 07:12:56,767 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-19 07:12:56,767 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-19 07:12:56,768 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 740.4ms
2025-11-19 07:17:53,105 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-19 07:17:53,105 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-19 07:17:53,107 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-19 07:17:53,107 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:17:53,108 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:17:53,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:17:53,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:17:53,108 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:17:53,108 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:17:53,109 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:17:53,109 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-19 07:17:53,110 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-19 07:17:53,110 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.3ms
2025-11-19 07:17:57,416 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-19 07:17:57,417 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-19 07:17:57,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-19 07:17:57,420 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:17:57,421 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:17:57,421 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:17:57,421 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:17:57,421 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:17:57,523 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:17:57,523 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-19 07:17:57,541 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-19 07:17:57,545 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-19 07:17:57,557 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-19 07:17:57,667 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-19 07:17:57,668 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 3248, Rotación: True
2025-11-19 07:17:57,679 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-19 07:17:57,680 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-19 07:17:57,680 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-19 07:17:57,680 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 3248
2025-11-19 07:17:57,681 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-19 07:17:57,682 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 261.9ms
2025-11-19 07:17:57,687 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-19 07:17:57,688 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.9ms
2025-11-19 07:17:57,690 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-19 07:17:57,690 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:17:57,690 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:17:57,690 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:17:57,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:17:57,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:17:57,693 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:17:57,694 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-19 07:17:57,697 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-19 07:17:57,697 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-19 07:17:57,697 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-19 07:17:57,718 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-19 07:17:57,719 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-19 07:17:57,720 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 30.0ms
2025-11-19 07:17:57,762 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-19 07:17:57,763 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.8ms
2025-11-19 07:17:57,764 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-19 07:17:57,766 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.5ms
2025-11-19 07:17:57,766 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-19 07:17:57,767 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-19 07:17:57,767 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-19 07:17:57,769 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-19 07:17:57,770 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-19 07:17:57,771 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 4.4ms
2025-11-19 07:17:57,771 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 4.3ms
2025-11-19 07:17:57,771 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 4.2ms
2025-11-19 07:17:57,773 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:17:57,773 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:17:57,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:17:57,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:17:57,773 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:17:57,777 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:17:57,777 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-19 07:17:57,799 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-19 07:17:57,799 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-19 07:17:57,851 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-19 07:17:57,851 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 81.3ms
2025-11-19 07:17:57,854 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-19 07:17:57,855 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:17:57,855 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:17:57,855 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:17:57,855 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:17:57,856 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:17:57,858 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:17:57,858 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-19 07:17:57,859 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 90.3ms
2025-11-19 07:17:57,875 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-19 07:17:57,875 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-19 07:17:57,922 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-19 07:17:57,922 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-19 07:17:57,923 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-19 07:17:57,924 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:17:57,924 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:17:57,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:17:57,924 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:17:57,925 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:17:57,927 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:17:57,928 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-19 07:17:57,934 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-19 07:17:57,939 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-19 07:17:57,940 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-19 07:17:57,941 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 86.7ms
2025-11-19 07:17:57,942 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 19.1ms
2025-11-19 07:17:57,948 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-19 07:17:57,949 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:17:57,949 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:17:57,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:17:57,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:17:57,949 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:17:57,953 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:17:57,953 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-19 07:17:57,959 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-19 07:17:57,959 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-19 07:17:57,960 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-19 07:17:57,961 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-19 07:17:57,961 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-19 07:17:57,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:17:57,962 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:17:57,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:17:57,962 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:17:57,963 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:17:57,965 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:17:57,966 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-19 07:17:57,966 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:17:57,966 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:17:57,966 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:17:57,966 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:17:57,967 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:17:57,970 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:17:57,970 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-19 07:17:57,976 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-19 07:17:57,977 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-19 07:17:57,977 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-19 07:17:57,983 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-19 07:17:57,984 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-19 07:17:57,988 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-19 07:17:57,988 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-19 07:17:57,989 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 40.5ms
2025-11-19 07:17:57,990 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 29.3ms
2025-11-19 07:17:57,990 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 29.3ms
2025-11-19 07:19:59,088 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-19 07:19:59,089 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-19 07:19:59,090 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-19 07:19:59,091 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:19:59,091 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:19:59,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:19:59,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:19:59,091 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:19:59,092 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:19:59,092 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:19:59,092 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-19 07:19:59,197 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-19 07:19:59,197 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-19 07:19:59,197 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-19 07:19:59,594 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-19 07:19:59,594 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-19 07:19:59,594 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-19 07:19:59,595 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-19 07:19:59,639 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-19 07:19:59,640 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 3249, Rotación: False
2025-11-19 07:19:59,640 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 3249
2025-11-19 07:19:59,641 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-19 07:19:59,641 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 551.0ms
2025-11-19 07:19:59,916 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-19 07:19:59,917 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.0ms
2025-11-19 07:19:59,919 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-19 07:19:59,919 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-19 07:19:59,920 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-19 07:19:59,920 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.9ms
2025-11-19 07:19:59,921 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.4ms
2025-11-19 07:19:59,921 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.3ms
2025-11-19 07:19:59,924 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-19 07:19:59,924 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-19 07:19:59,925 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.2ms
2025-11-19 07:19:59,925 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.2ms
2025-11-19 07:20:05,587 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-19 07:20:05,588 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-19 07:20:05,589 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-19 07:20:05,589 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:05,589 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:05,589 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:05,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:05,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:05,590 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:05,590 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:05,591 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-19 07:20:05,595 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-19 07:20:05,595 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-19 07:20:05,596 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-19 07:20:05,597 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:05,597 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:05,597 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:05,597 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:05,598 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:05,598 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:05,598 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:05,598 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-19 07:20:05,599 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:05,599 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:05,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:05,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:05,599 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:05,599 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:05,600 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:05,600 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-19 07:20:05,605 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-19 07:20:05,606 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-19 07:20:05,611 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-19 07:20:05,611 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-19 07:20:05,616 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-19 07:20:05,617 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-19 07:20:05,618 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-19 07:20:05,618 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 31.0ms
2025-11-19 07:20:05,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 30.3ms
2025-11-19 07:20:05,619 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 30.2ms
2025-11-19 07:20:08,875 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-19 07:20:08,876 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-19 07:20:08,876 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-19 07:20:08,876 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:08,877 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:08,877 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:08,877 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:08,877 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:08,877 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:08,878 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:08,878 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-19 07:20:08,882 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-19 07:20:08,883 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-19 07:20:08,884 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-19 07:20:08,884 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:08,885 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:08,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:08,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:08,885 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:08,885 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:08,886 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:08,886 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-19 07:20:08,886 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:08,887 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:08,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:08,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:08,887 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:08,887 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:08,887 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:08,888 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-19 07:20:08,893 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-19 07:20:08,893 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-19 07:20:08,897 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-19 07:20:08,897 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-19 07:20:08,903 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-19 07:20:08,903 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-19 07:20:08,904 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-19 07:20:08,904 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 29.3ms
2025-11-19 07:20:08,905 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 29.0ms
2025-11-19 07:20:08,905 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 28.8ms
2025-11-19 07:20:33,751 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-19 07:20:33,752 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.7ms
2025-11-19 07:20:33,753 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-19 07:20:33,753 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.7ms
2025-11-19 07:20:33,755 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:20:33,755 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:33,755 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:33,755 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:33,756 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:33,756 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:33,756 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:33,756 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:33,756 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:20:33,760 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:20:33,760 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTU1Njk5LCJpYXQiOjE3NjM1NTQ3OTksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.UMplOBGI6c2yF1KwPA3SnZCc2rB-8sobVHLkyJ3xemI', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://localhost:5173', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8'}
2025-11-19 07:20:33,761 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-19 07:20:33,761 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-19 07:20:33,761 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:20:33,761 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-19 07:20:33,989 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:20:33,992 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 237.0ms
2025-11-19 07:20:33,993 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:20:33,994 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:33,994 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:33,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:33,994 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:33,995 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:33,995 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:33,995 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:33,995 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:20:33,999 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:20:33,999 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTU1Njk5LCJpYXQiOjE3NjM1NTQ3OTksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.UMplOBGI6c2yF1KwPA3SnZCc2rB-8sobVHLkyJ3xemI', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://localhost:5173', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8'}
2025-11-19 07:20:34,000 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-19 07:20:34,000 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-19 07:20:34,000 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:20:34,000 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-19 07:20:34,002 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:20:34,003 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.5ms
2025-11-19 07:20:35,168 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-19 07:20:35,170 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.7ms
2025-11-19 07:20:35,170 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-19 07:20:35,172 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.3ms
2025-11-19 07:20:37,988 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:20:37,989 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:37,989 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:37,989 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:37,989 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:37,989 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:37,990 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:37,990 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:37,990 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:20:37,994 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:20:37,994 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:20:38,082 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:20:38,083 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 95.0ms
2025-11-19 07:20:38,085 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:20:38,086 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:38,086 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:38,086 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:38,086 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:38,086 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:38,086 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:38,087 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:38,087 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:20:38,092 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:20:38,092 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:20:38,093 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:20:38,094 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.0ms
2025-11-19 07:20:44,845 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-19 07:20:44,846 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-19 07:20:44,848 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-19 07:20:44,848 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-19 07:20:44,849 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-19 07:20:44,849 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.6ms
2025-11-19 07:20:44,850 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.4ms
2025-11-19 07:20:44,850 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.0ms
2025-11-19 07:20:48,646 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:20:48,647 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:20:48,647 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:48,648 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:48,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:48,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:48,648 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:48,648 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:48,649 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:48,649 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:20:48,653 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:20:48,653 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXNfc3VwZXJhZG1pbiI6dHJ1ZSwiZXhwIjoxNzYzNTU1Njk5LCJpYXQiOjE3NjM1NTQ3OTksInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.UMplOBGI6c2yF1KwPA3SnZCc2rB-8sobVHLkyJ3xemI', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://localhost:5173', 'referer': 'http://localhost:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8'}
2025-11-19 07:20:48,654 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-19 07:20:48,654 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-19 07:20:48,654 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:20:48,654 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-19 07:20:48,655 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:20:48,656 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:48,656 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:48,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:48,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:48,657 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:48,657 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:48,657 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:48,657 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:20:48,660 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-19 07:20:48,661 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-19 07:20:48,662 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:20:48,663 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 16.1ms
2025-11-19 07:20:48,663 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 15.7ms
2025-11-19 07:20:59,691 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-19 07:20:59,692 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:20:59,692 - app.middleware.tenant_middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-19 07:20:59,692 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-19 07:20:59,692 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:20:59,692 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-19 07:20:59,693 - app.middleware.tenant_middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-19 07:20:59,693 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:20:59,693 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-19 07:20:59,694 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-19 07:20:59,695 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.5ms
2025-11-19 07:21:19,718 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-19 07:21:19,718 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-19 07:21:19,719 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.7ms
2025-11-19 07:21:19,719 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.5ms
2025-11-19 07:21:20,632 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-19 07:21:20,633 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-19 07:21:20,633 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.9ms
2025-11-19 07:21:20,633 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.7ms
2025-11-19 07:21:21,519 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:21:21,519 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:21:21,519 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:21:21,520 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:21:21,520 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:21:21,520 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:21:21,520 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:21:21,523 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:21:21,524 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:21:21,528 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:21:21,528 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTU1NTc3LCJpYXQiOjE3NjM1NTQ2NzcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9._hZHUW_Sy04Q5Qt30-CRWr_SgVFSrLTtILhSO23gET8', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTU5NDc3LCJpYXQiOjE3NjM1NTQ2NzcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.3ij61dZE-aXIEN44tS2dq9B_7zSv5-ntc489mmbcagk'}
2025-11-19 07:21:21,528 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-19 07:21:21,529 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-19 07:21:21,529 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:21:21,529 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-19 07:21:21,531 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:21:21,532 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:21:21,532 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:21:21,533 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:21:21,533 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:21:21,533 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:21:21,536 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:21:21,536 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:21:21,540 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:21:21,540 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:21:21,541 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:21:21,542 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 23.8ms
2025-11-19 07:21:21,543 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 23.5ms
2025-11-19 07:21:21,589 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:21:21,590 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:21:21,590 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:21:21,590 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:21:21,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:21:21,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:21:21,590 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:21:21,593 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:21:21,593 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:21:21,598 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:21:21,599 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTU1NTc3LCJpYXQiOjE3NjM1NTQ2NzcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9._hZHUW_Sy04Q5Qt30-CRWr_SgVFSrLTtILhSO23gET8', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTU5NDc3LCJpYXQiOjE3NjM1NTQ2NzcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.3ij61dZE-aXIEN44tS2dq9B_7zSv5-ntc489mmbcagk'}
2025-11-19 07:21:21,599 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-19 07:21:21,599 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-19 07:21:21,599 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:21:21,599 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-19 07:21:21,601 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:21:21,602 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:21:21,602 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:21:21,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:21:21,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:21:21,602 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:21:21,614 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:21:21,614 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:21:21,622 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:21:21,622 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:21:21,624 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:21:21,625 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 36.0ms
2025-11-19 07:21:21,625 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 35.7ms
2025-11-19 07:21:27,655 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-19 07:21:27,656 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:21:27,656 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:21:27,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:21:27,656 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:21:27,657 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:21:27,659 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:21:27,659 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-19 07:21:27,662 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-19 07:21:27,663 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-19 07:21:27,664 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-19 07:21:27,680 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-19 07:21:27,681 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 3250, Rotación: True
2025-11-19 07:21:27,749 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-19 07:21:27,749 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-19 07:21:27,749 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-19 07:21:27,749 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 3250
2025-11-19 07:21:27,750 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-19 07:21:27,750 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 94.9ms
2025-11-19 07:21:27,756 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-19 07:21:27,756 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:21:27,756 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:21:27,756 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:21:27,756 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:21:27,757 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:21:27,759 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:21:27,759 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-19 07:21:27,761 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-19 07:21:27,761 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-19 07:21:27,761 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-19 07:21:27,763 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-19 07:21:27,764 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-19 07:21:27,764 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.5ms
2025-11-19 07:21:27,839 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-19 07:21:27,839 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:21:27,840 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:21:27,840 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:21:27,840 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:21:27,840 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:21:27,842 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:21:27,843 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-19 07:21:27,843 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:21:27,846 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-19 07:21:27,846 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-19 07:21:27,847 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-19 07:21:27,848 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:21:27,848 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:21:27,848 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:21:27,848 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:21:27,848 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:21:27,851 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:21:27,851 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:21:27,855 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:21:27,856 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:21:27,857 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:21:27,857 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 18.6ms
2025-11-19 07:21:27,858 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 15.3ms
2025-11-19 07:21:27,860 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-19 07:21:27,861 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:21:27,861 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:21:27,861 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:21:27,861 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:21:27,862 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:21:27,862 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:21:27,864 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:21:27,864 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-19 07:21:27,868 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-19 07:21:27,869 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-19 07:21:27,870 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-19 07:21:27,871 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:21:27,871 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:21:27,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:21:27,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:21:27,871 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:21:27,874 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:21:27,874 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:21:27,878 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:21:27,878 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:21:27,880 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:21:27,880 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 20.3ms
2025-11-19 07:21:27,881 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 20.1ms
2025-11-19 07:21:35,034 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:21:35,035 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:21:35,035 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:21:35,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:21:35,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:21:35,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:21:35,038 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:21:35,038 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:21:35,043 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:21:35,043 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTU1Nzg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.ShLdK7bz9TC5waTWO285f8Zwo3LZGxad9NyuXuCT6Qk', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTU5Njg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.CE0Adrry9UZqF96oakUivblyhTAoRIWURXiSTG4mDzA'}
2025-11-19 07:21:35,043 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-19 07:21:35,044 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-19 07:21:35,044 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:21:35,044 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-19 07:21:35,046 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:21:35,047 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 12.7ms
2025-11-19 07:21:35,049 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:21:35,049 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:21:35,049 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:21:35,050 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:21:35,050 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:21:35,050 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:21:35,053 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:21:35,054 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:21:35,058 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:21:35,058 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTU1Nzg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.ShLdK7bz9TC5waTWO285f8Zwo3LZGxad9NyuXuCT6Qk', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTU5Njg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.CE0Adrry9UZqF96oakUivblyhTAoRIWURXiSTG4mDzA'}
2025-11-19 07:21:35,059 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-19 07:21:35,059 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-19 07:21:35,059 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:21:35,059 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-19 07:21:35,061 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:21:35,062 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.6ms
2025-11-19 07:22:13,102 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:22:13,103 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:22:13,103 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:22:13,103 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:22:13,103 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:22:13,103 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:22:13,106 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:22:13,106 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:22:13,111 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:22:13,112 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTU1Nzg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.ShLdK7bz9TC5waTWO285f8Zwo3LZGxad9NyuXuCT6Qk', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTU5Njg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.CE0Adrry9UZqF96oakUivblyhTAoRIWURXiSTG4mDzA'}
2025-11-19 07:22:13,112 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-19 07:22:13,112 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-19 07:22:13,112 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:22:13,113 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-19 07:22:13,115 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:22:13,116 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.5ms
2025-11-19 07:22:13,118 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:22:13,119 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:22:13,119 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:22:13,119 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:22:13,119 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:22:13,119 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:22:13,123 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:22:13,123 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:22:13,127 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:22:13,127 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTU1Nzg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.ShLdK7bz9TC5waTWO285f8Zwo3LZGxad9NyuXuCT6Qk', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTU5Njg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.CE0Adrry9UZqF96oakUivblyhTAoRIWURXiSTG4mDzA'}
2025-11-19 07:22:13,127 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-19 07:22:13,128 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-19 07:22:13,128 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:22:13,128 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-19 07:22:13,130 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:22:13,131 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.1ms
2025-11-19 07:22:35,582 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-19 07:22:35,583 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-19 07:22:35,583 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-19 07:22:35,584 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-19 07:22:35,584 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.9ms
2025-11-19 07:22:35,585 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.6ms
2025-11-19 07:22:35,585 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.5ms
2025-11-19 07:22:35,586 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.8ms
2025-11-19 07:22:37,362 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:22:37,363 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:22:37,363 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:22:37,363 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:22:37,364 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:22:37,364 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:22:37,364 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:22:37,364 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:22:37,367 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:22:37,367 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:22:37,373 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:22:37,373 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTU1Nzg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.ShLdK7bz9TC5waTWO285f8Zwo3LZGxad9NyuXuCT6Qk', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTU5Njg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.CE0Adrry9UZqF96oakUivblyhTAoRIWURXiSTG4mDzA'}
2025-11-19 07:22:37,373 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-19 07:22:37,373 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-19 07:22:37,374 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:22:37,374 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-19 07:22:37,375 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:22:37,376 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:22:37,376 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:22:37,376 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:22:37,376 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:22:37,377 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:22:37,379 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:22:37,379 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:22:37,380 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:22:37,380 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:22:37,381 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:22:37,381 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:22:37,381 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:22:37,383 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:22:37,383 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:22:37,388 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:22:37,388 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:22:37,390 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:22:37,393 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-19 07:22:37,393 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-19 07:22:37,394 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:22:37,395 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:22:37,396 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:22:37,396 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:22:37,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:22:37,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:22:37,396 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:22:37,399 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:22:37,399 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:22:37,404 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:22:37,405 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTU1Nzg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.ShLdK7bz9TC5waTWO285f8Zwo3LZGxad9NyuXuCT6Qk', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTU5Njg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.CE0Adrry9UZqF96oakUivblyhTAoRIWURXiSTG4mDzA'}
2025-11-19 07:22:37,405 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-19 07:22:37,405 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-19 07:22:37,405 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:22:37,405 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-19 07:22:37,407 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:22:37,407 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 45.1ms
2025-11-19 07:22:37,407 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 44.8ms
2025-11-19 07:22:37,408 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 44.7ms
2025-11-19 07:22:37,409 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.2ms
2025-11-19 07:22:37,412 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:22:37,413 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:22:37,413 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:22:37,413 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:22:37,414 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:22:37,414 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:22:37,414 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:22:37,414 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:22:37,415 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:22:37,417 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:22:37,417 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:22:37,418 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:22:37,418 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:22:37,418 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:22:37,418 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:22:37,419 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:22:37,421 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:22:37,421 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:22:37,422 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:22:37,422 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:22:37,422 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:22:37,422 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:22:37,422 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:22:37,425 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:22:37,425 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:22:37,430 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:22:37,430 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTU1Nzg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.ShLdK7bz9TC5waTWO285f8Zwo3LZGxad9NyuXuCT6Qk', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTU5Njg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.CE0Adrry9UZqF96oakUivblyhTAoRIWURXiSTG4mDzA'}
2025-11-19 07:22:37,430 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-19 07:22:37,430 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-19 07:22:37,430 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:22:37,431 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-19 07:22:37,432 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:22:37,433 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:22:37,433 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:22:37,433 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:22:37,433 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:22:37,433 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:22:37,436 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:22:37,436 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:22:37,440 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-19 07:22:37,440 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-19 07:22:37,441 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:22:37,444 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:22:37,445 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:22:37,446 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:22:37,449 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:22:37,449 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTU1Nzg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.ShLdK7bz9TC5waTWO285f8Zwo3LZGxad9NyuXuCT6Qk', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTU5Njg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.CE0Adrry9UZqF96oakUivblyhTAoRIWURXiSTG4mDzA'}
2025-11-19 07:22:37,450 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=10, solo_activos=True
2025-11-19 07:22:37,450 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=10
2025-11-19 07:22:37,450 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:22:37,450 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True por usuario: superadmin
2025-11-19 07:22:37,451 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:22:37,453 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 40.6ms
2025-11-19 07:22:37,454 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 40.8ms
2025-11-19 07:22:37,454 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 40.9ms
2025-11-19 07:22:37,454 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 40.9ms
2025-11-19 07:22:37,457 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:22:37,458 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:22:37,458 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:22:37,458 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:22:37,458 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:22:37,459 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:22:37,461 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:22:37,461 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:22:37,465 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:22:37,465 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:22:37,466 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:22:37,467 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.2ms
2025-11-19 07:22:37,469 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:22:37,470 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:22:37,470 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:22:37,471 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:22:37,471 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:22:37,471 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:22:37,474 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:22:37,474 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:22:37,477 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:22:37,478 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:22:37,479 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:22:37,479 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.9ms
2025-11-19 07:23:01,110 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:23:01,110 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:23:01,111 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:23:01,111 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:23:01,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:23:01,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:23:01,111 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:23:01,114 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:23:01,114 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:23:01,114 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:23:01,114 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:23:01,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:23:01,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:23:01,115 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:23:01,118 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:23:01,118 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:23:01,119 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:23:01,123 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:23:01,124 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:23:01,125 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:23:01,129 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:23:01,129 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTU1Nzg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.ShLdK7bz9TC5waTWO285f8Zwo3LZGxad9NyuXuCT6Qk', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTU5Njg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.CE0Adrry9UZqF96oakUivblyhTAoRIWURXiSTG4mDzA'}
2025-11-19 07:23:01,129 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-19 07:23:01,129 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-19 07:23:01,130 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:23:01,130 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-19 07:23:01,131 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:23:01,132 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:23:01,132 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:23:01,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:23:01,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:23:01,132 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:23:01,135 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:23:01,135 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:23:01,139 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-19 07:23:01,139 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-19 07:23:01,140 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:23:01,141 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 31.2ms
2025-11-19 07:23:01,141 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 31.2ms
2025-11-19 07:23:01,143 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 23.9ms
2025-11-19 07:23:01,145 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-19 07:23:01,146 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:23:01,146 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:23:01,146 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:23:01,146 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:23:01,147 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:23:01,147 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:23:01,149 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:23:01,149 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-19 07:23:01,150 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:23:01,150 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:23:01,150 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:23:01,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:23:01,150 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:23:01,151 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:23:01,153 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:23:01,153 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:23:01,156 - app.api.v1.endpoints.clientes - INFO - SOLICITUD RECIBIDA en /clientes/
2025-11-19 07:23:01,156 - app.api.v1.endpoints.clientes - INFO - Headers recibidos: {'host': 'backend.app.local:8000', 'connection': 'keep-alive', 'authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzYzNTU1Nzg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJhY2Nlc3MiLCJhY2Nlc3NfbGV2ZWwiOjUsImlzX3N1cGVyX2FkbWluIjp0cnVlLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiJ9.ShLdK7bz9TC5waTWO285f8Zwo3LZGxad9NyuXuCT6Qk', 'x-client-type': 'web', 'accept': 'application/json, text/plain, */*', 'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', 'origin': 'http://platform.app.local:5173', 'referer': 'http://platform.app.local:5173/', 'accept-encoding': 'gzip, deflate', 'accept-language': 'es-ES,es;q=0.9,en;q=0.8', 'cookie': 'refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdXBlcmFkbWluIiwiY2xpZW50ZV9pZCI6MSwiZXhwIjoxNzY0MTU5Njg3LCJpYXQiOjE3NjM1NTQ4ODcsInR5cGUiOiJyZWZyZXNoIiwiYWNjZXNzX2xldmVsIjo1LCJpc19zdXBlcl9hZG1pbiI6dHJ1ZSwidXNlcl90eXBlIjoic3VwZXJfYWRtaW4ifQ.CE0Adrry9UZqF96oakUivblyhTAoRIWURXiSTG4mDzA'}
2025-11-19 07:23:01,157 - app.api.v1.endpoints.clientes - INFO - Query params: skip=0, limit=100, solo_activos=True
2025-11-19 07:23:01,157 - app.api.v1.endpoints.clientes - INFO - URL completa: http://backend.app.local:8000/api/v1/clientes/?skip=0&limit=100
2025-11-19 07:23:01,157 - app.api.v1.endpoints.clientes - INFO - Usuario: superadmin
2025-11-19 07:23:01,157 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 100, solo_activos: True por usuario: superadmin
2025-11-19 07:23:01,159 - app.api.v1.endpoints.clientes - INFO - Lista de clientes recuperada: 5 clientes
2025-11-19 07:23:01,162 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:23:01,162 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:23:01,163 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:23:01,163 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:23:01,163 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:23:01,164 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:23:01,164 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:23:01,164 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:23:01,166 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:23:01,166 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:23:01,169 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-19 07:23:01,169 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-19 07:23:01,170 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:23:01,171 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 26.2ms
2025-11-19 07:23:01,171 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 25.7ms
2025-11-19 07:23:01,172 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 22.2ms
2025-11-19 07:23:01,174 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:23:01,175 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:23:01,175 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:23:01,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:23:01,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:23:01,175 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:23:01,178 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:23:01,178 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:23:01,181 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:23:01,181 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:23:01,182 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:23:01,183 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.0ms
2025-11-19 07:23:01,185 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-19 07:23:01,185 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 07:23:01,185 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 07:23:01,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 07:23:01,185 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 07:23:01,186 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 07:23:01,188 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 07:23:01,188 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-19 07:23:01,192 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-19 07:23:01,193 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-19 07:23:01,193 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 4 módulos
2025-11-19 07:23:01,194 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.8ms
2025-11-19 07:59:49,048 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'backend', 'assets', 'static', 'admin', 'cdn', 'www', 'api'}
2025-11-19 08:00:44,478 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-19 08:00:44,479 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.9ms
2025-11-19 08:00:44,481 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-19 08:00:44,482 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:00:44,482 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:00:44,482 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:00:44,482 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:00:44,482 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:00:44,556 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:00:44,556 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-19 08:00:44,717 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-19 08:00:44,724 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-19 08:00:44,733 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-19 08:00:44,742 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-19 08:00:44,743 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 3251, Rotación: True
2025-11-19 08:00:44,747 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-19 08:00:44,747 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-19 08:00:44,747 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-19 08:00:44,748 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 3251
2025-11-19 08:00:44,748 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-19 08:00:44,754 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 272.9ms
2025-11-19 08:00:44,760 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-19 08:00:44,760 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.7ms
2025-11-19 08:00:44,762 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-19 08:00:44,763 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:00:44,763 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:00:44,763 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:00:44,763 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:00:44,763 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:00:44,766 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:00:44,766 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-19 08:00:44,770 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-19 08:00:44,770 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-19 08:00:44,770 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-19 08:00:44,787 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-19 08:00:44,787 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-19 08:00:44,788 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 25.5ms
2025-11-19 08:09:34,406 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-19 08:09:34,406 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:09:34,407 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:09:34,407 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:09:34,407 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:09:34,407 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:09:34,409 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:09:34,410 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-19 08:09:34,427 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-19 08:09:34,428 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-19 08:09:34,429 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-19 08:09:34,431 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-19 08:09:34,431 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 3252, Rotación: True
2025-11-19 08:09:34,432 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-19 08:09:34,432 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-19 08:09:34,432 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-19 08:09:34,433 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 3252
2025-11-19 08:09:34,433 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-19 08:09:34,433 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 27.5ms
2025-11-19 08:09:34,442 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-19 08:09:34,442 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:09:34,443 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:09:34,443 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:09:34,443 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:09:34,443 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:09:34,446 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:09:34,446 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-19 08:09:34,447 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-19 08:09:34,447 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-19 08:09:34,448 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-19 08:09:34,450 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-19 08:09:34,450 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-19 08:09:34,451 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.8ms
2025-11-19 08:09:41,248 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-19 08:09:41,248 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:09:41,248 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:09:41,249 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:09:41,249 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:09:41,249 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:09:41,252 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:09:41,252 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-19 08:09:41,255 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-19 08:09:41,256 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-19 08:09:41,257 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-19 08:09:41,260 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-19 08:09:41,261 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 3253, Rotación: True
2025-11-19 08:09:41,262 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-19 08:09:41,263 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-19 08:09:41,263 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-19 08:09:41,264 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 3253
2025-11-19 08:09:41,264 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-19 08:09:41,264 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.7ms
2025-11-19 08:09:41,269 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-19 08:09:41,269 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:09:41,269 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:09:41,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:09:41,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:09:41,270 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:09:41,273 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:09:41,273 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-19 08:09:41,274 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-19 08:09:41,275 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-19 08:09:41,275 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-19 08:09:41,277 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-19 08:09:41,277 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-19 08:09:41,277 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 8.6ms
2025-11-19 08:09:46,240 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-19 08:09:46,241 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:09:46,241 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:09:46,241 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:09:46,241 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:09:46,241 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:09:46,244 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:09:46,244 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-19 08:09:46,247 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-19 08:09:46,249 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-19 08:09:46,250 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-19 08:09:46,253 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-19 08:09:46,254 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 3254, Rotación: True
2025-11-19 08:09:46,255 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-19 08:09:46,256 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-19 08:09:46,256 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-19 08:09:46,256 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 3254
2025-11-19 08:09:46,256 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-19 08:09:46,257 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 16.8ms
2025-11-19 08:09:46,262 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-19 08:09:46,262 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:09:46,262 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:09:46,262 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:09:46,263 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:09:46,263 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:09:46,265 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:09:46,266 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-19 08:09:46,268 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-19 08:09:46,268 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-19 08:09:46,268 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-19 08:09:46,271 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-19 08:09:46,271 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-19 08:09:46,272 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 10.3ms
2025-11-19 08:45:58,610 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-19 08:45:58,611 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.8ms
2025-11-19 08:45:58,613 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-19 08:45:58,613 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:45:58,613 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:45:58,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:45:58,613 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:45:58,614 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:45:58,616 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:45:58,616 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-19 08:45:58,635 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-19 08:45:58,635 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-19 08:45:58,635 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-19 08:45:58,872 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-19 08:45:58,873 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-19 08:45:58,873 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-19 08:45:58,874 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-19 08:45:58,875 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-19 08:45:58,875 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 3255, Rotación: False
2025-11-19 08:45:58,875 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 3255
2025-11-19 08:45:58,876 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-19 08:45:58,876 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 263.6ms
2025-11-19 08:45:58,907 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-19 08:45:58,909 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-19 08:45:58,910 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-19 08:45:58,910 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.9ms
2025-11-19 08:45:58,911 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.1ms
2025-11-19 08:45:58,912 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.0ms
2025-11-19 08:45:58,914 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-19 08:45:58,916 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-19 08:45:58,916 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-19 08:45:58,917 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.9ms
2025-11-19 08:45:58,917 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-19 08:45:58,918 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.2ms
2025-11-19 08:45:58,918 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.1ms
2025-11-19 08:45:58,919 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:45:58,919 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:45:58,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:45:58,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:45:58,919 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:45:58,922 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:45:58,922 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-19 08:45:58,938 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-19 08:45:58,938 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-19 08:45:58,977 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-19 08:45:58,978 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-19 08:45:58,979 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-19 08:45:58,979 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:45:58,980 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:45:58,980 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:45:58,980 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:45:58,980 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:45:58,983 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:45:58,983 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-19 08:45:58,984 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:45:58,984 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:45:58,984 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:45:58,984 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:45:58,984 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:45:58,987 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:45:58,987 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-19 08:45:58,997 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-19 08:45:58,999 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-19 08:45:58,999 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-19 08:45:59,004 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-19 08:45:59,004 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-19 08:45:59,014 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-19 08:45:59,014 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-19 08:45:59,015 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 97.8ms
2025-11-19 08:45:59,016 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 37.6ms
2025-11-19 08:45:59,016 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 37.5ms
2025-11-19 08:45:59,018 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-19 08:45:59,019 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:45:59,019 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:45:59,019 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:45:59,019 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:45:59,020 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:45:59,022 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:45:59,022 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-19 08:45:59,027 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-19 08:45:59,027 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-19 08:45:59,028 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-19 08:45:59,029 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-19 08:45:59,029 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-19 08:45:59,030 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:45:59,030 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:45:59,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:45:59,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:45:59,031 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:45:59,034 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:45:59,034 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/usuarios/
2025-11-19 08:45:59,034 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:45:59,034 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-19 08:45:59,034 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-19 08:45:59,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-19 08:45:59,035 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-19 08:45:59,037 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-19 08:45:59,038 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/roles/all-active/
2025-11-19 08:45:59,043 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 1 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-19 08:45:59,043 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 1: page=1, limit=10, search='None'
2025-11-19 08:45:59,047 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-19 08:45:59,047 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 1 - Total: 1, Página: 1
2025-11-19 08:45:59,051 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 1 para lista simple
2025-11-19 08:45:59,052 - app.services.rol_service - INFO - Se encontraron 0 roles activos para cliente 1
2025-11-19 08:45:59,052 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 1 - Total: 0
2025-11-19 08:45:59,052 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 33.8ms
2025-11-19 08:45:59,053 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.2ms
2025-11-19 08:45:59,054 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 24.5ms
2025-11-19 08:49:34,906 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-19 08:49:34,906 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.4ms
2025-11-19 08:49:34,908 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-19 08:49:34,908 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-19 08:49:34,908 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
